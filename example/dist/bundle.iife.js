!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VWM=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t={exports:{}},n={},i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var a=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,a,l=s(e),c=1;c<arguments.length;c++){for(var u in n=Object(arguments[c]))r.call(n,u)&&(l[u]=n[u]);if(i){a=i(n);for(var h=0;h<a.length;h++)o.call(n,a[h])&&(l[a[h]]=n[a[h]])}}return l};
/** @license React v17.0.2
	 * react.development.js
	 *
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */!function(e){!function(){var t=a,n=60103,i=60106;e.Fragment=60107,e.StrictMode=60108,e.Profiler=60114;var r=60109,o=60110,s=60112;e.Suspense=60113;var l=60120,c=60115,u=60116,h=60121,d=60122,f=60117,p=60129,A=60131;if("function"==typeof Symbol&&Symbol.for){var m=Symbol.for;n=m("react.element"),i=m("react.portal"),e.Fragment=m("react.fragment"),e.StrictMode=m("react.strict_mode"),e.Profiler=m("react.profiler"),r=m("react.provider"),o=m("react.context"),s=m("react.forward_ref"),e.Suspense=m("react.suspense"),l=m("react.suspense_list"),c=m("react.memo"),u=m("react.lazy"),h=m("react.block"),d=m("react.server.block"),f=m("react.fundamental"),m("react.scope"),m("react.opaque.id"),p=m("react.debug_trace_mode"),m("react.offscreen"),A=m("react.legacy_hidden")}var g="function"==typeof Symbol&&Symbol.iterator;function y(e){if(null===e||"object"!=typeof e)return null;var t=g&&e[g]||e["@@iterator"];return"function"==typeof t?t:null}var _={current:null},v={current:null},b={},x=null;function w(e){x=e}b.setExtraStackFrame=function(e){x=e},b.getCurrentStack=null,b.getStackAddendum=function(){var e="";x&&(e+=x);var t=b.getCurrentStack;return t&&(e+=t()||""),e};var E={ReactCurrentDispatcher:_,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:v,IsSomeRendererActing:{current:!1},assign:t};function S(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];k("warn",e,n)}function T(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];k("error",e,n)}function k(e,t,n){var i=E.ReactDebugCurrentFrame.getStackAddendum();""!==i&&(t+="%s",n=n.concat([i]));var r=n.map((function(e){return""+e}));r.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,r)}E.ReactDebugCurrentFrame=b;var C={};function P(e,t){var n=e.constructor,i=n&&(n.displayName||n.name)||"ReactClass",r=i+"."+t;C[r]||(T("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",t,i),C[r]=!0)}var M={isMounted:function(e){return!1},enqueueForceUpdate:function(e,t,n){P(e,"forceUpdate")},enqueueReplaceState:function(e,t,n,i){P(e,"replaceState")},enqueueSetState:function(e,t,n,i){P(e,"setState")}},I={};function L(e,t,n){this.props=e,this.context=t,this.refs=I,this.updater=n||M}Object.freeze(I),L.prototype.isReactComponent={},L.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},L.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};var R={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},z=function(e,t){Object.defineProperty(L.prototype,e,{get:function(){S("%s(...) is deprecated in plain JavaScript React classes. %s",t[0],t[1])}})};for(var D in R)R.hasOwnProperty(D)&&z(D,R[D]);function O(){}function B(e,t,n){this.props=e,this.context=t,this.refs=I,this.updater=n||M}O.prototype=L.prototype;var F=B.prototype=new O;function N(e){return e.displayName||"Context"}function U(t){if(null==t)return null;if("number"==typeof t.tag&&T("Received an unexpected object in getComponentName(). This is likely a bug in React. Please file an issue."),"function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case e.Fragment:return"Fragment";case i:return"Portal";case e.Profiler:return"Profiler";case e.StrictMode:return"StrictMode";case e.Suspense:return"Suspense";case l:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case o:return N(t)+".Consumer";case r:return N(t._context)+".Provider";case s:return f=t,p=t.render,A="ForwardRef",m=p.displayName||p.name||"",f.displayName||(""!==m?A+"("+m+")":A);case c:return U(t.type);case h:return U(t._render);case u:var n=t,a=n._payload,d=n._init;try{return U(d(a))}catch(e){return null}}var f,p,A,m;return null}F.constructor=B,t(F,L.prototype),F.isPureReactComponent=!0;var j,V,G,W=Object.prototype.hasOwnProperty,$={key:!0,ref:!0,__self:!0,__source:!0};function q(e){if(W.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}function Z(e){if(W.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}function H(e,t){var n=function(){j||(j=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"key",{get:n,configurable:!0})}function Q(e,t){var n=function(){V||(V=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"ref",{get:n,configurable:!0})}function X(e){if("string"==typeof e.ref&&v.current&&e.__self&&v.current.stateNode!==e.__self){var t=U(v.current.type);G[t]||(T('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',t,e.ref),G[t]=!0)}}G={};var Y=function(e,t,i,r,o,s,a){var l={$$typeof:n,type:e,key:t,ref:i,props:a,_owner:s,_store:{}};return Object.defineProperty(l._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(l,"_self",{configurable:!1,enumerable:!1,writable:!1,value:r}),Object.defineProperty(l,"_source",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.freeze&&(Object.freeze(l.props),Object.freeze(l)),l};function K(e,t,n){var i,r={},o=null,s=null,a=null,l=null;if(null!=t)for(i in q(t)&&(s=t.ref,X(t)),Z(t)&&(o=""+t.key),a=void 0===t.__self?null:t.__self,l=void 0===t.__source?null:t.__source,t)W.call(t,i)&&!$.hasOwnProperty(i)&&(r[i]=t[i]);var c=arguments.length-2;if(1===c)r.children=n;else if(c>1){for(var u=Array(c),h=0;h<c;h++)u[h]=arguments[h+2];Object.freeze&&Object.freeze(u),r.children=u}if(e&&e.defaultProps){var d=e.defaultProps;for(i in d)void 0===r[i]&&(r[i]=d[i])}if(o||s){var f="function"==typeof e?e.displayName||e.name||"Unknown":e;o&&H(r,f),s&&Q(r,f)}return Y(e,o,s,a,l,v.current,r)}function J(e,n,i){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r,o,s=t({},e.props),a=e.key,l=e.ref,c=e._self,u=e._source,h=e._owner;if(null!=n)for(r in q(n)&&(l=n.ref,h=v.current),Z(n)&&(a=""+n.key),e.type&&e.type.defaultProps&&(o=e.type.defaultProps),n)W.call(n,r)&&!$.hasOwnProperty(r)&&(void 0===n[r]&&void 0!==o?s[r]=o[r]:s[r]=n[r]);var d=arguments.length-2;if(1===d)s.children=i;else if(d>1){for(var f=Array(d),p=0;p<d;p++)f[p]=arguments[p+2];s.children=f}return Y(e.type,a,l,c,u,h,s)}function ee(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var te=!1,ne=/\/+/g;function ie(e){return e.replace(ne,"$&/")}function re(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,i={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,(function(e){return i[e]}))):t.toString(36);var n,i}function oe(e,t,r,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l,c,u,h=!1;if(null===e)h=!0;else switch(a){case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case n:case i:h=!0}}if(h){var d=e,f=s(d),p=""===o?"."+re(d,0):o;if(Array.isArray(f)){var A="";null!=p&&(A=ie(p)+"/"),oe(f,t,A,"",(function(e){return e}))}else null!=f&&(ee(f)&&(l=f,c=r+(!f.key||d&&d.key===f.key?"":ie(""+f.key)+"/")+p,f=Y(l.type,c,l.ref,l._self,l._source,l._owner,l.props)),t.push(f));return 1}var m=0,g=""===o?".":o+":";if(Array.isArray(e))for(var _=0;_<e.length;_++)m+=oe(u=e[_],t,r,g+re(u,_),s);else{var v=y(e);if("function"==typeof v){var b=e;v===b.entries&&(te||S("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),te=!0);for(var x,w=v.call(b),E=0;!(x=w.next()).done;)m+=oe(u=x.value,t,r,g+re(u,E++),s)}else if("object"===a){var T=""+e;throw Error("Objects are not valid as a React child (found: "+("[object Object]"===T?"object with keys {"+Object.keys(e).join(", ")+"}":T)+"). If you meant to render a collection of children, use an array instead.")}}return m}function se(e,t,n){if(null==e)return e;var i=[],r=0;return oe(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function ae(e){if(-1===e._status){var t=(0,e._result)(),n=e;n._status=0,n._result=t,t.then((function(t){if(0===e._status){var n=t.default;void 0===n&&T("lazy: Expected the result of a dynamic import() call. Instead received: %s\n\nYour code should look like: \n  const MyComponent = lazy(() => import('./MyComponent'))",t);var i=e;i._status=1,i._result=n}}),(function(t){if(0===e._status){var n=e;n._status=2,n._result=t}}))}if(1===e._status)return e._result;throw e._result}function le(t){return"string"==typeof t||"function"==typeof t||(t===e.Fragment||t===e.Profiler||t===p||t===e.StrictMode||t===e.Suspense||t===l||t===A||"object"==typeof t&&null!==t&&(t.$$typeof===u||t.$$typeof===c||t.$$typeof===r||t.$$typeof===o||t.$$typeof===s||t.$$typeof===f||t.$$typeof===h||t[0]===d))}function ce(){var e=_.current;if(null===e)throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.");return e}var ue,he,de,fe,pe,Ae,me,ge=0;function ye(){}ye.__reactDisabledLog=!0;var _e,ve=E.ReactCurrentDispatcher;function be(e,t,n){if(void 0===_e)try{throw Error()}catch(e){var i=e.stack.trim().match(/\n( *(at )?)/);_e=i&&i[1]||""}return"\n"+_e+e}var xe,we=!1,Ee="function"==typeof WeakMap?WeakMap:Map;function Se(e,n){if(!e||we)return"";var i,r=xe.get(e);if(void 0!==r)return r;we=!0;var o,s=Error.prepareStackTrace;Error.prepareStackTrace=void 0,o=ve.current,ve.current=null,function(){if(0===ge){ue=console.log,he=console.info,de=console.warn,fe=console.error,pe=console.group,Ae=console.groupCollapsed,me=console.groupEnd;var e={configurable:!0,enumerable:!0,value:ye,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}ge++}();try{if(n){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(e){i=e}Reflect.construct(e,[],a)}else{try{a.call()}catch(e){i=e}e.call(a.prototype)}}else{try{throw Error()}catch(e){i=e}e()}}catch(t){if(t&&i&&"string"==typeof t.stack){for(var l=t.stack.split("\n"),c=i.stack.split("\n"),u=l.length-1,h=c.length-1;u>=1&&h>=0&&l[u]!==c[h];)h--;for(;u>=1&&h>=0;u--,h--)if(l[u]!==c[h]){if(1!==u||1!==h)do{if(u--,--h<0||l[u]!==c[h]){var d="\n"+l[u].replace(" at new "," at ");return"function"==typeof e&&xe.set(e,d),d}}while(u>=1&&h>=0);break}}}finally{we=!1,ve.current=o,function(){if(0==--ge){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:t({},e,{value:ue}),info:t({},e,{value:he}),warn:t({},e,{value:de}),error:t({},e,{value:fe}),group:t({},e,{value:pe}),groupCollapsed:t({},e,{value:Ae}),groupEnd:t({},e,{value:me})})}ge<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=s}var f=e?e.displayName||e.name:"",p=f?be(f):"";return"function"==typeof e&&xe.set(e,p),p}function Te(e,t,n){return Se(e,!1)}function ke(t,n,i){if(null==t)return"";if("function"==typeof t)return Se(t,function(e){var t=e.prototype;return!(!t||!t.isReactComponent)}(t));if("string"==typeof t)return be(t);switch(t){case e.Suspense:return be("Suspense");case l:return be("SuspenseList")}if("object"==typeof t)switch(t.$$typeof){case s:return Te(t.render);case c:return ke(t.type,n,i);case h:return Te(t._render);case u:var r=t,o=r._payload,a=r._init;try{return ke(a(o),n,i)}catch(e){}}return""}xe=new Ee;var Ce,Pe={},Me=E.ReactDebugCurrentFrame;function Ie(e){if(e){var t=e._owner,n=ke(e.type,e._source,t?t.type:null);Me.setExtraStackFrame(n)}else Me.setExtraStackFrame(null)}function Le(e){if(e){var t=e._owner;w(ke(e.type,e._source,t?t.type:null))}else w(null)}function Re(){if(v.current){var e=U(v.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}function ze(e){return null!=e&&void 0!==(t=e.__source)?"\n\nCheck your code at "+t.fileName.replace(/^.*[\\\/]/,"")+":"+t.lineNumber+".":"";var t}Ce=!1;var De={};function Oe(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var n=function(e){var t=Re();if(!t){var n="string"==typeof e?e:e.displayName||e.name;n&&(t="\n\nCheck the top-level render call using <"+n+">.")}return t}(t);if(!De[n]){De[n]=!0;var i="";e&&e._owner&&e._owner!==v.current&&(i=" It was passed a child from "+U(e._owner.type)+"."),Le(e),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',n,i),Le(null)}}}function Be(e,t){if("object"==typeof e)if(Array.isArray(e))for(var n=0;n<e.length;n++){var i=e[n];ee(i)&&Oe(i,t)}else if(ee(e))e._store&&(e._store.validated=!0);else if(e){var r=y(e);if("function"==typeof r&&r!==e.entries)for(var o,s=r.call(e);!(o=s.next()).done;)ee(o.value)&&Oe(o.value,t)}}function Fe(e){var t,n=e.type;if(null!=n&&"string"!=typeof n){if("function"==typeof n)t=n.propTypes;else{if("object"!=typeof n||n.$$typeof!==s&&n.$$typeof!==c)return;t=n.propTypes}if(t){var i=U(n);!function(e,t,n,i,r){var o=Function.call.bind(Object.prototype.hasOwnProperty);for(var s in e)if(o(e,s)){var a=void 0;try{if("function"!=typeof e[s]){var l=Error((i||"React class")+": "+n+" type `"+s+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[s]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw l.name="Invariant Violation",l}a=e[s](t,s,i,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){a=e}!a||a instanceof Error||(Ie(r),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",i||"React class",n,s,typeof a),Ie(null)),a instanceof Error&&!(a.message in Pe)&&(Pe[a.message]=!0,Ie(r),T("Failed %s type: %s",n,a.message),Ie(null))}}(t,e.props,"prop",i,e)}else if(void 0!==n.PropTypes&&!Ce){Ce=!0,T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",U(n)||"Unknown")}"function"!=typeof n.getDefaultProps||n.getDefaultProps.isReactClassApproved||T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Ne(e){for(var t=Object.keys(e.props),n=0;n<t.length;n++){var i=t[n];if("children"!==i&&"key"!==i){Le(e),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",i),Le(null);break}}null!==e.ref&&(Le(e),T("Invalid attribute `ref` supplied to `React.Fragment`."),Le(null))}function Ue(t,i,r){var o=le(t);if(!o){var s="";(void 0===t||"object"==typeof t&&null!==t&&0===Object.keys(t).length)&&(s+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var a,l=ze(i);s+=l||Re(),null===t?a="null":Array.isArray(t)?a="array":void 0!==t&&t.$$typeof===n?(a="<"+(U(t.type)||"Unknown")+" />",s=" Did you accidentally export a JSX literal instead of a component?"):a=typeof t,T("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",a,s)}var c=K.apply(this,arguments);if(null==c)return c;if(o)for(var u=2;u<arguments.length;u++)Be(arguments[u],t);return t===e.Fragment?Ne(c):Fe(c),c}var je=!1;try{var Ve=Object.freeze({});new Map([[Ve,null]]),new Set([Ve])}catch(e){}var Ge=Ue,We=function(e,t,n){for(var i=J.apply(this,arguments),r=2;r<arguments.length;r++)Be(arguments[r],i.type);return Fe(i),i},$e=function(e){var t=Ue.bind(null,e);return t.type=e,je||(je=!0,S("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(t,"type",{enumerable:!1,get:function(){return S("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:e}),e}}),t},qe={map:se,forEach:function(e,t,n){se(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return se(e,(function(){t++})),t},toArray:function(e){return se(e,(function(e){return e}))||[]},only:function(e){if(!ee(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};e.Children=qe,e.Component=L,e.PureComponent=B,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=E,e.cloneElement=We,e.createContext=function(e,t){void 0===t?t=null:null!==t&&"function"!=typeof t&&T("createContext: Expected the optional second argument to be a function. Instead received: %s",t);var n={$$typeof:o,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null};n.Provider={$$typeof:r,_context:n};var i=!1,s=!1,a=!1,l={$$typeof:o,_context:n,_calculateChangedBits:n._calculateChangedBits};return Object.defineProperties(l,{Provider:{get:function(){return s||(s=!0,T("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),n.Provider},set:function(e){n.Provider=e}},_currentValue:{get:function(){return n._currentValue},set:function(e){n._currentValue=e}},_currentValue2:{get:function(){return n._currentValue2},set:function(e){n._currentValue2=e}},_threadCount:{get:function(){return n._threadCount},set:function(e){n._threadCount=e}},Consumer:{get:function(){return i||(i=!0,T("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),n.Consumer}},displayName:{get:function(){return n.displayName},set:function(e){a||(S("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",e),a=!0)}}}),n.Consumer=l,n._currentRenderer=null,n._currentRenderer2=null,n},e.createElement=Ge,e.createFactory=$e,e.createRef=function(){var e={current:null};return Object.seal(e),e},e.forwardRef=function(e){null!=e&&e.$$typeof===c?T("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):"function"!=typeof e?T("forwardRef requires a render function but was given %s.",null===e?"null":typeof e):0!==e.length&&2!==e.length&&T("forwardRef render functions accept exactly two parameters: props and ref. %s",1===e.length?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),null!=e&&(null==e.defaultProps&&null==e.propTypes||T("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?"));var t,n={$$typeof:s,render:e};return Object.defineProperty(n,"displayName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(n){t=n,null==e.displayName&&(e.displayName=n)}}),n},e.isValidElement=ee,e.lazy=function(e){var t,n,i={$$typeof:u,_payload:{_status:-1,_result:e},_init:ae};return Object.defineProperties(i,{defaultProps:{configurable:!0,get:function(){return t},set:function(e){T("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),t=e,Object.defineProperty(i,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return n},set:function(e){T("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),n=e,Object.defineProperty(i,"propTypes",{enumerable:!0})}}}),i},e.memo=function(e,t){le(e)||T("memo: The first argument must be a component. Instead received: %s",null===e?"null":typeof e);var n,i={$$typeof:c,type:e,compare:void 0===t?null:t};return Object.defineProperty(i,"displayName",{enumerable:!1,configurable:!0,get:function(){return n},set:function(t){n=t,null==e.displayName&&(e.displayName=t)}}),i},e.useCallback=function(e,t){return ce().useCallback(e,t)},e.useContext=function(e,t){var n=ce();if(void 0!==t&&T("useContext() second argument is reserved for future use in React. Passing it is not supported. You passed: %s.%s",t,"number"==typeof t&&Array.isArray(arguments[2])?"\n\nDid you call array.map(useContext)? Calling Hooks inside a loop is not supported. Learn more at https://reactjs.org/link/rules-of-hooks":""),void 0!==e._context){var i=e._context;i.Consumer===e?T("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):i.Provider===e&&T("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return n.useContext(e,t)},e.useDebugValue=function(e,t){return ce().useDebugValue(e,t)},e.useEffect=function(e,t){return ce().useEffect(e,t)},e.useImperativeHandle=function(e,t,n){return ce().useImperativeHandle(e,t,n)},e.useLayoutEffect=function(e,t){return ce().useLayoutEffect(e,t)},e.useMemo=function(e,t){return ce().useMemo(e,t)},e.useReducer=function(e,t,n){return ce().useReducer(e,t,n)},e.useRef=function(e){return ce().useRef(e)},e.useState=function(e){return ce().useState(e)},e.version="17.0.2"}()}(n),t.exports=n;var l=t.exports,c={exports:{}},u={},h={exports:{}},d={};
/** @license React v0.20.2
	 * scheduler.development.js
	 *
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */
!function(e){!function(){var t,n,i,r;if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();e.unstable_now=function(){return s.now()-a}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var l=null,c=null,u=function(){if(null!==l)try{var t=e.unstable_now();l(!0,t),l=null}catch(e){throw setTimeout(u,0),e}};t=function(e){null!==l?setTimeout(t,0,e):(l=e,setTimeout(u,0))},n=function(e,t){c=setTimeout(e,t)},i=function(){clearTimeout(c)},e.unstable_shouldYield=function(){return!1},r=e.unstable_forceFrameRate=function(){}}else{var h=window.setTimeout,d=window.clearTimeout;if("undefined"!=typeof console){var f=window.requestAnimationFrame,p=window.cancelAnimationFrame;"function"!=typeof f&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof p&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var A=!1,m=null,g=-1,y=5,_=0;e.unstable_shouldYield=function(){return e.unstable_now()>=_},r=function(){},e.unstable_forceFrameRate=function(e){e<0||e>125?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):y=e>0?Math.floor(1e3/e):5};var v=new MessageChannel,b=v.port2;v.port1.onmessage=function(){if(null!==m){var t=e.unstable_now();_=t+y;try{m(!0,t)?b.postMessage(null):(A=!1,m=null)}catch(e){throw b.postMessage(null),e}}else A=!1},t=function(e){m=e,A||(A=!0,b.postMessage(null))},n=function(t,n){g=h((function(){t(e.unstable_now())}),n)},i=function(){d(g),g=-1}}function x(e,t){var n=e.length;e.push(t),function(e,t,n){var i=n;for(;;){var r=i-1>>>1,o=e[r];if(!(void 0!==o&&S(o,t)>0))return;e[r]=t,e[i]=o,i=r}}(e,t,n)}function w(e){var t=e[0];return void 0===t?null:t}function E(e){var t=e[0];if(void 0!==t){var n=e.pop();return n!==t&&(e[0]=n,function(e,t,n){var i=n,r=e.length;for(;i<r;){var o=2*(i+1)-1,s=e[o],a=o+1,l=e[a];if(void 0!==s&&S(s,t)<0)void 0!==l&&S(l,s)<0?(e[i]=l,e[a]=t,i=a):(e[i]=s,e[o]=t,i=o);else{if(!(void 0!==l&&S(l,t)<0))return;e[i]=l,e[a]=t,i=a}}}(e,n,0)),t}return null}function S(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var T=[],k=[],C=1,P=null,M=3,I=!1,L=!1,R=!1;function z(e){for(var t=w(k);null!==t;){if(null===t.callback)E(k);else{if(!(t.startTime<=e))return;E(k),t.sortIndex=t.expirationTime,x(T,t)}t=w(k)}}function D(e){if(R=!1,z(e),!L)if(null!==w(T))L=!0,t(O);else{var i=w(k);null!==i&&n(D,i.startTime-e)}}function O(t,r){L=!1,R&&(R=!1,i()),I=!0;var o=M;try{return function(t,i){var r=i;z(r),P=w(T);for(;null!==P&&(!(P.expirationTime>r)||t&&!e.unstable_shouldYield());){var o=P.callback;if("function"==typeof o){P.callback=null,M=P.priorityLevel;var s=o(P.expirationTime<=r);r=e.unstable_now(),"function"==typeof s?P.callback=s:P===w(T)&&E(T),z(r)}else E(T);P=w(T)}if(null!==P)return!0;var a=w(k);return null!==a&&n(D,a.startTime-r),!1}(t,r)}finally{P=null,M=o,I=!1}}var B=r;e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){L||I||(L=!0,t(O))},e.unstable_getCurrentPriorityLevel=function(){return M},e.unstable_getFirstCallbackNode=function(){return w(T)},e.unstable_next=function(e){var t;switch(M){case 1:case 2:case 3:t=3;break;default:t=M}var n=M;M=t;try{return e()}finally{M=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=B,e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=M;M=e;try{return t()}finally{M=n}},e.unstable_scheduleCallback=function(r,o,s){var a,l,c=e.unstable_now();if("object"==typeof s&&null!==s){var u=s.delay;a="number"==typeof u&&u>0?c+u:c}else a=c;switch(r){case 1:l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}var h=a+l,d={id:C++,callback:o,priorityLevel:r,startTime:a,expirationTime:h,sortIndex:-1};return a>c?(d.sortIndex=a,x(k,d),null===w(T)&&d===w(k)&&(R?i():R=!0,n(D,a-c))):(d.sortIndex=h,x(T,d),L||I||(L=!0,t(O))),d},e.unstable_wrapCallback=function(e){var t=M;return function(){var n=M;M=t;try{return e.apply(this,arguments)}finally{M=n}}}}()}(d),h.exports=d;var f={exports:{}},p={};
/** @license React v0.20.2
	 * scheduler-tracing.development.js
	 *
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */
!function(e){!function(){var t=0,n=0;e.__interactionsRef=null,e.__subscriberRef=null,e.__interactionsRef={current:new Set},e.__subscriberRef={current:null};var i=null;function r(e){var t=!1,n=null;if(i.forEach((function(i){try{i.onInteractionTraced(e)}catch(e){t||(t=!0,n=e)}})),t)throw n}function o(e){var t=!1,n=null;if(i.forEach((function(i){try{i.onInteractionScheduledWorkCompleted(e)}catch(e){t||(t=!0,n=e)}})),t)throw n}function s(e,t){var n=!1,r=null;if(i.forEach((function(i){try{i.onWorkScheduled(e,t)}catch(e){n||(n=!0,r=e)}})),n)throw r}function a(e,t){var n=!1,r=null;if(i.forEach((function(i){try{i.onWorkStarted(e,t)}catch(e){n||(n=!0,r=e)}})),n)throw r}function l(e,t){var n=!1,r=null;if(i.forEach((function(i){try{i.onWorkStopped(e,t)}catch(e){n||(n=!0,r=e)}})),n)throw r}function c(e,t){var n=!1,r=null;if(i.forEach((function(i){try{i.onWorkCanceled(e,t)}catch(e){n||(n=!0,r=e)}})),n)throw r}i=new Set,e.unstable_clear=function(t){var n=e.__interactionsRef.current;e.__interactionsRef.current=new Set;try{return t()}finally{e.__interactionsRef.current=n}},e.unstable_getCurrent=function(){return e.__interactionsRef.current},e.unstable_getThreadID=function(){return++n},e.unstable_subscribe=function(t){i.add(t),1===i.size&&(e.__subscriberRef.current={onInteractionScheduledWorkCompleted:o,onInteractionTraced:r,onWorkCanceled:c,onWorkScheduled:s,onWorkStarted:a,onWorkStopped:l})},e.unstable_trace=function(n,i,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s={__count:1,id:t++,name:n,timestamp:i},a=e.__interactionsRef.current,l=new Set(a);l.add(s),e.__interactionsRef.current=l;var c,u=e.__subscriberRef.current;try{null!==u&&u.onInteractionTraced(s)}finally{try{null!==u&&u.onWorkStarted(l,o)}finally{try{c=r()}finally{e.__interactionsRef.current=a;try{null!==u&&u.onWorkStopped(l,o)}finally{s.__count--,null!==u&&0===s.__count&&u.onInteractionScheduledWorkCompleted(s)}}}}return c},e.unstable_unsubscribe=function(t){i.delete(t),0===i.size&&(e.__subscriberRef.current=null)},e.unstable_wrap=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.__interactionsRef.current,r=e.__subscriberRef.current;null!==r&&r.onWorkScheduled(i,n),i.forEach((function(e){e.__count++}));var o=!1;function s(){var s=e.__interactionsRef.current;e.__interactionsRef.current=i,r=e.__subscriberRef.current;try{var a;try{null!==r&&r.onWorkStarted(i,n)}finally{try{a=t.apply(void 0,arguments)}finally{e.__interactionsRef.current=s,null!==r&&r.onWorkStopped(i,n)}}return a}finally{o||(o=!0,i.forEach((function(e){e.__count--,null!==r&&0===e.__count&&r.onInteractionScheduledWorkCompleted(e)})))}}return s.cancel=function(){r=e.__subscriberRef.current;try{null!==r&&r.onWorkCanceled(i,n)}finally{i.forEach((function(e){e.__count--,r&&0===e.__count&&r.onInteractionScheduledWorkCompleted(e)}))}},s}}()}(p),f.exports=p,function(){var e=t.exports,n=a,i=h.exports,r=f.exports,o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function s(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];c("warn",e,n)}function l(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];c("error",e,n)}function c(e,t,n){var i=o.ReactDebugCurrentFrame.getStackAddendum();""!==i&&(t+="%s",n=n.concat([i]));var r=n.map((function(e){return""+e}));r.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,r)}if(!e)throw Error("ReactDOM was loaded before React. Make sure you load the React package before loading ReactDOM.");var d=10,p=11,A=12,m=13,g=14,y=15,_=17,v=19,b=20,x=22,w=23,E=24,S=!1,T=new Set,k={},C={};function P(e,t){M(e,t),M(e+"Capture",t)}function M(e,t){k[e]&&l("EventRegistry: More than one plugin attempted to publish the same registration name, `%s`.",e),k[e]=t;var n=e.toLowerCase();C[n]=e,"onDoubleClick"===e&&(C.ondblclick=e);for(var i=0;i<t.length;i++)T.add(t[i])}var I=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),L=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",R=L+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",z="data-reactroot",D=new RegExp("^["+L+"]["+R+"]*$"),O=Object.prototype.hasOwnProperty,B={},F={};function N(e){return!!O.call(F,e)||!O.call(B,e)&&(D.test(e)?(F[e]=!0,!0):(B[e]=!0,l("Invalid attribute name: `%s`",e),!1))}function U(e,t,n){return null!==t?0===t.type:!n&&(e.length>2&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1]))}function j(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":if(i)return!1;if(null!==n)return!n.acceptsBooleans;var r=e.toLowerCase().slice(0,5);return"data-"!==r&&"aria-"!==r;default:return!1}}function V(e,t,n,i){if(null==t)return!0;if(j(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||t<1}return!1}function G(e){return $.hasOwnProperty(e)?$[e]:null}function W(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var $={};["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"].forEach((function(e){$[e]=new W(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0],n=e[1];$[t]=new W(t,1,!1,n,null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){$[e]=new W(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){$[e]=new W(e,2,!1,e,null,!1,!1)})),["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","disableRemotePlayback","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach((function(e){$[e]=new W(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){$[e]=new W(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){$[e]=new W(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){$[e]=new W(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){$[e]=new W(e,5,!1,e.toLowerCase(),null,!1,!1)}));var q=/[\-\:]([a-z])/g,Z=function(e){return e[1].toUpperCase()};["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach((function(e){var t=e.replace(q,Z);$[t]=new W(t,1,!1,e,null,!1,!1)})),["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach((function(e){var t=e.replace(q,Z);$[t]=new W(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(q,Z);$[t]=new W(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){$[e]=new W(e,1,!1,e.toLowerCase(),null,!1,!1)}));$.xlinkHref=new W("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){$[e]=new W(e,1,!1,e.toLowerCase(),null,!0,!0)}));var H=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,Q=!1;function X(e){!Q&&H.test(e)&&(Q=!0,l("A future version of React will block javascript: URLs as a security precaution. Use event handlers instead if you can. If you need to generate unsafe HTML try using dangerouslySetInnerHTML instead. React was passed %s.",JSON.stringify(e)))}function Y(e,t,n,i){if(i.mustUseProperty)return e[i.propertyName];i.sanitizeURL&&X(""+n);var r=i.attributeName,o=null;if(4===i.type){if(e.hasAttribute(r)){var s=e.getAttribute(r);return""===s||(V(t,n,i,!1)?s:s===""+n?n:s)}}else if(e.hasAttribute(r)){if(V(t,n,i,!1))return e.getAttribute(r);if(3===i.type)return n;o=e.getAttribute(r)}return V(t,n,i,!1)?null===o?n:o:o===""+n?n:o}function K(e,t,n){if(N(t)){if(function(e){return null!==e&&"object"==typeof e&&e.$$typeof===fe}(n))return n;if(!e.hasAttribute(t))return void 0===n?void 0:null;var i=e.getAttribute(t);return i===""+n?n:i}}function J(e,t,n,i){var r=G(t);if(!U(t,r,i))if(V(t,n,r,i)&&(n=null),i||null===r){if(N(t)){var o=t;null===n?e.removeAttribute(o):e.setAttribute(o,""+n)}}else if(r.mustUseProperty){var s=r.propertyName;if(null===n){var a=r.type;e[s]=3!==a&&""}else e[s]=n}else{var l=r.attributeName,c=r.attributeNamespace;if(null===n)e.removeAttribute(l);else{var u,h=r.type;3===h||4===h&&!0===n?u="":(u=""+n,r.sanitizeURL&&X(u.toString())),c?e.setAttributeNS(c,l,u):e.setAttribute(l,u)}}}var ee=60103,te=60106,ne=60107,ie=60108,re=60114,oe=60109,se=60110,ae=60112,le=60113,ce=60120,ue=60115,he=60116,de=60121,fe=60128,pe=60129,Ae=60130,me=60131;if("function"==typeof Symbol&&Symbol.for){var ge=Symbol.for;ee=ge("react.element"),te=ge("react.portal"),ne=ge("react.fragment"),ie=ge("react.strict_mode"),re=ge("react.profiler"),oe=ge("react.provider"),se=ge("react.context"),ae=ge("react.forward_ref"),le=ge("react.suspense"),ce=ge("react.suspense_list"),ue=ge("react.memo"),he=ge("react.lazy"),de=ge("react.block"),ge("react.server.block"),ge("react.fundamental"),ge("react.scope"),fe=ge("react.opaque.id"),pe=ge("react.debug_trace_mode"),Ae=ge("react.offscreen"),me=ge("react.legacy_hidden")}var ye="function"==typeof Symbol&&Symbol.iterator;function _e(e){if(null===e||"object"!=typeof e)return null;var t=ye&&e[ye]||e["@@iterator"];return"function"==typeof t?t:null}var ve,be,xe,we,Ee,Se,Te,ke=0;function Ce(){}function Pe(){if(0===ke){ve=console.log,be=console.info,xe=console.warn,we=console.error,Ee=console.group,Se=console.groupCollapsed,Te=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Ce,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}ke++}function Me(){if(0===--ke){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:n({},e,{value:ve}),info:n({},e,{value:be}),warn:n({},e,{value:xe}),error:n({},e,{value:we}),group:n({},e,{value:Ee}),groupCollapsed:n({},e,{value:Se}),groupEnd:n({},e,{value:Te})})}ke<0&&l("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}Ce.__reactDisabledLog=!0;var Ie,Le=o.ReactCurrentDispatcher;function Re(e,t,n){if(void 0===Ie)try{throw Error()}catch(e){var i=e.stack.trim().match(/\n( *(at )?)/);Ie=i&&i[1]||""}return"\n"+Ie+e}var ze,De=!1,Oe="function"==typeof WeakMap?WeakMap:Map;function Be(e,t){if(!e||De)return"";var n,i=ze.get(e);if(void 0!==i)return i;De=!0;var r,o=Error.prepareStackTrace;Error.prepareStackTrace=void 0,r=Le.current,Le.current=null,Pe();try{if(t){var s=function(){throw Error()};if(Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(s,[])}catch(e){n=e}Reflect.construct(e,[],s)}else{try{s.call()}catch(e){n=e}e.call(s.prototype)}}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var a=t.stack.split("\n"),l=n.stack.split("\n"),c=a.length-1,u=l.length-1;c>=1&&u>=0&&a[c]!==l[u];)u--;for(;c>=1&&u>=0;c--,u--)if(a[c]!==l[u]){if(1!==c||1!==u)do{if(c--,--u<0||a[c]!==l[u]){var h="\n"+a[c].replace(" at new "," at ");return"function"==typeof e&&ze.set(e,h),h}}while(c>=1&&u>=0);break}}}finally{De=!1,Le.current=r,Me(),Error.prepareStackTrace=o}var d=e?e.displayName||e.name:"",f=d?Re(d):"";return"function"==typeof e&&ze.set(e,f),f}function Fe(e,t,n){return Be(e,!1)}function Ne(e,t,n){if(null==e)return"";if("function"==typeof e)return Be(e,function(e){var t=e.prototype;return!(!t||!t.isReactComponent)}(e));if("string"==typeof e)return Re(e);switch(e){case le:return Re("Suspense");case ce:return Re("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case ae:return Fe(e.render);case ue:return Ne(e.type,t,n);case de:return Fe(e._render);case he:var i=e,r=i._payload,o=i._init;try{return Ne(o(r),t,n)}catch(e){}}return""}function Ue(e){switch(e._debugOwner&&e._debugOwner.type,e._debugSource,e.tag){case 5:return Re(e.type);case 16:return Re("Lazy");case m:return Re("Suspense");case v:return Re("SuspenseList");case 0:case 2:case y:return Fe(e.type);case p:return Fe(e.type.render);case x:return Fe(e.type._render);case 1:return Be(e.type,!0);default:return""}}function je(e){try{var t="",n=e;do{t+=Ue(n),n=n.return}while(n);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}function Ve(e){return e.displayName||"Context"}function Ge(e){if(null==e)return null;if("number"==typeof e.tag&&l("Received an unexpected object in getComponentName(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case re:return"Profiler";case ie:return"StrictMode";case le:return"Suspense";case ce:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case se:return Ve(e)+".Consumer";case oe:return Ve(e._context)+".Provider";case ae:return r=e,o=e.render,s="ForwardRef",a=o.displayName||o.name||"",r.displayName||(""!==a?s+"("+a+")":s);case ue:return Ge(e.type);case de:return Ge(e._render);case he:var t=e,n=t._payload,i=t._init;try{return Ge(i(n))}catch(e){return null}}var r,o,s,a;return null}ze=new Oe;var We=o.ReactDebugCurrentFrame,$e=null,qe=!1;function Ze(){if(null===$e)return null;var e=$e._debugOwner;return null!=e?Ge(e.type):null}function He(){return null===$e?"":je($e)}function Qe(){We.getCurrentStack=null,$e=null,qe=!1}function Xe(e){We.getCurrentStack=He,$e=e,qe=!1}function Ye(e){qe=e}function Ke(e){return""+e}function Je(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}var et={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0};function tt(e,t){et[t.type]||t.onChange||t.onInput||t.readOnly||t.disabled||null==t.value||l("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`."),t.onChange||t.readOnly||t.disabled||null==t.checked||l("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}function nt(e){var t=e.type,n=e.nodeName;return n&&"input"===n.toLowerCase()&&("checkbox"===t||"radio"===t)}function it(e){return e._valueTracker}function rt(e){it(e)||(e._valueTracker=function(e){var t=nt(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,o=n.set;Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable});var s={getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){!function(e){e._valueTracker=null}(e),delete e[t]}};return s}}(e))}function ot(e){if(!e)return!1;var t=it(e);if(!t)return!0;var n=t.getValue(),i=function(e){var t="";return e?t=nt(e)?e.checked?"true":"false":e.value:t}(e);return i!==n&&(t.setValue(i),!0)}function st(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var at=!1,lt=!1,ct=!1,ut=!1;function ht(e){return"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}function dt(e,t){var i=e,r=t.checked;return n({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:i._wrapperState.initialChecked})}function ft(e,t){tt(0,t),void 0===t.checked||void 0===t.defaultChecked||lt||(l("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",Ze()||"A component",t.type),lt=!0),void 0===t.value||void 0===t.defaultValue||at||(l("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",Ze()||"A component",t.type),at=!0);var n=e,i=null==t.defaultValue?"":t.defaultValue;n._wrapperState={initialChecked:null!=t.checked?t.checked:t.defaultChecked,initialValue:Je(null!=t.value?t.value:i),controlled:ht(t)}}function pt(e,t){var n=e,i=t.checked;null!=i&&J(n,"checked",i,!1)}function At(e,t){var n=e,i=ht(t);n._wrapperState.controlled||!i||ut||(l("A component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),ut=!0),!n._wrapperState.controlled||i||ct||(l("A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),ct=!0),pt(e,t);var r=Je(t.value),o=t.type;if(null!=r)"number"===o?(0===r&&""===n.value||n.value!=r)&&(n.value=Ke(r)):n.value!==Ke(r)&&(n.value=Ke(r));else if("submit"===o||"reset"===o)return void n.removeAttribute("value");t.hasOwnProperty("value")?yt(n,t.type,r):t.hasOwnProperty("defaultValue")&&yt(n,t.type,Je(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(n.defaultChecked=!!t.defaultChecked)}function mt(e,t,n){var i=e;if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(("submit"===r||"reset"===r)&&(void 0===t.value||null===t.value))return;var o=Ke(i._wrapperState.initialValue);n||o!==i.value&&(i.value=o),i.defaultValue=o}var s=i.name;""!==s&&(i.name=""),i.defaultChecked=!i.defaultChecked,i.defaultChecked=!!i._wrapperState.initialChecked,""!==s&&(i.name=s)}function gt(e,t){var n=e;At(n,t),function(e,t){var n=t.name;if("radio"===t.type&&null!=n){for(var i=e;i.parentNode;)i=i.parentNode;for(var r=i.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),o=0;o<r.length;o++){var s=r[o];if(s!==e&&s.form===e.form){var a=vl(s);if(!a)throw Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");ot(s),At(s,a)}}}}(n,t)}function yt(e,t,n){"number"===t&&st(e.ownerDocument)===e||(null==n?e.defaultValue=Ke(e._wrapperState.initialValue):e.defaultValue!==Ke(n)&&(e.defaultValue=Ke(n)))}var _t,vt=!1,bt=!1;function xt(t,n){"object"==typeof n.children&&null!==n.children&&e.Children.forEach(n.children,(function(e){null!=e&&"string"!=typeof e&&"number"!=typeof e&&"string"==typeof e.type&&(bt||(bt=!0,l("Only strings and numbers are supported as <option> children.")))})),null==n.selected||vt||(l("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),vt=!0)}function wt(t,i){var r=n({children:void 0},i),o=function(t){var n="";return e.Children.forEach(t,(function(e){null!=e&&(n+=e)})),n}(i.children);return o&&(r.children=o),r}function Et(){var e=Ze();return e?"\n\nCheck the render method of `"+e+"`.":""}_t=!1;var St=["value","defaultValue"];function Tt(e,t,n,i){var r=e.options;if(t){for(var o=n,s={},a=0;a<o.length;a++)s["$"+o[a]]=!0;for(var l=0;l<r.length;l++){var c=s.hasOwnProperty("$"+r[l].value);r[l].selected!==c&&(r[l].selected=c),c&&i&&(r[l].defaultSelected=!0)}}else{for(var u=Ke(Je(n)),h=null,d=0;d<r.length;d++){if(r[d].value===u)return r[d].selected=!0,void(i&&(r[d].defaultSelected=!0));null!==h||r[d].disabled||(h=r[d])}null!==h&&(h.selected=!0)}}function kt(e,t){return n({},t,{value:void 0})}function Ct(e,t){var n=e;!function(e){tt(0,e);for(var t=0;t<St.length;t++){var n=St[t];if(null!=e[n]){var i=Array.isArray(e[n]);e.multiple&&!i?l("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",n,Et()):!e.multiple&&i&&l("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",n,Et())}}}(t),n._wrapperState={wasMultiple:!!t.multiple},void 0===t.value||void 0===t.defaultValue||_t||(l("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://reactjs.org/link/controlled-components"),_t=!0)}var Pt=!1;function Mt(e,t){var i=e;if(null!=t.dangerouslySetInnerHTML)throw Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");return n({},t,{value:void 0,defaultValue:void 0,children:Ke(i._wrapperState.initialValue)})}function It(e,t){var n=e;tt(0,t),void 0===t.value||void 0===t.defaultValue||Pt||(l("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://reactjs.org/link/controlled-components",Ze()||"A component"),Pt=!0);var i=t.value;if(null==i){var r=t.children,o=t.defaultValue;if(null!=r){if(l("Use the `defaultValue` or `value` props instead of setting children on <textarea>."),null!=o)throw Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(Array.isArray(r)){if(!(r.length<=1))throw Error("<textarea> can only have at most one child.");r=r[0]}o=r}null==o&&(o=""),i=o}n._wrapperState={initialValue:Je(i)}}function Lt(e,t){var n=e,i=Je(t.value),r=Je(t.defaultValue);if(null!=i){var o=Ke(i);o!==n.value&&(n.value=o),null==t.defaultValue&&n.defaultValue!==o&&(n.defaultValue=o)}null!=r&&(n.defaultValue=Ke(r))}function Rt(e,t){var n=e,i=n.textContent;i===n._wrapperState.initialValue&&""!==i&&null!==i&&(n.value=i)}var zt="http://www.w3.org/1999/xhtml",Dt="http://www.w3.org/1998/Math/MathML",Ot="http://www.w3.org/2000/svg",Bt=zt,Ft=Ot;function Nt(e){switch(e){case"svg":return Ot;case"math":return Dt;default:return zt}}function Ut(e,t){return null==e||e===zt?Nt(t):e===Ot&&"foreignObject"===t?zt:e}var jt,Vt,Gt=(Vt=function(e,t){if(e.namespaceURI!==Ft||"innerHTML"in e)e.innerHTML=t;else{(jt=jt||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>";for(var n=jt.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return Vt(e,t,n,i)}))}:Vt),Wt=8,$t=function(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t},qt={animation:["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction"],background:["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"],backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:["borderBottomColor","borderBottomStyle","borderBottomWidth","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderTopColor","borderTopStyle","borderTopWidth"],borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:["fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","lineHeight"],fontVariant:["fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition"],gap:["columnGap","rowGap"],grid:["gridAutoColumns","gridAutoFlow","gridAutoRows","gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPositionX","maskPositionY","maskRepeat","maskSize"],maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},Zt={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};var Ht=["Webkit","ms","Moz","O"];function Qt(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||Zt.hasOwnProperty(e)&&Zt[e]?(""+t).trim():t+"px"}Object.keys(Zt).forEach((function(e){Ht.forEach((function(t){Zt[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=Zt[e]}))}));var Xt=/([A-Z])/g,Yt=/^ms-/;var Kt=/^(?:webkit|moz|o)[A-Z]/,Jt=/^-ms-/,en=/-(.)/g,tn=/;\s*$/,nn={},rn={},on=!1,sn=!1,an=function(e){nn.hasOwnProperty(e)&&nn[e]||(nn[e]=!0,l("Unsupported style property %s. Did you mean %s?",e,e.replace(Jt,"ms-").replace(en,(function(e,t){return t.toUpperCase()}))))},ln=function(e,t){e.indexOf("-")>-1?an(e):Kt.test(e)?function(e){nn.hasOwnProperty(e)&&nn[e]||(nn[e]=!0,l("Unsupported vendor-prefixed style property %s. Did you mean %s?",e,e.charAt(0).toUpperCase()+e.slice(1)))}(e):tn.test(t)&&function(e,t){rn.hasOwnProperty(t)&&rn[t]||(rn[t]=!0,l('Style property values shouldn\'t contain a semicolon. Try "%s: %s" instead.',e,t.replace(tn,"")))}(e,t),"number"==typeof t&&(isNaN(t)?function(e,t){on||(on=!0,l("`NaN` is an invalid value for the `%s` css style property.",e))}(e):isFinite(t)||function(e,t){sn||(sn=!0,l("`Infinity` is an invalid value for the `%s` css style property.",e))}(e))};function cn(e){var t="",n="";for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if(null!=r){var o=0===i.indexOf("--");t+=n+(o?i:i.replace(Xt,"-$1").toLowerCase().replace(Yt,"-ms-"))+":",t+=Qt(i,r,o),n=";"}}return t||null}function un(e,t){var n=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=0===i.indexOf("--");r||ln(i,t[i]);var o=Qt(i,t[i],r);"float"===i&&(i="cssFloat"),r?n.setProperty(i,o):n[i]=o}}function hn(e){var t={};for(var n in e)for(var i=qt[n]||[n],r=0;r<i.length;r++)t[i[r]]=n;return t}var dn=n({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fn(e,t){if(t){if(dn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(e+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.")}if(!t.suppressContentEditableWarning&&t.contentEditable&&null!=t.children&&l("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."),null!=t.style&&"object"!=typeof t.style)throw Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.")}}function pn(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var An={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},mn={"aria-current":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},gn={},yn=new RegExp("^(aria)-["+R+"]*$"),_n=new RegExp("^(aria)[A-Z]["+R+"]*$"),vn=Object.prototype.hasOwnProperty;function bn(e,t){if(vn.call(gn,t)&&gn[t])return!0;if(_n.test(t)){var n="aria-"+t.slice(4).toLowerCase(),i=mn.hasOwnProperty(n)?n:null;if(null==i)return l("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",t),gn[t]=!0,!0;if(t!==i)return l("Invalid ARIA attribute `%s`. Did you mean `%s`?",t,i),gn[t]=!0,!0}if(yn.test(t)){var r=t.toLowerCase(),o=mn.hasOwnProperty(r)?r:null;if(null==o)return gn[t]=!0,!1;if(t!==o)return l("Unknown ARIA attribute `%s`. Did you mean `%s`?",t,o),gn[t]=!0,!0}return!0}function xn(e,t){pn(e,t)||function(e,t){var n=[];for(var i in t)bn(0,i)||n.push(i);var r=n.map((function(e){return"`"+e+"`"})).join(", ");1===n.length?l("Invalid aria prop %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",r,e):n.length>1&&l("Invalid aria props %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",r,e)}(e,t)}var wn=!1;var En,Sn={},Tn=Object.prototype.hasOwnProperty,kn=/^on./,Cn=/^on[^A-Z]/,Pn=new RegExp("^(aria)-["+R+"]*$"),Mn=new RegExp("^(aria)[A-Z]["+R+"]*$");En=function(e,t,n,i){if(Tn.call(Sn,t)&&Sn[t])return!0;var r=t.toLowerCase();if("onfocusin"===r||"onfocusout"===r)return l("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),Sn[t]=!0,!0;if(null!=i){var o=i.registrationNameDependencies,s=i.possibleRegistrationNames;if(o.hasOwnProperty(t))return!0;var a=s.hasOwnProperty(r)?s[r]:null;if(null!=a)return l("Invalid event handler property `%s`. Did you mean `%s`?",t,a),Sn[t]=!0,!0;if(kn.test(t))return l("Unknown event handler property `%s`. It will be ignored.",t),Sn[t]=!0,!0}else if(kn.test(t))return Cn.test(t)&&l("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",t),Sn[t]=!0,!0;if(Pn.test(t)||Mn.test(t))return!0;if("innerhtml"===r)return l("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),Sn[t]=!0,!0;if("aria"===r)return l("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),Sn[t]=!0,!0;if("is"===r&&null!=n&&"string"!=typeof n)return l("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof n),Sn[t]=!0,!0;if("number"==typeof n&&isNaN(n))return l("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",t),Sn[t]=!0,!0;var c=G(t),u=null!==c&&0===c.type;if(An.hasOwnProperty(r)){var h=An[r];if(h!==t)return l("Invalid DOM property `%s`. Did you mean `%s`?",t,h),Sn[t]=!0,!0}else if(!u&&t!==r)return l("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",t,r),Sn[t]=!0,!0;return"boolean"==typeof n&&j(t,n,c,!1)?(n?l('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',n,t,t,n,t):l('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',n,t,t,n,t,t,t),Sn[t]=!0,!0):!!u||(j(t,n,c,!1)?(Sn[t]=!0,!1):("false"!==n&&"true"!==n||null===c||3!==c.type||(l("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",n,t,"false"===n?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',t,n),Sn[t]=!0),!0))};function In(e,t,n){pn(e,t)||function(e,t,n){var i=[];for(var r in t)En(0,r,t[r],n)||i.push(r);var o=i.map((function(e){return"`"+e+"`"})).join(", ");1===i.length?l("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",o,e):i.length>1&&l("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",o,e)}(e,t,n)}function Ln(e){var t=e.target||e.srcElement||window;return t.correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Rn=null,zn=null,Dn=null;function On(e){var t=yl(e);if(t){if("function"!=typeof Rn)throw Error("setRestoreImplementation() needs to be called to handle a target for controlled events. This error is likely caused by a bug in React. Please file an issue.");var n=t.stateNode;if(n){var i=vl(n);Rn(t.stateNode,t.type,i)}}}function Bn(e){zn?Dn?Dn.push(e):Dn=[e]:zn=e}function Fn(){if(zn){var e=zn,t=Dn;if(zn=null,Dn=null,On(e),t)for(var n=0;n<t.length;n++)On(t[n])}}var Nn=function(e,t){return e(t)},Un=function(e,t,n,i,r){return e(t,n,i,r)},jn=function(){},Vn=Nn,Gn=!1,Wn=!1;function $n(){(null!==zn||null!==Dn)&&(jn(),Fn())}function qn(e,t){var n=e.stateNode;if(null===n)return null;var i=vl(n);if(null===i)return null;var r=i[t];if(function(e,t,n){switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":return!(!n.disabled||(i=t,"button"!==i&&"input"!==i&&"select"!==i&&"textarea"!==i));default:return!1}var i}(t,e.type,i))return null;if(r&&"function"!=typeof r)throw Error("Expected `"+t+"` listener to be a function, instead got a value of `"+typeof r+"` type.");return r}var Zn=!1;if(I)try{var Hn={};Object.defineProperty(Hn,"passive",{get:function(){Zn=!0}}),window.addEventListener("test",Hn,Hn),window.removeEventListener("test",Hn,Hn)}catch(e){Zn=!1}function Qn(e,t,n,i,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var Xn=Qn;if("undefined"!=typeof window&&"function"==typeof window.dispatchEvent&&"undefined"!=typeof document&&"function"==typeof document.createEvent){var Yn=document.createElement("react");Xn=function(e,t,n,i,r,o,s,a,l){if("undefined"==typeof document)throw Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var c=document.createEvent("Event"),u=!1,h=!0,d=window.event,f=Object.getOwnPropertyDescriptor(window,"event");function p(){Yn.removeEventListener(b,g,!1),void 0!==window.event&&window.hasOwnProperty("event")&&(window.event=d)}var A,m=Array.prototype.slice.call(arguments,3);function g(){u=!0,p(),t.apply(n,m),h=!1}var y=!1,_=!1;function v(e){if(A=e.error,y=!0,null===A&&0===e.colno&&0===e.lineno&&(_=!0),e.defaultPrevented&&null!=A&&"object"==typeof A)try{A._suppressLogging=!0}catch(e){}}var b="react-"+(e||"invokeguardedcallback");if(window.addEventListener("error",v),Yn.addEventListener(b,g,!1),c.initEvent(b,!1,!1),Yn.dispatchEvent(c),f&&Object.defineProperty(window,"event",f),u&&h&&(y?_&&(A=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):A=new Error("An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the \"Pause on exceptions\" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue."),this.onError(A)),window.removeEventListener("error",v),!u)return p(),Qn.apply(this,arguments)}}var Kn=Xn,Jn=!1,ei=null,ti=!1,ni=null,ii={onError:function(e){Jn=!0,ei=e}};function ri(e,t,n,i,r,o,s,a,l){Jn=!1,ei=null,Kn.apply(ii,arguments)}function oi(){return Jn}function si(){if(Jn){var e=ei;return Jn=!1,ei=null,e}throw Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}function ai(e){return e._reactInternals}var li,ci,ui,hi,di=64,fi=128,pi=256,Ai=512,mi=8192,gi=1024,yi=2048,_i=4096,vi=16384,bi=o.ReactCurrentOwner;function xi(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{var i=t;do{0!=(1026&(t=i).flags)&&(n=t.return),i=t.return}while(i)}return 3===t.tag?n:null}function wi(e){if(e.tag===m){var t=e.memoizedState;if(null===t){var n=e.alternate;null!==n&&(t=n.memoizedState)}if(null!==t)return t.dehydrated}return null}function Ei(e){return 3===e.tag?e.stateNode.containerInfo:null}function Si(e){if(xi(e)!==e)throw Error("Unable to find node on an unmounted component.")}function Ti(e){var t=e.alternate;if(!t){var n=xi(e);if(null===n)throw Error("Unable to find node on an unmounted component.");return n!==e?null:e}for(var i=e,r=t;;){var o=i.return;if(null===o)break;var s=o.alternate;if(null===s){var a=o.return;if(null!==a){i=r=a;continue}break}if(o.child===s.child){for(var l=o.child;l;){if(l===i)return Si(o),e;if(l===r)return Si(o),t;l=l.sibling}throw Error("Unable to find node on an unmounted component.")}if(i.return!==r.return)i=o,r=s;else{for(var c=!1,u=o.child;u;){if(u===i){c=!0,i=o,r=s;break}if(u===r){c=!0,r=o,i=s;break}u=u.sibling}if(!c){for(u=s.child;u;){if(u===i){c=!0,i=s,r=o;break}if(u===r){c=!0,r=s,i=o;break}u=u.sibling}if(!c)throw Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(i.alternate!==r)throw Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(3!==i.tag)throw Error("Unable to find node on an unmounted component.");return i.stateNode.current===i?e:t}function ki(e){var t=Ti(e);if(!t)return null;for(var n=t;;){if(5===n.tag||6===n.tag)return n;if(n.child)n.child.return=n,n=n.child;else{if(n===t)return null;for(;!n.sibling;){if(!n.return||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}}return null}function Ci(e,t){for(var n=t,i=e.alternate;null!==n;){if(n===e||n===i)return!0;n=n.return}return!1}var Pi=!1,Mi=[],Ii=null,Li=null,Ri=null,zi=new Map,Di=new Map,Oi=[];var Bi=["mousedown","mouseup","touchcancel","touchend","touchstart","auxclick","dblclick","pointercancel","pointerdown","pointerup","dragend","dragstart","drop","compositionend","compositionstart","keydown","keypress","keyup","input","textInput","copy","cut","paste","click","change","contextmenu","reset","submit"];function Fi(e){return Bi.indexOf(e)>-1}function Ni(e,t,n,i,r){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:r,targetContainers:[i]}}function Ui(e,t,n,i,r){var o=Ni(e,t,n,i,r);Mi.push(o)}function ji(e,t){switch(e){case"focusin":case"focusout":Ii=null;break;case"dragenter":case"dragleave":Li=null;break;case"mouseover":case"mouseout":Ri=null;break;case"pointerover":case"pointerout":var n=t.pointerId;zi.delete(n);break;case"gotpointercapture":case"lostpointercapture":var i=t.pointerId;Di.delete(i)}}function Vi(e,t,n,i,r,o){if(null===e||e.nativeEvent!==o){var s=Ni(t,n,i,r,o);if(null!==t){var a=yl(t);null!==a&&ci(a)}return s}e.eventSystemFlags|=i;var l=e.targetContainers;return null!==r&&-1===l.indexOf(r)&&l.push(r),e}function Gi(e){var t=gl(e.target);if(null!==t){var n=xi(t);if(null!==n){var r=n.tag;if(r===m){var o=wi(n);if(null!==o)return e.blockedOn=o,void hi(e.lanePriority,(function(){i.unstable_runWithPriority(e.priority,(function(){ui(n)}))}))}else if(3===r){if(n.stateNode.hydrate)return void(e.blockedOn=Ei(n))}}}e.blockedOn=null}function Wi(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;t.length>0;){var n=t[0],i=Jr(e.domEventName,e.eventSystemFlags,n,e.nativeEvent);if(null!==i){var r=yl(i);return null!==r&&ci(r),e.blockedOn=i,!1}t.shift()}return!0}function $i(e,t,n){Wi(e)&&n.delete(t)}function qi(){for(Pi=!1;Mi.length>0;){var e=Mi[0];if(null!==e.blockedOn){var t=yl(e.blockedOn);null!==t&&li(t);break}for(var n=e.targetContainers;n.length>0;){var i=n[0],r=Jr(e.domEventName,e.eventSystemFlags,i,e.nativeEvent);if(null!==r){e.blockedOn=r;break}n.shift()}null===e.blockedOn&&Mi.shift()}null!==Ii&&Wi(Ii)&&(Ii=null),null!==Li&&Wi(Li)&&(Li=null),null!==Ri&&Wi(Ri)&&(Ri=null),zi.forEach($i),Di.forEach($i)}function Zi(e,t){e.blockedOn===t&&(e.blockedOn=null,Pi||(Pi=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,qi)))}function Hi(e){if(Mi.length>0){Zi(Mi[0],e);for(var t=1;t<Mi.length;t++){var n=Mi[t];n.blockedOn===e&&(n.blockedOn=null)}}null!==Ii&&Zi(Ii,e),null!==Li&&Zi(Li,e),null!==Ri&&Zi(Ri,e);var i=function(t){return Zi(t,e)};zi.forEach(i),Di.forEach(i);for(var r=0;r<Oi.length;r++){var o=Oi[r];o.blockedOn===e&&(o.blockedOn=null)}for(;Oi.length>0;){var s=Oi[0];if(null!==s.blockedOn)break;Gi(s),null===s.blockedOn&&Oi.shift()}}function Qi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Xi={animationend:Qi("Animation","AnimationEnd"),animationiteration:Qi("Animation","AnimationIteration"),animationstart:Qi("Animation","AnimationStart"),transitionend:Qi("Transition","TransitionEnd")},Yi={},Ki={};function Ji(e){if(Yi[e])return Yi[e];if(!Xi[e])return e;var t=Xi[e];for(var n in t)if(t.hasOwnProperty(n)&&n in Ki)return Yi[e]=t[n];return e}I&&(Ki=document.createElement("div").style,"AnimationEvent"in window||(delete Xi.animationend.animation,delete Xi.animationiteration.animation,delete Xi.animationstart.animation),"TransitionEvent"in window||delete Xi.transitionend.transition);var er=Ji("animationend"),tr=Ji("animationiteration"),nr=Ji("animationstart"),ir=Ji("transitionend"),rr=new Map,or=new Map,sr=["cancel","cancel","click","click","close","close","contextmenu","contextMenu","copy","copy","cut","cut","auxclick","auxClick","dblclick","doubleClick","dragend","dragEnd","dragstart","dragStart","drop","drop","focusin","focus","focusout","blur","input","input","invalid","invalid","keydown","keyDown","keypress","keyPress","keyup","keyUp","mousedown","mouseDown","mouseup","mouseUp","paste","paste","pause","pause","play","play","pointercancel","pointerCancel","pointerdown","pointerDown","pointerup","pointerUp","ratechange","rateChange","reset","reset","seeked","seeked","submit","submit","touchcancel","touchCancel","touchend","touchEnd","touchstart","touchStart","volumechange","volumeChange"],ar=["change","selectionchange","textInput","compositionstart","compositionend","compositionupdate"],lr=["drag","drag","dragenter","dragEnter","dragexit","dragExit","dragleave","dragLeave","dragover","dragOver","mousemove","mouseMove","mouseout","mouseOut","mouseover","mouseOver","pointermove","pointerMove","pointerout","pointerOut","pointerover","pointerOver","scroll","scroll","toggle","toggle","touchmove","touchMove","wheel","wheel"],cr=["abort","abort",er,"animationEnd",tr,"animationIteration",nr,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ir,"transitionEnd","waiting","waiting"];function ur(e,t){for(var n=0;n<e.length;n+=2){var i=e[n],r=e[n+1],o="on"+(r[0].toUpperCase()+r.slice(1));or.set(i,t),rr.set(i,o),P(o,[i])}}var hr=i.unstable_now;if(null==r.__interactionsRef||null==r.__interactionsRef.current)throw Error("It is not supported to run the profiling version of a renderer (for example, `react-dom/profiling`) without also replacing the `scheduler/tracing` module with `scheduler/tracing-profiling`. Your bundler might have a setting for aliasing both modules. Learn more at https://reactjs.org/link/profiling");hr();var dr=15,fr=10,pr=3584,Ar=4186112,mr=62914560,gr=33554432,yr=67108864,_r=134217727,vr=134217728,br=805306368,xr=1073741824,wr=-1;var Er=8;function Sr(e){if(0!=(1&e))return Er=dr,1;if(0!=(2&e))return Er=14,2;if(0!=(4&e))return Er=13,4;var t=24&e;if(0!==t)return Er=12,t;if(0!=(32&e))return Er=11,32;var n=192&e;if(0!==n)return Er=fr,n;if(0!=(256&e))return Er=9,256;var i=pr&e;if(0!==i)return Er=8,i;if(0!=(4096&e))return Er=7,4096;var r=Ar&e;if(0!==r)return Er=6,r;var o=mr&e;if(0!==o)return Er=5,o;if(e&yr)return Er=4,yr;if(0!=(e&vr))return Er=3,vr;var s=br&e;return 0!==s?(Er=2,s):0!=(xr&e)?(Er=1,xr):(l("Should have found matching lanes. This is a bug in React."),Er=8,e)}function Tr(e,t){var n=e.pendingLanes;if(0===n)return Er=0,0;var i=0,r=0,o=e.expiredLanes,s=e.suspendedLanes,a=e.pingedLanes;if(0!==o)i=o,r=Er=dr;else{var l=n&_r;if(0!==l){var c=l&~s;if(0!==c)i=Sr(c),r=Er;else{var u=l&a;0!==u&&(i=Sr(u),r=Er)}}else{var h=n&~s;0!==h?(i=Sr(h),r=Er):0!==a&&(i=Sr(a),r=Er)}}if(0===i)return 0;if(i=n&function(e){return(function(e){var t=31-Vr(e);return t<0?0:1<<t}(e)<<1)-1}(i),0!==t&&t!==i&&0==(t&s)){if(Sr(t),r<=Er)return t;Er=r}var d=e.entangledLanes;if(0!==d)for(var f=e.entanglements,p=i&d;p>0;){var A=Rr(p),m=1<<A;i|=f[A],p&=~m}return i}function kr(e,t){Sr(e);return Er>=fr?t+250:Er>=6?t+5e3:wr}function Cr(e){var t=-1073741825&e.pendingLanes;return 0!==t?t:t&xr?xr:0}function Pr(e){return 0!=(e&_r)}function Mr(e){return(e&mr)===e}function Ir(e,t){switch(e){case 0:case 6:case 5:break;case dr:return 1;case 14:return 2;case 12:var n=Lr(24&~t);return 0===n?Ir(fr,t):n;case fr:var i=Lr(192&~t);return 0===i?Ir(8,t):i;case 8:var r=Lr(pr&~t);return 0===r&&0===(r=Lr(Ar&~t))&&(r=Lr(pr)),r;case 2:var o=Lr(br&~t);return 0===o&&(o=Lr(br)),o}throw Error("Invalid update priority: "+e+". This is a bug in React.")}function Lr(e){return function(e){return e&-e}(e)}function Rr(e){return 31-Vr(e)}function zr(e,t){return 0!=(e&t)}function Dr(e,t){return(e&t)===t}function Or(e,t){return e|t}function Br(e,t){return e&~t}function Fr(e){for(var t=[],n=0;n<31;n++)t.push(e);return t}function Nr(e,t,n){e.pendingLanes|=t;var i=t-1;e.suspendedLanes&=i,e.pingedLanes&=i,e.eventTimes[Rr(t)]=n}function Ur(e,t,n){e.pingedLanes|=e.suspendedLanes&t}function jr(e,t){e.mutableReadLanes|=t&e.pendingLanes}var Vr=Math.clz32?Math.clz32:function(e){if(0===e)return 32;return 31-(Gr(e)/Wr|0)|0},Gr=Math.log,Wr=Math.LN2;var $r=i.unstable_UserBlockingPriority,qr=i.unstable_runWithPriority,Zr=!0;function Hr(e){Zr=!!e}function Qr(e,t,n){var i,r=function(e){var t=or.get(e);return void 0===t?2:t}(t);switch(r){case 0:i=Xr;break;case 1:i=Yr;break;default:i=Kr}return i.bind(null,t,n,e)}function Xr(e,t,n,i){i.timeStamp,Gn||jn(),function(e,t,n,i,r){var o=Gn;Gn=!0;try{Un(e,t,n,i,r)}finally{(Gn=o)||$n()}}(Kr,e,t,n,i)}function Yr(e,t,n,i){qr($r,Kr.bind(null,e,t,n,i))}function Kr(e,t,n,i){if(Zr){var r;if((r=0==(4&t))&&Mi.length>0&&Fi(e))Ui(null,e,t,n,i);else{var o=Jr(e,t,n,i);if(null!==o){if(r){if(Fi(e))return void Ui(o,e,t,n,i);if(function(e,t,n,i,r){switch(t){case"focusin":return Ii=Vi(Ii,e,t,n,i,r),!0;case"dragenter":return Li=Vi(Li,e,t,n,i,r),!0;case"mouseover":return Ri=Vi(Ri,e,t,n,i,r),!0;case"pointerover":var o=r,s=o.pointerId;return zi.set(s,Vi(zi.get(s)||null,e,t,n,i,o)),!0;case"gotpointercapture":var a=r,l=a.pointerId;return Di.set(l,Vi(Di.get(l)||null,e,t,n,i,a)),!0}return!1}(o,e,t,n,i))return;ji(e,i)}Zs(e,t,i,null,n)}else r&&ji(e,i)}}}function Jr(e,t,n,i){var r=gl(Ln(i));if(null!==r){var o=xi(r);if(null===o)r=null;else{var s=o.tag;if(s===m){var a=wi(o);if(null!==a)return a;r=null}else if(3===s){if(o.stateNode.hydrate)return Ei(o);r=null}else o!==r&&(r=null)}}return Zs(e,t,i,r,n),null}var eo=null,to=null,no=null;function io(){if(no)return no;var e,t,n=to,i=n.length,r=ro(),o=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[o-t];t++);var a=t>1?1-t:void 0;return no=r.slice(e,a)}function ro(){return"value"in eo?eo.value:eo.textContent}function oo(e){var t,n=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===n&&(t=13):t=n,10===t&&(t=13),t>=32||13===t?t:0}function so(){return!0}function ao(){return!1}function lo(e){function t(t,n,i,r,o){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null,e)if(e.hasOwnProperty(s)){var a=e[s];this[s]=a?a(r):r[s]}var l=null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue;return this.isDefaultPrevented=l?so:ao,this.isPropagationStopped=ao,this}return n(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=so)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=so)},persist:function(){},isPersistent:so}),t}var co,uo,ho,fo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},po=lo(fo),Ao=n({},fo,{view:0,detail:0}),mo=lo(Ao);var go=n({},Ao,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Po,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(function(e){e!==ho&&(ho&&"mousemove"===e.type?(co=e.screenX-ho.screenX,uo=e.screenY-ho.screenY):(co=0,uo=0),ho=e)}(e),co)},movementY:function(e){return"movementY"in e?e.movementY:uo}}),yo=lo(go),_o=lo(n({},go,{dataTransfer:0})),vo=lo(n({},Ao,{relatedTarget:0})),bo=lo(n({},fo,{animationName:0,elapsedTime:0,pseudoElement:0})),xo=lo(n({},fo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),wo=lo(n({},fo,{data:0})),Eo=wo,So={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},To={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};var ko={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Co(e){var t=this.nativeEvent;if(t.getModifierState)return t.getModifierState(e);var n=ko[e];return!!n&&!!t[n]}function Po(e){return Co}var Mo=lo(n({},Ao,{key:function(e){if(e.key){var t=So[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=oo(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?To[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Po,charCode:function(e){return"keypress"===e.type?oo(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?oo(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Io=lo(n({},go,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Lo=lo(n({},Ao,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Po})),Ro=lo(n({},fo,{propertyName:0,elapsedTime:0,pseudoElement:0})),zo=lo(n({},go,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Do=[9,13,27,32],Oo=I&&"CompositionEvent"in window,Bo=null;I&&"documentMode"in document&&(Bo=document.documentMode);var Fo=I&&"TextEvent"in window&&!Bo,No=I&&(!Oo||Bo&&Bo>8&&Bo<=11),Uo=String.fromCharCode(32);var jo=!1;function Vo(e,t){switch(e){case"keyup":return-1!==Do.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Go(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function Wo(e){return"ko"===e.locale}var $o=!1;function qo(e,t,n,i,r){var o,s;if(Oo?o=function(e){switch(e){case"compositionstart":return"onCompositionStart";case"compositionend":return"onCompositionEnd";case"compositionupdate":return"onCompositionUpdate"}}(t):$o?Vo(t,i)&&(o="onCompositionEnd"):function(e,t){return"keydown"===e&&229===t.keyCode}(t,i)&&(o="onCompositionStart"),!o)return null;No&&!Wo(i)&&($o||"onCompositionStart"!==o?"onCompositionEnd"===o&&$o&&(s=io()):$o=function(e){return eo=e,to=ro(),!0}(r));var a=Qs(n,o);if(a.length>0){var l=new wo(o,t,null,i,r);if(e.push({event:l,listeners:a}),s)l.data=s;else{var c=Go(i);null!==c&&(l.data=c)}}}function Zo(e,t){if($o){if("compositionend"===e||!Oo&&Vo(e,t)){var n=io();return eo=null,to=null,no=null,$o=!1,n}return null}switch(e){default:return null;case"keypress":if(!function(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}(t)){if(t.char&&t.char.length>1)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return No&&!Wo(t)?null:t.data}}function Ho(e,t,n,i,r){var o;if(!(o=Fo?function(e,t){switch(e){case"compositionend":return Go(t);case"keypress":return 32!==t.which?null:(jo=!0,Uo);case"textInput":var n=t.data;return n===Uo&&jo?null:n;default:return null}}(t,i):Zo(t,i)))return null;var s=Qs(n,"onBeforeInput");if(s.length>0){var a=new Eo("onBeforeInput","beforeinput",null,i,r);e.push({event:a,listeners:s}),a.data=o}}var Qo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xo(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Qo[e.type]:"textarea"===t}
/**
	 * Checks if an event is supported in the current execution environment.
	 *
	 * NOTE: This will not work correctly for non-generic events such as `change`,
	 * `reset`, `load`, `error`, and `select`.
	 *
	 * Borrows from Modernizr.
	 *
	 * @param {string} eventNameSuffix Event name, e.g. "click".
	 * @return {boolean} True if the event is supported.
	 * @internal
	 * @license Modernizr 3.0.0pre (Custom Build) | MIT
	 */function Yo(e,t,n,i){Bn(i);var r=Qs(t,"onChange");if(r.length>0){var o=new po("onChange","change",null,n,i);e.push({event:o,listeners:r})}}var Ko=null,Jo=null;function es(e){var t=[];Yo(t,Jo,e,Ln(e)),function(e,t){if(Gn)return e(t);Gn=!0;try{Nn(e,t)}finally{Gn=!1,$n()}}(ts,t)}function ts(e){Us(e,0)}function ns(e){if(ot(_l(e)))return e}function is(e,t){if("change"===e)return t}var rs=!1;function os(){Ko&&(Ko.detachEvent("onpropertychange",ss),Ko=null,Jo=null)}function ss(e){"value"===e.propertyName&&ns(Jo)&&es(e)}function as(e,t,n){"focusin"===e?(os(),function(e,t){Jo=t,(Ko=e).attachEvent("onpropertychange",ss)}(t,n)):"focusout"===e&&os()}function ls(e,t){if("selectionchange"===e||"keyup"===e||"keydown"===e)return ns(Jo)}function cs(e,t){if("click"===e)return ns(t)}function us(e,t){if("input"===e||"change"===e)return ns(t)}function hs(e,t,n,i,r,o,s){var a,l,c,u,h,d,f=n?_l(n):window;if("select"===(u=(c=f).nodeName&&c.nodeName.toLowerCase())||"input"===u&&"file"===c.type?a=is:Xo(f)?rs?a=us:(a=ls,l=as):function(e){var t=e.nodeName;return t&&"input"===t.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}(f)&&(a=cs),a){var p=a(t,n);if(p)return void Yo(e,p,i,r)}l&&l(t,f,n),"focusout"===t&&(d=(h=f)._wrapperState)&&d.controlled&&"number"===h.type&&yt(h,"number",h.value)}function ds(e,t,n,i,r,o,s){var a="mouseover"===t||"pointerover"===t,l="mouseout"===t||"pointerout"===t;if(a&&0==(16&o)){var c=i.relatedTarget||i.fromElement;if(c&&(gl(c)||ml(c)))return}if(l||a){var u,h,d;if(r.window===r)u=r;else{var f=r.ownerDocument;u=f?f.defaultView||f.parentWindow:window}if(l){var p=i.relatedTarget||i.toElement;if(h=n,null!==(d=p?gl(p):null))(d!==xi(d)||5!==d.tag&&6!==d.tag)&&(d=null)}else h=null,d=n;if(h!==d){var A=yo,m="onMouseLeave",g="onMouseEnter",y="mouse";"pointerout"!==t&&"pointerover"!==t||(A=Io,m="onPointerLeave",g="onPointerEnter",y="pointer");var _=null==h?u:_l(h),v=null==d?u:_l(d),b=new A(m,y+"leave",h,i,r);b.target=_,b.relatedTarget=v;var x=null;if(gl(r)===n){var w=new A(g,y+"enter",d,i,r);w.target=v,w.relatedTarget=_,x=w}!function(e,t,n,i,r){var o=i&&r?function(e,t){for(var n=e,i=t,r=0,o=n;o;o=Xs(o))r++;for(var s=0,a=i;a;a=Xs(a))s++;for(;r-s>0;)n=Xs(n),r--;for(;s-r>0;)i=Xs(i),s--;var l=r;for(;l--;){if(n===i||null!==i&&n===i.alternate)return n;n=Xs(n),i=Xs(i)}return null}(i,r):null;null!==i&&Ys(e,t,i,o,!1);null!==r&&null!==n&&Ys(e,n,r,o,!0)}(e,b,x,h,d)}}}I&&(rs=function(e){if(!I)return!1;var t="on"+e,n=t in document;if(!n){var i=document.createElement("div");i.setAttribute(t,"return;"),n="function"==typeof i[t]}return n}("input")&&(!document.documentMode||document.documentMode>9));var fs="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ps=Object.prototype.hasOwnProperty;function As(e,t){if(fs(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var r=0;r<n.length;r++)if(!ps.call(t,n[r])||!fs(e[n[r]],t[n[r]]))return!1;return!0}function ms(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function gs(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function ys(e,t){for(var n=ms(e),i=0,r=0;n;){if(3===n.nodeType){if(r=i+n.textContent.length,i<=t&&r>=t)return{node:n,offset:t-i};i=r}n=ms(gs(n))}}function _s(e){var t=e.ownerDocument,n=t&&t.defaultView||window,i=n.getSelection&&n.getSelection();if(!i||0===i.rangeCount)return null;var r=i.anchorNode,o=i.anchorOffset,s=i.focusNode,a=i.focusOffset;try{r.nodeType,s.nodeType}catch(e){return null}return function(e,t,n,i,r){var o=0,s=-1,a=-1,l=0,c=0,u=e,h=null;e:for(;;){for(var d=null;u!==t||0!==n&&3!==u.nodeType||(s=o+n),u!==i||0!==r&&3!==u.nodeType||(a=o+r),3===u.nodeType&&(o+=u.nodeValue.length),null!==(d=u.firstChild);)h=u,u=d;for(;;){if(u===e)break e;if(h===t&&++l===n&&(s=o),h===i&&++c===r&&(a=o),null!==(d=u.nextSibling))break;h=(u=h).parentNode}u=d}if(-1===s||-1===a)return null;return{start:s,end:a}}(e,r,o,s,a)}function vs(e){return e&&3===e.nodeType}function bs(e,t){return!(!e||!t)&&(e===t||!vs(e)&&(vs(t)?bs(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function xs(e){return e&&e.ownerDocument&&bs(e.ownerDocument.documentElement,e)}function ws(e){try{return"string"==typeof e.contentWindow.location.href}catch(e){return!1}}function Es(){for(var e=window,t=st();t instanceof e.HTMLIFrameElement;){if(!ws(t))return t;t=st((e=t.contentWindow).document)}return t}function Ss(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Ts(e){var t=Es(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&xs(n)){null!==i&&Ss(n)&&function(e,t){var n=t.start,i=t.end;void 0===i&&(i=n);"selectionStart"in e?(e.selectionStart=n,e.selectionEnd=Math.min(i,e.value.length)):function(e,t){var n=e.ownerDocument||document,i=n&&n.defaultView||window;if(i.getSelection){var r=i.getSelection(),o=e.textContent.length,s=Math.min(t.start,o),a=void 0===t.end?s:Math.min(t.end,o);if(!r.extend&&s>a){var l=a;a=s,s=l}var c=ys(e,s),u=ys(e,a);if(c&&u){if(1===r.rangeCount&&r.anchorNode===c.node&&r.anchorOffset===c.offset&&r.focusNode===u.node&&r.focusOffset===u.offset)return;var h=n.createRange();h.setStart(c.node,c.offset),r.removeAllRanges(),s>a?(r.addRange(h),r.extend(u.node,u.offset)):(h.setEnd(u.node,u.offset),r.addRange(h))}}}(e,t)}(n,i);for(var r=[],o=n;o=o.parentNode;)1===o.nodeType&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});"function"==typeof n.focus&&n.focus();for(var s=0;s<r.length;s++){var a=r[s];a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}}function ks(e){return("selectionStart"in e?{start:e.selectionStart,end:e.selectionEnd}:_s(e))||{start:0,end:0}}var Cs=I&&"documentMode"in document&&document.documentMode<=11;var Ps=null,Ms=null,Is=null,Ls=!1;function Rs(e,t,n){var i,r=(i=n).window===i?i.document:9===i.nodeType?i:i.ownerDocument;if(!Ls&&null!=Ps&&Ps===st(r)){var o=function(e){if("selectionStart"in e&&Ss(e))return{start:e.selectionStart,end:e.selectionEnd};var t=(e.ownerDocument&&e.ownerDocument.defaultView||window).getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}(Ps);if(!Is||!As(Is,o)){Is=o;var s=Qs(Ms,"onSelect");if(s.length>0){var a=new po("onSelect","select",null,t,n);e.push({event:a,listeners:s}),a.target=Ps}}}}function zs(e,t,n,i,r,o,s){var a=rr.get(t);if(void 0!==a){var l=po,c=t;switch(t){case"keypress":if(0===oo(i))return;case"keydown":case"keyup":l=Mo;break;case"focusin":c="focus",l=vo;break;case"focusout":c="blur",l=vo;break;case"beforeblur":case"afterblur":l=vo;break;case"click":if(2===i.button)return;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=yo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=_o;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Lo;break;case er:case tr:case nr:l=bo;break;case ir:l=Ro;break;case"scroll":l=mo;break;case"wheel":l=zo;break;case"copy":case"cut":case"paste":l=xo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Io}var u=0!=(4&o),h=!u&&"scroll"===t,d=function(e,t,n,i,r){var o=null!==t?t+"Capture":null,s=i?o:t,a=[],l=e,c=null;for(;null!==l;){var u=l,h=u.stateNode;if(5===u.tag&&null!==h&&(c=h,null!==s)){var d=qn(l,s);null!=d&&a.push(Hs(l,d,c))}if(r)break;l=l.return}return a}(n,a,i.type,u,h);if(d.length>0){var f=new l(a,c,null,i,r);e.push({event:f,listeners:d})}}}function Ds(e,t,n,i,r,o,s){zs(e,t,n,i,r,o),0==(7&o)&&(ds(e,t,n,i,r,o),hs(e,t,n,i,r),function(e,t,n,i,r,o,s){var a=n?_l(n):window;switch(t){case"focusin":(Xo(a)||"true"===a.contentEditable)&&(Ps=a,Ms=n,Is=null);break;case"focusout":Ps=null,Ms=null,Is=null;break;case"mousedown":Ls=!0;break;case"contextmenu":case"mouseup":case"dragend":Ls=!1,Rs(e,i,r);break;case"selectionchange":if(Cs)break;case"keydown":case"keyup":Rs(e,i,r)}}(e,t,n,i,r),function(e,t,n,i,r,o,s){qo(e,t,n,i,r),Ho(e,t,n,i,r)}(e,t,n,i,r))}ur(sr,0),ur(lr,1),ur(cr,2),function(e,t){for(var n=0;n<e.length;n++)or.set(e[n],t)}(ar,0),M("onMouseEnter",["mouseout","mouseover"]),M("onMouseLeave",["mouseout","mouseover"]),M("onPointerEnter",["pointerout","pointerover"]),M("onPointerLeave",["pointerout","pointerover"]),P("onChange",["change","click","focusin","focusout","input","keydown","keyup","selectionchange"]),P("onSelect",["focusout","contextmenu","dragend","focusin","keydown","keyup","mousedown","mouseup","selectionchange"]),P("onBeforeInput",["compositionend","keypress","textInput","paste"]),P("onCompositionEnd",["compositionend","focusout","keydown","keypress","keyup","mousedown"]),P("onCompositionStart",["compositionstart","focusout","keydown","keypress","keyup","mousedown"]),P("onCompositionUpdate",["compositionupdate","focusout","keydown","keypress","keyup","mousedown"]);var Os=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],Bs=new Set(["cancel","close","invalid","load","scroll","toggle"].concat(Os));function Fs(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,s,a,l){if(ri.apply(this,arguments),Jn){var c=si();ti||(ti=!0,ni=c)}}(i,t,void 0,e),e.currentTarget=null}function Ns(e,t,n){var i;if(n)for(var r=t.length-1;r>=0;r--){var o=t[r],s=o.instance,a=o.currentTarget,l=o.listener;if(s!==i&&e.isPropagationStopped())return;Fs(e,l,a),i=s}else for(var c=0;c<t.length;c++){var u=t[c],h=u.instance,d=u.currentTarget,f=u.listener;if(h!==i&&e.isPropagationStopped())return;Fs(e,f,d),i=h}}function Us(e,t){for(var n=0!=(4&t),i=0;i<e.length;i++){var r=e[i];Ns(r.event,r.listeners,n)}!function(){if(ti){var e=ni;throw ti=!1,ni=null,e}}()}function js(e,t){var n=xl(t),i=Ks(e,false);n.has(i)||($s(t,e,2,false),n.add(i))}var Vs="_reactListening"+Math.random().toString(36).slice(2);function Gs(e){e[Vs]||(e[Vs]=!0,T.forEach((function(t){Bs.has(t)||Ws(t,!1,e,null),Ws(t,!0,e,null)})))}function Ws(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=n;if("selectionchange"===e&&9!==n.nodeType&&(o=n.ownerDocument),null!==i&&!t&&Bs.has(e)){if("scroll"!==e)return;r|=2,o=i}var s=xl(o),a=Ks(e,t);s.has(a)||(t&&(r|=4),$s(o,e,r,t),s.add(a))}function $s(e,t,n,i,r){var o=Qr(e,t,n),s=void 0;Zn&&("touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0)),e=e,i?void 0!==s?function(e,t,n,i){e.addEventListener(t,n,{capture:!0,passive:i})}(e,t,o,s):function(e,t,n){e.addEventListener(t,n,!0)}(e,t,o):void 0!==s?function(e,t,n,i){e.addEventListener(t,n,{passive:i})}(e,t,o,s):function(e,t,n){e.addEventListener(t,n,!1)}(e,t,o)}function qs(e,t){return e===t||8===e.nodeType&&e.parentNode===t}function Zs(e,t,n,i,r){var o=i;if(0==(1&t)&&0==(2&t)){var s=r;if(null!==i){var a=i;e:for(;;){if(null===a)return;var l=a.tag;if(3===l||4===l){var c=a.stateNode.containerInfo;if(qs(c,s))break;if(4===l)for(var u=a.return;null!==u;){var h=u.tag;if(3===h||4===h)if(qs(u.stateNode.containerInfo,s))return;u=u.return}for(;null!==c;){var d=gl(c);if(null===d)return;var f=d.tag;if(5===f||6===f){a=o=d;continue e}c=c.parentNode}}a=a.return}}}!function(e,t,n){if(Wn)return e(t,n);Wn=!0;try{Vn(e,t,n)}finally{Wn=!1,$n()}}((function(){return function(e,t,n,i,r){var o=[];Ds(o,e,i,n,Ln(n),t),Us(o,t)}(e,t,n,o)}))}function Hs(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Qs(e,t){for(var n=t+"Capture",i=[],r=e;null!==r;){var o=r,s=o.stateNode;if(5===o.tag&&null!==s){var a=s,l=qn(r,n);null!=l&&i.unshift(Hs(r,l,a));var c=qn(r,t);null!=c&&i.push(Hs(r,c,a))}r=r.return}return i}function Xs(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Ys(e,t,n,i,r){for(var o=t._reactName,s=[],a=n;null!==a&&a!==i;){var l=a,c=l.alternate,u=l.stateNode,h=l.tag;if(null!==c&&c===i)break;if(5===h&&null!==u){var d=u;if(r){var f=qn(a,o);null!=f&&s.unshift(Hs(a,f,d))}else if(!r){var p=qn(a,o);null!=p&&s.push(Hs(a,p,d))}}a=a.return}0!==s.length&&e.push({event:t,listeners:s})}function Ks(e,t){return e+"__"+(t?"capture":"bubble")}var Js,ea,ta,na,ia,ra,oa,sa,aa,la,ca=!1,ua="dangerouslySetInnerHTML",ha="suppressContentEditableWarning",da="suppressHydrationWarning",fa="autoFocus",pa="children",Aa="style",ma=Bt;Js={dialog:!0,webview:!0},ta=function(e,t){xn(e,t),function(e,t){"input"!==e&&"textarea"!==e&&"select"!==e||null==t||null!==t.value||wn||(wn=!0,"select"===e&&t.multiple?l("`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.",e):l("`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",e))}(e,t),In(e,t,{registrationNameDependencies:k,possibleRegistrationNames:C})},sa=I&&!document.documentMode;var ga=/\r\n?/g,ya=/\u0000|\uFFFD/g;function _a(e){return 9===e.nodeType?e:e.ownerDocument}function va(){}function ba(e){e.onclick=va}function xa(e,t,n,i){var r,o=pn(t,n);switch(ta(t,n),t){case"dialog":js("cancel",e),js("close",e),r=n;break;case"iframe":case"object":case"embed":js("load",e),r=n;break;case"video":case"audio":for(var s=0;s<Os.length;s++)js(Os[s],e);r=n;break;case"source":js("error",e),r=n;break;case"img":case"image":case"link":js("error",e),js("load",e),r=n;break;case"details":js("toggle",e),r=n;break;case"input":ft(e,n),r=dt(e,n),js("invalid",e);break;case"option":xt(0,n),r=wt(0,n);break;case"select":Ct(e,n),r=kt(0,n),js("invalid",e);break;case"textarea":It(e,n),r=Mt(e,n),js("invalid",e);break;default:r=n}switch(fn(t,r),function(e,t,n,i,r){for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];if(o===Aa)s&&Object.freeze(s),un(t,s);else if(o===ua){var a=s?s.__html:void 0;null!=a&&Gt(t,a)}else o===pa?"string"==typeof s?("textarea"!==e||""!==s)&&$t(t,s):"number"==typeof s&&$t(t,""+s):o===ha||o===da||o===fa||(k.hasOwnProperty(o)?null!=s&&("function"!=typeof s&&oa(o,s),"onScroll"===o&&js("scroll",t)):null!=s&&J(t,o,s,r))}}(t,e,0,r,o),t){case"input":rt(e),mt(e,n,!1);break;case"textarea":rt(e),Rt(e);break;case"option":!function(e,t){null!=t.value&&e.setAttribute("value",Ke(Je(t.value)))}(e,n);break;case"select":!function(e,t){var n=e;n.multiple=!!t.multiple;var i=t.value;null!=i?Tt(n,!!t.multiple,i,!1):null!=t.defaultValue&&Tt(n,!!t.multiple,t.defaultValue,!0)}(e,n);break;default:"function"==typeof r.onClick&&ba(e)}}function wa(e,t,n,i,r){ta(t,i);var o,s,a,c,u=null;switch(t){case"input":o=dt(e,n),s=dt(e,i),u=[];break;case"option":o=wt(0,n),s=wt(0,i),u=[];break;case"select":o=kt(0,n),s=kt(0,i),u=[];break;case"textarea":o=Mt(e,n),s=Mt(e,i),u=[];break;default:s=i,"function"!=typeof(o=n).onClick&&"function"==typeof s.onClick&&ba(e)}fn(t,s);var h=null;for(a in o)if(!s.hasOwnProperty(a)&&o.hasOwnProperty(a)&&null!=o[a])if(a===Aa){var d=o[a];for(c in d)d.hasOwnProperty(c)&&(h||(h={}),h[c]="")}else a===ua||a===pa||a===ha||a===da||a===fa||(k.hasOwnProperty(a)?u||(u=[]):(u=u||[]).push(a,null));for(a in s){var f=s[a],p=null!=o?o[a]:void 0;if(s.hasOwnProperty(a)&&f!==p&&(null!=f||null!=p))if(a===Aa)if(f&&Object.freeze(f),p){for(c in p)!p.hasOwnProperty(c)||f&&f.hasOwnProperty(c)||(h||(h={}),h[c]="");for(c in f)f.hasOwnProperty(c)&&p[c]!==f[c]&&(h||(h={}),h[c]=f[c])}else h||(u||(u=[]),u.push(a,h)),h=f;else if(a===ua){var A=f?f.__html:void 0,m=p?p.__html:void 0;null!=A&&m!==A&&(u=u||[]).push(a,A)}else a===pa?"string"!=typeof f&&"number"!=typeof f||(u=u||[]).push(a,""+f):a===ha||a===da||(k.hasOwnProperty(a)?(null!=f&&("function"!=typeof f&&oa(a,f),"onScroll"===a&&js("scroll",e)),u||p===f||(u=[])):"object"==typeof f&&null!==f&&f.$$typeof===fe?f.toString():(u=u||[]).push(a,f))}return h&&(!function(e,t){if(t){var n,i=hn(e),r=hn(t),o={};for(var s in i){var a=i[s],c=r[s];if(c&&a!==c){var u=a+","+c;if(o[u])continue;o[u]=!0,l("%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",null==(n=e[a])||"boolean"==typeof n||""===n?"Removing":"Updating",a,c)}}}}(h,s.style),(u=u||[]).push(Aa,h)),u}function Ea(e,t,n,i,r){"input"===n&&"radio"===r.type&&null!=r.name&&pt(e,r);pn(n,i);switch(function(e,t,n,i){for(var r=0;r<t.length;r+=2){var o=t[r],s=t[r+1];o===Aa?un(e,s):o===ua?Gt(e,s):o===pa?$t(e,s):J(e,o,s,i)}}(e,t,0,pn(n,r)),n){case"input":At(e,r);break;case"textarea":Lt(e,r);break;case"select":!function(e,t){var n=e,i=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!t.multiple;var r=t.value;null!=r?Tt(n,!!t.multiple,r,!1):i!==!!t.multiple&&(null!=t.defaultValue?Tt(n,!!t.multiple,t.defaultValue,!0):Tt(n,!!t.multiple,t.multiple?[]:"",!1))}(e,r)}}function Sa(e,t){na(e.nodeValue,t)}function Ta(e,t){ca||(ca=!0,l("Did not expect server HTML to contain a <%s> in <%s>.",t.nodeName.toLowerCase(),e.nodeName.toLowerCase()))}function ka(e,t){ca||(ca=!0,l('Did not expect server HTML to contain the text node "%s" in <%s>.',t.nodeValue,e.nodeName.toLowerCase()))}function Ca(e,t,n){ca||(ca=!0,l("Expected server HTML to contain a matching <%s> in <%s>.",t,e.nodeName.toLowerCase()))}function Pa(e,t){""!==t&&(ca||(ca=!0,l('Expected server HTML to contain a matching text node for "%s" in <%s>.',t,e.nodeName.toLowerCase())))}aa=function(e){return("string"==typeof e?e:""+e).replace(ga,"\n").replace(ya,"")},na=function(e,t){if(!ca){var n=aa(t),i=aa(e);i!==n&&(ca=!0,l('Text content did not match. Server: "%s" Client: "%s"',i,n))}},ia=function(e,t,n){if(!ca){var i=aa(n),r=aa(t);r!==i&&(ca=!0,l("Prop `%s` did not match. Server: %s Client: %s",e,JSON.stringify(r),JSON.stringify(i)))}},ra=function(e){if(!ca){ca=!0;var t=[];e.forEach((function(e){t.push(e)})),l("Extra attributes from the server: %s",t)}},oa=function(e,t){!1===t?l("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",e,e,e):l("Expected `%s` listener to be a function, instead got a value of `%s` type.",e,typeof t)},la=function(e,t){var n=e.namespaceURI===ma?e.ownerDocument.createElement(e.tagName):e.ownerDocument.createElementNS(e.namespaceURI,e.tagName);return n.innerHTML=t,n.innerHTML};var Ma,Ia,La=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],Ra=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],za=Ra.concat(["button"]),Da=["dd","dt","li","option","optgroup","p","rp","rt"],Oa={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};Ia=function(e,t){var i=n({},e||Oa),r={tag:t};return-1!==Ra.indexOf(t)&&(i.aTagInScope=null,i.buttonTagInScope=null,i.nobrTagInScope=null),-1!==za.indexOf(t)&&(i.pTagInButtonScope=null),-1!==La.indexOf(t)&&"address"!==t&&"div"!==t&&"p"!==t&&(i.listItemTagAutoclosing=null,i.dlItemTagAutoclosing=null),i.current=r,"form"===t&&(i.formTag=r),"a"===t&&(i.aTagInScope=r),"button"===t&&(i.buttonTagInScope=r),"nobr"===t&&(i.nobrTagInScope=r),"p"===t&&(i.pTagInButtonScope=r),"li"===t&&(i.listItemTagAutoclosing=r),"dd"!==t&&"dt"!==t||(i.dlItemTagAutoclosing=r),i};var Ba={};Ma=function(e,t,n){var i=(n=n||Oa).current,r=i&&i.tag;null!=t&&(null!=e&&l("validateDOMNesting: when childText is passed, childTag should be null"),e="#text");var o=function(e,t){switch(t){case"select":return"option"===e||"optgroup"===e||"#text"===e;case"optgroup":return"option"===e||"#text"===e;case"option":return"#text"===e;case"tr":return"th"===e||"td"===e||"style"===e||"script"===e||"template"===e;case"tbody":case"thead":case"tfoot":return"tr"===e||"style"===e||"script"===e||"template"===e;case"colgroup":return"col"===e||"template"===e;case"table":return"caption"===e||"colgroup"===e||"tbody"===e||"tfoot"===e||"thead"===e||"style"===e||"script"===e||"template"===e;case"head":return"base"===e||"basefont"===e||"bgsound"===e||"link"===e||"meta"===e||"title"===e||"noscript"===e||"noframes"===e||"style"===e||"script"===e||"template"===e;case"html":return"head"===e||"body"===e||"frameset"===e;case"frameset":return"frame"===e;case"#document":return"html"===e}switch(e){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return"h1"!==t&&"h2"!==t&&"h3"!==t&&"h4"!==t&&"h5"!==t&&"h6"!==t;case"rp":case"rt":return-1===Da.indexOf(t);case"body":case"caption":case"col":case"colgroup":case"frameset":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return null==t}return!0}(e,r)?null:i,s=o?null:function(e,t){switch(e){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return t.pTagInButtonScope;case"form":return t.formTag||t.pTagInButtonScope;case"li":return t.listItemTagAutoclosing;case"dd":case"dt":return t.dlItemTagAutoclosing;case"button":return t.buttonTagInScope;case"a":return t.aTagInScope;case"nobr":return t.nobrTagInScope}return null}(e,n),a=o||s;if(a){var c=a.tag,u=!!o+"|"+e+"|"+c;if(!Ba[u]){Ba[u]=!0;var h=e,d="";if("#text"===e?/\S/.test(t)?h="Text nodes":(h="Whitespace text nodes",d=" Make sure you don't have any extra whitespace between tags on each line of your source code."):h="<"+e+">",o){var f="";"table"===c&&"tr"===e&&(f+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),l("validateDOMNesting(...): %s cannot appear as a child of <%s>.%s%s",h,c,d,f)}else l("validateDOMNesting(...): %s cannot appear as a descendant of <%s>.",h,c)}}};var Fa="$?",Na="$!",Ua=null,ja=null;function Va(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Ga(e){var t;Ua=Zr,t=Es(),ja={focusedElem:t,selectionRange:Ss(t)?ks(t):null};return Hr(!1),null}function Wa(e,t,n,i,r){var o=i;if(Ma(e,null,o.ancestorInfo),"string"==typeof t.children||"number"==typeof t.children){var s=""+t.children,a=Ia(o.ancestorInfo,e);Ma(null,s,a)}var c=function(e,t,n,i){var r,o,s=_a(n),a=i;if(a===ma&&(a=Nt(e)),a===ma){if((r=pn(e,t))||e===e.toLowerCase()||l("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",e),"script"===e){var c=s.createElement("div");c.innerHTML="<script><\/script>";var u=c.firstChild;o=c.removeChild(u)}else if("string"==typeof t.is)o=s.createElement(e,{is:t.is});else if(o=s.createElement(e),"select"===e){var h=o;t.multiple?h.multiple=!0:t.size&&(h.size=t.size)}}else o=s.createElementNS(a,e);return a===ma&&(r||"[object HTMLUnknownElement]"!==Object.prototype.toString.call(o)||Object.prototype.hasOwnProperty.call(Js,e)||(Js[e]=!0,l("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",e))),o}(e,t,n,o.namespace);return pl(r,c),bl(c,t),c}function $a(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}function qa(e,t,n,i){Ma(null,e,n.ancestorInfo);var r=function(e,t){return _a(t).createTextNode(e)}(e,t);return pl(i,r),r}var Za="function"==typeof setTimeout?setTimeout:void 0,Ha="function"==typeof clearTimeout?clearTimeout:void 0;function Qa(e){$t(e,"")}function Xa(e,t){e.removeChild(t)}function Ya(e){var t=(e=e).style;"function"==typeof t.setProperty?t.setProperty("display","none","important"):t.display="none"}function Ka(e,t){e=e;var n=t.style,i=null!=n&&n.hasOwnProperty("display")?n.display:null;e.style.display=Qt("display",i)}function Ja(e,t){e.nodeValue=t}function el(e){if(1===e.nodeType)e.textContent="";else if(9===e.nodeType){var t=e.body;null!=t&&(t.textContent="")}}function tl(e){return e.data===Na}function nl(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function il(e){return nl(e.nextSibling)}function rl(e){return nl(e.firstChild)}function ol(e,t,n,i,r,o){return pl(o,e),bl(e,n),function(e,t,n,i,r){var o,s;switch(ea=!0===n.suppressHydrationWarning,o=pn(t,n),ta(t,n),t){case"dialog":js("cancel",e),js("close",e);break;case"iframe":case"object":case"embed":js("load",e);break;case"video":case"audio":for(var a=0;a<Os.length;a++)js(Os[a],e);break;case"source":js("error",e);break;case"img":case"image":case"link":js("error",e),js("load",e);break;case"details":js("toggle",e);break;case"input":ft(e,n),js("invalid",e);break;case"option":xt(0,n);break;case"select":Ct(e,n),js("invalid",e);break;case"textarea":It(e,n),js("invalid",e)}fn(t,n),s=new Set;for(var l=e.attributes,c=0;c<l.length;c++)switch(l[c].name.toLowerCase()){case"data-reactroot":case"value":case"checked":case"selected":break;default:s.add(l[c].name)}var u,h=null;for(var d in n)if(n.hasOwnProperty(d)){var f=n[d];if(d===pa)"string"==typeof f?e.textContent!==f&&(ea||na(e.textContent,f),h=[pa,f]):"number"==typeof f&&e.textContent!==""+f&&(ea||na(e.textContent,f),h=[pa,""+f]);else if(k.hasOwnProperty(d))null!=f&&("function"!=typeof f&&oa(d,f),"onScroll"===d&&js("scroll",e));else if("boolean"==typeof o){var p=void 0,A=G(d);if(ea);else if(d===ha||d===da||"value"===d||"checked"===d||"selected"===d);else if(d===ua){var m=e.innerHTML,g=f?f.__html:void 0;if(null!=g){var y=la(e,g);y!==m&&ia(d,m,y)}}else if(d===Aa){if(s.delete(d),sa){var _=cn(f);_!==(p=e.getAttribute("style"))&&ia(d,p,_)}}else if(o)s.delete(d.toLowerCase()),f!==(p=K(e,d,f))&&ia(d,p,f);else if(!U(d,A,o)&&!V(d,f,A,o)){var v=!1;if(null!==A)s.delete(A.attributeName),p=Y(e,d,f,A);else{var b=i;if(b===ma&&(b=Nt(t)),b===ma)s.delete(d.toLowerCase());else{var x=(u=void 0,u=d.toLowerCase(),An.hasOwnProperty(u)&&An[u]||null);null!==x&&x!==d&&(v=!0,s.delete(x)),s.delete(d)}p=K(e,d,f)}f===p||v||ia(d,p,f)}}}switch(s.size>0&&!ea&&ra(s),t){case"input":rt(e),mt(e,n,!0);break;case"textarea":rt(e),Rt(e);break;case"select":case"option":break;default:"function"==typeof n.onClick&&ba(e)}return h}(e,t,n,r.namespace)}function sl(e){for(var t=e.previousSibling,n=0;t;){if(8===t.nodeType){var i=t.data;if("$"===i||i===Na||i===Fa){if(0===n)return t;n--}else"/$"===i&&n++}t=t.previousSibling}return null}var al=0;function ll(e){var t="r:"+(al++).toString(36);return{toString:function(){return e(),t},valueOf:function(){return e(),t}}}var cl=Math.random().toString(36).slice(2),ul="__reactFiber$"+cl,hl="__reactProps$"+cl,dl="__reactContainer$"+cl,fl="__reactEvents$"+cl;function pl(e,t){t[ul]=e}function Al(e){e[dl]=null}function ml(e){return!!e[dl]}function gl(e){var t=e[ul];if(t)return t;for(var n=e.parentNode;n;){if(t=n[dl]||n[ul]){var i=t.alternate;if(null!==t.child||null!==i&&null!==i.child)for(var r=sl(e);null!==r;){var o=r[ul];if(o)return o;r=sl(r)}return t}n=(e=n).parentNode}return null}function yl(e){var t=e[ul]||e[dl];return t&&(5===t.tag||6===t.tag||t.tag===m||3===t.tag)?t:null}function _l(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error("getNodeFromInstance: Invalid argument.")}function vl(e){return e[hl]||null}function bl(e,t){e[hl]=t}function xl(e){var t=e[fl];return void 0===t&&(t=e[fl]=new Set),t}var wl={},El=o.ReactDebugCurrentFrame;function Sl(e){if(e){var t=e._owner,n=Ne(e.type,e._source,t?t.type:null);El.setExtraStackFrame(n)}else El.setExtraStackFrame(null)}function Tl(e,t,n,i,r){var o=Function.call.bind(Object.prototype.hasOwnProperty);for(var s in e)if(o(e,s)){var a=void 0;try{if("function"!=typeof e[s]){var c=Error((i||"React class")+": "+n+" type `"+s+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[s]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw c.name="Invariant Violation",c}a=e[s](t,s,i,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){a=e}!a||a instanceof Error||(Sl(r),l("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",i||"React class",n,s,typeof a),Sl(null)),a instanceof Error&&!(a.message in wl)&&(wl[a.message]=!0,Sl(r),l("Failed %s type: %s",n,a.message),Sl(null))}}var kl,Cl=[];kl=[];var Pl,Ml=-1;function Il(e){return{current:e}}function Ll(e,t){Ml<0?l("Unexpected pop."):(t!==kl[Ml]&&l("Unexpected Fiber popped."),e.current=Cl[Ml],Cl[Ml]=null,kl[Ml]=null,Ml--)}function Rl(e,t,n){Ml++,Cl[Ml]=e.current,kl[Ml]=n,e.current=t}Pl={};var zl={};Object.freeze(zl);var Dl=Il(zl),Ol=Il(!1),Bl=zl;function Fl(e,t,n){return n&&Vl(t)?Bl:Dl.current}function Nl(e,t,n){var i=e.stateNode;i.__reactInternalMemoizedUnmaskedChildContext=t,i.__reactInternalMemoizedMaskedChildContext=n}function Ul(e,t){var n=e.type,i=n.contextTypes;if(!i)return zl;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={};for(var s in i)o[s]=t[s];return Tl(i,o,"context",Ge(n)||"Unknown"),r&&Nl(e,t,o),o}function jl(){return Ol.current}function Vl(e){var t=e.childContextTypes;return null!=t}function Gl(e){Ll(Ol,e),Ll(Dl,e)}function Wl(e){Ll(Ol,e),Ll(Dl,e)}function $l(e,t,n){if(Dl.current!==zl)throw Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");Rl(Dl,t,e),Rl(Ol,n,e)}function ql(e,t,i){var r=e.stateNode,o=t.childContextTypes;if("function"!=typeof r.getChildContext){var s=Ge(t)||"Unknown";return Pl[s]||(Pl[s]=!0,l("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",s,s)),i}var a=r.getChildContext();for(var c in a)if(!(c in o))throw Error((Ge(t)||"Unknown")+'.getChildContext(): key "'+c+'" is not defined in childContextTypes.');return Tl(o,a,"child context",Ge(t)||"Unknown"),n({},i,a)}function Zl(e){var t=e.stateNode,n=t&&t.__reactInternalMemoizedMergedChildContext||zl;return Bl=Dl.current,Rl(Dl,n,e),Rl(Ol,Ol.current,e),!0}function Hl(e,t,n){var i=e.stateNode;if(!i)throw Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(n){var r=ql(e,t,Bl);i.__reactInternalMemoizedMergedChildContext=r,Ll(Ol,e),Ll(Dl,e),Rl(Dl,r,e),Rl(Ol,n,e)}else Ll(Ol,e),Rl(Ol,n,e)}function Ql(e){if(!function(e){return xi(e)===e}(e)||1!==e.tag)throw Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var t=e;do{switch(t.tag){case 3:return t.stateNode.context;case 1:if(Vl(t.type))return t.stateNode.__reactInternalMemoizedMergedChildContext}t=t.return}while(null!==t);throw Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}var Xl=null,Yl=null,Kl=!1,Jl="undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__;function ec(e,t){if(Yl&&"function"==typeof Yl.onCommitFiberRoot)try{var n=(e.current.flags&di)===di;Yl.onCommitFiberRoot(Xl,e,t,n)}catch(e){Kl||(Kl=!0,l("React instrumentation encountered an error: %s",e))}}var tc=i.unstable_runWithPriority,nc=i.unstable_scheduleCallback,ic=i.unstable_cancelCallback,rc=i.unstable_shouldYield,oc=i.unstable_requestPaint,sc=i.unstable_now,ac=i.unstable_getCurrentPriorityLevel,lc=i.unstable_ImmediatePriority,cc=i.unstable_UserBlockingPriority,uc=i.unstable_NormalPriority,hc=i.unstable_LowPriority,dc=i.unstable_IdlePriority;if(null==r.__interactionsRef||null==r.__interactionsRef.current)throw Error("It is not supported to run the profiling version of a renderer (for example, `react-dom/profiling`) without also replacing the `scheduler/tracing` module with `scheduler/tracing-profiling`. Your bundler might have a setting for aliasing both modules. Learn more at https://reactjs.org/link/profiling");var fc={},pc=99,Ac=98,mc=97,gc=rc,yc=void 0!==oc?oc:function(){},_c=null,vc=null,bc=!1,xc=sc(),wc=xc<1e4?sc:function(){return sc()-xc};function Ec(){switch(ac()){case lc:return pc;case cc:return Ac;case uc:return mc;case hc:return 96;case dc:return 95;default:throw Error("Unknown priority level.")}}function Sc(e){switch(e){case pc:return lc;case Ac:return cc;case mc:return uc;case 96:return hc;case 95:return dc;default:throw Error("Unknown priority level.")}}function Tc(e,t){var n=Sc(e);return tc(n,t)}function kc(e,t,n){var i=Sc(e);return nc(i,t,n)}function Cc(e){e!==fc&&ic(e)}function Pc(){if(null!==vc){var e=vc;vc=null,ic(e)}Mc()}function Mc(){if(!bc&&null!==_c){bc=!0;var e=0;try{var t=_c;Tc(pc,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(true)}while(null!==n)}})),_c=null}catch(t){throw null!==_c&&(_c=_c.slice(e+1)),nc(lc,Pc),t}finally{bc=!1}}}var Ic="17.0.2",Lc=o.ReactCurrentBatchConfig;var Rc={recordUnsafeLifecycleWarnings:function(e,t){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(e,t){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}},zc=function(e){var t=[];return e.forEach((function(e){t.push(e)})),t.sort().join(", ")},Dc=[],Oc=[],Bc=[],Fc=[],Nc=[],Uc=[],jc=new Set;Rc.recordUnsafeLifecycleWarnings=function(e,t){jc.has(e.type)||("function"==typeof t.componentWillMount&&!0!==t.componentWillMount.__suppressDeprecationWarning&&Dc.push(e),1&e.mode&&"function"==typeof t.UNSAFE_componentWillMount&&Oc.push(e),"function"==typeof t.componentWillReceiveProps&&!0!==t.componentWillReceiveProps.__suppressDeprecationWarning&&Bc.push(e),1&e.mode&&"function"==typeof t.UNSAFE_componentWillReceiveProps&&Fc.push(e),"function"==typeof t.componentWillUpdate&&!0!==t.componentWillUpdate.__suppressDeprecationWarning&&Nc.push(e),1&e.mode&&"function"==typeof t.UNSAFE_componentWillUpdate&&Uc.push(e))},Rc.flushPendingUnsafeLifecycleWarnings=function(){var e=new Set;Dc.length>0&&(Dc.forEach((function(t){e.add(Ge(t.type)||"Component"),jc.add(t.type)})),Dc=[]);var t=new Set;Oc.length>0&&(Oc.forEach((function(e){t.add(Ge(e.type)||"Component"),jc.add(e.type)})),Oc=[]);var n=new Set;Bc.length>0&&(Bc.forEach((function(e){n.add(Ge(e.type)||"Component"),jc.add(e.type)})),Bc=[]);var i=new Set;Fc.length>0&&(Fc.forEach((function(e){i.add(Ge(e.type)||"Component"),jc.add(e.type)})),Fc=[]);var r=new Set;Nc.length>0&&(Nc.forEach((function(e){r.add(Ge(e.type)||"Component"),jc.add(e.type)})),Nc=[]);var o=new Set;(Uc.length>0&&(Uc.forEach((function(e){o.add(Ge(e.type)||"Component"),jc.add(e.type)})),Uc=[]),t.size>0)&&l("Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n\nPlease update the following components: %s",zc(t));i.size>0&&l("Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n\nPlease update the following components: %s",zc(i));o.size>0&&l("Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n\nPlease update the following components: %s",zc(o));e.size>0&&s("componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",zc(e));n.size>0&&s("componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",zc(n));r.size>0&&s("componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",zc(r))};var Vc=new Map,Gc=new Set;function Wc(e,t){if(e&&e.defaultProps){var i=n({},t),r=e.defaultProps;for(var o in r)void 0===i[o]&&(i[o]=r[o]);return i}return t}Rc.recordLegacyContextWarning=function(e,t){var n=function(e){for(var t=null,n=e;null!==n;)1&n.mode&&(t=n),n=n.return;return t}(e);if(null!==n){if(!Gc.has(e.type)){var i=Vc.get(n);(null!=e.type.contextTypes||null!=e.type.childContextTypes||null!==t&&"function"==typeof t.getChildContext)&&(void 0===i&&(i=[],Vc.set(n,i)),i.push(e))}}else l("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.")},Rc.flushLegacyContextWarning=function(){Vc.forEach((function(e,t){if(0!==e.length){var n=e[0],i=new Set;e.forEach((function(e){i.add(Ge(e.type)||"Component"),Gc.add(e.type)}));var r=zc(i);try{Xe(n),l("Legacy context API has been detected within a strict-mode tree.\n\nThe old API will be supported in all 16.x releases, but applications using it should migrate to the new version.\n\nPlease update the following components: %s\n\nLearn more about this warning here: https://reactjs.org/link/legacy-context",r)}finally{Qe()}}}))},Rc.discardPendingWarnings=function(){Dc=[],Oc=[],Bc=[],Fc=[],Nc=[],Uc=[],Vc=new Map};var $c,qc=1073741823,Zc=Il(null);$c={};var Hc=null,Qc=null,Xc=null,Yc=!1;function Kc(){Hc=null,Qc=null,Xc=null,Yc=!1}function Jc(){Yc=!0}function eu(){Yc=!1}function tu(e,t){var n=e.type._context;Rl(Zc,n._currentValue,e),n._currentValue=t,void 0!==n._currentRenderer&&null!==n._currentRenderer&&n._currentRenderer!==$c&&l("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),n._currentRenderer=$c}function nu(e){var t=Zc.current;Ll(Zc,e),e.type._context._currentValue=t}function iu(e,t){for(var n=e;null!==n;){var i=n.alternate;if(Dr(n.childLanes,t)){if(null===i||Dr(i.childLanes,t))break;i.childLanes=Or(i.childLanes,t)}else n.childLanes=Or(n.childLanes,t),null!==i&&(i.childLanes=Or(i.childLanes,t));n=n.return}}function ru(e,t){Hc=e,Qc=null,Xc=null;var n=e.dependencies;null!==n&&(null!==n.firstContext&&(zr(n.lanes,t)&&op(),n.firstContext=null))}function ou(e,t){if(Yc&&l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo()."),Xc===e);else if(!1===t||0===t);else{var n;"number"!=typeof t||t===qc?(Xc=e,n=qc):n=t;var i={context:e,observedBits:n,next:null};if(null===Qc){if(null===Hc)throw Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");Qc=i,Hc.dependencies={lanes:0,firstContext:i,responders:null}}else Qc=Qc.next=i}return e._currentValue}var su,au,lu=2,cu=!1;function uu(e){var t={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null};e.updateQueue=t}function hu(e,t){var n=t.updateQueue,i=e.updateQueue;if(n===i){var r={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects};t.updateQueue=r}}function du(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function fu(e,t){var n=e.updateQueue;if(null!==n){var i=n.shared,r=i.pending;null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,au!==i||su||(l("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),su=!0)}}function pu(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i){var r=i.updateQueue;if(n===r){var o=null,s=null,a=n.firstBaseUpdate;if(null!==a){var l=a;do{var c={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};null===s?o=s=c:(s.next=c,s=c),l=l.next}while(null!==l);null===s?o=s=t:(s.next=t,s=t)}else o=s=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}}var u=n.lastBaseUpdate;null===u?n.firstBaseUpdate=t:u.next=t,n.lastBaseUpdate=t}function Au(e,t,i,r,o,s){switch(i.tag){case 1:var a=i.payload;if("function"==typeof a){Jc();var l=a.call(s,r,o);if(1&e.mode){Pe();try{a.call(s,r,o)}finally{Me()}}return eu(),l}return a;case 3:e.flags=-4097&e.flags|di;case 0:var c,u=i.payload;if("function"==typeof u){if(Jc(),c=u.call(s,r,o),1&e.mode){Pe();try{u.call(s,r,o)}finally{Me()}}eu()}else c=u;return null==c?r:n({},r,c);case lu:return cu=!0,r}return r}function mu(e,t,n,i){var r=e.updateQueue;cu=!1,au=r.shared;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(null!==a){r.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;if(null!==u){var h=u.updateQueue,d=h.lastBaseUpdate;d!==s&&(null===d?h.firstBaseUpdate=c:d.next=c,h.lastBaseUpdate=l)}}if(null!==o){for(var f=r.baseState,p=0,A=null,m=null,g=null,y=o;;){var _=y.lane,v=y.eventTime;if(Dr(i,_)){if(null!==g){var b={eventTime:v,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null};g=g.next=b}if(f=Au(e,0,y,f,t,n),null!==y.callback){e.flags|=32;var x=r.effects;null===x?r.effects=[y]:x.push(y)}}else{var w={eventTime:v,lane:_,tag:y.tag,payload:y.payload,callback:y.callback,next:null};null===g?(m=g=w,A=f):g=g.next=w,p=Or(p,_)}if(null===(y=y.next)){if(null===(a=r.shared.pending))break;var E=a,S=E.next;E.next=null,y=S,r.lastBaseUpdate=E,r.shared.pending=null}}null===g&&(A=f),r.baseState=A,r.firstBaseUpdate=m,r.lastBaseUpdate=g,nm(p),e.lanes=p,e.memoizedState=f}au=null}function gu(e,t){if("function"!=typeof e)throw Error("Invalid argument passed as callback. Expected a function. Instead received: "+e);e.call(t)}function yu(){cu=!1}function _u(){return cu}function vu(e,t,n){var i=t.effects;if(t.effects=null,null!==i)for(var r=0;r<i.length;r++){var o=i[r],s=o.callback;null!==s&&(o.callback=null,gu(s,n))}}su=!1,au=null;var bu,xu,wu,Eu,Su,Tu,ku,Cu,Pu,Mu,Iu={},Lu=Array.isArray,Ru=(new e.Component).refs;bu=new Set,xu=new Set,wu=new Set,Eu=new Set,Cu=new Set,Su=new Set,Pu=new Set,Mu=new Set;var zu=new Set;function Du(e,t,i,r){var o=e.memoizedState;if(1&e.mode){Pe();try{i(r,o)}finally{Me()}}var s=i(r,o);Tu(t,s);var a=null==s?o:n({},o,s);(e.memoizedState=a,0===e.lanes)&&(e.updateQueue.baseState=a)}ku=function(e,t){if(null!==e&&"function"!=typeof e){var n=t+"_"+e;zu.has(n)||(zu.add(n),l("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",t,e))}},Tu=function(e,t){if(void 0===t){var n=Ge(e)||"Component";Su.has(n)||(Su.add(n),l("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",n))}},Object.defineProperty(Iu,"_processChildContext",{enumerable:!1,value:function(){throw Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(Iu);var Ou,Bu,Fu,Nu,Uu,ju={isMounted:function(e){var t=bi.current;if(null!==t&&1===t.tag){var n=t,i=n.stateNode;i._warnedAboutRefsInRender||l("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Ge(n.type)||"A component"),i._warnedAboutRefsInRender=!0}var r=ai(e);return!!r&&xi(r)===r},enqueueSetState:function(e,t,n){var i=ai(e),r=OA(),o=BA(i),s=du(r,o);s.payload=t,null!=n&&(ku(n,"setState"),s.callback=n),fu(i,s),NA(i,o,r)},enqueueReplaceState:function(e,t,n){var i=ai(e),r=OA(),o=BA(i),s=du(r,o);s.tag=1,s.payload=t,null!=n&&(ku(n,"replaceState"),s.callback=n),fu(i,s),NA(i,o,r)},enqueueForceUpdate:function(e,t){var n=ai(e),i=OA(),r=BA(n),o=du(i,r);o.tag=lu,null!=t&&(ku(t,"forceUpdate"),o.callback=t),fu(n,o),NA(n,r,i)}};function Vu(e,t,n,i,r,o,s){var a=e.stateNode;if("function"==typeof a.shouldComponentUpdate){if(1&e.mode){Pe();try{a.shouldComponentUpdate(i,o,s)}finally{Me()}}var c=a.shouldComponentUpdate(i,o,s);return void 0===c&&l("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Ge(t)||"Component"),c}return!t.prototype||!t.prototype.isPureReactComponent||(!As(n,i)||!As(r,o))}function Gu(e,t){var n;t.updater=ju,e.stateNode=t,n=e,t._reactInternals=n,t._reactInternalInstance=Iu}function Wu(e,t,n){var i=!1,r=zl,o=zl,s=t.contextType;if("contextType"in t&&(!(null===s||void 0!==s&&s.$$typeof===se&&void 0===s._context)&&!Mu.has(t))){Mu.add(t);var a="";a=void 0===s?" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":"object"!=typeof s?" However, it is set to a "+typeof s+".":s.$$typeof===oe?" Did you accidentally pass the Context.Provider instead?":void 0!==s._context?" Did you accidentally pass the Context.Consumer instead?":" However, it is set to an object with keys {"+Object.keys(s).join(", ")+"}.",l("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Ge(t)||"Component",a)}if("object"==typeof s&&null!==s)o=ou(s);else{r=Fl(0,t,!0);var c=t.contextTypes;o=(i=null!=c)?Ul(e,r):zl}if(1&e.mode){Pe();try{new t(n,o)}finally{Me()}}var u=new t(n,o),h=e.memoizedState=null!==u.state&&void 0!==u.state?u.state:null;if(Gu(e,u),"function"==typeof t.getDerivedStateFromProps&&null===h){var d=Ge(t)||"Component";xu.has(d)||(xu.add(d),l("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",d,null===u.state?"null":"undefined",d))}if("function"==typeof t.getDerivedStateFromProps||"function"==typeof u.getSnapshotBeforeUpdate){var f=null,p=null,A=null;if("function"==typeof u.componentWillMount&&!0!==u.componentWillMount.__suppressDeprecationWarning?f="componentWillMount":"function"==typeof u.UNSAFE_componentWillMount&&(f="UNSAFE_componentWillMount"),"function"==typeof u.componentWillReceiveProps&&!0!==u.componentWillReceiveProps.__suppressDeprecationWarning?p="componentWillReceiveProps":"function"==typeof u.UNSAFE_componentWillReceiveProps&&(p="UNSAFE_componentWillReceiveProps"),"function"==typeof u.componentWillUpdate&&!0!==u.componentWillUpdate.__suppressDeprecationWarning?A="componentWillUpdate":"function"==typeof u.UNSAFE_componentWillUpdate&&(A="UNSAFE_componentWillUpdate"),null!==f||null!==p||null!==A){var m=Ge(t)||"Component",g="function"==typeof t.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";Eu.has(m)||(Eu.add(m),l("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n%s uses %s but also contains the following legacy lifecycles:%s%s%s\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://reactjs.org/link/unsafe-component-lifecycles",m,g,null!==f?"\n  "+f:"",null!==p?"\n  "+p:"",null!==A?"\n  "+A:""))}}return i&&Nl(e,r,o),u}function $u(e,t,n,i){var r=t.state;if("function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==r){var o=Ge(e.type)||"Component";bu.has(o)||(bu.add(o),l("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",o)),ju.enqueueReplaceState(t,t.state,null)}}function qu(e,t,n,i){!function(e,t,n){var i=e.stateNode,r=Ge(t)||"Component";i.render||(t.prototype&&"function"==typeof t.prototype.render?l("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",r):l("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",r)),!i.getInitialState||i.getInitialState.isReactClassApproved||i.state||l("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",r),i.getDefaultProps&&!i.getDefaultProps.isReactClassApproved&&l("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",r),i.propTypes&&l("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",r),i.contextType&&l("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",r),i.contextTypes&&l("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",r),t.contextType&&t.contextTypes&&!Pu.has(t)&&(Pu.add(t),l("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",r)),"function"==typeof i.componentShouldUpdate&&l("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",r),t.prototype&&t.prototype.isPureReactComponent&&void 0!==i.shouldComponentUpdate&&l("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Ge(t)||"A pure component"),"function"==typeof i.componentDidUnmount&&l("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",r),"function"==typeof i.componentDidReceiveProps&&l("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",r),"function"==typeof i.componentWillRecieveProps&&l("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",r),"function"==typeof i.UNSAFE_componentWillRecieveProps&&l("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",r);var o=i.props!==n;void 0!==i.props&&o&&l("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",r,r),i.defaultProps&&l("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",r,r),"function"!=typeof i.getSnapshotBeforeUpdate||"function"==typeof i.componentDidUpdate||wu.has(t)||(wu.add(t),l("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Ge(t))),"function"==typeof i.getDerivedStateFromProps&&l("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",r),"function"==typeof i.getDerivedStateFromError&&l("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",r),"function"==typeof t.getSnapshotBeforeUpdate&&l("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",r);var s=i.state;s&&("object"!=typeof s||Lu(s))&&l("%s.state: must be set to an object or null",r),"function"==typeof i.getChildContext&&"object"!=typeof t.childContextTypes&&l("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",r)}(e,t,n);var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Ru,uu(e);var o=t.contextType;if("object"==typeof o&&null!==o)r.context=ou(o);else{var s=Fl(0,t,!0);r.context=Ul(e,s)}if(r.state===n){var a=Ge(t)||"Component";Cu.has(a)||(Cu.add(a),l("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",a))}1&e.mode&&Rc.recordLegacyContextWarning(e,r),Rc.recordUnsafeLifecycleWarnings(e,r),mu(e,n,r,i),r.state=e.memoizedState;var c=t.getDerivedStateFromProps;"function"==typeof c&&(Du(e,t,c,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(!function(e,t){var n=t.state;"function"==typeof t.componentWillMount&&t.componentWillMount(),"function"==typeof t.UNSAFE_componentWillMount&&t.UNSAFE_componentWillMount(),n!==t.state&&(l("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",Ge(e.type)||"Component"),ju.enqueueReplaceState(t,t.state,null))}(e,r),mu(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4)}var Zu;Ou=!1,Bu=!1,Fu={},Nu={},Uu={},Zu=function(e,t){if(null!==e&&"object"==typeof e&&e._store&&!e._store.validated&&null==e.key){if("object"!=typeof e._store)throw Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");e._store.validated=!0;var n=Ge(t.type)||"Component";Nu[n]||(Nu[n]=!0,l('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};var Hu=Array.isArray;function Qu(e,t,n){var i=n.ref;if(null!==i&&"function"!=typeof i&&"object"!=typeof i){if(1&e.mode&&(!n._owner||!n._self||n._owner.stateNode===n._self)){var r=Ge(e.type)||"Component";Fu[r]||(l('A string ref, "%s", has been found within a strict mode tree. String refs are a source of potential bugs and should be avoided. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',i),Fu[r]=!0)}if(n._owner){var o,s=n._owner;if(s){var a=s;if(1!==a.tag)throw Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");o=a.stateNode}if(!o)throw Error("Missing owner for string ref "+i+". This error is likely caused by a bug in React. Please file an issue.");var c=""+i;if(null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===c)return t.ref;var u=function(e){var t=o.refs;t===Ru&&(t=o.refs={}),null===e?delete t[c]:t[c]=e};return u._stringRef=c,u}if("string"!=typeof i)throw Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!n._owner)throw Error("Element ref was specified as a string ("+i+") but no owner was set. This could happen for one of the following reasons:\n1. You may be adding a ref to a function component\n2. You may be adding a ref to a component that was not created inside a component's render method\n3. You have multiple copies of React loaded\nSee https://reactjs.org/link/refs-must-have-owner for more information.")}return i}function Xu(e,t){if("textarea"!==e.type)throw Error("Objects are not valid as a React child (found: "+("[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}function Yu(e){var t=Ge(e.type)||"Component";Uu[t]||(Uu[t]=!0,l("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it."))}function Ku(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,i){if(!e)return null;for(var r=i;null!==r;)t(n,r),r=r.sibling;return null}function i(e,t){for(var n=new Map,i=t;null!==i;)null!==i.key?n.set(i.key,i):n.set(i.index,i),i=i.sibling;return n}function r(e,t){var n=hg(e,t);return n.index=0,n.sibling=null,n}function o(t,n,i){if(t.index=i,!e)return n;var r=t.alternate;if(null!==r){var o=r.index;return o<n?(t.flags=2,n):o}return t.flags=2,n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function a(e,t,n,i){if(null===t||6!==t.tag){var o=gg(n,e.mode,i);return o.return=e,o}var s=r(t,n);return s.return=e,s}function c(e,t,n,i){if(null!==t&&(t.elementType===n.type||Xm(t,n))){var o=r(t,n.props);return o.ref=Qu(e,t,n),o.return=e,o._debugSource=n._source,o._debugOwner=n._owner,o}var s=pg(n,e.mode,i);return s.ref=Qu(e,t,n),s.return=e,s}function u(e,t,n,i){if(null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation){var o=yg(n,e.mode,i);return o.return=e,o}var s=r(t,n.children||[]);return s.return=e,s}function h(e,t,n,i,o){if(null===t||7!==t.tag){var s=Ag(n,e.mode,i,o);return s.return=e,s}var a=r(t,n);return a.return=e,a}function d(e,t,n){if("string"==typeof t||"number"==typeof t){var i=gg(""+t,e.mode,n);return i.return=e,i}if("object"==typeof t&&null!==t){switch(t.$$typeof){case ee:var r=pg(t,e.mode,n);return r.ref=Qu(e,null,t),r.return=e,r;case te:var o=yg(t,e.mode,n);return o.return=e,o}if(Hu(t)||_e(t)){var s=Ag(t,e.mode,n,null);return s.return=e,s}Xu(e,t)}return"function"==typeof t&&Yu(e),null}function f(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n||"number"==typeof n)return null!==r?null:a(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===r?n.type===ne?h(e,t,n.props.children,i,r):c(e,t,n,i):null;case te:return n.key===r?u(e,t,n,i):null}if(Hu(n)||_e(n))return null!==r?null:h(e,t,n,i,null);Xu(e,n)}return"function"==typeof n&&Yu(e),null}function A(e,t,n,i,r){if("string"==typeof i||"number"==typeof i)return a(t,e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case ee:var o=e.get(null===i.key?n:i.key)||null;return i.type===ne?h(t,o,i.props.children,r,i.key):c(t,o,i,r);case te:return u(t,e.get(null===i.key?n:i.key)||null,i,r)}if(Hu(i)||_e(i))return h(t,e.get(n)||null,i,r,null);Xu(t,i)}return"function"==typeof i&&Yu(t),null}function m(e,t,n){if("object"!=typeof e||null===e)return t;switch(e.$$typeof){case ee:case te:Zu(e,n);var i=e.key;if("string"!=typeof i)break;if(null===t){(t=new Set).add(i);break}if(!t.has(i)){t.add(i);break}l("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted — the behavior is unsupported and could change in a future version.",i)}return t}return function(a,c,u,h){var g="object"==typeof u&&null!==u&&u.type===ne&&null===u.key;g&&(u=u.props.children);var _="object"==typeof u&&null!==u;if(_)switch(u.$$typeof){case ee:return s(function(e,i,o,s){for(var a=o.key,l=i;null!==l;){if(l.key===a){if(7===l.tag){if(o.type===ne){n(e,l.sibling);var c=r(l,o.props.children);return c.return=e,c._debugSource=o._source,c._debugOwner=o._owner,c}}else if(l.elementType===o.type||Xm(l,o)){n(e,l.sibling);var u=r(l,o.props);return u.ref=Qu(e,l,o),u.return=e,u._debugSource=o._source,u._debugOwner=o._owner,u}n(e,l);break}t(e,l),l=l.sibling}if(o.type===ne){var h=Ag(o.props.children,e.mode,s,o.key);return h.return=e,h}var d=pg(o,e.mode,s);return d.ref=Qu(e,i,o),d.return=e,d}(a,c,u,h));case te:return s(function(e,i,o,s){for(var a=o.key,l=i;null!==l;){if(l.key===a){if(4===l.tag&&l.stateNode.containerInfo===o.containerInfo&&l.stateNode.implementation===o.implementation){n(e,l.sibling);var c=r(l,o.children||[]);return c.return=e,c}n(e,l);break}t(e,l),l=l.sibling}var u=yg(o,e.mode,s);return u.return=e,u}(a,c,u,h))}if("string"==typeof u||"number"==typeof u)return s(function(e,t,i,o){if(null!==t&&6===t.tag){n(e,t.sibling);var s=r(t,i);return s.return=e,s}n(e,t);var a=gg(i,e.mode,o);return a.return=e,a}(a,c,""+u,h));if(Hu(u))return function(r,s,a,l){for(var c=null,u=0;u<a.length;u++)c=m(a[u],c,r);for(var h=null,p=null,g=s,y=0,_=0,v=null;null!==g&&_<a.length;_++){g.index>_?(v=g,g=null):v=g.sibling;var b=f(r,g,a[_],l);if(null===b){null===g&&(g=v);break}e&&g&&null===b.alternate&&t(r,g),y=o(b,y,_),null===p?h=b:p.sibling=b,p=b,g=v}if(_===a.length)return n(r,g),h;if(null===g){for(;_<a.length;_++){var x=d(r,a[_],l);null!==x&&(y=o(x,y,_),null===p?h=x:p.sibling=x,p=x)}return h}for(var w=i(0,g);_<a.length;_++){var E=A(w,r,_,a[_],l);null!==E&&(e&&null!==E.alternate&&w.delete(null===E.key?_:E.key),y=o(E,y,_),null===p?h=E:p.sibling=E,p=E)}return e&&w.forEach((function(e){return t(r,e)})),h}(a,c,u,h);if(_e(u))return function(r,s,a,c){var u=_e(a);if("function"!=typeof u)throw Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");"function"==typeof Symbol&&"Generator"===a[Symbol.toStringTag]&&(Bu||l("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),Bu=!0),a.entries===u&&(Ou||l("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Ou=!0);var h=u.call(a);if(h)for(var p=null,g=h.next();!g.done;g=h.next())p=m(g.value,p,r);var y=u.call(a);if(null==y)throw Error("An iterable object provided no iterator.");for(var _=null,v=null,b=s,x=0,w=0,E=null,S=y.next();null!==b&&!S.done;w++,S=y.next()){b.index>w?(E=b,b=null):E=b.sibling;var T=f(r,b,S.value,c);if(null===T){null===b&&(b=E);break}e&&b&&null===T.alternate&&t(r,b),x=o(T,x,w),null===v?_=T:v.sibling=T,v=T,b=E}if(S.done)return n(r,b),_;if(null===b){for(;!S.done;w++,S=y.next()){var k=d(r,S.value,c);null!==k&&(x=o(k,x,w),null===v?_=k:v.sibling=k,v=k)}return _}for(var C=i(0,b);!S.done;w++,S=y.next()){var P=A(C,r,w,S.value,c);null!==P&&(e&&null!==P.alternate&&C.delete(null===P.key?w:P.key),x=o(P,x,w),null===v?_=P:v.sibling=P,v=P)}return e&&C.forEach((function(e){return t(r,e)})),_}(a,c,u,h);if(_&&Xu(a,u),"function"==typeof u&&Yu(a),void 0===u&&!g)switch(a.tag){case 1:if(a.stateNode.render._isMockFunction)break;case x:case 0:case p:case y:throw Error((Ge(a.type)||"Component")+"(...): Nothing was returned from render. This usually means a return statement is missing. Or, to render nothing, return null.")}return n(a,c)}}var Ju=Ku(!0),eh=Ku(!1);function th(e,t){for(var n=e.child;null!==n;)dg(n,t),n=n.sibling}var nh={},ih=Il(nh),rh=Il(nh),oh=Il(nh);function sh(e){if(e===nh)throw Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return e}function ah(){return sh(oh.current)}function lh(e,t){Rl(oh,t,e),Rl(rh,e,e),Rl(ih,nh,e);var n=function(e){var t,n,i=e.nodeType;switch(i){case 9:case 11:t=9===i?"#document":"#fragment";var r=e.documentElement;n=r?r.namespaceURI:Ut(null,"");break;default:var o=8===i?e.parentNode:e;n=Ut(o.namespaceURI||null,t=o.tagName)}var s=t.toLowerCase();return{namespace:n,ancestorInfo:Ia(null,s)}}(t);Ll(ih,e),Rl(ih,n,e)}function ch(e){Ll(ih,e),Ll(rh,e),Ll(oh,e)}function uh(){return sh(ih.current)}function hh(e){sh(oh.current);var t,n,i,r=sh(ih.current),o=(t=r,n=e.type,{namespace:Ut((i=t).namespace,n),ancestorInfo:Ia(i.ancestorInfo,n)});r!==o&&(Rl(rh,e,e),Rl(ih,o,e))}function dh(e){rh.current===e&&(Ll(ih,e),Ll(rh,e))}var fh=Il(0);function ph(e,t){return 0!=(e&t)}function Ah(e){return 1&e}function mh(e,t){return 1&e|t}function gh(e,t){Rl(fh,t,e)}function yh(e){Ll(fh,e)}function _h(e,t){var n=e.memoizedState;if(null!==n)return null!==n.dehydrated;var i=e.memoizedProps;return void 0!==i.fallback&&(!0!==i.unstable_avoidThisFallback||!t)}function vh(e){for(var t=e;null!==t;){if(t.tag===m){var n=t.memoizedState;if(null!==n){var i=n.dehydrated;if(null===i||i.data===Fa||tl(i))return t}}else if(t.tag===v&&void 0!==t.memoizedProps.revealOrder){if(0!=(t.flags&di))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)return null;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var bh=null,xh=null,wh=!1;function Eh(e,t){switch(e.tag){case 3:!function(e,t){1===t.nodeType?Ta(e,t):8===t.nodeType||ka(e,t)}(e.stateNode.containerInfo,t);break;case 5:!function(e,t,n,i){!0!==t.suppressHydrationWarning&&(1===i.nodeType?Ta(n,i):8===i.nodeType||ka(n,i))}(e.type,e.memoizedProps,e.stateNode,t)}var n,i=((n=cg(5,null,null,0)).elementType="DELETED",n.type="DELETED",n);i.stateNode=t,i.return=e,i.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i}function Sh(e,t){switch(t.flags=-1025&t.flags|2,e.tag){case 3:var n=e.stateNode.containerInfo;switch(t.tag){case 5:var i=t.type;t.pendingProps,function(e,t,n){Ca(e,t)}(n,i);break;case 6:!function(e,t){Pa(e,t)}(n,t.pendingProps)}break;case 5:e.type;var r=e.memoizedProps,o=e.stateNode;switch(t.tag){case 5:var s=t.type;t.pendingProps,function(e,t,n,i,r){!0!==t.suppressHydrationWarning&&Ca(n,i)}(0,r,o,s);break;case 6:!function(e,t,n,i){!0!==t.suppressHydrationWarning&&Pa(n,i)}(0,r,o,t.pendingProps);break;case m:!function(e,t,n){t.suppressHydrationWarning}(0,r)}break;default:return}}function Th(e,t){switch(e.tag){case 5:var n=e.type;e.pendingProps;var i=function(e,t,n){return 1!==e.nodeType||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e}(t,n);return null!==i&&(e.stateNode=i,!0);case 6:var r=function(e,t){return""===t||3!==e.nodeType?null:e}(t,e.pendingProps);return null!==r&&(e.stateNode=r,!0);default:return!1}}function kh(e){if(wh){var t=xh;if(!t)return Sh(bh,e),wh=!1,void(bh=e);var n=t;if(!Th(e,t)){if(!(t=il(n))||!Th(e,t))return Sh(bh,e),wh=!1,void(bh=e);Eh(bh,n)}bh=e,xh=rl(t)}}function Ch(e){var t=e.stateNode,n=e.memoizedProps,i=function(e,t,n){return pl(n,e),function(e,t){return e.nodeValue!==t}(e,t)}(t,n,e);if(i){var r=bh;if(null!==r)switch(r.tag){case 3:r.stateNode.containerInfo;!function(e,t,n){Sa(t,n)}(0,t,n);break;case 5:r.type;var o=r.memoizedProps;r.stateNode;!function(e,t,n,i,r){!0!==t.suppressHydrationWarning&&Sa(i,r)}(0,o,0,t,n)}}return i}function Ph(e){var t=e.memoizedState,n=null!==t?t.dehydrated:null;if(!n)throw Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return function(e){for(var t=e.nextSibling,n=0;t;){if(8===t.nodeType){var i=t.data;if("/$"===i){if(0===n)return il(t);n--}else"$"!==i&&i!==Na&&i!==Fa||n++}t=t.nextSibling}return null}(n)}function Mh(e){for(var t=e.return;null!==t&&5!==t.tag&&3!==t.tag&&t.tag!==m;)t=t.return;bh=t}function Ih(e){if(e!==bh)return!1;if(!wh)return Mh(e),wh=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!$a(t,e.memoizedProps))for(var n=xh;n;)Eh(e,n),n=il(n);return Mh(e),xh=e.tag===m?Ph(e):bh?il(e.stateNode):null,!0}function Lh(){bh=null,xh=null,wh=!1}function Rh(){return wh}var zh,Dh=[];function Oh(){for(var e=0;e<Dh.length;e++){Dh[e]._workInProgressVersionPrimary=null}Dh.length=0}function Bh(e,t){e._workInProgressVersionPrimary=t,Dh.push(e)}zh={};var Fh,Nh,Uh=o.ReactCurrentDispatcher,jh=o.ReactCurrentBatchConfig;Nh={},Fh=new Set;var Vh=0,Gh=null,Wh=null,$h=null,qh=!1,Zh=!1,Hh=null,Qh=null,Xh=-1,Yh=!1;function Kh(){var e=Hh;null===Qh?Qh=[e]:Qh.push(e)}function Jh(){var e=Hh;null!==Qh&&(Xh++,Qh[Xh]!==e&&function(e){var t=Ge(Gh.type);if(!Fh.has(t)&&(Fh.add(t),null!==Qh)){for(var n="",i=30,r=0;r<=Xh;r++){for(var o=Qh[r],s=r===Xh?e:o,a=r+1+". "+o;a.length<i;)a+=" ";n+=a+=s+"\n"}l("React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks\n\n   Previous render            Next render\n   ------------------------------------------------------\n%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",t,n)}}(e))}function ed(e){null==e||Array.isArray(e)||l("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",Hh,typeof e)}function td(){throw Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.")}function nd(e,t){if(Yh)return!1;if(null===t)return l("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",Hh),!1;e.length!==t.length&&l("The final argument passed to %s changed size between renders. The order and size of this array must remain constant.\n\nPrevious: %s\nIncoming: %s",Hh,"["+t.join(", ")+"]","["+e.join(", ")+"]");for(var n=0;n<t.length&&n<e.length;n++)if(!fs(e[n],t[n]))return!1;return!0}function id(e,t,n,i,r,o){Vh=o,Gh=t,Qh=null!==e?e._debugHookTypes:null,Xh=-1,Yh=null!==e&&e.type!==t.type,t.memoizedState=null,t.updateQueue=null,t.lanes=0,null!==e&&null!==e.memoizedState?Uh.current=Jd:Uh.current=null!==Qh?Kd:Yd;var s=n(i,r);if(Zh){var a=0;do{if(Zh=!1,!(a<25))throw Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");a+=1,Yh=!1,Wh=null,$h=null,t.updateQueue=null,Xh=-1,Uh.current=ef,s=n(i,r)}while(Zh)}Uh.current=Xd,t._debugHookTypes=Qh;var l=null!==Wh&&null!==Wh.next;if(Vh=0,Gh=null,Wh=null,$h=null,Hh=null,Qh=null,Xh=-1,qh=!1,l)throw Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return s}function rd(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes=Br(e.lanes,n)}function od(){if(Uh.current=Xd,qh){for(var e=Gh.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}qh=!1}Vh=0,Gh=null,Wh=null,$h=null,Qh=null,Xh=-1,Hh=null,Wd=!1,Zh=!1}function sd(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===$h?Gh.memoizedState=$h=e:$h=$h.next=e,$h}function ad(){var e,t;if(null===Wh){var n=Gh.alternate;e=null!==n?n.memoizedState:null}else e=Wh.next;if(null!==(t=null===$h?Gh.memoizedState:$h.next))t=($h=t).next,Wh=e;else{if(null===e)throw Error("Rendered more hooks than during the previous render.");var i={memoizedState:(Wh=e).memoizedState,baseState:Wh.baseState,baseQueue:Wh.baseQueue,queue:Wh.queue,next:null};null===$h?Gh.memoizedState=$h=i:$h=$h.next=i}return $h}function ld(e,t){return"function"==typeof t?t(e):t}function cd(e,t,n){var i,r=sd();i=void 0!==n?n(t):t,r.memoizedState=r.baseState=i;var o=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},s=o.dispatch=Qd.bind(null,Gh,o);return[r.memoizedState,s]}function ud(e,t,n){var i=ad(),r=i.queue;if(null===r)throw Error("Should have a queue. This is likely a bug in React. Please file an issue.");r.lastRenderedReducer=e;var o=Wh,s=o.baseQueue,a=r.pending;if(null!==a){if(null!==s){var c=s.next,u=a.next;s.next=u,a.next=c}o.baseQueue!==s&&l("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),o.baseQueue=s=a,r.pending=null}if(null!==s){var h=s.next,d=o.baseState,f=null,p=null,A=null,m=h;do{var g=m.lane;if(Dr(Vh,g)){if(null!==A){var y={lane:0,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null};A=A.next=y}if(m.eagerReducer===e)d=m.eagerState;else d=e(d,m.action)}else{var _={lane:g,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null};null===A?(p=A=_,f=d):A=A.next=_,Gh.lanes=Or(Gh.lanes,g),nm(g)}m=m.next}while(null!==m&&m!==h);null===A?f=d:A.next=p,fs(d,i.memoizedState)||op(),i.memoizedState=d,i.baseState=f,i.baseQueue=A,r.lastRenderedState=d}var v=r.dispatch;return[i.memoizedState,v]}function hd(e,t,n){var i=ad(),r=i.queue;if(null===r)throw Error("Should have a queue. This is likely a bug in React. Please file an issue.");r.lastRenderedReducer=e;var o=r.dispatch,s=r.pending,a=i.memoizedState;if(null!==s){r.pending=null;var l=s.next,c=l;do{a=e(a,c.action),c=c.next}while(c!==l);fs(a,i.memoizedState)||op(),i.memoizedState=a,null===i.baseQueue&&(i.baseState=a),r.lastRenderedState=a}return[a,o]}function dd(e,t,n){var i;null==(i=t)._currentPrimaryRenderer?i._currentPrimaryRenderer=zh:i._currentPrimaryRenderer!==zh&&l("Detected multiple renderers concurrently rendering the same mutable source. This is currently unsupported.");var r=(0,t._getVersion)(t._source),o=!1,s=function(e){return e._workInProgressVersionPrimary}(t);if(null!==s?o=s===r:(o=Dr(Vh,e.mutableReadLanes))&&Bh(t,r),o){var a=n(t._source);return"function"==typeof a&&l("Mutable source should not return a function as the snapshot value. Functions may close over mutable values and cause tearing."),a}throw function(e){Dh.push(e)}(t),Error("Cannot read from mutable source during the current render without tearing. This is a bug in React. Please file an issue.")}function fd(e,t,n,i){var r=Jp;if(null===r)throw Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");var o=t._getVersion,s=o(t._source),a=Uh.current,c=a.useState((function(){return dd(r,t,n)})),u=c[0],h=c[1],d=u,f=$h,p=e.memoizedState,A=p.refs,m=A.getSnapshot,g=p.source,y=p.subscribe,_=Gh;if(e.memoizedState={refs:A,source:t,subscribe:i},a.useEffect((function(){A.getSnapshot=n,A.setSnapshot=h;var e=o(t._source);if(!fs(s,e)){var i=n(t._source);if("function"==typeof i&&l("Mutable source should not return a function as the snapshot value. Functions may close over mutable values and cause tearing."),!fs(d,i)){h(i);var a=BA(_);jr(r,a)}!function(e,t){e.entangledLanes|=t;for(var n=e.entanglements,i=t;i>0;){var r=Rr(i),o=1<<r;n[r]|=t,i&=~o}}(r,r.mutableReadLanes)}}),[n,t,i]),a.useEffect((function(){var e=i(t._source,(function(){var e=A.getSnapshot,n=A.setSnapshot;try{n(e(t._source));var i=BA(_);jr(r,i)}catch(e){n((function(){throw e}))}}));return"function"!=typeof e&&l("Mutable source subscribe function must return an unsubscribe function."),e}),[t,i]),!fs(m,n)||!fs(g,t)||!fs(y,i)){var v={pending:null,dispatch:null,lastRenderedReducer:ld,lastRenderedState:d};v.dispatch=h=Qd.bind(null,Gh,v),f.queue=v,f.baseQueue=null,d=dd(r,t,n),f.memoizedState=f.baseState=d}return d}function pd(e,t,n){var i=sd();return i.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},fd(i,e,t,n)}function Ad(e,t,n){return fd(ad(),e,t,n)}function md(e){var t=sd();"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e;var n=t.queue={pending:null,dispatch:null,lastRenderedReducer:ld,lastRenderedState:e},i=n.dispatch=Qd.bind(null,Gh,n);return[t.memoizedState,i]}function gd(e){return ud(ld)}function yd(e){return hd(ld)}function _d(e,t,n,i){var r={tag:e,create:t,destroy:n,deps:i,next:null},o=Gh.updateQueue;if(null===o)o={lastEffect:null},Gh.updateQueue=o,o.lastEffect=r.next=r;else{var s=o.lastEffect;if(null===s)o.lastEffect=r.next=r;else{var a=s.next;s.next=r,r.next=a,o.lastEffect=r}}return r}function vd(e){var t=sd(),n={current:e};return Object.seal(n),t.memoizedState=n,n}function bd(e){return ad().memoizedState}function xd(e,t,n,i){var r=sd(),o=void 0===i?null:i;Gh.flags|=e,r.memoizedState=_d(1|t,n,void 0,o)}function wd(e,t,n,i){var r=ad(),o=void 0===i?null:i,s=void 0;if(null!==Wh){var a=Wh.memoizedState;if(s=a.destroy,null!==o)if(nd(o,a.deps))return void _d(t,n,s,o)}Gh.flags|=e,r.memoizedState=_d(1|t,n,s,o)}function Ed(e,t){return"undefined"!=typeof jest&&Rm(Gh),xd(516,4,e,t)}function Sd(e,t){return"undefined"!=typeof jest&&Rm(Gh),wd(516,4,e,t)}function Td(e,t){return xd(4,2,e,t)}function kd(e,t){return wd(4,2,e,t)}function Cd(e,t){if("function"==typeof t){var n=t,i=e();return n(i),function(){n(null)}}if(null!=t){var r=t;r.hasOwnProperty("current")||l("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(r).join(", ")+"}");var o=e();return r.current=o,function(){r.current=null}}}function Pd(e,t,n){"function"!=typeof t&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var i=null!=n?n.concat([e]):null;return xd(4,2,Cd.bind(null,t,e),i)}function Md(e,t,n){"function"!=typeof t&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var i=null!=n?n.concat([e]):null;return wd(4,2,Cd.bind(null,t,e),i)}function Id(e,t){}var Ld=Id;function Rd(e,t){var n=void 0===t?null:t;return sd().memoizedState=[e,n],e}function zd(e,t){var n=ad(),i=void 0===t?null:t,r=n.memoizedState;if(null!==r&&(null!==i&&nd(i,r[1])))return r[0];return n.memoizedState=[e,i],e}function Dd(e,t){var n=sd(),i=void 0===t?null:t,r=e();return n.memoizedState=[r,i],r}function Od(e,t){var n=ad(),i=void 0===t?null:t,r=n.memoizedState;if(null!==r&&(null!==i&&nd(i,r[1])))return r[0];var o=e();return n.memoizedState=[o,i],o}function Bd(e){var t=md(e),n=t[0],i=t[1];return Ed((function(){var t=jh.transition;jh.transition=1;try{i(e)}finally{jh.transition=t}}),[e]),n}function Fd(e){var t=gd(),n=t[0],i=t[1];return Sd((function(){var t=jh.transition;jh.transition=1;try{i(e)}finally{jh.transition=t}}),[e]),n}function Nd(e){var t=yd(),n=t[0],i=t[1];return Sd((function(){var t=jh.transition;jh.transition=1;try{i(e)}finally{jh.transition=t}}),[e]),n}function Ud(e,t){var n=Ec();Tc(n<Ac?Ac:n,(function(){e(!0)})),Tc(n>mc?mc:n,(function(){var n=jh.transition;jh.transition=1;try{e(!1),t()}finally{jh.transition=n}}))}function jd(){var e=md(!1),t=e[0],n=e[1],i=Ud.bind(null,n);return vd(i),[i,t]}function Vd(){var e=gd()[0];return[bd().current,e]}function Gd(){var e=yd()[0];return[bd().current,e]}var Wd=!1;function $d(e){var t=Ge(e.type)||"Unknown";qe&&!Nh[t]&&(l("The object passed back from useOpaqueIdentifier is meant to be passed through to attributes only. Do not read the value directly."),Nh[t]=!0)}function qd(){var e=ll.bind(null,$d.bind(null,Gh));if(Rh()){var t=!1,n=Gh,i={$$typeof:fe,toString:o=function(){throw t||(t=!0,Wd=!0,r(e()),Wd=!1,$d(n)),Error("The object passed back from useOpaqueIdentifier is meant to be passed through to attributes only. Do not read the value directly.")},valueOf:o},r=md(i)[1];return 0==(2&Gh.mode)&&(Gh.flags|=516,_d(5,(function(){r(e())}),void 0,null)),i}var o,s=e();return md(s),s}function Zd(){return gd()[0]}function Hd(){return yd()[0]}function Qd(e,t,n){"function"==typeof arguments[3]&&l("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var i=OA(),r=BA(e),o={lane:r,action:n,eagerReducer:null,eagerState:null,next:null},s=t.pending;null===s?o.next=o:(o.next=s.next,s.next=o),t.pending=o;var a=e.alternate;if(e===Gh||null!==a&&a===Gh)Zh=qh=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)){var c=t.lastRenderedReducer;if(null!==c){var u;u=Uh.current,Uh.current=nf;try{var h=t.lastRenderedState,d=c(h,n);if(o.eagerReducer=c,o.eagerState=d,fs(d,h))return}catch(e){}finally{Uh.current=u}}}"undefined"!=typeof jest&&(Lm(e),zm(e)),NA(e,r,i)}}var Xd={readContext:ou,useCallback:td,useContext:td,useEffect:td,useImperativeHandle:td,useLayoutEffect:td,useMemo:td,useReducer:td,useRef:td,useState:td,useDebugValue:td,useDeferredValue:td,useTransition:td,useMutableSource:td,useOpaqueIdentifier:td,unstable_isNewReconciler:S},Yd=null,Kd=null,Jd=null,ef=null,tf=null,nf=null,rf=null,of=function(){l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},sf=function(){l("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};Yd={readContext:function(e,t){return ou(e,t)},useCallback:function(e,t){return Hh="useCallback",Kh(),ed(t),Rd(e,t)},useContext:function(e,t){return Hh="useContext",Kh(),ou(e,t)},useEffect:function(e,t){return Hh="useEffect",Kh(),ed(t),Ed(e,t)},useImperativeHandle:function(e,t,n){return Hh="useImperativeHandle",Kh(),ed(n),Pd(e,t,n)},useLayoutEffect:function(e,t){return Hh="useLayoutEffect",Kh(),ed(t),Td(e,t)},useMemo:function(e,t){Hh="useMemo",Kh(),ed(t);var n=Uh.current;Uh.current=tf;try{return Dd(e,t)}finally{Uh.current=n}},useReducer:function(e,t,n){Hh="useReducer",Kh();var i=Uh.current;Uh.current=tf;try{return cd(e,t,n)}finally{Uh.current=i}},useRef:function(e){return Hh="useRef",Kh(),vd(e)},useState:function(e){Hh="useState",Kh();var t=Uh.current;Uh.current=tf;try{return md(e)}finally{Uh.current=t}},useDebugValue:function(e,t){Hh="useDebugValue",Kh()},useDeferredValue:function(e){return Hh="useDeferredValue",Kh(),Bd(e)},useTransition:function(){return Hh="useTransition",Kh(),jd()},useMutableSource:function(e,t,n){return Hh="useMutableSource",Kh(),pd(e,t,n)},useOpaqueIdentifier:function(){return Hh="useOpaqueIdentifier",Kh(),qd()},unstable_isNewReconciler:S},Kd={readContext:function(e,t){return ou(e,t)},useCallback:function(e,t){return Hh="useCallback",Jh(),Rd(e,t)},useContext:function(e,t){return Hh="useContext",Jh(),ou(e,t)},useEffect:function(e,t){return Hh="useEffect",Jh(),Ed(e,t)},useImperativeHandle:function(e,t,n){return Hh="useImperativeHandle",Jh(),Pd(e,t,n)},useLayoutEffect:function(e,t){return Hh="useLayoutEffect",Jh(),Td(e,t)},useMemo:function(e,t){Hh="useMemo",Jh();var n=Uh.current;Uh.current=tf;try{return Dd(e,t)}finally{Uh.current=n}},useReducer:function(e,t,n){Hh="useReducer",Jh();var i=Uh.current;Uh.current=tf;try{return cd(e,t,n)}finally{Uh.current=i}},useRef:function(e){return Hh="useRef",Jh(),vd(e)},useState:function(e){Hh="useState",Jh();var t=Uh.current;Uh.current=tf;try{return md(e)}finally{Uh.current=t}},useDebugValue:function(e,t){Hh="useDebugValue",Jh()},useDeferredValue:function(e){return Hh="useDeferredValue",Jh(),Bd(e)},useTransition:function(){return Hh="useTransition",Jh(),jd()},useMutableSource:function(e,t,n){return Hh="useMutableSource",Jh(),pd(e,t,n)},useOpaqueIdentifier:function(){return Hh="useOpaqueIdentifier",Jh(),qd()},unstable_isNewReconciler:S},Jd={readContext:function(e,t){return ou(e,t)},useCallback:function(e,t){return Hh="useCallback",Jh(),zd(e,t)},useContext:function(e,t){return Hh="useContext",Jh(),ou(e,t)},useEffect:function(e,t){return Hh="useEffect",Jh(),Sd(e,t)},useImperativeHandle:function(e,t,n){return Hh="useImperativeHandle",Jh(),Md(e,t,n)},useLayoutEffect:function(e,t){return Hh="useLayoutEffect",Jh(),kd(e,t)},useMemo:function(e,t){Hh="useMemo",Jh();var n=Uh.current;Uh.current=nf;try{return Od(e,t)}finally{Uh.current=n}},useReducer:function(e,t,n){Hh="useReducer",Jh();var i=Uh.current;Uh.current=nf;try{return ud(e)}finally{Uh.current=i}},useRef:function(e){return Hh="useRef",Jh(),bd()},useState:function(e){Hh="useState",Jh();var t=Uh.current;Uh.current=nf;try{return gd()}finally{Uh.current=t}},useDebugValue:function(e,t){return Hh="useDebugValue",Jh(),Ld()},useDeferredValue:function(e){return Hh="useDeferredValue",Jh(),Fd(e)},useTransition:function(){return Hh="useTransition",Jh(),Vd()},useMutableSource:function(e,t,n){return Hh="useMutableSource",Jh(),Ad(e,t,n)},useOpaqueIdentifier:function(){return Hh="useOpaqueIdentifier",Jh(),Zd()},unstable_isNewReconciler:S},ef={readContext:function(e,t){return ou(e,t)},useCallback:function(e,t){return Hh="useCallback",Jh(),zd(e,t)},useContext:function(e,t){return Hh="useContext",Jh(),ou(e,t)},useEffect:function(e,t){return Hh="useEffect",Jh(),Sd(e,t)},useImperativeHandle:function(e,t,n){return Hh="useImperativeHandle",Jh(),Md(e,t,n)},useLayoutEffect:function(e,t){return Hh="useLayoutEffect",Jh(),kd(e,t)},useMemo:function(e,t){Hh="useMemo",Jh();var n=Uh.current;Uh.current=rf;try{return Od(e,t)}finally{Uh.current=n}},useReducer:function(e,t,n){Hh="useReducer",Jh();var i=Uh.current;Uh.current=rf;try{return hd(e)}finally{Uh.current=i}},useRef:function(e){return Hh="useRef",Jh(),bd()},useState:function(e){Hh="useState",Jh();var t=Uh.current;Uh.current=rf;try{return yd()}finally{Uh.current=t}},useDebugValue:function(e,t){return Hh="useDebugValue",Jh(),Ld()},useDeferredValue:function(e){return Hh="useDeferredValue",Jh(),Nd(e)},useTransition:function(){return Hh="useTransition",Jh(),Gd()},useMutableSource:function(e,t,n){return Hh="useMutableSource",Jh(),Ad(e,t,n)},useOpaqueIdentifier:function(){return Hh="useOpaqueIdentifier",Jh(),Hd()},unstable_isNewReconciler:S},tf={readContext:function(e,t){return of(),ou(e,t)},useCallback:function(e,t){return Hh="useCallback",sf(),Kh(),Rd(e,t)},useContext:function(e,t){return Hh="useContext",sf(),Kh(),ou(e,t)},useEffect:function(e,t){return Hh="useEffect",sf(),Kh(),Ed(e,t)},useImperativeHandle:function(e,t,n){return Hh="useImperativeHandle",sf(),Kh(),Pd(e,t,n)},useLayoutEffect:function(e,t){return Hh="useLayoutEffect",sf(),Kh(),Td(e,t)},useMemo:function(e,t){Hh="useMemo",sf(),Kh();var n=Uh.current;Uh.current=tf;try{return Dd(e,t)}finally{Uh.current=n}},useReducer:function(e,t,n){Hh="useReducer",sf(),Kh();var i=Uh.current;Uh.current=tf;try{return cd(e,t,n)}finally{Uh.current=i}},useRef:function(e){return Hh="useRef",sf(),Kh(),vd(e)},useState:function(e){Hh="useState",sf(),Kh();var t=Uh.current;Uh.current=tf;try{return md(e)}finally{Uh.current=t}},useDebugValue:function(e,t){Hh="useDebugValue",sf(),Kh()},useDeferredValue:function(e){return Hh="useDeferredValue",sf(),Kh(),Bd(e)},useTransition:function(){return Hh="useTransition",sf(),Kh(),jd()},useMutableSource:function(e,t,n){return Hh="useMutableSource",sf(),Kh(),pd(e,t,n)},useOpaqueIdentifier:function(){return Hh="useOpaqueIdentifier",sf(),Kh(),qd()},unstable_isNewReconciler:S},nf={readContext:function(e,t){return of(),ou(e,t)},useCallback:function(e,t){return Hh="useCallback",sf(),Jh(),zd(e,t)},useContext:function(e,t){return Hh="useContext",sf(),Jh(),ou(e,t)},useEffect:function(e,t){return Hh="useEffect",sf(),Jh(),Sd(e,t)},useImperativeHandle:function(e,t,n){return Hh="useImperativeHandle",sf(),Jh(),Md(e,t,n)},useLayoutEffect:function(e,t){return Hh="useLayoutEffect",sf(),Jh(),kd(e,t)},useMemo:function(e,t){Hh="useMemo",sf(),Jh();var n=Uh.current;Uh.current=nf;try{return Od(e,t)}finally{Uh.current=n}},useReducer:function(e,t,n){Hh="useReducer",sf(),Jh();var i=Uh.current;Uh.current=nf;try{return ud(e)}finally{Uh.current=i}},useRef:function(e){return Hh="useRef",sf(),Jh(),bd()},useState:function(e){Hh="useState",sf(),Jh();var t=Uh.current;Uh.current=nf;try{return gd()}finally{Uh.current=t}},useDebugValue:function(e,t){return Hh="useDebugValue",sf(),Jh(),Ld()},useDeferredValue:function(e){return Hh="useDeferredValue",sf(),Jh(),Fd(e)},useTransition:function(){return Hh="useTransition",sf(),Jh(),Vd()},useMutableSource:function(e,t,n){return Hh="useMutableSource",sf(),Jh(),Ad(e,t,n)},useOpaqueIdentifier:function(){return Hh="useOpaqueIdentifier",sf(),Jh(),Zd()},unstable_isNewReconciler:S},rf={readContext:function(e,t){return of(),ou(e,t)},useCallback:function(e,t){return Hh="useCallback",sf(),Jh(),zd(e,t)},useContext:function(e,t){return Hh="useContext",sf(),Jh(),ou(e,t)},useEffect:function(e,t){return Hh="useEffect",sf(),Jh(),Sd(e,t)},useImperativeHandle:function(e,t,n){return Hh="useImperativeHandle",sf(),Jh(),Md(e,t,n)},useLayoutEffect:function(e,t){return Hh="useLayoutEffect",sf(),Jh(),kd(e,t)},useMemo:function(e,t){Hh="useMemo",sf(),Jh();var n=Uh.current;Uh.current=nf;try{return Od(e,t)}finally{Uh.current=n}},useReducer:function(e,t,n){Hh="useReducer",sf(),Jh();var i=Uh.current;Uh.current=nf;try{return hd(e)}finally{Uh.current=i}},useRef:function(e){return Hh="useRef",sf(),Jh(),bd()},useState:function(e){Hh="useState",sf(),Jh();var t=Uh.current;Uh.current=nf;try{return yd()}finally{Uh.current=t}},useDebugValue:function(e,t){return Hh="useDebugValue",sf(),Jh(),Ld()},useDeferredValue:function(e){return Hh="useDeferredValue",sf(),Jh(),Nd(e)},useTransition:function(){return Hh="useTransition",sf(),Jh(),Gd()},useMutableSource:function(e,t,n){return Hh="useMutableSource",sf(),Jh(),Ad(e,t,n)},useOpaqueIdentifier:function(){return Hh="useOpaqueIdentifier",sf(),Jh(),Hd()},unstable_isNewReconciler:S};var af=i.unstable_now,lf=0,cf=-1;function uf(){return lf}function hf(){lf=af()}function df(e){cf=af(),e.actualStartTime<0&&(e.actualStartTime=af())}function ff(e){cf=-1}function pf(e,t){if(cf>=0){var n=af()-cf;e.actualDuration+=n,t&&(e.selfBaseDuration=n),cf=-1}}function Af(e){for(var t=e.child;t;)e.actualDuration+=t.actualDuration,t=t.sibling}var mf,gf,yf,_f,vf,bf,xf,wf,Ef=o.ReactCurrentOwner,Sf=!1;function Tf(e,t,n,i){t.child=null===e?eh(t,null,n,i):Ju(t,e.child,n,i)}function kf(e,t,n,i,r){if(t.type!==t.elementType){var o=n.propTypes;o&&Tl(o,i,"prop",Ge(n))}var s,a=n.render,l=t.ref;if(ru(t,r),Ef.current=t,Ye(!0),s=id(e,t,a,i,l,r),1&t.mode){Pe();try{s=id(e,t,a,i,l,r)}finally{Me()}}return Ye(!1),null===e||Sf?(t.flags|=1,Tf(e,t,s,r),t.child):(rd(e,t,r),sp(e,t,r))}function Cf(e,t,n,i,r,o){if(null===e){var s=n.type;if(function(e){return"function"==typeof e&&!ug(e)&&void 0===e.defaultProps}(s)&&null===n.compare&&void 0===n.defaultProps){var a;return a=Zm(s),t.tag=y,t.type=a,Nf(t,s),Pf(e,t,a,i,r,o)}var l=s.propTypes;l&&Tl(l,i,"prop",Ge(s));var c=fg(n.type,null,i,t,t.mode,o);return c.ref=t.ref,c.return=t,t.child=c,c}var u=n.type,h=u.propTypes;h&&Tl(h,i,"prop",Ge(u));var d=e.child;if(!zr(r,o)){var f=d.memoizedProps,p=n.compare;if((p=null!==p?p:As)(f,i)&&e.ref===t.ref)return sp(e,t,o)}t.flags|=1;var A=hg(d,i);return A.ref=t.ref,A.return=t,t.child=A,A}function Pf(e,t,n,i,r,o){if(t.type!==t.elementType){var s=t.elementType;if(s.$$typeof===he){var a=s,l=a._payload,c=a._init;try{s=c(l)}catch(e){s=null}var u=s&&s.propTypes;u&&Tl(u,i,"prop",Ge(s))}}if(null!==e&&(As(e.memoizedProps,i)&&e.ref===t.ref&&t.type===e.type)){if(Sf=!1,!zr(o,r))return t.lanes=e.lanes,sp(e,t,o);0!=(e.flags&vi)&&(Sf=!0)}return Rf(e,t,n,i,o)}function Mf(e,t,n){var i,r=t.pendingProps,o=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0==(4&t.mode)){var a={baseLanes:0};t.memoizedState=a,HA(t,n)}else{if(!zr(n,xr)){var l;if(null!==s)l=Or(s.baseLanes,n);else l=n;Bm(xr),t.lanes=t.childLanes=xr;var c={baseLanes:l};return t.memoizedState=c,HA(t,l),null}var u={baseLanes:0};t.memoizedState=u,HA(t,null!==s?s.baseLanes:n)}else null!==s?(i=Or(s.baseLanes,n),t.memoizedState=null):i=n,HA(t,i);return Tf(e,t,o,n),t.child}mf={},gf={},yf={},_f={},vf={},bf=!1,xf={},wf={};var If=Mf;function Lf(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=fi)}function Rf(e,t,n,i,r){if(t.type!==t.elementType){var o=n.propTypes;o&&Tl(o,i,"prop",Ge(n))}var s,a;if(s=Ul(t,Fl(0,n,!0)),ru(t,r),Ef.current=t,Ye(!0),a=id(e,t,n,i,s,r),1&t.mode){Pe();try{a=id(e,t,n,i,s,r)}finally{Me()}}return Ye(!1),null===e||Sf?(t.flags|=1,Tf(e,t,a,r),t.child):(rd(e,t,r),sp(e,t,r))}function zf(e,t,n,i,r){if(t.type!==t.elementType){var o=n.propTypes;o&&Tl(o,i,"prop",Ge(n))}var s,a;Vl(n)?(s=!0,Zl(t)):s=!1,ru(t,r),null===t.stateNode?(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Wu(t,n,i),qu(t,n,i,r),a=!0):a=null===e?function(e,t,n,i){var r=e.stateNode,o=e.memoizedProps;r.props=o;var s=r.context,a=t.contextType,l=zl;l="object"==typeof a&&null!==a?ou(a):Ul(e,Fl(0,t,!0));var c=t.getDerivedStateFromProps,u="function"==typeof c||"function"==typeof r.getSnapshotBeforeUpdate;u||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||o===n&&s===l||$u(e,r,n,l),yu();var h=e.memoizedState,d=r.state=h;if(mu(e,n,r,i),d=e.memoizedState,o===n&&h===d&&!jl()&&!_u())return"function"==typeof r.componentDidMount&&(e.flags|=4),!1;"function"==typeof c&&(Du(e,t,c,n),d=e.memoizedState);var f=_u()||Vu(e,t,o,n,h,d,l);return f?(u||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(e.flags|=4)):("function"==typeof r.componentDidMount&&(e.flags|=4),e.memoizedProps=n,e.memoizedState=d),r.props=n,r.state=d,r.context=l,f}(t,n,i,r):function(e,t,n,i,r){var o=t.stateNode;hu(e,t);var s=t.memoizedProps,a=t.type===t.elementType?s:Wc(t.type,s);o.props=a;var l=t.pendingProps,c=o.context,u=n.contextType,h=zl;h="object"==typeof u&&null!==u?ou(u):Ul(t,Fl(0,n,!0));var d=n.getDerivedStateFromProps,f="function"==typeof d||"function"==typeof o.getSnapshotBeforeUpdate;f||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||s===l&&c===h||$u(t,o,i,h),yu();var p=t.memoizedState,A=o.state=p;if(mu(t,i,o,r),A=t.memoizedState,s===l&&p===A&&!jl()&&!_u())return"function"==typeof o.componentDidUpdate&&(s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4)),"function"==typeof o.getSnapshotBeforeUpdate&&(s===e.memoizedProps&&p===e.memoizedState||(t.flags|=pi)),!1;"function"==typeof d&&(Du(t,n,d,i),A=t.memoizedState);var m=_u()||Vu(t,n,a,i,p,A,h);return m?(f||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(i,A,h),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,A,h)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=pi)):("function"==typeof o.componentDidUpdate&&(s===e.memoizedProps&&p===e.memoizedState||(t.flags|=4)),"function"==typeof o.getSnapshotBeforeUpdate&&(s===e.memoizedProps&&p===e.memoizedState||(t.flags|=pi)),t.memoizedProps=i,t.memoizedState=A),o.props=i,o.state=A,o.context=h,m}(e,t,n,i,r);var c=Df(e,t,n,a,s,r),u=t.stateNode;return a&&u.props!==i&&(bf||l("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",Ge(t.type)||"a component"),bf=!0),c}function Df(e,t,n,i,r,o){Lf(e,t);var s=0!=(t.flags&di);if(!i&&!s)return r&&Hl(t,n,!1),sp(e,t,o);var a,l=t.stateNode;if(Ef.current=t,s&&"function"!=typeof n.getDerivedStateFromError)a=null,ff();else{if(Ye(!0),a=l.render(),1&t.mode){Pe();try{l.render()}finally{Me()}}Ye(!1)}return t.flags|=1,null!==e&&s?function(e,t,n,i){t.child=Ju(t,e.child,null,i),t.child=Ju(t,null,n,i)}(e,t,a,o):Tf(e,t,a,o),t.memoizedState=l.state,r&&Hl(t,n,!0),t.child}function Of(e){var t=e.stateNode;t.pendingContext?$l(e,t.pendingContext,t.pendingContext!==t.context):t.context&&$l(e,t.context,!1),lh(e,t.containerInfo)}function Bf(e,t,n){Of(t);var i=t.updateQueue;if(null===e||null===i)throw Error("If the root does not have an updateQueue, we should have already bailed out. This error is likely caused by a bug in React. Please file an issue.");var r=t.pendingProps,o=t.memoizedState,s=null!==o?o.element:null;hu(e,t),mu(t,r,null,n);var a=t.memoizedState.element;if(a===s)return Lh(),sp(e,t,n);var l,c,u=t.stateNode;if(u.hydrate&&(c=(l=t).stateNode.containerInfo,xh=rl(c),bh=l,wh=!0,1)){var h=u.mutableSourceEagerHydrationData;if(null!=h)for(var d=0;d<h.length;d+=2){Bh(h[d],h[d+1])}var f=eh(t,null,a,n);t.child=f;for(var p=f;p;)p.flags=-3&p.flags|gi,p=p.sibling}else Tf(e,t,a,n),Lh();return t.child}function Ff(e,t,n,i,r){null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2);var o=t.pendingProps,s=n,a=s._payload,l=(0,s._init)(a);t.type=l;var c=t.tag=function(e){if("function"==typeof e)return ug(e)?1:0;if(null!=e){var t=e.$$typeof;if(t===ae)return p;if(t===ue)return g}return 2}(l),u=Wc(l,o);switch(c){case 0:return Nf(t,l),t.type=l=Zm(l),Rf(null,t,l,u,r);case 1:return t.type=l=Hm(l),zf(null,t,l,u,r);case p:return t.type=l=Qm(l),kf(null,t,l,u,r);case g:if(t.type!==t.elementType){var h=l.propTypes;h&&Tl(h,u,"prop",Ge(l))}return Cf(null,t,l,Wc(l.type,u),i,r)}var d="";throw null!==l&&"object"==typeof l&&l.$$typeof===he&&(d=" Did you wrap a component in React.lazy() more than once?"),Error("Element type is invalid. Received a promise that resolves to: "+l+". Lazy element type must resolve to a class or function."+d)}function Nf(e,t){if(t&&t.childContextTypes&&l("%s(...): childContextTypes cannot be defined on a function component.",t.displayName||t.name||"Component"),null!==e.ref){var n="",i=Ze();i&&(n+="\n\nCheck the render method of `"+i+"`.");var r=i||e._debugID||"",o=e._debugSource;o&&(r=o.fileName+":"+o.lineNumber),vf[r]||(vf[r]=!0,l("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",n))}if("function"==typeof t.getDerivedStateFromProps){var s=Ge(t)||"Unknown";_f[s]||(l("%s: Function components do not support getDerivedStateFromProps.",s),_f[s]=!0)}if("object"==typeof t.contextType&&null!==t.contextType){var a=Ge(t)||"Unknown";yf[a]||(l("%s: Function components do not support contextType.",a),yf[a]=!0)}}var Uf={dehydrated:null,retryLane:0};function jf(e){return{baseLanes:e}}function Vf(e,t){return{baseLanes:Or(e.baseLanes,t)}}function Gf(e,t){return Br(e.childLanes,t)}function Wf(e,t,n){var i=t.pendingProps;Pg(t)&&(t.flags|=di);var r=fh.current,o=!1;if(0!=(t.flags&di)||function(e,t,n,i){return(null===t||null!==t.memoizedState)&&ph(e,2)}(r,e)?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0!==i.fallback&&!0!==i.unstable_avoidThisFallback&&(r=r|1),gh(t,r=Ah(r)),null===e){void 0!==i.fallback&&kh(t);var s=i.children,a=i.fallback;if(o){var l=$f(t,s,a,n);return t.child.memoizedState=jf(n),t.memoizedState=Uf,l}if("number"==typeof i.unstable_expectedLoadTime){var c=$f(t,s,a,n);return t.child.memoizedState=jf(n),t.memoizedState=Uf,t.lanes=gr,Bm(gr),c}return function(e,t,n){var i=e.mode,r=mg({mode:"visible",children:t},i,n,null);return r.return=e,e.child=r,r}(t,s,n)}if(null!==e.memoizedState){if(o){var u=i.fallback,h=Hf(e,t,i.children,u,n),d=t.child,f=e.child.memoizedState;return d.memoizedState=null===f?jf(n):Vf(f,n),d.childLanes=Gf(e,n),t.memoizedState=Uf,h}var p=Zf(e,t,i.children,n);return t.memoizedState=null,p}if(o){var A=i.fallback,m=Hf(e,t,i.children,A,n),g=t.child,y=e.child.memoizedState;return g.memoizedState=null===y?jf(n):Vf(y,n),g.childLanes=Gf(e,n),t.memoizedState=Uf,m}var _=Zf(e,t,i.children,n);return t.memoizedState=null,_}function $f(e,t,n,i){var r,o,s=e.mode,a=e.child,l={mode:"hidden",children:t};return 0==(2&s)&&null!==a?((r=a).childLanes=0,r.pendingProps=l,8&e.mode&&(r.actualDuration=0,r.actualStartTime=-1,r.selfBaseDuration=0,r.treeBaseDuration=0),o=Ag(n,s,i,null)):(r=mg(l,s,0,null),o=Ag(n,s,i,null)),r.return=e,o.return=e,r.sibling=o,e.child=r,o}function qf(e,t){return hg(e,t)}function Zf(e,t,n,i){var r=e.child,o=r.sibling,s=qf(r,{mode:"visible",children:n});return 0==(2&t.mode)&&(s.lanes=i),s.return=t,s.sibling=null,null!==o&&(o.nextEffect=null,o.flags=8,t.firstEffect=t.lastEffect=o),t.child=s,s}function Hf(e,t,n,i,r){var o,s,a=t.mode,l=e.child,c=l.sibling,u={mode:"hidden",children:n};if(0==(2&a)&&t.child!==l){(o=t.child).childLanes=0,o.pendingProps=u,8&t.mode&&(o.actualDuration=0,o.actualStartTime=-1,o.selfBaseDuration=l.selfBaseDuration,o.treeBaseDuration=l.treeBaseDuration);var h=o.lastEffect;null!==h?(t.firstEffect=o.firstEffect,t.lastEffect=h,h.nextEffect=null):t.firstEffect=t.lastEffect=null}else o=qf(l,u);return null!==c?s=hg(c,i):(s=Ag(i,a,r,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,s}function Qf(e,t){e.lanes=Or(e.lanes,t);var n=e.alternate;null!==n&&(n.lanes=Or(n.lanes,t)),iu(e.return,t)}function Xf(e,t){var n=Array.isArray(e),i=!n&&"function"==typeof _e(e);if(n||i){var r=n?"array":"iterable";return l("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",r,t,r),!1}return!0}function Yf(e,t,n,i,r,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r,s.lastEffect=o)}function Kf(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail,s=i.children;!function(e){if(void 0!==e&&"forwards"!==e&&"backwards"!==e&&"together"!==e&&!xf[e])if(xf[e]=!0,"string"==typeof e)switch(e.toLowerCase()){case"together":case"forwards":case"backwards":l('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',e,e.toLowerCase());break;case"forward":case"backward":l('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',e,e.toLowerCase());break;default:l('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}else l('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}(r),function(e,t){void 0===e||wf[e]||("collapsed"!==e&&"hidden"!==e?(wf[e]=!0,l('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',e)):"forwards"!==t&&"backwards"!==t&&(wf[e]=!0,l('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',e)))}(o,r),function(e,t){if(("forwards"===t||"backwards"===t)&&null!=e&&!1!==e)if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(!Xf(e[n],n))return}else{var i=_e(e);if("function"==typeof i){var r=i.call(e);if(r)for(var o=r.next(),s=0;!o.done;o=r.next()){if(!Xf(o.value,s))return;s++}}else l('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',t)}}(s,r),Tf(e,t,s,n);var a=fh.current;ph(a,2)?(a=mh(a,2),t.flags|=di):(null!==e&&0!=(e.flags&di)&&function(e,t,n){for(var i=t;null!==i;){if(i.tag===m)null!==i.memoizedState&&Qf(i,n);else if(i.tag===v)Qf(i,n);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)return;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}(t,t.child,n),a=Ah(a));if(gh(t,a),0==(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":var c,u=function(e){for(var t=e,n=null;null!==t;){var i=t.alternate;null!==i&&null===vh(i)&&(n=t),t=t.sibling}return n}(t.child);null===u?(c=t.child,t.child=null):(c=u.sibling,u.sibling=null),Yf(t,!1,c,u,o,t.lastEffect);break;case"backwards":var h=null,d=t.child;for(t.child=null;null!==d;){var f=d.alternate;if(null!==f&&null===vh(f)){t.child=d;break}var p=d.sibling;d.sibling=h,h=d,d=p}Yf(t,!0,h,null,o,t.lastEffect);break;case"together":Yf(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}var Jf=!1;function ep(e,t,n){var i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value;"value"in r||Jf||(Jf=!0,l("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var a=t.type.propTypes;if(a&&Tl(a,r,"prop","Context.Provider"),tu(t,s),null!==o){var c=function(e,t,n){if(fs(n,t))return 0;var i="function"==typeof e._calculateChangedBits?e._calculateChangedBits(n,t):qc;return(i&qc)!==i&&l("calculateChangedBits: Expected the return value to be a 31-bit integer. Instead received: %s",i),0|i}(i,s,o.value);if(0===c){if(o.children===r.children&&!jl())return sp(e,t,n)}else!function(e,t,n,i){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var o=void 0,s=r.dependencies;if(null!==s){o=r.child;for(var a=s.firstContext;null!==a;){if(a.context===t&&0!=(a.observedBits&n)){if(1===r.tag){var l=du(wr,Lr(i));l.tag=lu,fu(r,l)}r.lanes=Or(r.lanes,i);var c=r.alternate;null!==c&&(c.lanes=Or(c.lanes,i)),iu(r.return,i),s.lanes=Or(s.lanes,i);break}a=a.next}}else o=r.tag===d&&r.type===e.type?null:r.child;if(null!==o)o.return=r;else for(o=r;null!==o;){if(o===e){o=null;break}var u=o.sibling;if(null!==u){u.return=o.return,o=u;break}o=o.return}r=o}}(t,i,c,n)}return Tf(e,t,r.children,n),t.child}var tp,np,ip,rp=!1;function op(){Sf=!0}function sp(e,t,n){return null!==e&&(t.dependencies=e.dependencies),ff(),nm(t.lanes),zr(n,t.childLanes)?(function(e,t){if(null!==e&&t.child!==e.child)throw Error("Resuming work not yet implemented.");if(null!==t.child){var n=t.child,i=hg(n,n.pendingProps);for(t.child=i,i.return=t;null!==n.sibling;)n=n.sibling,(i=i.sibling=hg(n,n.pendingProps)).return=t;i.sibling=null}}(e,t),t.child):null}function ap(e,t,n){var i=t.lanes;if(t._debugNeedsRemount&&null!==e)return function(e,t,n){var i=t.return;if(null===i)throw new Error("Cannot swap the root fiber.");if(e.alternate=null,t.alternate=null,n.index=t.index,n.sibling=t.sibling,n.return=t.return,n.ref=t.ref,t===i.child)i.child=n;else{var r=i.child;if(null===r)throw new Error("Expected parent to have a child.");for(;r.sibling!==t;)if(null===(r=r.sibling))throw new Error("Expected to find the previous sibling.");r.sibling=n}var o=i.lastEffect;return null!==o?(o.nextEffect=e,i.lastEffect=e):i.firstEffect=i.lastEffect=e,e.nextEffect=null,e.flags=8,n.flags|=2,n}(e,t,fg(t.type,t.key,t.pendingProps,t._debugOwner||null,t.mode,t.lanes));if(null!==e)if(e.memoizedProps!==t.pendingProps||jl()||t.type!==e.type)Sf=!0;else{if(!zr(n,i)){switch(Sf=!1,t.tag){case 3:Of(t),Lh();break;case 5:hh(t);break;case 1:Vl(t.type)&&Zl(t);break;case 4:lh(t,t.stateNode.containerInfo);break;case d:tu(t,t.memoizedProps.value);break;case A:zr(n,t.childLanes)&&(t.flags|=4);var r=t.stateNode;r.effectDuration=0,r.passiveEffectDuration=0;break;case m:if(null!==t.memoizedState){if(zr(n,t.child.childLanes))return Wf(e,t,n);gh(t,Ah(fh.current));var o=sp(e,t,n);return null!==o?o.sibling:null}gh(t,Ah(fh.current));break;case v:var s=0!=(e.flags&di),a=zr(n,t.childLanes);if(s){if(a)return Kf(e,t,n);t.flags|=di}var c=t.memoizedState;if(null!==c&&(c.rendering=null,c.tail=null,c.lastEffect=null),gh(t,fh.current),a)break;return null;case w:case E:return t.lanes=0,Mf(e,t,n)}return sp(e,t,n)}Sf=0!=(e.flags&vi)}else Sf=!1;switch(t.lanes=0,t.tag){case 2:return function(e,t,n,i){null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2);var r,o,s=t.pendingProps;if(r=Ul(t,Fl(0,n,!1)),ru(t,i),n.prototype&&"function"==typeof n.prototype.render){var a=Ge(n)||"Unknown";mf[a]||(l("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",a,a),mf[a]=!0)}if(1&t.mode&&Rc.recordLegacyContextWarning(t,null),Ye(!0),Ef.current=t,o=id(null,t,n,s,r,i),Ye(!1),t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof){var c=Ge(n)||"Unknown";gf[c]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",c,c,c),gf[c]=!0)}if("object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof){var u=Ge(n)||"Unknown";gf[u]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",u,u,u),gf[u]=!0),t.tag=1,t.memoizedState=null,t.updateQueue=null;var h=!1;Vl(n)?(h=!0,Zl(t)):h=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,uu(t);var d=n.getDerivedStateFromProps;return"function"==typeof d&&Du(t,n,d,s),Gu(t,o),qu(t,n,s,i),Df(null,t,n,!0,h,i)}if(t.tag=0,1&t.mode){Pe();try{o=id(null,t,n,s,r,i)}finally{Me()}}return Tf(null,t,o,i),Nf(t,n),t.child}(e,t,t.type,n);case 16:return Ff(e,t,t.elementType,i,n);case 0:var u=t.type,h=t.pendingProps;return Rf(e,t,u,t.elementType===u?h:Wc(u,h),n);case 1:var f=t.type,S=t.pendingProps;return zf(e,t,f,t.elementType===f?S:Wc(f,S),n);case 3:return Bf(e,t,n);case 5:return function(e,t,n){hh(t),null===e&&kh(t);var i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children;return $a(i,r)?s=null:null!==o&&$a(i,o)&&(t.flags|=16),Lf(e,t),Tf(e,t,s,n),t.child}(e,t,n);case 6:return function(e,t){return null===e&&kh(t),null}(e,t);case m:return Wf(e,t,n);case 4:return function(e,t,n){lh(t,t.stateNode.containerInfo);var i=t.pendingProps;return null===e?t.child=Ju(t,null,i,n):Tf(e,t,i,n),t.child}(e,t,n);case p:var T=t.type,k=t.pendingProps;return kf(e,t,T,t.elementType===T?k:Wc(T,k),n);case 7:return function(e,t,n){return Tf(e,t,t.pendingProps,n),t.child}(e,t,n);case 8:return function(e,t,n){return Tf(e,t,t.pendingProps.children,n),t.child}(e,t,n);case A:return function(e,t,n){t.flags|=4;var i=t.stateNode;return i.effectDuration=0,i.passiveEffectDuration=0,Tf(e,t,t.pendingProps.children,n),t.child}(e,t,n);case d:return ep(e,t,n);case 9:return function(e,t,n){var i=t.type;void 0===i._context?i!==i.Consumer&&(rp||(rp=!0,l("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):i=i._context;var r=t.pendingProps,o=r.children;"function"!=typeof o&&l("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),ru(t,n);var s,a=ou(i,r.unstable_observedBits);return Ef.current=t,Ye(!0),s=o(a),Ye(!1),t.flags|=1,Tf(e,t,s,n),t.child}(e,t,n);case g:var C=t.type,P=Wc(C,t.pendingProps);if(t.type!==t.elementType){var M=C.propTypes;M&&Tl(M,P,"prop",Ge(C))}return Cf(e,t,C,P=Wc(C.type,P),i,n);case y:return Pf(e,t,t.type,t.pendingProps,i,n);case _:var I=t.type,L=t.pendingProps;return function(e,t,n,i,r){var o;return null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,Vl(n)?(o=!0,Zl(t)):o=!1,ru(t,r),Wu(t,n,i),qu(t,n,i,r),Df(null,t,n,!0,o,r)}(e,t,I,t.elementType===I?L:Wc(I,L),n);case v:return Kf(e,t,n);case b:case 21:case x:break;case w:return Mf(e,t,n);case E:return If(e,t,n)}throw Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function lp(e){e.flags|=4}function cp(e){e.flags|=fi}function up(e,t){if(!Rh())switch(e.tailMode){case"hidden":for(var n=e.tail,i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":for(var r=e.tail,o=null;null!==r;)null!==r.alternate&&(o=r),r=r.sibling;null===o?t||null===e.tail?e.tail=null:e.tail.sibling=null:o.sibling=null}}function hp(e,t,n){var i,r,o,s=t.pendingProps;switch(t.tag){case 2:case 16:case y:case 0:case p:case 7:case 8:case A:case 9:case g:return null;case 1:return Vl(t.type)&&Gl(t),null;case 3:ch(t),Wl(t),Oh();var a=t.stateNode;if(a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),null===e||null===e.child)Ih(t)?lp(t):a.hydrate||(t.flags|=pi);return null;case 5:dh(t);var l=ah(),c=t.type;if(null!==e&&null!=t.stateNode)np(e,t,c,s),e.ref!==t.ref&&cp(t);else{if(!s){if(null===t.stateNode)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return null}var u=uh();if(Ih(t))r=u,o=ol((i=t).stateNode,i.type,i.memoizedProps,0,r,i),i.updateQueue=o,null!==o&&lp(t);else{var h=Wa(c,s,l,u,t);tp(h,t),t.stateNode=h,function(e,t,n,i,r){return xa(e,t,n),Va(t,n)}(h,c,s)&&lp(t)}null!==t.ref&&cp(t)}return null;case 6:var f=s;if(e&&null!=t.stateNode){var S=e.memoizedProps;ip(0,t,S,f)}else{if("string"!=typeof f&&null===t.stateNode)throw Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var T=ah(),k=uh();Ih(t)?Ch(t)&&lp(t):t.stateNode=qa(f,T,k,t)}return null;case m:yh(t);var C=t.memoizedState;if(0!=(t.flags&di))return t.lanes=n,0!=(8&t.mode)&&Af(t),t;var P=null!==C,M=!1;if(null===e)void 0!==t.memoizedProps.fallback&&Ih(t);else M=null!==e.memoizedState;if(P&&!M)if(0!=(2&t.mode))null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||ph(fh.current,1)?0===rA&&(rA=3):function(){0!==rA&&3!==rA||(rA=4);null!==Jp&&(Pr(aA)||Pr(lA))&&GA(Jp,tA)}();return(P||M)&&(t.flags|=4),null;case 4:return ch(t),null===e&&Gs(t.stateNode.containerInfo),null;case d:return nu(t),null;case _:return Vl(t.type)&&Gl(t),null;case v:yh(t);var I=t.memoizedState;if(null===I)return null;var L=0!=(t.flags&di),R=I.rendering;if(null===R)if(L)up(I,!1);else{if(!(0===rA&&(null===e||0==(e.flags&di))))for(var z=t.child;null!==z;){var D=vh(z);if(null!==D){L=!0,t.flags|=di,up(I,!1);var O=D.updateQueue;return null!==O&&(t.updateQueue=O,t.flags|=4),null===I.lastEffect&&(t.firstEffect=null),t.lastEffect=I.lastEffect,th(t,n),gh(t,mh(fh.current,2)),t.child}z=z.sibling}null!==I.tail&&wc()>pA()&&(t.flags|=di,L=!0,up(I,!1),t.lanes=gr,Bm(gr))}else{if(!L){var B=vh(R);if(null!==B){t.flags|=di,L=!0;var F=B.updateQueue;if(null!==F&&(t.updateQueue=F,t.flags|=4),up(I,!0),null===I.tail&&"hidden"===I.tailMode&&!R.alternate&&!Rh()){var N=t.lastEffect=I.lastEffect;return null!==N&&(N.nextEffect=null),null}}else 2*wc()-I.renderingStartTime>pA()&&n!==xr&&(t.flags|=di,L=!0,up(I,!1),t.lanes=gr,Bm(gr))}if(I.isBackwards)R.sibling=t.child,t.child=R;else{var U=I.last;null!==U?U.sibling=R:t.child=R,I.last=R}}if(null!==I.tail){var j=I.tail;I.rendering=j,I.tail=j.sibling,I.lastEffect=t.lastEffect,I.renderingStartTime=wc(),j.sibling=null;var V=fh.current;return gh(t,V=L?mh(V,2):Ah(V)),j}return null;case b:case 21:case x:break;case w:case E:if(QA(t),null!==e){var G=t.memoizedState;null!==e.memoizedState!==(null!==G)&&"unstable-defer-without-hiding"!==s.mode&&(t.flags|=4)}return null}throw Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function dp(e,t){switch(e.tag){case 1:Vl(e.type)&&Gl(e);var n=e.flags;return n&_i?(e.flags=-4097&n|di,0!=(8&e.mode)&&Af(e),e):null;case 3:ch(e),Wl(e),Oh();var i=e.flags;if(0!=(i&di))throw Error("The root failed to unmount after an error. This is likely a bug in React. Please file an issue.");return e.flags=-4097&i|di,e;case 5:return dh(e),null;case m:yh(e);var r=e.flags;return r&_i?(e.flags=-4097&r|di,0!=(8&e.mode)&&Af(e),e):null;case v:return yh(e),null;case 4:return ch(e),null;case d:return nu(e),null;case w:case E:return QA(e),null;default:return null}}function fp(e){switch(e.tag){case 1:var t=e.type.childContextTypes;null!=t&&Gl(e);break;case 3:ch(e),Wl(e),Oh();break;case 5:dh(e);break;case 4:ch(e);break;case m:case v:yh(e);break;case d:nu(e);break;case w:case E:QA(e)}}function pp(e,t){return{value:e,source:t,stack:je(t)}}function Ap(e,t){try{0;var n=t.value,i=t.source,r=t.stack,o=null!==r?r:"";if(null!=n&&n._suppressLogging){if(1===e.tag)return;console.error(n)}var s=i?Ge(i.type):null,a=s?"The above error occurred in the <"+s+"> component:":"The above error occurred in one of your React components:",l=Ge(e.type),c=a+"\n"+o+"\n\n"+(l?"React will try to recreate this component tree from scratch using the error boundary you provided, "+l+".":"Consider adding an error boundary to your tree to customize error handling behavior.\nVisit https://reactjs.org/link/error-boundaries to learn more about error boundaries.");console.error(c)}catch(e){setTimeout((function(){throw e}))}}tp=function(e,t,n,i){for(var r,o,s=t.child;null!==s;){if(5===s.tag||6===s.tag)r=e,o=s.stateNode,r.appendChild(o);else if(4===s.tag);else if(null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)return;for(;null===s.sibling;){if(null===s.return||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},np=function(e,t,n,i,r){var o=e.memoizedProps;if(o!==i){var s=function(e,t,n,i,r,o){var s=o;if(typeof i.children!=typeof n.children&&("string"==typeof i.children||"number"==typeof i.children)){var a=""+i.children,l=Ia(s.ancestorInfo,t);Ma(null,a,l)}return wa(e,t,n,i)}(t.stateNode,n,o,i,0,uh());t.updateQueue=s,s&&lp(t)}},ip=function(e,t,n,i){n!==i&&lp(t)};var mp="function"==typeof WeakMap?WeakMap:Map;function gp(e,t,n){var i=du(wr,n);i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){vm(r),Ap(e,t)},i}function yp(e,t,n){var i=du(wr,n);i.tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var o=t.value;i.payload=function(){return Ap(e,t),r(o)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch?i.callback=function(){var n;Ym(e),"function"!=typeof r&&(n=this,null===yA?yA=new Set([n]):yA.add(n),Ap(e,t));var i=t.value,o=t.stack;this.componentDidCatch(i,{componentStack:null!==o?o:""}),"function"!=typeof r&&(zr(e.lanes,1)||l("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",Ge(e.type)||"Unknown"))}:i.callback=function(){Ym(e)},i}function _p(e,t,n){var i,r=e.pingCache;if(null===r?(r=e.pingCache=new mp,i=new Set,r.set(t,i)):void 0===(i=r.get(t))&&(i=new Set,r.set(t,i)),!i.has(n)){i.add(n);var o=wm.bind(null,e,t,n);t.then(o,o)}}function vp(e,t,n,i,r){if(n.flags|=yi,n.firstEffect=n.lastEffect=null,null!==i&&"object"==typeof i&&"function"==typeof i.then){var o=i;if(0==(2&n.mode)){var s=n.alternate;s?(n.updateQueue=s.updateQueue,n.memoizedState=s.memoizedState,n.lanes=s.lanes):(n.updateQueue=null,n.memoizedState=null)}var a=ph(fh.current,1),l=t;do{if(l.tag===m&&_h(l,a)){var c=l.updateQueue;if(null===c){var u=new Set;u.add(o),l.updateQueue=u}else c.add(o);if(0==(2&l.mode)){if(l.flags|=di,n.flags|=vi,n.flags&=-2981,1===n.tag)if(null===n.alternate)n.tag=_;else{var h=du(wr,1);h.tag=lu,fu(n,h)}return void(n.lanes=Or(n.lanes,1))}return _p(e,o,r),l.flags|=_i,void(l.lanes=r)}l=l.return}while(null!==l);i=new Error((Ge(n.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==rA&&(rA=2),i=pp(i,n);var d=t;do{switch(d.tag){case 3:var f=i;d.flags|=_i;var p=Lr(r);return d.lanes=Or(d.lanes,p),void pu(d,gp(d,f,p));case 1:var A=i,g=d.type,y=d.stateNode;if(0==(d.flags&di)&&("function"==typeof g.getDerivedStateFromError||null!==y&&"function"==typeof y.componentDidCatch&&!_m(y))){d.flags|=_i;var v=Lr(r);return d.lanes=Or(d.lanes,v),void pu(d,yp(d,A,v))}}d=d.return}while(null!==d)}var bp;bp=new Set;var xp="function"==typeof WeakSet?WeakSet:Set,wp=function(e,t){t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()};function Ep(e){var t=e.ref;null!==t&&("function"==typeof t?(ri(null,t,null,null),oi()&&xm(e,si())):t.current=null)}function Sp(e,t){(ri(null,t,null),oi())&&xm(e,si())}function Tp(e,t){switch(t.tag){case 0:case p:case y:case x:case 5:case 6:case 4:case _:return;case 1:if(t.flags&pi&&null!==e){var n=e.memoizedProps,i=e.memoizedState,r=t.stateNode;t.type!==t.elementType||bf||(r.props!==t.memoizedProps&&l("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ge(t.type)||"instance"),r.state!==t.memoizedState&&l("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ge(t.type)||"instance"));var o=r.getSnapshotBeforeUpdate(t.elementType===t.type?n:Wc(t.type,n),i),s=bp;void 0!==o||s.has(t.type)||(s.add(t.type),l("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",Ge(t.type))),r.__reactInternalSnapshotBeforeUpdate=o}return;case 3:if(t.flags&pi)el(t.stateNode.containerInfo);return}throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function kp(e,t,n,i){switch(n.tag){case 0:case p:case y:case x:return function(e,t){var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next,o=r;do{if((o.tag&e)===e){var s=o.create;o.destroy=s();var a=o.destroy;void 0!==a&&"function"!=typeof a&&l("An effect function must not return anything besides a function, which is used for clean-up.%s",null===a?" You returned null. If your effect does not require clean up, return undefined (or nothing).":"function"==typeof a.then?"\n\nIt looks like you wrote useEffect(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:\n\nuseEffect(() => {\n  async function fetchData() {\n    // You can await here\n    const response = await MyAPI.getData(someId);\n    // ...\n  }\n  fetchData();\n}, [someId]); // Or [] if effect doesn't need props or state\n\nLearn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching":" You returned: "+a)}o=o.next}while(o!==r)}}(3,n),void function(e){var t=e.updateQueue,n=null!==t?t.lastEffect:null;if(null!==n){var i=n.next,r=i;do{var o=r,s=o.next,a=o.tag;0!=(4&a)&&0!=(1&a)&&(mm(e,r),Am(e,r)),r=s}while(r!==i)}}(n);case 1:var r=n.stateNode;if(4&n.flags)if(null===t)n.type!==n.elementType||bf||(r.props!==n.memoizedProps&&l("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ge(n.type)||"instance"),r.state!==n.memoizedState&&l("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ge(n.type)||"instance")),r.componentDidMount();else{var o=n.elementType===n.type?t.memoizedProps:Wc(n.type,t.memoizedProps),s=t.memoizedState;n.type!==n.elementType||bf||(r.props!==n.memoizedProps&&l("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ge(n.type)||"instance"),r.state!==n.memoizedState&&l("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ge(n.type)||"instance")),r.componentDidUpdate(o,s,r.__reactInternalSnapshotBeforeUpdate)}var a=n.updateQueue;return void(null!==a&&(n.type!==n.elementType||bf||(r.props!==n.memoizedProps&&l("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ge(n.type)||"instance"),r.state!==n.memoizedState&&l("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ge(n.type)||"instance")),vu(0,a,r)));case 3:var c=n.updateQueue;if(null!==c){var u=null;if(null!==n.child)switch(n.child.tag){case 5:case 1:u=n.child.stateNode}vu(0,c,u)}return;case 5:var h=n.stateNode;if(null===t&&4&n.flags)!function(e,t,n,i){Va(t,n)&&e.focus()}(h,n.type,n.memoizedProps);return;case 6:case 4:case v:case _:case b:case 21:case w:case E:return;case A:var d=n.memoizedProps;d.onCommit;var f=d.onRender;n.stateNode.effectDuration;var g=uf();return void("function"==typeof f&&f(n.memoizedProps.id,null===t?"mount":"update",n.actualDuration,n.treeBaseDuration,n.actualStartTime,g,e.memoizedInteractions));case m:return void function(e,t){if(null===t.memoizedState){var n=t.alternate;if(null!==n){var i=n.memoizedState;if(null!==i){var r=i.dehydrated;null!==r&&function(e){Hi(e)}(r)}}}}(0,n)}throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function Cp(e,t){for(var n=e;;){if(5===n.tag){var i=n.stateNode;t?Ya(i):Ka(n.stateNode,n.memoizedProps)}else if(6===n.tag){var r=n.stateNode;t?r.nodeValue="":Ja(r,n.memoizedProps)}else if(n.tag!==w&&n.tag!==E||null===n.memoizedState||n===e){if(null!==n.child){n.child.return=n,n=n.child;continue}}else;if(n===e)return;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function Pp(e){var t=e.ref;if(null!==t){var n,i=e.stateNode;e.tag,n=i,"function"==typeof t?t(n):(t.hasOwnProperty("current")||l("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",Ge(e.type)),t.current=n)}}function Mp(e){var t=e.ref;null!==t&&("function"==typeof t?t(null):t.current=null)}function Ip(e,t,n){switch(function(e){if(Yl&&"function"==typeof Yl.onCommitFiberUnmount)try{Yl.onCommitFiberUnmount(Xl,e)}catch(e){Kl||(Kl=!0,l("React instrumentation encountered an error: %s",e))}}(t),t.tag){case 0:case p:case g:case y:case x:var i=t.updateQueue;if(null!==i){var r=i.lastEffect;if(null!==r){var o=r.next,s=o;do{var a=s,c=a.destroy,u=a.tag;void 0!==c&&(0!=(4&u)?mm(t,s):Sp(t,c)),s=s.next}while(s!==o)}}return;case 1:Ep(t);var h=t.stateNode;return void("function"==typeof h.componentWillUnmount&&function(e,t){ri(null,wp,null,e,t),oi()&&xm(e,si())}(t,h));case 5:return void Ep(t);case 4:return void Fp(e,t);case b:case 18:case 21:return}}function Lp(e,t,n){for(var i=t;;)if(Ip(e,i),null===i.child||4===i.tag){if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function Rp(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null,e._debugOwner=null}function zp(e){return 5===e.tag||3===e.tag||4===e.tag}function Dp(e){var t,n,i=function(e){for(var t=e.return;null!==t;){if(zp(t))return t;t=t.return}throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}(e),r=i.stateNode;switch(i.tag){case 5:t=r,n=!1;break;case 3:case 4:t=r.containerInfo,n=!0;break;default:throw Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}16&i.flags&&(Qa(t),i.flags&=-17);var o=function(e){var t=e;e:for(;;){for(;null===t.sibling;){if(null===t.return||zp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue e;if(null===t.child||4===t.tag)continue e;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}(e);n?Op(e,o,t):Bp(e,o,t)}function Op(e,t,n){var i=e.tag,r=5===i||6===i;if(r){var o=r?e.stateNode:e.stateNode.instance;t?function(e,t,n){8===e.nodeType?e.parentNode.insertBefore(t,n):e.insertBefore(t,n)}(n,o,t):function(e,t){var n;8===e.nodeType?(n=e.parentNode).insertBefore(t,e):(n=e).appendChild(t),null==e._reactRootContainer&&null===n.onclick&&ba(n)}(n,o)}else if(4===i);else{var s=e.child;if(null!==s){Op(s,t,n);for(var a=s.sibling;null!==a;)Op(a,t,n),a=a.sibling}}}function Bp(e,t,n){var i=e.tag,r=5===i||6===i;if(r){var o=r?e.stateNode:e.stateNode.instance;t?function(e,t,n){e.insertBefore(t,n)}(n,o,t):function(e,t){e.appendChild(t)}(n,o)}else if(4===i);else{var s=e.child;if(null!==s){Bp(s,t,n);for(var a=s.sibling;null!==a;)Bp(a,t,n),a=a.sibling}}}function Fp(e,t,n){for(var i,r,o,s,a=t,l=!1;;){if(!l){var c=a.return;e:for(;;){if(null===c)throw Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");var u=c.stateNode;switch(c.tag){case 5:i=u,r=!1;break e;case 3:case 4:i=u.containerInfo,r=!0;break e}c=c.return}l=!0}if(5===a.tag||6===a.tag)Lp(e,a),r?(o=i,s=a.stateNode,8===o.nodeType?o.parentNode.removeChild(s):o.removeChild(s)):Xa(i,a.stateNode);else if(4===a.tag){if(null!==a.child){i=a.stateNode.containerInfo,r=!0,a.child.return=a,a=a.child;continue}}else if(Ip(e,a),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)return;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(l=!1)}a.sibling.return=a.return,a=a.sibling}}function Np(e,t,n){Fp(e,t);var i=t.alternate;Rp(t),null!==i&&Rp(i)}function Up(e,t){switch(t.tag){case 0:case p:case g:case y:case x:return void function(e,t){var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var r=i.next,o=r;do{if((o.tag&e)===e){var s=o.destroy;o.destroy=void 0,void 0!==s&&s()}o=o.next}while(o!==r)}}(3,t);case 1:case A:case _:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps,r=null!==e?e.memoizedProps:i,o=t.type,s=t.updateQueue;t.updateQueue=null,null!==s&&function(e,t,n,i,r,o){bl(e,r),Ea(e,t,n,i,r)}(n,s,o,r,i)}return;case 6:if(null===t.stateNode)throw Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var a=t.stateNode,l=t.memoizedProps;null!==e&&e.memoizedProps;return void function(e,t,n){e.nodeValue=n}(a,0,l);case 3:var c=t.stateNode;return void(c.hydrate&&(c.hydrate=!1,Hi(c.containerInfo)));case m:return function(e){if(null!==e.memoizedState){hA=wc(),Cp(e.child,!0)}}(t),void jp(t);case v:return void jp(t);case b:case 21:break;case w:case E:return void Cp(t,null!==t.memoizedState)}throw Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}function jp(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new xp),t.forEach((function(t){var i=Em.bind(null,e,t);n.has(t)||(!0!==t.__reactDoNotTraceInteractions&&(i=r.unstable_wrap(i)),n.add(t),t.then(i,i))}))}}function Vp(e,t){if(null!==e){var n=e.memoizedState;if(null===n||null!==n.dehydrated){var i=t.memoizedState;return null!==i&&null===i.dehydrated}}return!1}function Gp(e){Qa(e.stateNode)}if("function"==typeof Symbol&&Symbol.for){var Wp=Symbol.for;Wp("selector.component"),Wp("selector.has_pseudo_class"),Wp("selector.role"),Wp("selector.test_id"),Wp("selector.text")}var $p=[];var qp=Math.ceil,Zp=o.ReactCurrentDispatcher,Hp=o.ReactCurrentOwner,Qp=o.IsSomeRendererActing,Xp=16,Yp=32,Kp=0,Jp=null,eA=null,tA=0,nA=0,iA=Il(0),rA=0,oA=null,sA=0,aA=0,lA=0,cA=0,uA=null,hA=0,dA=1/0;function fA(){dA=wc()+500}function pA(){return dA}var AA=null,mA=!1,gA=null,yA=null,_A=!1,vA=null,bA=90,xA=0,wA=[],EA=[],SA=null,TA=0,kA=null,CA=0,PA=null,MA=wr,IA=0,LA=0,RA=!1,zA=null,DA=!1;function OA(){return 0!=(48&Kp)?wc():MA!==wr?MA:MA=wc()}function BA(e){var t=e.mode;if(0==(2&t))return 1;if(0==(4&t))return Ec()===pc?1:2;if(0===IA&&(IA=sA),0!==Lc.transition)return 0!==LA&&(LA=null!==uA?uA.pendingLanes:0),function(e,t){var n=Lr(Ar&~t);return 0===n&&0===(n=Lr(Ar&~e))&&(n=Lr(Ar)),n}(IA,LA);var n,i=Ec();0!=(4&Kp)&&i===Ac?n=Ir(12,IA):n=Ir(function(e){switch(e){case 99:return dr;case 98:return fr;case 97:case 96:return 8;case 95:return 2;default:return 0}}(i),IA);return n}function FA(e){var t,n=e.mode;return 0==(2&n)?1:0==(4&n)?Ec()===pc?1:2:(0===IA&&(IA=sA),0===(t=Lr(mr&~IA))&&(t=Lr(mr)),t)}function NA(e,t,n){!function(){if(TA>50)throw TA=0,kA=null,Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");CA>50&&(CA=0,l("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}(),function(e){if(qe&&0!=(Kp&Xp)&&!Wd)switch(e.tag){case 0:case p:case y:var t=eA&&Ge(eA.type)||"Unknown",n=t;if(!Pm.has(n))Pm.add(n),l("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",Ge(e.type)||"Unknown",t,t);break;case 1:Mm||(l("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),Mm=!0)}}(e);var i=UA(e,t);if(null===i)return function(e){var t=e.tag;if(3!==t&&1!==t&&0!==t&&t!==p&&t!==g&&t!==y&&t!==x)return;if(0!=(e.flags&mi))return;var n=Ge(e.type)||"ReactComponent";if(null!==Cm){if(Cm.has(n))return;Cm.add(n)}else Cm=new Set([n]);if(RA);else{var i=$e;try{Xe(e),l("Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in %s.",1===t?"the componentWillUnmount method":"a useEffect cleanup function")}finally{i?Xe(e):Qe()}}}(e),null;Nr(i,t,n),i===Jp&&(lA=Or(lA,t),4===rA&&GA(i,tA));var r=Ec();1===t?0!=(8&Kp)&&0==(48&Kp)?(Nm(i,t),WA(i)):(jA(i,n),Nm(i,t),0===Kp&&(fA(),Pc())):(0==(4&Kp)||r!==Ac&&r!==pc||(null===SA?SA=new Set([i]):SA.add(i)),jA(i,n),Nm(i,t)),uA=i}function UA(e,t){e.lanes=Or(e.lanes,t);var n=e.alternate;null!==n&&(n.lanes=Or(n.lanes,t)),null===n&&0!=(1026&e.flags)&&Tm(e);for(var i=e,r=e.return;null!==r;)r.childLanes=Or(r.childLanes,t),null!==(n=r.alternate)?n.childLanes=Or(n.childLanes,t):0!=(1026&r.flags)&&Tm(e),i=r,r=r.return;return 3===i.tag?i.stateNode:null}function jA(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.pendingLanes,i=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,s=n;s>0;){var a=Rr(s),l=1<<a,c=o[a];c===wr?0!=(l&i)&&0==(l&r)||(o[a]=kr(l,t)):c<=t&&(e.expiredLanes|=l),s&=~l}}(e,t);var i=Tr(e,e===Jp?tA:0),r=Er;if(0!==i){if(null!==n){if(e.callbackPriority===r)return;Cc(n)}var o,s;if(r===dr)s=WA.bind(null,e),null===_c?(_c=[s],vc=nc(lc,Mc)):_c.push(s),o=fc;else if(14===r)o=kc(pc,WA.bind(null,e));else{o=kc(function(e){switch(e){case dr:case 14:return 99;case 13:case 12:case 11:case fr:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error("Invalid update priority: "+e+". This is a bug in React.")}}(r),VA.bind(null,e))}e.callbackPriority=r,e.callbackNode=o}else null!==n&&(Cc(n),e.callbackNode=null,e.callbackPriority=0)}function VA(e){if(MA=wr,IA=0,LA=0,0!=(48&Kp))throw Error("Should not already be working.");var t=e.callbackNode;if(pm()&&e.callbackNode!==t)return null;var n=Tr(e,e===Jp?tA:0);if(0===n)return null;var i=function(e,t){var n=Kp;Kp|=Xp;var i=KA();Jp===e&&tA===t||(fA(),XA(e,t),Um(e,t));var r=em(e);for(;;)try{om();break}catch(t){YA(e,t)}return Kc(),tm(r),JA(i),Kp=n,null!==eA?0:(Jp=null,tA=0,rA)}(e,n);if(zr(sA,lA))XA(e,0);else if(0!==i){if(2===i&&(Kp|=64,e.hydrate&&(e.hydrate=!1,el(e.containerInfo)),0!==(n=Cr(e))&&(i=im(e,n))),1===i){var r=oA;throw XA(e,0),GA(e,n),jA(e,wc()),r}var o=e.current.alternate;e.finishedWork=o,e.finishedLanes=n,function(e,t,n){switch(t){case 0:case 1:throw Error("Root did not complete. This is a bug in React.");case 2:case 5:cm(e);break;case 3:if(GA(e,n),Mr(n)&&!(Vm>0)){var i=hA+500-wc();if(i>10){if(0!==Tr(e,0))break;var r=e.suspendedLanes;if(!Dr(r,n)){OA(),Ur(e,r);break}e.timeoutHandle=Za(cm.bind(null,e),i);break}}cm(e);break;case 4:if(GA(e,n),function(e){return(e&Ar)===e}(n))break;var o=function(e,t){for(var n=e.eventTimes,i=wr;t>0;){var r=Rr(t),o=1<<r,s=n[r];s>i&&(i=s),t&=~o}return i}(e,n),s=o,a=wc()-s,l=((c=a)<120?120:c<480?480:c<1080?1080:c<1920?1920:c<3e3?3e3:c<4320?4320:1960*qp(c/1960))-a;if(l>10){e.timeoutHandle=Za(cm.bind(null,e),l);break}cm(e);break;default:throw Error("Unknown root exit status.")}var c}(e,i,n)}return jA(e,wc()),e.callbackNode===t?VA.bind(null,e):null}function GA(e,t){t=Br(t,cA),function(e,t){e.suspendedLanes|=t,e.pingedLanes&=~t;for(var n=e.expirationTimes,i=t;i>0;){var r=Rr(i),o=1<<r;n[r]=wr,i&=~o}}(e,t=Br(t,lA))}function WA(e){if(0!=(48&Kp))throw Error("Should not already be working.");var t,n;if(pm(),e===Jp&&zr(e.expiredLanes,tA)?(n=im(e,t=tA),zr(sA,lA)&&(n=im(e,t=Tr(e,t)))):n=im(e,t=Tr(e,0)),0!==e.tag&&2===n&&(Kp|=64,e.hydrate&&(e.hydrate=!1,el(e.containerInfo)),0!==(t=Cr(e))&&(n=im(e,t))),1===n){var i=oA;throw XA(e,0),GA(e,t),jA(e,wc()),i}var r=e.current.alternate;return e.finishedWork=r,e.finishedLanes=t,cm(e),jA(e,wc()),null}function $A(e,t){var n=Kp;Kp|=1;try{return e(t)}finally{0===(Kp=n)&&(fA(),Pc())}}function qA(e,t){var n=Kp;Kp&=-2,Kp|=8;try{return e(t)}finally{0===(Kp=n)&&(fA(),Pc())}}function ZA(e,t){var n=Kp;if(0!=(48&n))return l("flushSync was called from inside a lifecycle method. React cannot flush when React is already rendering. Consider moving this call to a scheduler task or micro task."),e(t);Kp|=1;try{return e?Tc(pc,e.bind(null,t)):void 0}finally{Kp=n,Pc()}}function HA(e,t){Rl(iA,nA,e),nA=Or(nA,t),sA=Or(sA,t)}function QA(e){nA=iA.current,Ll(iA,e)}function XA(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Ha(n)),null!==eA)for(var i=eA.return;null!==i;)fp(i),i=i.return;Jp=e,eA=hg(e.current,null),tA=nA=sA=t,rA=0,oA=null,aA=0,lA=0,cA=0,PA=null,Rc.discardPendingWarnings()}function YA(e,t){for(;;){var n=eA;try{if(Kc(),od(),Qe(),Hp.current=null,null===n||null===n.return)return rA=1,oA=t,void(eA=null);8&n.mode&&pf(n,!0),vp(e,n.return,n,t,tA),am(n)}catch(e){t=e,eA===n&&null!==n?(n=n.return,eA=n):n=eA;continue}return}}function KA(){var e=Zp.current;return Zp.current=Xd,null===e?Xd:e}function JA(e){Zp.current=e}function em(e){var t=r.__interactionsRef.current;return r.__interactionsRef.current=e.memoizedInteractions,t}function tm(e){r.__interactionsRef.current=e}function nm(e){aA=Or(e,aA)}function im(e,t){var n=Kp;Kp|=Xp;var i=KA();Jp===e&&tA===t||(XA(e,t),Um(e,t));for(var r=em(e);;)try{rm();break}catch(t){YA(e,t)}if(Kc(),tm(r),Kp=n,JA(i),null!==eA)throw Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return Jp=null,tA=0,rA}function rm(){for(;null!==eA;)sm(eA)}function om(){for(;null!==eA&&!gc();)sm(eA)}function sm(e){var t,n=e.alternate;Xe(e),0!=(8&e.mode)?(df(e),t=km(n,e,nA),pf(e,!0)):t=km(n,e,nA),Qe(),e.memoizedProps=e.pendingProps,null===t?am(e):eA=t,Hp.current=null}function am(e){var t=e;do{var n=t.alternate,i=t.return;if(0==(t.flags&yi)){Xe(t);var r=void 0;if(0==(8&t.mode)?r=hp(n,t,nA):(df(t),r=hp(n,t,nA),pf(t,!1)),Qe(),null!==r)return void(eA=r);if(lm(t),null!==i&&0==(i.flags&yi))null===i.firstEffect&&(i.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==i.lastEffect&&(i.lastEffect.nextEffect=t.firstEffect),i.lastEffect=t.lastEffect),t.flags>1&&(null!==i.lastEffect?i.lastEffect.nextEffect=t:i.firstEffect=t,i.lastEffect=t)}else{var o=dp(t);if(null!==o)return o.flags&=2047,void(eA=o);if(0!=(8&t.mode)){pf(t,!1);for(var s=t.actualDuration,a=t.child;null!==a;)s+=a.actualDuration,a=a.sibling;t.actualDuration=s}null!==i&&(i.firstEffect=i.lastEffect=null,i.flags|=yi)}var l=t.sibling;if(null!==l)return void(eA=l);eA=t=i}while(null!==t);0===rA&&(rA=5)}function lm(e){if(e.tag!==E&&e.tag!==w||null===e.memoizedState||zr(nA,xr)||0==(4&e.mode)){var t=0;if(0!=(8&e.mode)){for(var n=e.actualDuration,i=e.selfBaseDuration,r=null===e.alternate||e.child!==e.alternate.child,o=e.child;null!==o;)t=Or(t,Or(o.lanes,o.childLanes)),r&&(n+=o.actualDuration),i+=o.treeBaseDuration,o=o.sibling;if(e.tag===m&&null!==e.memoizedState){var s=e.child;null!==s&&(i-=s.treeBaseDuration)}e.actualDuration=n,e.treeBaseDuration=i}else for(var a=e.child;null!==a;)t=Or(t,Or(a.lanes,a.childLanes)),a=a.sibling;e.childLanes=t}}function cm(e){var t=Ec();return Tc(pc,um.bind(null,e,t)),null}function um(e,t){do{pm()}while(null!==vA);if(Rc.flushLegacyContextWarning(),Rc.flushPendingUnsafeLifecycleWarnings(),0!=(48&Kp))throw Error("Should not already be working.");var n=e.finishedWork,i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");e.callbackNode=null;var r,o=Or(n.lanes,n.childLanes);if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t;for(var i=e.entanglements,r=e.eventTimes,o=e.expirationTimes,s=n;s>0;){var a=Rr(s),l=1<<a;i[a]=0,r[a]=wr,o[a]=wr,s&=~l}}(e,o),null!==SA&&!function(e){return 0!=(24&e)}(o)&&SA.has(e)&&SA.delete(e),e===Jp&&(Jp=null,eA=null,tA=0),n.flags>1?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){var s=Kp;Kp|=Yp;var a=em(e);Hp.current=null,zA=Ga(e.containerInfo),DA=!1,AA=r;do{if(ri(null,hm,null),oi()){if(null===AA)throw Error("Should be working on an effect.");var l=si();xm(AA,l),AA=AA.nextEffect}}while(null!==AA);zA=null,hf(),AA=r;do{if(ri(null,dm,null,e,t),oi()){if(null===AA)throw Error("Should be working on an effect.");var c=si();xm(AA,c),AA=AA.nextEffect}}while(null!==AA);e.containerInfo,Ts(ja),Hr(Ua),Ua=null,ja=null,e.current=n,AA=r;do{if(ri(null,fm,null,e,i),oi()){if(null===AA)throw Error("Should be working on an effect.");var u=si();xm(AA,u),AA=AA.nextEffect}}while(null!==AA);AA=null,yc(),tm(a),Kp=s}else e.current=n,hf();var h=_A;if(_A)_A=!1,vA=e,xA=i,bA=t;else for(AA=r;null!==AA;){var d=AA.nextEffect;AA.nextEffect=null,8&AA.flags&&Gm(AA),AA=d}if(0!==(o=e.pendingLanes)){if(null!==PA){var f=PA;PA=null;for(var p=0;p<f.length;p++)Fm(e,f[p],e.memoizedInteractions)}Nm(e,o)}else yA=null;if(h||jm(e,i),1===o?e===kA?TA++:(TA=0,kA=e):TA=0,ec(n.stateNode,t),$p.forEach((function(e){return e()})),jA(e,wc()),mA){mA=!1;var A=gA;throw gA=null,A}return 0!=(8&Kp)||Pc(),null}function hm(){for(;null!==AA;){var e=AA.alternate;DA||null===zA||(0!=(8&AA.flags)?Ci(AA,zA)&&(DA=!0):AA.tag===m&&Vp(e,AA)&&Ci(AA,zA)&&(DA=!0));var t=AA.flags;0!=(t&pi)&&(Xe(AA),Tp(e,AA),Qe()),0!=(t&Ai)&&(_A||(_A=!0,kc(mc,(function(){return pm(),null})))),AA=AA.nextEffect}}function dm(e,t){for(;null!==AA;){Xe(AA);var n=AA.flags;if(16&n&&Gp(AA),n&fi){var i=AA.alternate;null!==i&&Mp(i)}switch(1038&n){case 2:Dp(AA),AA.flags&=-3;break;case 6:Dp(AA),AA.flags&=-3,Up(AA.alternate,AA);break;case gi:AA.flags&=-1025;break;case 1028:AA.flags&=-1025,Up(AA.alternate,AA);break;case 4:Up(AA.alternate,AA);break;case 8:Np(e,AA)}Qe(),AA=AA.nextEffect}}function fm(e,t){for(;null!==AA;){Xe(AA);var n=AA.flags;if(36&n)kp(e,AA.alternate,AA);n&fi&&Pp(AA),Qe(),AA=AA.nextEffect}}function pm(){if(90!==bA){var e=bA>mc?mc:bA;return bA=90,Tc(e,ym)}return!1}function Am(e,t){wA.push(t,e),_A||(_A=!0,kc(mc,(function(){return pm(),null})))}function mm(e,t){EA.push(t,e),e.flags|=mi;var n=e.alternate;null!==n&&(n.flags|=mi),_A||(_A=!0,kc(mc,(function(){return pm(),null})))}function gm(e){var t=e.create;e.destroy=t()}function ym(){if(null===vA)return!1;var e=vA,t=xA;if(vA=null,xA=0,0!=(48&Kp))throw Error("Cannot flush passive effects while already rendering.");RA=!0;var n=Kp;Kp|=Yp;var i=em(e),r=EA;EA=[];for(var o=0;o<r.length;o+=2){var s=r[o],a=r[o+1],l=s.destroy;s.destroy=void 0,a.flags&=-8193;var c=a.alternate;if(null!==c&&(c.flags&=-8193),"function"==typeof l){if(Xe(a),ri(null,l,null),oi()){if(null===a)throw Error("Should be working on an effect.");xm(a,si())}Qe()}}var u=wA;wA=[];for(var h=0;h<u.length;h+=2){var d=u[h],f=u[h+1];if(Xe(f),ri(null,gm,null,d),oi()){if(null===f)throw Error("Should be working on an effect.");xm(f,si())}Qe()}for(var p=e.current.firstEffect;null!==p;){var A=p.nextEffect;p.nextEffect=null,8&p.flags&&Gm(p),p=A}return tm(i),jm(e,t),RA=!1,Kp=n,Pc(),CA=null===vA?0:CA+1,!0}function _m(e){return null!==yA&&yA.has(e)}var vm=function(e){mA||(mA=!0,gA=e)};function bm(e,t,n){fu(e,gp(e,pp(n,t),1));var i=OA(),r=UA(e,1);null!==r&&(Nr(r,1,i),jA(r,i),Nm(r,1))}function xm(e,t){if(3!==e.tag)for(var n=e.return;null!==n;){if(3===n.tag)return void bm(n,e,t);if(1===n.tag){var i=n.type,r=n.stateNode;if("function"==typeof i.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&!_m(r)){var o=pp(t,e);fu(n,yp(n,o,1));var s=OA(),a=UA(n,1);if(null!==a)Nr(a,1,s),jA(a,s),Nm(a,1);else if("function"==typeof r.componentDidCatch&&!_m(r))try{r.componentDidCatch(t,o)}catch(e){}return}}n=n.return}else bm(e,e,t)}function wm(e,t,n){var i=e.pingCache;null!==i&&i.delete(t);var r=OA();Ur(e,n),Jp===e&&Dr(tA,n)&&(4===rA||3===rA&&Mr(tA)&&wc()-hA<500?XA(e,0):cA=Or(cA,n)),jA(e,r),Nm(e,n)}function Em(e,t){var n;null!==(n=e.stateNode)&&n.delete(t),function(e,t){0===t&&(t=FA(e));var n=OA(),i=UA(e,t);null!==i&&(Nr(i,t,n),jA(i,n),Nm(i,t))}(e,0)}var Sm=null;function Tm(e){if(0==(Kp&Xp)&&6&e.mode){var t=e.tag;if(2===t||3===t||1===t||0===t||t===p||t===g||t===y||t===x){var n=Ge(e.type)||"ReactComponent";if(null!==Sm){if(Sm.has(n))return;Sm.add(n)}else Sm=new Set([n]);var i=$e;try{Xe(e),l("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{i?Xe(e):Qe()}}}}var km,Cm=null;km=function(e,t,n){var i=_g(null,t);try{return ap(e,t,n)}catch(r){if(null!==r&&"object"==typeof r&&"function"==typeof r.then)throw r;if(Kc(),od(),fp(t),_g(t,i),8&t.mode&&df(t),ri(null,ap,null,e,t,n),oi())throw si();throw r}};var Pm,Mm=!1;Pm=new Set;var Im={current:!1};function Lm(e){if(!0===Qp.current&&!0!==Im.current){var t=$e;try{Xe(e),l("It looks like you're using the wrong act() around your test interactions.\nBe sure to use the matching version of act() corresponding to your renderer:\n\n// for react-dom:\nimport {act} from 'react-dom/test-utils';\n// ...\nact(() => ...);\n\n// for react-test-renderer:\nimport TestRenderer from react-test-renderer';\nconst {act} = TestRenderer;\n// ...\nact(() => ...);")}finally{t?Xe(e):Qe()}}}function Rm(e){0!=(1&e.mode)&&!1===Qp.current&&!1===Im.current&&l("An update to %s ran an effect, but was not wrapped in act(...).\n\nWhen testing, code that causes React state updates should be wrapped into act(...):\n\nact(() => {\n  /* fire events that update state */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act",Ge(e.type))}var zm=function(e){if(0===Kp&&!1===Qp.current&&!1===Im.current){var t=$e;try{Xe(e),l("An update to %s inside a test was not wrapped in act(...).\n\nWhen testing, code that causes React state updates should be wrapped into act(...):\n\nact(() => {\n  /* fire events that update state */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act",Ge(e.type))}finally{t?Xe(e):Qe()}}},Dm=!1;function Om(e,t){return 1e3*t+e.interactionThreadID}function Bm(e){null===PA?PA=[e]:PA.push(e)}function Fm(e,t,n){if(n.size>0){var i=e.pendingInteractionMap,o=i.get(t);null!=o?n.forEach((function(e){o.has(e)||e.__count++,o.add(e)})):(i.set(t,new Set(n)),n.forEach((function(e){e.__count++})));var s=r.__subscriberRef.current;if(null!==s){var a=Om(e,t);s.onWorkScheduled(n,a)}}}function Nm(e,t){Fm(e,t,r.__interactionsRef.current)}function Um(e,t){var n=new Set;if(e.pendingInteractionMap.forEach((function(e,i){zr(t,i)&&e.forEach((function(e){return n.add(e)}))})),e.memoizedInteractions=n,n.size>0){var i=r.__subscriberRef.current;if(null!==i){var o=Om(e,t);try{i.onWorkStarted(n,o)}catch(e){kc(pc,(function(){throw e}))}}}}function jm(e,t){var n,i=e.pendingLanes;try{if(null!==(n=r.__subscriberRef.current)&&e.memoizedInteractions.size>0){var o=Om(e,t);n.onWorkStopped(e.memoizedInteractions,o)}}catch(e){kc(pc,(function(){throw e}))}finally{var s=e.pendingInteractionMap;s.forEach((function(e,t){zr(i,t)||(s.delete(t),e.forEach((function(e){if(e.__count--,null!==n&&0===e.__count)try{n.onInteractionScheduledWorkCompleted(e)}catch(e){kc(pc,(function(){throw e}))}})))}))}}var Vm=0;function Gm(e){e.sibling=null,e.stateNode=null}var Wm=null,$m=null,qm=function(e){Wm=e};function Zm(e){if(null===Wm)return e;var t=Wm(e);return void 0===t?e:t.current}function Hm(e){return Zm(e)}function Qm(e){if(null===Wm)return e;var t=Wm(e);if(void 0===t){if(null!=e&&"function"==typeof e.render){var n=Zm(e.render);if(e.render!==n){var i={$$typeof:ae,render:n};return void 0!==e.displayName&&(i.displayName=e.displayName),i}}return e}return t.current}function Xm(e,t){if(null===Wm)return!1;var n=e.elementType,i=t.type,r=!1,o="object"==typeof i&&null!==i?i.$$typeof:null;switch(e.tag){case 1:"function"==typeof i&&(r=!0);break;case 0:("function"==typeof i||o===he)&&(r=!0);break;case p:(o===ae||o===he)&&(r=!0);break;case g:case y:(o===ue||o===he)&&(r=!0);break;default:return!1}if(r){var s=Wm(n);if(void 0!==s&&s===Wm(i))return!0}return!1}function Ym(e){null!==Wm&&"function"==typeof WeakSet&&(null===$m&&($m=new WeakSet),$m.add(e))}var Km=function(e,t){if(null!==Wm){var n=t.staleFamilies,i=t.updatedFamilies;pm(),ZA((function(){eg(e.current,i,n)}))}},Jm=function(e,t){e.context===zl&&(pm(),ZA((function(){Eg(t,e,null,null)})))};function eg(e,t,n){var i=e.alternate,r=e.child,o=e.sibling,s=e.tag,a=e.type,l=null;switch(s){case 0:case y:case 1:l=a;break;case p:l=a.render}if(null===Wm)throw new Error("Expected resolveFamily to be set during hot reload.");var c=!1,u=!1;if(null!==l){var h=Wm(l);void 0!==h&&(n.has(h)?u=!0:t.has(h)&&(1===s?u=!0:c=!0))}null!==$m&&($m.has(e)||null!==i&&$m.has(i))&&(u=!0),u&&(e._debugNeedsRemount=!0),(u||c)&&NA(e,1,wr),null===r||u||eg(r,t,n),null!==o&&eg(o,t,n)}var tg,ng=function(e,t){var n=new Set,i=new Set(t.map((function(e){return e.current})));return ig(e.current,i,n),n};function ig(e,t,n){var i=e.child,r=e.sibling,o=e.tag,s=e.type,a=null;switch(o){case 0:case y:case 1:a=s;break;case p:a=s.render}var l=!1;null!==a&&t.has(a)&&(l=!0),l?function(e,t){if(function(e,t){var n=e,i=!1;for(;;){if(5===n.tag)i=!0,t.add(n.stateNode);else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)return i;for(;null===n.sibling;){if(null===n.return||n.return===e)return i;n=n.return}n.sibling.return=n.return,n=n.sibling}return!1}(e,t))return;var n=e;for(;;){switch(n.tag){case 5:return void t.add(n.stateNode);case 4:case 3:return void t.add(n.stateNode.containerInfo)}if(null===n.return)throw new Error("Expected to reach root first.");n=n.return}}(e,n):null!==i&&ig(i,t,n),null!==r&&ig(r,t,n)}tg=!1;try{var rg=Object.preventExtensions({});new Map([[rg,null]]),new Set([rg])}catch(e){tg=!0}var og=1;function sg(e,t,n,i){this.tag=e,this.key=n,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=t,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=i,this.flags=0,this.nextEffect=null,this.firstEffect=null,this.lastEffect=null,this.lanes=0,this.childLanes=0,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugID=og++,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,tg||"function"!=typeof Object.preventExtensions||Object.preventExtensions(this)}var ag,lg,cg=function(e,t,n,i){return new sg(e,t,n,i)};function ug(e){var t=e.prototype;return!(!t||!t.isReactComponent)}function hg(e,t){var n=e.alternate;null===n?((n=cg(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n._debugID=e._debugID,n._debugSource=e._debugSource,n._debugOwner=e._debugOwner,n._debugHookTypes=e._debugHookTypes,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null,n.actualDuration=0,n.actualStartTime=-1),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue;var i=e.dependencies;switch(n.dependencies=null===i?null:{lanes:i.lanes,firstContext:i.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.selfBaseDuration=e.selfBaseDuration,n.treeBaseDuration=e.treeBaseDuration,n._debugNeedsRemount=e._debugNeedsRemount,n.tag){case 2:case 0:case y:n.type=Zm(e.type);break;case 1:n.type=Hm(e.type);break;case p:n.type=Qm(e.type)}return n}function dg(e,t){e.flags&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null;var n=e.alternate;if(null===n)e.childLanes=0,e.lanes=t,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null,e.selfBaseDuration=0,e.treeBaseDuration=0;else{e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type;var i=n.dependencies;e.dependencies=null===i?null:{lanes:i.lanes,firstContext:i.firstContext},e.selfBaseDuration=n.selfBaseDuration,e.treeBaseDuration=n.treeBaseDuration}return e}function fg(e,t,n,i,r,o){var s=2,a=e;if("function"==typeof e)ug(e)?(s=1,a=Hm(a)):a=Zm(a);else if("string"==typeof e)s=5;else e:switch(e){case ne:return Ag(n.children,r,o,t);case pe:s=8,r|=16;break;case ie:s=8,r|=1;break;case re:return function(e,t,n,i){"string"!=typeof e.id&&l('Profiler must specify an "id" as a prop');var r=cg(A,e,i,8|t);return r.elementType=re,r.type=re,r.lanes=n,r.stateNode={effectDuration:0,passiveEffectDuration:0},r}(n,r,o,t);case le:return function(e,t,n,i){var r=cg(m,e,i,t);return r.type=le,r.elementType=le,r.lanes=n,r}(n,r,o,t);case ce:return function(e,t,n,i){var r=cg(v,e,i,t);return r.type=ce,r.elementType=ce,r.lanes=n,r}(n,r,o,t);case Ae:return mg(n,r,o,t);case me:return function(e,t,n,i){var r=cg(E,e,i,t);return r.type=me,r.elementType=me,r.lanes=n,r}(n,r,o,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case oe:s=d;break e;case se:s=9;break e;case ae:s=p,a=Qm(a);break e;case ue:s=g;break e;case he:s=16,a=null;break e;case de:s=x;break e}var c="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(c+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var u=i?Ge(i.type):null;throw u&&(c+="\n\nCheck the render method of `"+u+"`."),Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(null==e?e:typeof e)+"."+c)}var h=cg(s,n,t,r);return h.elementType=e,h.type=a,h.lanes=o,h._debugOwner=i,h}function pg(e,t,n){var i;i=e._owner;var r=fg(e.type,e.key,e.props,i,t,n);return r._debugSource=e._source,r._debugOwner=e._owner,r}function Ag(e,t,n,i){var r=cg(7,e,i,t);return r.lanes=n,r}function mg(e,t,n,i){var r=cg(w,e,i,t);return r.type=Ae,r.elementType=Ae,r.lanes=n,r}function gg(e,t,n){var i=cg(6,e,null,t);return i.lanes=n,i}function yg(e,t,n){var i=null!==e.children?e.children:[],r=cg(4,i,e.key,t);return r.lanes=n,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}function _g(e,t){return null===e&&(e=cg(2,null,null,0)),e.tag=t.tag,e.key=t.key,e.elementType=t.elementType,e.type=t.type,e.stateNode=t.stateNode,e.return=t.return,e.child=t.child,e.sibling=t.sibling,e.index=t.index,e.ref=t.ref,e.pendingProps=t.pendingProps,e.memoizedProps=t.memoizedProps,e.updateQueue=t.updateQueue,e.memoizedState=t.memoizedState,e.dependencies=t.dependencies,e.mode=t.mode,e.flags=t.flags,e.nextEffect=t.nextEffect,e.firstEffect=t.firstEffect,e.lastEffect=t.lastEffect,e.lanes=t.lanes,e.childLanes=t.childLanes,e.alternate=t.alternate,e.actualDuration=t.actualDuration,e.actualStartTime=t.actualStartTime,e.selfBaseDuration=t.selfBaseDuration,e.treeBaseDuration=t.treeBaseDuration,e._debugID=t._debugID,e._debugSource=t._debugSource,e._debugOwner=t._debugOwner,e._debugNeedsRemount=t._debugNeedsRemount,e._debugHookTypes=t._debugHookTypes,e}function vg(e,t,n){switch(this.tag=t,this.containerInfo=e,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=-1,this.context=null,this.pendingContext=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Fr(0),this.expirationTimes=Fr(wr),this.pendingLanes=0,this.suspendedLanes=0,this.pingedLanes=0,this.expiredLanes=0,this.mutableReadLanes=0,this.finishedLanes=0,this.entangledLanes=0,this.entanglements=Fr(0),this.mutableSourceEagerHydrationData=null,this.interactionThreadID=r.unstable_getThreadID(),this.memoizedInteractions=new Set,this.pendingInteractionMap=new Map,t){case 1:this._debugRootType="createBlockingRoot()";break;case 2:this._debugRootType="createRoot()";break;case 0:this._debugRootType="createLegacyRoot()"}}function bg(e,t,n,i){var r=new vg(e,t,n),o=function(e){var t;return t=2===e?7:1===e?3:0,Jl&&(t|=8),cg(3,null,null,t)}(t);return r.current=o,o.stateNode=r,uu(o),r}function xg(e,t){var n=(0,t._getVersion)(t._source);null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)}function wg(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}function Eg(e,t,n,r){!function(e,t){if(Yl&&"function"==typeof Yl.onScheduleFiberRoot)try{Yl.onScheduleFiberRoot(Xl,e,t)}catch(e){Kl||(Kl=!0,l("React instrumentation encountered an error: %s",e))}}(t,e);var o,s=t.current,a=OA();"undefined"!=typeof jest&&(o=s,!1===Dm&&void 0===i.unstable_flushAllWithoutAsserting&&(2&o.mode||4&o.mode)&&(Dm=!0,l("In Concurrent or Sync modes, the \"scheduler\" module needs to be mocked to guarantee consistent behaviour across tests and browsers. For example, with jest: \njest.mock('scheduler', () => require('scheduler/unstable_mock'));\n\nFor more info, visit https://reactjs.org/link/mock-scheduler")),Lm(s));var c=BA(s),u=function(e){if(!e)return zl;var t=ai(e),n=Ql(t);if(1===t.tag){var i=t.type;if(Vl(i))return ql(t,i,n)}return n}(n);null===t.context?t.context=u:t.pendingContext=u,qe&&null!==$e&&!ag&&(ag=!0,l("Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.\n\nCheck the render method of %s.",Ge($e.type)||"Unknown"));var h=du(a,c);return h.payload={element:e},null!==(r=void 0===r?null:r)&&("function"!=typeof r&&l("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",r),h.callback=r),fu(s,h),NA(s,c,a),c}function Sg(e){var t=e.current;return t.child?(t.child.tag,t.child.stateNode):null}function Tg(e,t){var n,i,r=e.memoizedState;null!==r&&null!==r.dehydrated&&(r.retryLane=(n=r.retryLane,i=t,0!==n&&n<i?n:i))}function kg(e,t){Tg(e,t);var n=e.alternate;n&&Tg(n,t)}function Cg(e){var t=function(e){var t=Ti(e);if(!t)return null;for(var n=t;;){if(5===n.tag||6===n.tag)return n;if(n.child&&4!==n.tag)n.child.return=n,n=n.child;else{if(n===t)return null;for(;!n.sibling;){if(!n.return||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}}return null}(e);return null===t?null:t.tag===b?t.stateNode.instance:t.stateNode}ag=!1,lg={};var Pg=function(e){return!1};var Mg,Ig,Lg,Rg,zg,Dg,Og,Bg,Fg=function(e,t,i){var r=t[i],o=Array.isArray(e)?e.slice():n({},e);return i+1===t.length?(Array.isArray(o)?o.splice(r,1):delete o[r],o):(o[r]=Fg(e[r],t,i+1),o)},Ng=function(e,t){return Fg(e,t,0)},Ug=function(e,t,i,r){var o=t[r],s=Array.isArray(e)?e.slice():n({},e);r+1===t.length?(s[i[r]]=s[o],Array.isArray(s)?s.splice(o,1):delete s[o]):s[o]=Ug(e[o],t,i,r+1);return s},jg=function(e,t,n){if(t.length===n.length){for(var i=0;i<n.length-1;i++)if(t[i]!==n[i])return void s("copyWithRename() expects paths to be the same except for the deepest key");return Ug(e,t,n,0)}s("copyWithRename() expects paths of the same length")},Vg=function(e,t,i,r){if(i>=t.length)return r;var o=t[i],s=Array.isArray(e)?e.slice():n({},e);return s[o]=Vg(e[o],t,i+1,r),s},Gg=function(e,t,n){return Vg(e,t,0,n)},Wg=function(e,t){for(var n=e.memoizedState;null!==n&&t>0;)n=n.next,t--;return n};function $g(e){var t=ki(e);return null===t?null:t.stateNode}function qg(e){return null}function Zg(){return $e}function Hg(e,t,n){this._internalRoot=function(e,t,n){var i=null!=n&&!0===n.hydrate;null!=n&&n.hydrationOptions;var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null,o=function(e,t,n,i){return bg(e,t,n)}(e,t,i);if(function(e,t){t[dl]=e}(o.current,e),e.nodeType,Gs(e.nodeType===Wt?e.parentNode:e),r)for(var s=0;s<r.length;s++){xg(o,r[s])}return o}(e,t,n)}function Qg(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}Mg=function(e,t,i,r){var o=Wg(e,t);if(null!==o){var s=Gg(o.memoizedState,i,r);o.memoizedState=s,o.baseState=s,e.memoizedProps=n({},e.memoizedProps),NA(e,1,wr)}},Ig=function(e,t,i){var r=Wg(e,t);if(null!==r){var o=Ng(r.memoizedState,i);r.memoizedState=o,r.baseState=o,e.memoizedProps=n({},e.memoizedProps),NA(e,1,wr)}},Lg=function(e,t,i,r){var o=Wg(e,t);if(null!==o){var s=jg(o.memoizedState,i,r);o.memoizedState=s,o.baseState=s,e.memoizedProps=n({},e.memoizedProps),NA(e,1,wr)}},Rg=function(e,t,n){e.pendingProps=Gg(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),NA(e,1,wr)},zg=function(e,t){e.pendingProps=Ng(e.memoizedProps,t),e.alternate&&(e.alternate.pendingProps=e.pendingProps),NA(e,1,wr)},Dg=function(e,t,n){e.pendingProps=jg(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),NA(e,1,wr)},Og=function(e){NA(e,1,wr)},Bg=function(e){Pg=e},Hg.prototype.render=function(e){var t=this._internalRoot;"function"==typeof arguments[1]&&l("render(...): does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var n=t.containerInfo;if(8!==n.nodeType){var i=Cg(t.current);i&&i.parentNode!==n&&l("render(...): It looks like the React-rendered content of the root container was removed without using React. This is not supported and will cause errors. Instead, call root.unmount() to empty a root's container.")}Eg(e,t,null,null)},Hg.prototype.unmount=function(){"function"==typeof arguments[0]&&l("unmount(...): does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var e=this._internalRoot,t=e.containerInfo;Eg(null,e,null,(function(){Al(t)}))};var Xg,Yg=o.ReactCurrentOwner,Kg=!1;function Jg(e){return e?9===e.nodeType?e.documentElement:e.firstChild:null}function ey(e,t){var n=t||function(e){var t=Jg(e);return!(!t||1!==t.nodeType||!t.hasAttribute(z))}(e);if(!n)for(var i,r=!1;i=e.lastChild;)!r&&1===i.nodeType&&i.hasAttribute(z)&&(r=!0,l("render(): Target node has markup rendered by React, but there are unrelated nodes as well. This is most commonly caused by white-space inserted around server-rendered markup.")),e.removeChild(i);return!n||t||Kg||(Kg=!0,s("render(): Calling ReactDOM.render() to hydrate server-rendered markup will stop working in React v18. Replace the ReactDOM.render() call with ReactDOM.hydrate() if you want React to attach to the server HTML.")),function(e,t){return new Hg(e,0,t)}(e,n?{hydrate:!0}:void 0)}function ty(e,t,n,i,r){Xg(n),function(e,t){null!==e&&"function"!=typeof e&&l("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",t,e)}(void 0===r?null:r,"render");var o,s=n._reactRootContainer;if(s){if(o=s._internalRoot,"function"==typeof r){var a=r;r=function(){var e=Sg(o);a.call(e)}}Eg(t,o,e,r)}else{if(s=n._reactRootContainer=ey(n,i),o=s._internalRoot,"function"==typeof r){var c=r;r=function(){var e=Sg(o);c.call(e)}}qA((function(){Eg(t,o,e,r)}))}return Sg(o)}Xg=function(e){if(e._reactRootContainer&&8!==e.nodeType){var t=Cg(e._reactRootContainer._internalRoot.current);t&&t.parentNode!==e&&l("render(...): It looks like the React-rendered content of this container was removed without using React. This is not supported and will cause errors. Instead, call ReactDOM.unmountComponentAtNode to empty a container.")}var n=!!e._reactRootContainer,i=Jg(e);!(!i||!yl(i))&&!n&&l("render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."),1===e.nodeType&&e.tagName&&"BODY"===e.tagName.toUpperCase()&&l("render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app.")},li=function(e){e.tag===m&&(NA(e,4,OA()),kg(e,4))},function(e){ci=e}((function(e){if(e.tag===m){var t=OA(),n=yr;NA(e,n,t),kg(e,n)}})),function(e){ui=e}((function(e){if(e.tag===m){var t=OA(),n=BA(e);NA(e,n,t),kg(e,n)}})),function(e){hi=e}((function(e,t){try{return t()}finally{}}));var ny,iy,ry,oy=!1;function sy(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Qg(t))throw Error("Target container is not a DOM element.");return wg(e,t,null,n)}"function"==typeof Map&&null!=Map.prototype&&"function"==typeof Map.prototype.forEach&&"function"==typeof Set&&null!=Set.prototype&&"function"==typeof Set.prototype.clear&&"function"==typeof Set.prototype.forEach||l("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),Rn=function(e,t,n){switch(t){case"input":return void gt(e,n);case"textarea":return void function(e,t){Lt(e,t)}(e,n);case"select":return void function(e,t){var n=e,i=t.value;null!=i&&Tt(n,!!t.multiple,i,!1)}(e,n)}},ny=function(e,t,n,i,r){var o=Kp;Kp|=4;try{return Tc(Ac,e.bind(null,t,n,i,r))}finally{0===(Kp=o)&&(fA(),Pc())}},iy=function(){0==(49&Kp)?(function(){if(null!==SA){var e=SA;SA=null,e.forEach((function(e){!function(e){e.expiredLanes|=24&e.pendingLanes}(e),jA(e,wc())}))}Pc()}(),pm()):0!=(Kp&Xp)&&l("unstable_flushDiscreteUpdates: Cannot flush updates when React is already rendering.")},ry=function(e,t){var n=Kp;Kp|=2;try{return e(t)}finally{0===(Kp=n)&&(fA(),Pc())}},Nn=$A,Un=ny,jn=iy,Vn=ry;var ay={Events:[yl,_l,vl,Bn,Fn,pm,Im]},ly=function(e){var t=e.findFiberByHostInstance,n=o.ReactCurrentDispatcher;return function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled)return!0;if(!t.supportsFiber)return l("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{Xl=t.inject(e),Yl=t}catch(e){l("React instrumentation encountered an error: %s.",e)}return!0}({bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:Mg,overrideHookStateDeletePath:Ig,overrideHookStateRenamePath:Lg,overrideProps:Rg,overridePropsDeletePath:zg,overridePropsRenamePath:Dg,setSuspenseHandler:Bg,scheduleUpdate:Og,currentDispatcherRef:n,findHostInstanceByFiber:$g,findFiberByHostInstance:t||qg,findHostInstancesForRefresh:ng,scheduleRefresh:Km,scheduleRoot:Jm,setRefreshHandler:qm,getCurrentFiber:Zg})}({findFiberByHostInstance:gl,bundleType:1,version:Ic,rendererPackageName:"react-dom"});if(!ly&&I&&window.top===window.self&&(navigator.userAgent.indexOf("Chrome")>-1&&-1===navigator.userAgent.indexOf("Edge")||navigator.userAgent.indexOf("Firefox")>-1)){var cy=window.location.protocol;/^(https?|file):$/.test(cy)&&console.info("%cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools"+("file:"===cy?"\nYou might need to use a local HTTP server (instead of file://): https://reactjs.org/link/react-devtools-faq":""),"font-weight:bold")}u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ay,u.createPortal=sy,u.findDOMNode=function(e){var t=Yg.current;return null!==t&&null!==t.stateNode&&(t.stateNode._warnedAboutRefsInRender||l("%s is accessing findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Ge(t.type)||"A component"),t.stateNode._warnedAboutRefsInRender=!0),null==e?null:1===e.nodeType?e:function(e,t){var n=ai(e);if(void 0===n)throw"function"==typeof e.render?Error("Unable to find node on an unmounted component."):Error("Argument appears to not be a ReactComponent. Keys: "+Object.keys(e));var i=ki(n);if(null===i)return null;if(1&i.mode){var r=Ge(n.type)||"Component";if(!lg[r]){lg[r]=!0;var o=$e;try{Xe(i),1&n.mode?l("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",t,t,r):l("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",t,t,r)}finally{o?Xe(o):Qe()}}}return i.stateNode}(e,"findDOMNode")},u.flushSync=ZA,u.hydrate=function(e,t,n){if(!Qg(t))throw Error("Target container is not a DOM element.");return ml(t)&&void 0===t._reactRootContainer&&l("You are calling ReactDOM.hydrate() on a container that was previously passed to ReactDOM.createRoot(). This is not supported. Did you mean to call createRoot(container, {hydrate: true}).render(element)?"),ty(null,e,t,!0,n)},u.render=function(e,t,n){if(!Qg(t))throw Error("Target container is not a DOM element.");return ml(t)&&void 0===t._reactRootContainer&&l("You are calling ReactDOM.render() on a container that was previously passed to ReactDOM.createRoot(). This is not supported. Did you mean to call root.render(element)?"),ty(null,e,t,!1,n)},u.unmountComponentAtNode=function(e){if(!Qg(e))throw Error("unmountComponentAtNode(...): Target container is not a DOM element.");if(ml(e)&&void 0===e._reactRootContainer&&l("You are calling ReactDOM.unmountComponentAtNode() on a container that was previously passed to ReactDOM.createRoot(). This is not supported. Did you mean to call root.unmount()?"),e._reactRootContainer){var t=Jg(e);return t&&!yl(t)&&l("unmountComponentAtNode(): The node you're attempting to unmount was rendered by another copy of React."),qA((function(){ty(null,null,e,!1,(function(){e._reactRootContainer=null,Al(e)}))})),!0}var n=Jg(e),i=!(!n||!yl(n)),r=1===e.nodeType&&Qg(e.parentNode)&&!!e.parentNode._reactRootContainer;return i&&l("unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",r?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component."),!1},u.unstable_batchedUpdates=$A,u.unstable_createPortal=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return oy||(oy=!0,s('The ReactDOM.unstable_createPortal() alias has been deprecated, and will be removed in React 18+. Update your code to use ReactDOM.createPortal() instead. It has the exact same API, but without the "unstable_" prefix.')),sy(e,t,n)},u.unstable_renderSubtreeIntoContainer=function(e,t,n,i){return function(e,t,n,i){if(!Qg(n))throw Error("Target container is not a DOM element.");if(null==e||void 0===e._reactInternals)throw Error("parentComponent must be a valid React Component");return ty(e,t,n,!1,i)}(e,t,n,i)},u.version=Ic}(),c.exports=u;var A=c.exports;function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},m.apply(this,arguments)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function y(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function _(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b={exports:{}},x={exports:{}},w={};!function(){var e="function"==typeof Symbol&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,i=e?Symbol.for("react.fragment"):60107,r=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,s=e?Symbol.for("react.provider"):60109,a=e?Symbol.for("react.context"):60110,l=e?Symbol.for("react.async_mode"):60111,c=e?Symbol.for("react.concurrent_mode"):60111,u=e?Symbol.for("react.forward_ref"):60112,h=e?Symbol.for("react.suspense"):60113,d=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,p=e?Symbol.for("react.lazy"):60116,A=e?Symbol.for("react.block"):60121,m=e?Symbol.for("react.fundamental"):60117,g=e?Symbol.for("react.responder"):60118,y=e?Symbol.for("react.scope"):60119;function _(e){if("object"==typeof e&&null!==e){var d=e.$$typeof;switch(d){case t:var A=e.type;switch(A){case l:case c:case i:case o:case r:case h:return A;default:var m=A&&A.$$typeof;switch(m){case a:case u:case p:case f:case s:return m;default:return d}}case n:return d}}}var v=l,b=c,x=a,E=s,S=t,T=u,k=i,C=p,P=f,M=n,I=o,L=r,R=h,z=!1;function D(e){return _(e)===c}w.AsyncMode=v,w.ConcurrentMode=b,w.ContextConsumer=x,w.ContextProvider=E,w.Element=S,w.ForwardRef=T,w.Fragment=k,w.Lazy=C,w.Memo=P,w.Portal=M,w.Profiler=I,w.StrictMode=L,w.Suspense=R,w.isAsyncMode=function(e){return z||(z=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),D(e)||_(e)===l},w.isConcurrentMode=D,w.isContextConsumer=function(e){return _(e)===a},w.isContextProvider=function(e){return _(e)===s},w.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===t},w.isForwardRef=function(e){return _(e)===u},w.isFragment=function(e){return _(e)===i},w.isLazy=function(e){return _(e)===p},w.isMemo=function(e){return _(e)===f},w.isPortal=function(e){return _(e)===n},w.isProfiler=function(e){return _(e)===o},w.isStrictMode=function(e){return _(e)===r},w.isSuspense=function(e){return _(e)===h},w.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===c||e===o||e===r||e===h||e===d||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===f||e.$$typeof===s||e.$$typeof===a||e.$$typeof===u||e.$$typeof===m||e.$$typeof===g||e.$$typeof===y||e.$$typeof===A)},w.typeOf=_}(),x.exports=w;var E,S="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",T={},k=Function.call.bind(Object.prototype.hasOwnProperty);function C(e,t,n,i,r){for(var o in e)if(k(e,o)){var s;try{if("function"!=typeof e[o]){var a=Error((i||"React class")+": "+n+" type `"+o+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[o]+"`.");throw a.name="Invariant Violation",a}s=e[o](t,o,i,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){s=e}if(!s||s instanceof Error||E((i||"React class")+": type specification of "+n+" `"+o+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof s+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),s instanceof Error&&!(s.message in T)){T[s.message]=!0;var l=r?r():"";E("Failed "+n+" type: "+s.message+(null!=l?l:""))}}}E=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}},C.resetWarningCache=function(){T={}};var P,M=C,I=x.exports,L=a,R=S,z=M,D=Function.call.bind(Object.prototype.hasOwnProperty);function O(){return null}P=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}};var B=x.exports;b.exports=function(e,t){var n="function"==typeof Symbol&&Symbol.iterator,i="<<anonymous>>",r={array:l("array"),bool:l("boolean"),func:l("function"),number:l("number"),object:l("object"),string:l("string"),symbol:l("symbol"),any:a(O),arrayOf:function(e){return a((function(t,n,i,r,o){if("function"!=typeof e)return new s("Property `"+o+"` of component `"+i+"` has invalid PropType notation inside arrayOf.");var a=t[n];if(!Array.isArray(a))return new s("Invalid "+r+" `"+o+"` of type `"+u(a)+"` supplied to `"+i+"`, expected an array.");for(var l=0;l<a.length;l++){var c=e(a,l,i,r,o+"["+l+"]",R);if(c instanceof Error)return c}return null}))},element:a((function(t,n,i,r,o){var a=t[n];return e(a)?null:new s("Invalid "+r+" `"+o+"` of type `"+u(a)+"` supplied to `"+i+"`, expected a single ReactElement.")})),elementType:a((function(e,t,n,i,r){var o=e[t];return I.isValidElementType(o)?null:new s("Invalid "+i+" `"+r+"` of type `"+u(o)+"` supplied to `"+n+"`, expected a single ReactElement type.")})),instanceOf:function(e){return a((function(t,n,r,o,a){if(!(t[n]instanceof e)){var l=e.name||i;return new s("Invalid "+o+" `"+a+"` of type `"+((c=t[n]).constructor&&c.constructor.name?c.constructor.name:i)+"` supplied to `"+r+"`, expected instance of `"+l+"`.")}var c;return null}))},node:a((function(e,t,n,i,r){return c(e[t])?null:new s("Invalid "+i+" `"+r+"` supplied to `"+n+"`, expected a ReactNode.")})),objectOf:function(e){return a((function(t,n,i,r,o){if("function"!=typeof e)return new s("Property `"+o+"` of component `"+i+"` has invalid PropType notation inside objectOf.");var a=t[n],l=u(a);if("object"!==l)return new s("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected an object.");for(var c in a)if(D(a,c)){var h=e(a,c,i,r,o+"."+c,R);if(h instanceof Error)return h}return null}))},oneOf:function(e){if(!Array.isArray(e))return P(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),O;function t(t,n,i,r,a){for(var l=t[n],c=0;c<e.length;c++)if(o(l,e[c]))return null;var u=JSON.stringify(e,(function(e,t){return"symbol"===h(t)?String(t):t}));return new s("Invalid "+r+" `"+a+"` of value `"+String(l)+"` supplied to `"+i+"`, expected one of "+u+".")}return a(t)},oneOfType:function(e){if(!Array.isArray(e))return P("Invalid argument supplied to oneOfType, expected an instance of array."),O;for(var t=0;t<e.length;t++){var n=e[t];if("function"!=typeof n)return P("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+d(n)+" at index "+t+"."),O}return a((function(t,n,i,r,o){for(var a=0;a<e.length;a++)if(null==(0,e[a])(t,n,i,r,o,R))return null;return new s("Invalid "+r+" `"+o+"` supplied to `"+i+"`.")}))},shape:function(e){return a((function(t,n,i,r,o){var a=t[n],l=u(a);if("object"!==l)return new s("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");for(var c in e){var h=e[c];if(h){var d=h(a,c,i,r,o+"."+c,R);if(d)return d}}return null}))},exact:function(e){return a((function(t,n,i,r,o){var a=t[n],l=u(a);if("object"!==l)return new s("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");var c=L({},t[n],e);for(var h in c){var d=e[h];if(!d)return new s("Invalid "+r+" `"+o+"` key `"+h+"` supplied to `"+i+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var f=d(a,h,i,r,o+"."+h,R);if(f)return f}return null}))}};function o(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function s(e){this.message=e,this.stack=""}function a(e){var n={},r=0;function o(o,a,l,c,u,h,d){if(c=c||i,h=h||l,d!==R){if(t){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}if("undefined"!=typeof console){var p=c+":"+l;!n[p]&&r<3&&(P("You are manually calling a React.PropTypes validation function for the `"+h+"` prop on `"+c+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),n[p]=!0,r++)}}return null==a[l]?o?null===a[l]?new s("The "+u+" `"+h+"` is marked as required in `"+c+"`, but its value is `null`."):new s("The "+u+" `"+h+"` is marked as required in `"+c+"`, but its value is `undefined`."):null:e(a,l,c,u,h)}var a=o.bind(null,!1);return a.isRequired=o.bind(null,!0),a}function l(e){return a((function(t,n,i,r,o,a){var l=t[n];return u(l)!==e?new s("Invalid "+r+" `"+o+"` of type `"+h(l)+"` supplied to `"+i+"`, expected `"+e+"`."):null}))}function c(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(c);if(null===t||e(t))return!0;var i=function(e){var t=e&&(n&&e[n]||e["@@iterator"]);if("function"==typeof t)return t}(t);if(!i)return!1;var r,o=i.call(t);if(i!==t.entries){for(;!(r=o.next()).done;)if(!c(r.value))return!1}else for(;!(r=o.next()).done;){var s=r.value;if(s&&!c(s[1]))return!1}return!0;default:return!1}}function u(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||!!t&&("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}(t,e)?"symbol":t}function h(e){if(null==e)return""+e;var t=u(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function d(e){var t=h(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return s.prototype=Error.prototype,r.checkPropTypes=z,r.resetWarningCache=z.resetWarningCache,r.PropTypes=r,r}(B.isElement,!0);var F=b.exports;function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);s=!0);}catch(e){a=!0,r=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw r}}return o}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var U,j=1e-6,V="undefined"!=typeof Float32Array?Float32Array:Array;function G(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function W(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}function $(e,t){const n=W([],t,e);return G(n,n,1/n[3]),n}function q(e,t){const n=e%t;return n<0?t+n:n}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),U=new V(4),V!=Float32Array&&(U[0]=0,U[1]=0,U[2]=0,U[3]=0);const Z=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function H(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],A=t[13],m=t[14],g=t[15],y=n*a-i*s,_=n*l-r*s,v=n*c-o*s,b=i*l-r*a,x=i*c-o*a,w=r*c-o*l,E=u*A-h*p,S=u*m-d*p,T=u*g-f*p,k=h*m-d*A,C=h*g-f*A,P=d*g-f*m,M=y*P-_*C+v*k+b*T-x*S+w*E;return M?(M=1/M,e[0]=(a*P-l*C+c*k)*M,e[1]=(r*C-i*P-o*k)*M,e[2]=(A*w-m*x+g*b)*M,e[3]=(d*x-h*w-f*b)*M,e[4]=(l*T-s*P-c*S)*M,e[5]=(n*P-r*T+o*S)*M,e[6]=(m*v-p*w-g*_)*M,e[7]=(u*w-d*v+f*_)*M,e[8]=(s*C-a*T+c*E)*M,e[9]=(i*T-n*C-o*E)*M,e[10]=(p*x-A*v+g*y)*M,e[11]=(h*v-u*x-f*y)*M,e[12]=(a*S-s*k-l*E)*M,e[13]=(n*k-i*S+r*E)*M,e[14]=(A*_-p*b-m*y)*M,e[15]=(u*b-h*_+d*y)*M,e):null}function Q(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],A=t[12],m=t[13],g=t[14],y=t[15],_=n[0],v=n[1],b=n[2],x=n[3];return e[0]=_*i+v*a+b*h+x*A,e[1]=_*r+v*l+b*d+x*m,e[2]=_*o+v*c+b*f+x*g,e[3]=_*s+v*u+b*p+x*y,_=n[4],v=n[5],b=n[6],x=n[7],e[4]=_*i+v*a+b*h+x*A,e[5]=_*r+v*l+b*d+x*m,e[6]=_*o+v*c+b*f+x*g,e[7]=_*s+v*u+b*p+x*y,_=n[8],v=n[9],b=n[10],x=n[11],e[8]=_*i+v*a+b*h+x*A,e[9]=_*r+v*l+b*d+x*m,e[10]=_*o+v*c+b*f+x*g,e[11]=_*s+v*u+b*p+x*y,_=n[12],v=n[13],b=n[14],x=n[15],e[12]=_*i+v*a+b*h+x*A,e[13]=_*r+v*l+b*d+x*m,e[14]=_*o+v*c+b*f+x*g,e[15]=_*s+v*u+b*p+x*y,e}function X(e,t,n){var i,r,o,s,a,l,c,u,h,d,f,p,A=n[0],m=n[1],g=n[2];return t===e?(e[12]=t[0]*A+t[4]*m+t[8]*g+t[12],e[13]=t[1]*A+t[5]*m+t[9]*g+t[13],e[14]=t[2]*A+t[6]*m+t[10]*g+t[14],e[15]=t[3]*A+t[7]*m+t[11]*g+t[15]):(i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=i*A+a*m+h*g+t[12],e[13]=r*A+l*m+d*g+t[13],e[14]=o*A+c*m+f*g+t[14],e[15]=s*A+u*m+p*g+t[15]),e}function Y(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function K(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e}function J(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e}function ee(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(o=1/(i-r),e[10]=(r+i)*o,e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e}function te(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],A=e[13],m=e[14],g=e[15],y=t[0],_=t[1],v=t[2],b=t[3],x=t[4],w=t[5],E=t[6],S=t[7],T=t[8],k=t[9],C=t[10],P=t[11],M=t[12],I=t[13],L=t[14],R=t[15];return Math.abs(n-y)<=j*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-_)<=j*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(r-v)<=j*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(o-b)<=j*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-x)<=j*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-w)<=j*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-E)<=j*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-S)<=j*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-T)<=j*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-k)<=j*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-C)<=j*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(f-P)<=j*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(p-M)<=j*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(A-I)<=j*Math.max(1,Math.abs(A),Math.abs(I))&&Math.abs(m-L)<=j*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(g-R)<=j*Math.max(1,Math.abs(g),Math.abs(R))}function ne(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ie(e,t){return e[0]=-t[0],e[1]=-t[1],e}function re(e,t,n,i){var r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e}var oe=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e};function se(){var e=new V(3);return V!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ae(e,t,n){var i=new V(3);return i[0]=e,i[1]=t,i[2]=n,i}function le(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ce(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e}function ue(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e}function he(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e}!function(){var e=function(){var e=new V(2);return V!=Float32Array&&(e[0]=0,e[1]=0),e}()}();var de=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},fe=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},pe=function(e){var t=e[0],n=e[1],i=e[2];return Math.hypot(t,n,i)};function Ae(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}!function(){var e=se()}();const me=Math.PI,ge=me/4,ye=me/180,_e=180/me,ve=512,be=4003e4;function xe(e){return Math.pow(2,e)}function we(e){return Z(e)}function Ee([e,t]){Ae(Number.isFinite(e)),Ae(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=t*ye;return[ve*(e*ye+me)/(2*me),ve*(me+Math.log(Math.tan(ge+.5*n)))/(2*me)]}function Se([e,t]){const n=e/ve*(2*me)-me,i=2*(Math.atan(Math.exp(t/ve*(2*me)-me))-ge);return[n*_e,i*_e]}function Te({latitude:e,longitude:t,highPrecision:n=!1}){Ae(Number.isFinite(e)&&Number.isFinite(t));const i={},r=Math.cos(e*ye),o=512/360,s=o/r,a=12790407194604047e-21/r;if(i.unitsPerMeter=[a,a,a],i.metersPerUnit=[1/a,1/a,1/a],i.unitsPerDegree=[o,s,a],i.degreesPerUnit=[.703125,1/s,1/a],n){const t=ye*Math.tan(e*ye)/r,n=o*t/2,l=12790407194604047e-21*t,c=l/s*a;i.unitsPerDegree2=[0,n,l],i.unitsPerMeter2=[c,0,c]}return i}function ke(e,t){const[n,i,r]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=Te({longitude:n,latitude:i,highPrecision:!0}),u=Ee(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);const h=Se(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function Ce({height:e,pitch:t,bearing:n,altitude:i,scale:r,center:o=null}){const s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return X(s,s,[0,0,-i]),K(s,s,-t*ye),J(s,s,n*ye),Y(s,s,[r/=e,r,r]),o&&X(s,s,function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}([],o)),s}function Pe({width:e,height:t,fovy:n=Me(1.5),altitude:i,pitch:r=0,nearZMultiplier:o=1,farZMultiplier:s=1}){void 0!==i&&(n=Me(i));const a=.5*n*ye,l=Ie(n),c=r*ye,u=Math.sin(a)*l/Math.sin(Math.min(Math.max(Math.PI/2-c-a,.01),Math.PI-.01));return{fov:2*a,aspect:e/t,focalDistance:l,near:o,far:(Math.sin(c)*u+l)*s}}function Me(e){return 2*Math.atan(.5/e)*_e}function Ie(e){return.5/Math.tan(.5*e*ye)}function Le(e,t){const[n,i,r=0]=e;return Ae(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),$(t,[n,i,r,1])}function Re(e,t,n=0){const[i,r,o]=e;if(Ae(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o)){return $(t,[i,r,o,1])}const s=$(t,[i,r,0,1]),a=$(t,[i,r,1,1]),l=s[2],c=a[2];return re([],s,a,l===c?0:((n||0)-l)/(c-l))}function ze({width:e,height:t,bounds:n,minExtent:i=0,maxZoom:r=24,padding:o=0,offset:s=[0,0]}){const[[a,l],[c,u]]=n;if(Number.isFinite(o)){o={top:o,bottom:o,left:o,right:o}}else Ae(Number.isFinite(o.top)&&Number.isFinite(o.bottom)&&Number.isFinite(o.left)&&Number.isFinite(o.right));const h=new Fe({width:e,height:t,longitude:0,latitude:0,zoom:0}),d=h.project([a,u]),f=h.project([c,l]),p=[Math.max(Math.abs(f[0]-d[0]),i),Math.max(Math.abs(f[1]-d[1]),i)],A=[e-o.left-o.right-2*Math.abs(s[0]),t-o.top-o.bottom-2*Math.abs(s[1])];Ae(A[0]>0&&A[1]>0);const m=A[0]/p[0],g=A[1]/p[1],y=(o.right-o.left)/2/m,_=(o.bottom-o.top)/2/g,v=[(f[0]+d[0])/2+y,(f[1]+d[1])/2+_],b=h.unproject(v),x=Math.min(r,h.zoom+Z(Math.abs(Math.min(m,g))));return Ae(Number.isFinite(x)),{longitude:b[0],latitude:b[1],zoom:x}}const De=Math.PI/180;function Oe(e,t=0){const{width:n,height:i,unproject:r}=e,o={targetZ:t},s=r([0,i],o),a=r([n,i],o);let l,c;return(e.fovy?.5*e.fovy*De:Math.atan(.5/e.altitude))>(90-e.pitch)*De-.01?(l=Be(e,0,t),c=Be(e,n,t)):(l=r([0,0],o),c=r([n,0],o)),[s,a,c,l]}function Be(e,t,n){const{pixelUnprojectionMatrix:i}=e,r=$(i,[t,0,1,1]),o=$(i,[t,e.height,1,1]),s=Se(re([],r,o,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2])));return s[2]=n,s}class Fe{constructor({width:e,height:t,latitude:n=0,longitude:i=0,zoom:r=0,pitch:o=0,bearing:s=0,altitude:a=null,fovy:l=null,position:c=null,nearZMultiplier:u=.02,farZMultiplier:h=1.01}={width:1,height:1}){e=e||1,t=t||1,null===l&&null===a?l=Me(a=1.5):null===l?l=Me(a):null===a&&(a=Ie(l));const d=xe(r);a=Math.max(.75,a);const f=Te({longitude:i,latitude:n}),p=Ee([i,n]);p[2]=0,c&&function(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}(p,p,fe([],c,f.unitsPerMeter)),this.projectionMatrix=function({width:e,height:t,pitch:n,altitude:i,fovy:r,nearZMultiplier:o,farZMultiplier:s}){const{fov:a,aspect:l,near:c,far:u}=Pe({width:e,height:t,altitude:i,fovy:r,pitch:n,nearZMultiplier:o,farZMultiplier:s});return ee([],a,l,c,u)}({width:e,height:t,pitch:o,fovy:l,nearZMultiplier:u,farZMultiplier:h}),this.viewMatrix=Ce({height:t,scale:d,center:p,pitch:o,bearing:s,altitude:a}),this.width=e,this.height=t,this.scale=d,this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=o,this.bearing=s,this.altitude=a,this.fovy=l,this.center=p,this.meterOffset=c||[0,0,0],this.distanceScales=f,this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}_initMatrices(){const{width:e,height:t,projectionMatrix:n,viewMatrix:i}=this,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Q(r,r,n),Q(r,r,i),this.viewProjectionMatrix=r;const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Y(o,o,[e/2,-t/2,1]),X(o,o,[1,-1,0]),Q(o,o,r);const s=H([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o);if(!s)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=s}equals(e){return e instanceof Fe&&(e.width===this.width&&e.height===this.height&&te(e.projectionMatrix,this.projectionMatrix)&&te(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=Le(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,o=t?r:this.height-r;return 2===e.length?[i,o]:[i,o,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,o]=e,s=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=Re([i,s,o],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=Ee(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=Se(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){return Ee(e)}unprojectFlat(e){return Se(e)}getMapCenterByLngLatPosition({lngLat:e,pos:t}){const n=Re(t,this.pixelUnprojectionMatrix),i=ne([],Ee(e),ie([],n));return Se(ne([],this.center,i))}getLocationAtPoint({lngLat:e,pos:t}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:t})}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:o,zoom:s}=ze(Object.assign({width:n,height:i,bounds:e},t));return new Fe({width:n,height:i,longitude:r,latitude:o,zoom:s})}getBounds(e){const t=this.getBoundingRegion(e),n=Math.min(...t.map((e=>e[0]))),i=Math.max(...t.map((e=>e[0])));return[[n,Math.min(...t.map((e=>e[1])))],[i,Math.max(...t.map((e=>e[1])))]]}getBoundingRegion(e={}){return Oe(this,e.z||0)}}function Ne({width:e,height:t,longitude:n,latitude:i,zoom:r,pitch:o=0,bearing:s=0}){(n<-180||n>180)&&(n=q(n+180,360)-180),(s<-180||s>180)&&(s=q(s+180,360)-180);const a=Z(t/512);if(r<=a)r=a,i=0;else{const e=t/2/Math.pow(2,r),n=Se([0,e])[1];if(i<n)i=n;else{const t=Se([0,512-e])[1];i>t&&(i=t)}}return{width:e,height:t,longitude:n,latitude:i,zoom:r,pitch:o,bearing:s}}const Ue=["longitude","latitude","zoom"],je={curve:1.414,speed:1.2};function Ve(e,t,n,i={}){const r={},{startZoom:o,startCenterXY:s,uDelta:a,w0:l,u1:c,S:u,rho:h,rho2:d,r0:f}=We(e,t,i);if(c<.01){for(const i of Ue){const o=e[i],s=t[i];r[i]=(p=n)*s+(1-p)*o}return r}var p;const A=n*u,m=Math.cosh(f)/Math.cosh(f+h*A),g=l*((Math.cosh(f)*Math.tanh(f+h*A)-Math.sinh(f))/d)/c,y=o+we(1/m),_=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}([],a,g);ne(_,_,s);const v=Se(_);return r.longitude=v[0],r.latitude=v[1],r.zoom=y,r}function Ge(e,t,n={}){n=Object.assign({},je,n);const{screenSpeed:i,speed:r,maxDuration:o}=n,{S:s,rho:a}=We(e,t,n),l=1e3*s;let c;return c=Number.isFinite(i)?l/(i/a):l/r,Number.isFinite(o)&&c>o?0:c}function We(e,t,n){const i=(n=Object.assign({},je,n)).curve,r=e.zoom,o=[e.longitude,e.latitude],s=xe(r),a=t.zoom,l=[t.longitude,t.latitude],c=xe(a-r),u=Ee(o),h=Ee(l),d=oe([],h,u),f=Math.max(e.width,e.height),p=f/c,A=(g=(m=d)[0],y=m[1],Math.hypot(g,y)*s);var m,g,y;const _=Math.max(A,.01),v=i*i,b=(p*p-f*f+v*v*_*_)/(2*f*v*_),x=(p*p-f*f-v*v*_*_)/(2*p*v*_),w=Math.log(Math.sqrt(b*b+1)-b),E=Math.log(Math.sqrt(x*x+1)-x);return{startZoom:r,startCenterXY:u,uDelta:d,w0:f,u1:A,S:(E-w)/i,rho:i,rho2:v,r0:w,r1:E}}var $e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var r=i[n];e.call(t,r[1],r[0])}},t}()}(),qe="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,Ze="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),He="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(Ze):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var Qe=["top","right","bottom","left","width","height","size","weight"],Xe="undefined"!=typeof MutationObserver,Ye=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,i=!1,r=0;function o(){n&&(n=!1,e()),i&&a()}function s(){He(o)}function a(){var e=Date.now();if(n){if(e-r<2)return;i=!0}else n=!0,i=!1,setTimeout(s,t);r=e}return a}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){qe&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),Xe?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){qe&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;Qe.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),Ke=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},Je=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||Ze},et=st(0,0,0,0);function tt(e){return parseFloat(e)||0}function nt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+tt(e["border-"+n+"-width"])}),0)}function it(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return et;var i=Je(e).getComputedStyle(e),r=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var r=i[n],o=e["padding-"+r];t[r]=tt(o)}return t}(i),o=r.left+r.right,s=r.top+r.bottom,a=tt(i.width),l=tt(i.height);if("border-box"===i.boxSizing&&(Math.round(a+o)!==t&&(a-=nt(i,"left","right")+o),Math.round(l+s)!==n&&(l-=nt(i,"top","bottom")+s)),!function(e){return e===Je(e).document.documentElement}(e)){var c=Math.round(a+o)-t,u=Math.round(l+s)-n;1!==Math.abs(c)&&(a-=c),1!==Math.abs(u)&&(l-=u)}return st(r.left,r.top,a,l)}var rt="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof Je(e).SVGGraphicsElement}:function(e){return e instanceof Je(e).SVGElement&&"function"==typeof e.getBBox};function ot(e){return qe?rt(e)?function(e){var t=e.getBBox();return st(0,0,t.width,t.height)}(e):it(e):et}function st(e,t,n,i){return{x:e,y:t,width:n,height:i}}var at=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=st(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=ot(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),lt=function(e,t){var n,i,r,o,s,a,l,c=(i=(n=t).x,r=n.y,o=n.width,s=n.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(a.prototype),Ke(l,{x:i,y:r,width:o,height:s,top:r,right:i+o,bottom:s+r,left:i}),l);Ke(this,{target:e,contentRect:c})},ct=function(){function e(e,t,n){if(this.activeObservations_=[],this.observations_=new $e,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof Je(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new at(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof Je(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new lt(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),ut="undefined"!=typeof WeakMap?new WeakMap:new $e,ht=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=Ye.getInstance(),i=new ct(t,n,this);ut.set(this,i)};["observe","unobserve","disconnect"].forEach((function(e){ht.prototype[e]=function(){var t;return(t=ut.get(this))[e].apply(t,arguments)}}));var dt=void 0!==Ze.ResizeObserver?Ze.ResizeObserver:ht;function ft(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function At(e,t,n){return t&&pt(e.prototype,t),n&&pt(e,n),e}var mt="undefined"!=typeof document?document:{};function gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _t(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var bt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(e){if(!e)return null;if("string"==typeof e)return e;e.toJS&&(e=e.toJS());var t,n={},i=_t(e.layers);try{for(i.s();!(t=i.n()).done;){var r=t.value;n[r.id]=r}}catch(e){i.e(e)}finally{i.f()}var o=e.layers.map((function(e){var t=n[e.ref],i=null;if("interactive"in e&&delete(i=yt({},e)).interactive,t){delete(i=i||yt({},e)).ref;var r,o=_t(bt);try{for(o.s();!(r=o.n()).done;){var s=r.value;s in t&&(i[s]=t[s])}}catch(e){o.e(e)}finally{o.f()}}return i||e}));return yt(yt({},e),{},{layers:o})}var wt={container:b.exports.object,gl:b.exports.object,mapboxApiAccessToken:b.exports.string,mapboxApiUrl:b.exports.string,attributionControl:b.exports.bool,preserveDrawingBuffer:b.exports.bool,reuseMaps:b.exports.bool,transformRequest:b.exports.func,mapOptions:b.exports.object,mapStyle:b.exports.oneOfType([b.exports.string,b.exports.object]),preventStyleDiffing:b.exports.bool,visible:b.exports.bool,asyncRender:b.exports.bool,onLoad:b.exports.func,onError:b.exports.func,width:b.exports.number,height:b.exports.number,viewState:b.exports.object,longitude:b.exports.number,latitude:b.exports.number,zoom:b.exports.number,bearing:b.exports.number,pitch:b.exports.number,altitude:b.exports.number},Et={container:mt.body,mapboxApiAccessToken:function(){var e=null;if("undefined"!=typeof window&&window.location){var t=window.location.search.match(/access_token=([^&\/]*)/);e=t&&t[1]}e||"undefined"==typeof process||(e=e||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN);return e||"no-token"}(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:function(){},onError:function(e){e&&console.error(e.error)},width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function St(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"component";e.debug&&b.exports.checkPropTypes(wt,e,"prop",t)}var Tt=function(){function e(t){var n=this;if(ft(this,e),v(this,"props",Et),v(this,"width",0),v(this,"height",0),v(this,"_fireLoadEvent",(function(){n.props.onLoad({type:"load",target:n._map})})),v(this,"_handleError",(function(e){n.props.onError(e)})),!t.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=t.mapboxgl,e.initialized||(e.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(t)}return At(e,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(e){return this._update(this.props,e),this}},{key:"redraw",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=e.savedMap;var n=this._map.getContainer(),i=t.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,e.savedMap=null,t.mapStyle&&this._map.setStyle(xt(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&e.savedMap)this._reuse(t);else{if(t.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,t.gl}}var i={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:xt(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(i.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!e.savedMap?(e.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(e){var t=this;St(e=Object.assign({},Et,e),"Mapbox"),this.mapboxgl.accessToken=e.mapboxApiAccessToken||Et.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=e.mapboxApiUrl,this._create(e);var n=e.container;Object.defineProperty(n,"offsetWidth",{get:function(){return t.width}}),Object.defineProperty(n,"clientWidth",{get:function(){return t.width}}),Object.defineProperty(n,"offsetHeight",{get:function(){return t.height}}),Object.defineProperty(n,"clientHeight",{get:function(){return t.height}});var i=this._map.getCanvas();i&&(i.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}},{key:"_update",value:function(e,t){if(this._map){St(t=Object.assign({},this.props,t),"Mapbox");var n=this._updateMapViewport(e,t),i=this._updateMapSize(e,t);this._updateMapStyle(e,t),t.asyncRender||!n&&!i||this.redraw(),this.props=t}}},{key:"_updateMapStyle",value:function(e,t){e.mapStyle!==t.mapStyle&&this._map.setStyle(xt(t.mapStyle),{diff:!t.preventStyleDiffing})}},{key:"_updateMapSize",value:function(e,t){var n=e.width!==t.width||e.height!==t.height;return n&&(this.width=t.width,this.height=t.height,this._map.resize()),n}},{key:"_updateMapViewport",value:function(e,t){var n=this._getViewState(e),i=this._getViewState(t),r=i.latitude!==n.latitude||i.longitude!==n.longitude||i.zoom!==n.zoom||i.pitch!==n.pitch||i.bearing!==n.bearing||i.altitude!==n.altitude;return r&&(this._map.jumpTo(this._viewStateToMapboxProps(i)),i.altitude!==n.altitude&&(this._map.transform.altitude=i.altitude)),r}},{key:"_getViewState",value:function(e){var t=e.viewState||e,n=t.longitude,i=t.latitude,r=t.zoom,o=t.pitch,s=void 0===o?0:o,a=t.bearing,l=void 0===a?0:a,c=t.altitude;return{longitude:n,latitude:i,zoom:r,pitch:s,bearing:l,altitude:void 0===c?1.5:c}}},{key:"_checkStyleSheet",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0.47.0";if(void 0!==mt)try{var t=mt.createElement("div");t.className="mapboxgl-map",t.style.display="none",mt.body.appendChild(t);var n="static"!==window.getComputedStyle(t).position;if(!n){var i=mt.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(e,"/mapbox-gl.css")),mt.head.appendChild(i)}}catch(e){}}},{key:"_viewStateToMapboxProps",value:function(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}}}]),e}();v(Tt,"initialized",!1),v(Tt,"propTypes",wt),v(Tt,"defaultProps",Et),v(Tt,"savedMap",null);var kt={exports:{}};!function(e,t){e.exports=function(){var e,t,n;function i(i,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),n=r(s),"undefined"!=typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return i(["exports"],(function(e){var t="2.5.0",n=i;function i(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=n,this.p2y=i}i.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},i.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},i.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},i.prototype.solveCurveX=function(e,t){var n,i,r,o,s;for(void 0===t&&(t=1e-6),r=e,s=0;s<8;s++){if(o=this.sampleCurveX(r)-e,Math.abs(o)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=e)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(o=this.sampleCurveX(r),Math.abs(o-e)<t)return r;e>o?n=r:i=r,r=.5*(i-n)+n}return r},i.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var r=o;function o(e,t){this.x=e,this.y=t}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e};var s="undefined"!=typeof self?self:{};const a=Math.pow(2,53)-1,l=Math.PI/180,c=180/Math.PI;function u(e){return e*l}const h=[[0,0],[1,0],[1,1],[0,1]];function d(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function f(e,t,i,r){const o=new n(e,t,i,r);return function(e){return o.solve(e)}}const p=f(.25,.1,.25,1);function A(e,t,n){return Math.min(n,Math.max(t,e))}function m(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function g(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const r=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),r[s]=t,0==--i&&n(o,r)}))}))}function y(e){const t=[];for(const n in e)t.push(e[n]);return t}function _(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}let v=1;function b(){return v++}function x(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function w(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function E(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function S(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function T(e,t){return-1!==e.indexOf(t,e.length-t.length)}function k(e,t,n){const i={};for(const r in e)i[r]=t.call(n||this,e[r],r,e);return i}function C(e,t,n){const i={};for(const r in e)t.call(n||this,e[r],r,e)&&(i[r]=e[r]);return i}function P(e){return Array.isArray(e)?e.map(P):"object"==typeof e&&e?k(e,P):e}const M={};function I(e){M[e]||("undefined"!=typeof console&&console.warn(e),M[e]=!0)}function L(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function R(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}function z(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function D(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,i,r)=>{const o=i||r;return t[n]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let O,B,F,N=null;function U(e){if(null==N){const t=e.navigator?e.navigator.userAgent:null;N=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return N}function j(e){try{const t=s[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const V={now:()=>void 0!==F?F:s.performance.now(),setNow(e){F=e},restoreNow(){F=void 0},frame(e){const t=s.requestAnimationFrame(e);return{cancel:()=>s.cancelAnimationFrame(t)}},getImageData(e,t=0){const n=s.document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return n.width=e.width,n.height=e.height,i.drawImage(e,0,0,e.width,e.height),i.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:e=>(O||(O=s.document.createElement("a")),O.href=e,O.href),get devicePixelRatio(){return s.devicePixelRatio},get prefersReducedMotion(){return!!s.matchMedia&&(null==B&&(B=s.matchMedia("(prefers-reduced-motion: reduce)")),B.matches)}};let G;const W={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==G){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{G=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){G=e}}return G},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},$={supported:!1,testSupport:function(e){!H&&Z&&(Q?X(e):q=e)}};let q,Z,H=!1,Q=!1;function X(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Z),e.isContextLost())return;$.supported=!0}catch(e){}e.deleteTexture(t),H=!0}s.document&&(Z=s.document.createElement("img"),Z.onload=function(){q&&X(q),q=null,Q=!0},Z.onerror=function(){H=!0,q=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Y="01",K="NO_ACCESS_TOKEN";function J(e){return 0===e.indexOf("mapbox:")}function ee(e){return W.API_URL_REGEX.test(e)}const te=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ne(e){const t=e.match(te);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ie(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function re(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(s.atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class oe{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=re(W.ACCESS_TOKEN);let n="";return n=t&&t.u?s.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):W.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=j("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=s.localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const i=s.localStorage.getItem(n);i&&(this.anonId=i)}catch(e){I("Unable to read from LocalStorage")}}saveEventData(){const e=j("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{s.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&s.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){I("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,r){if(!W.EVENTS_URL)return;const o=ne(W.EVENTS_URL);o.params.push(`access_token=${r||W.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:Y,userId:this.anonId},a=n?_(s,n):s,l={url:ie(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=Te(l,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const se=new class extends oe{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){W.EVENTS_URL&&W.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>J(e)||ee(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=re(W.ACCESS_TOKEN),n=t?t.u:W.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;E(this.anonId)||(this.anonId=x(),i=!0);const r=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(r),n=(r-this.eventData.lastSuccess)/864e5;i=i||n>=1||n<-1||e.getDate()!==t.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(r,{"enabled.telemetry":!1},(e=>{e||(this.eventData.lastSuccess=r,this.eventData.tokenU=n)}),e)}},ae=se.postTurnstileEvent.bind(se),le=new class extends oe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,i){this.skuToken=t,this.errorCb=i,W.EVENTS_URL&&(n||W.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(K)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),E(this.anonId)||(this.anonId=x()),this.postEvent(n,{skuToken:this.skuToken},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},ce=le.postMapLoadEvent.bind(le),ue=new class extends oe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,i){if(!W.API_URL||!W.SESSION_PATH)return;const r=ne(W.API_URL+W.SESSION_PATH);r.params.push(`sku=${t||""}`),r.params.push(`access_token=${i||W.ACCESS_TOKEN||""}`);const o={url:ie(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ke(o,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)}))}getSessionAPI(e,t,n,i){this.skuToken=t,this.errorCb=i,W.SESSION_PATH&&W.API_URL&&(n||W.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(K)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},he=ue.getSessionAPI.bind(ue),de=new Set,fe="mapbox-tiles";let pe,Ae,me=500,ge=50;function ye(){s.caches&&!pe&&(pe=s.caches.open(fe))}function _e(e){const t=e.indexOf("?");return t<0?e:e.slice(0,t)}let ve=1/0;const be={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(be);class xe extends Error{constructor(e,t,n){401===t&&ee(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const we=z()?()=>self.worker&&self.worker.referrer:()=>("blob:"===s.location.protocol?s.parent:s).location.href,Ee=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(we())&&!/^\w+:/.test(n))){if(s.fetch&&s.Request&&s.AbortController&&s.Request.prototype.hasOwnProperty("signal"))return function(e,t){const n=new s.AbortController,i=new s.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:we(),signal:n.signal});let r=!1,o=!1;const a=(l=i.url).indexOf("sku=")>0&&ee(l);var l;"json"===e.type&&i.headers.set("Accept","application/json");const c=(n,r,l)=>{if(o)return;if(n&&"SecurityError"!==n.message&&I(n),r&&l)return u(r);const c=Date.now();s.fetch(i).then((n=>{if(n.ok){const e=a?n.clone():null;return u(n,e,c)}return t(new xe(n.statusText,n.status,e.url))})).catch((e=>{20!==e.code&&t(new Error(e.message))}))},u=(n,a,l)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{o||(a&&l&&function(e,t,n){if(ye(),!pe)return;const i={status:t.status,statusText:t.statusText,headers:new s.Headers};t.headers.forEach(((e,t)=>i.headers.set(t,e)));const r=D(t.headers.get("Cache-Control")||"");r["no-store"]||(r["max-age"]&&i.headers.set("Expires",new Date(n+1e3*r["max-age"]).toUTCString()),new Date(i.headers.get("Expires")).getTime()-n<42e4||function(e,t){if(void 0===Ae)try{new Response(new ReadableStream),Ae=!0}catch(e){Ae=!1}Ae?t(e.body):e.blob().then(t)}(t,(t=>{const n=new s.Response(t,i);ye(),pe&&pe.then((t=>t.put(_e(e.url),n))).catch((e=>I(e.message)))})))}(i,a,l),r=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return a?function(e,t){if(ye(),!pe)return t(null);const n=_e(e.url);pe.then((e=>{e.match(n).then((i=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=D(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(i);e.delete(n),r&&e.put(n,i.clone()),t(null,i,r)})).catch(t)})).catch(t)}(i,c):c(null,null),{cancel:()=>{o=!0,r||n.abort()}}}(e,t);if(z()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){const n=new s.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{t(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new xe(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,t)},Se=function(e,t){return Ee(_(e,{type:"arrayBuffer"}),t)},Te=function(e,t){return Ee(_(e,{method:"POST"}),t)},ke=function(e,t){return Ee(_(e,{method:"GET"}),t)};function Ce(e){const t=s.document.createElement("a");return t.href=e,t.protocol===s.document.location.protocol&&t.host===s.document.location.host}const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Me,Ie;Me=[],Ie=0;const Le=function(e,t){if($.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ie>=W.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Me.push(n),n}Ie++;let n=!1;const i=()=>{if(!n)for(n=!0,Ie--;Me.length&&Ie<W.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Me.shift(),{requestParameters:t,callback:n,cancelled:i}=e;i||(e.cancel=Le(t,n).cancel)}},r=Se(e,((e,n,r,o)=>{i(),e?t(e):n&&(s.createImageBitmap?function(e,t){const n=new s.Blob([new Uint8Array(e)],{type:"image/png"});s.createImageBitmap(n).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((e,n)=>t(e,n,r,o))):function(e,t){const n=new s.Image,i=s.URL;n.onload=()=>{t(null,n),i.revokeObjectURL(n.src),n.onload=null,s.requestAnimationFrame((()=>{n.src=Pe}))},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new s.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?i.createObjectURL(r):Pe}(n,((e,n)=>t(e,n,r,o))))}));return{cancel:()=>{r.cancel(),i()}}};function Re(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function ze(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class De{constructor(e,t={}){_(this,t),this.type=e}}class Oe extends De{constructor(e,t={}){super("error",_({error:e},t))}}class Be{on(e,t){return this._listeners=this._listeners||{},Re(e,t,this._listeners),this}off(e,t){return ze(e,t,this._listeners),ze(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Re(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new De(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const t of i)ze(n,t,this._oneTimeListeners),t.call(this,e);const r=this._eventedParent;r&&(_(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof Oe&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ne{constructor(e,t,n,i){this.message=(e?`${e}: `:"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function Ue(e){const t=e.value;return t?[new Ne(e.key,t,"constants have been deprecated as of v8")]:[]}function je(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}function Ve(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ge(e){if(Array.isArray(e))return e.map(Ge);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Ge(e[n]);return t}return Ve(e)}class We extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class $e{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,n]of t)this.bindings[e]=n}concat(e){return new $e(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const qe={kind:"null"},Ze={kind:"number"},He={kind:"string"},Qe={kind:"boolean"},Xe={kind:"color"},Ye={kind:"object"},Ke={kind:"value"},Je={kind:"collator"},et={kind:"formatted"},tt={kind:"resolvedImage"};function nt(e,t){return{kind:"array",itemType:e,N:t}}function it(e){if("array"===e.kind){const t=it(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const rt=[qe,Ze,He,Qe,Xe,et,Ye,nt(Ke),tt];function ot(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ot(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of rt)if(!ot(e,t))return null}return`Expected ${it(e)} but found ${it(t)} instead.`}function st(e,t){return t.some((t=>t.kind===e.kind))}function at(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function lt(e){var t={exports:{}};return e(t,t.exports),t.exports}var ct=lt((function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return i("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function o(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function s(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{t.parseCSSColor=function(e){var t,a=e.replace(/ /g,"").toLowerCase();if(a in n)return n[a].slice();if("#"===a[0])return 4===a.length?(t=parseInt(a.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===a.length&&(t=parseInt(a.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=o(h[1]),A=o(h[2]),m=A<=.5?A*(p+1):A+p-A*p,g=2*A-m;return[i(255*s(g,m,f+1/3)),i(255*s(g,m,f)),i(255*s(g,m,f-1/3)),d];default:return null}}return null}}catch(e){}}));class ut{constructor(e,t,n,i=1){this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof ut)return e;if("string"!=typeof e)return;const t=ct.parseCSSColor(e);return t?new ut(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,i]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${i})`}toArray(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}}ut.black=new ut(0,0,0,1),ut.white=new ut(1,1,1,1),ut.transparent=new ut(0,0,0,0),ut.red=new ut(1,0,0,1),ut.blue=new ut(0,0,1,1);class ht{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dt{constructor(e,t,n,i,r){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class ft{constructor(e){this.sections=e}static fromString(e){return new ft([new dt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof ft?e:ft.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class pt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new pt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function At(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof ut)return!0;if(e instanceof ht)return!0;if(e instanceof ft)return!0;if(e instanceof pt)return!0;if(Array.isArray(e)){for(const t of e)if(!mt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!mt(e[t]))return!1;return!0}return!1}function gt(e){if(null===e)return qe;if("string"==typeof e)return He;if("boolean"==typeof e)return Qe;if("number"==typeof e)return Ze;if(e instanceof ut)return Xe;if(e instanceof ht)return Je;if(e instanceof ft)return et;if(e instanceof pt)return tt;if(Array.isArray(e)){const t=e.length;let n;for(const t of e){const e=gt(t);if(n){if(n===e)continue;n=Ke;break}n=e}return nt(n||Ke,t)}return Ye}function yt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof ut||e instanceof ft||e instanceof pt?e.toString():JSON.stringify(e)}class _t{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!mt(e[1]))return t.error("invalid value");const n=e[1];let i=gt(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new _t(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ut?["rgba"].concat(this.value.toArray()):this.value instanceof ft?this.value.serialize():this.value}}class vt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const bt={string:He,number:Ze,boolean:Qe,object:Ye};class xt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in bt)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=bt[n],i++}else r=Ke;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}n=nt(r,o)}else n=bt[r];const o=[];for(;i<e.length;i++){const n=t.parse(e[i],i,Ke);if(!n)return null;o.push(n)}return new xt(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!ot(this.type,gt(n)))return n;if(t===this.args.length-1)throw new vt(`Expected value to be of type ${it(this.type)}, but found ${it(gt(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map((e=>e.serialize())))}}class wt{constructor(e){this.type=et,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let n=1;n<=e.length-1;++n){const o=e[n];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Ze),!e))return null;let n=null;if(o["text-font"]&&(n=t.parse(o["text-font"],1,nt(He)),!n))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,Xe),!s))return null;const a=i[i.length-1];a.scale=e,a.font=n,a.textColor=s}else{const o=t.parse(e[n],1,Ke);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:o,scale:null,font:null,textColor:null})}}return new wt(i)}evaluate(e){return new ft(this.sections.map((t=>{const n=t.content.evaluate(e);return gt(n)===tt?new dt("",n,null,null,null):new dt(yt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class Et{constructor(e){this.type=tt,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,He);return n?new Et(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=pt.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const St={"to-boolean":Qe,"to-color":Xe,"to-number":Ze,"to-string":He};class Tt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");const i=St[n],r=[];for(let n=1;n<e.length;n++){const i=t.parse(e[n],n,Ke);if(!i)return null;r.push(i)}return new Tt(i,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof ut)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:At(t[0],t[1],t[2],t[3]),!n))return new ut(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new vt(n||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new vt(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?ft.fromString(yt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?pt.fromString(yt(this.args[0].evaluate(e))):yt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new wt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Et(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const kt=["Unknown","Point","LineString","Polygon"];class Ct{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?kt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=ut.parse(e)),t}}class Pt{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const n=e[0],i=Pt.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[i,o]of s){a=new Kt(t.registry,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(i)?i[t-1]:i.type,o=a.parse(n,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(i)&&i.length!==s.length)a.error(`Expected ${i.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(i)?i[e]:i.type,n=s[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new Pt(n,r,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(it).join(", ")})`:`(${it(t.type)}...)`;var t})).join(" | "),i=[];for(let n=1;n<e.length;n++){const r=t.parse(e[n],1+i.length);if(!r)return null;i.push(it(r.type))}t.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(e,t){Pt.definitions=t;for(const n in t)e[n]=Pt}}class Mt{constructor(e,t,n){this.type=Je,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Qe);if(!i)return null;const r=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Qe);if(!r)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,He),!o)?null:new Mt(i,r,o)}evaluate(e){return new ht(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const It=8192;function Lt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Rt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function zt(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*It),Math.round(i*r*It)]}function Dt(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function Ot(e,t){let n=!1;for(let s=0,a=t.length;s<a;s++){const a=t[s];for(let t=0,s=a.length;t<s-1;t++){if(Dt(e,a[t],a[t+1]))return!1;(r=a[t])[1]>(i=e)[1]!=(o=a[t+1])[1]>i[1]&&i[0]<(o[0]-r[0])*(i[1]-r[1])/(o[1]-r[1])+r[0]&&(n=!n)}}var i,r,o;return n}function Bt(e,t){for(let n=0;n<t.length;n++)if(Ot(e,t[n]))return!0;return!1}function Ft(e,t,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(e[0]-n[0])*o-r*(e[1]-n[1]),a=(t[0]-n[0])*o-r*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function Nt(e,t,n){for(const c of n)for(let n=0;n<c.length-1;++n)if(0!=(a=[(s=c[n+1])[0]-(o=c[n])[0],s[1]-o[1]])[0]*(l=[(r=t)[0]-(i=e)[0],r[1]-i[1]])[1]-a[1]*l[0]&&Ft(i,r,o,s)&&Ft(o,s,i,r))return!0;var i,r,o,s,a,l;return!1}function Ut(e,t){for(let n=0;n<e.length;++n)if(!Ot(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Nt(e[n],e[n+1],t))return!1;return!0}function jt(e,t){for(let n=0;n<t.length;n++)if(Ut(e,t[n]))return!0;return!1}function Vt(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=[];for(let i=0;i<e[r].length;i++){const s=zt(e[r][i],n);Lt(t,s),o.push(s)}i.push(o)}return i}function Gt(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=Vt(e[r],t,n);i.push(o)}return i}function Wt(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}Lt(t,e)}function $t(e,t,n,i){const r=Math.pow(2,i.z)*It,o=[i.x*It,i.y*It],s=[];for(const i of e)for(const e of i){const i=[e.x+o[0],e.y+o[1]];Wt(i,t,n,r),s.push(i)}return s}function qt(e,t,n,i){const r=Math.pow(2,i.z)*It,o=[i.x*It,i.y*It],s=[];for(const n of e){const e=[];for(const i of n){const n=[i.x+o[0],i.y+o[1]];Lt(t,n),e.push(n)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const i of e)Wt(i,t,n,r)}var a;return s}class Zt{constructor(e,t){this.type=Qe,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Zt(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Zt(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Zt(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=Vt(t.coordinates,i,r),s=$t(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of s)if(!Ot(e,o))return!1}if("MultiPolygon"===t.type){const o=Gt(t.coordinates,i,r),s=$t(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of s)if(!Bt(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=Vt(t.coordinates,i,r),s=qt(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of s)if(!Ut(e,o))return!1}if("MultiPolygon"===t.type){const o=Gt(t.coordinates,i,r),s=qt(e.geometry(),n,i,r);if(!Rt(n,i))return!1;for(const e of s)if(!jt(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ht(e){if(e instanceof Pt){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Zt)return!1;let t=!0;return e.eachChild((e=>{t&&!Ht(e)&&(t=!1)})),t}function Qt(e){if(e instanceof Pt&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Qt(e)&&(t=!1)})),t}function Xt(e,t){if(e instanceof Pt&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!Xt(e,t)&&(n=!1)})),n}class Yt{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Yt(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Kt{constructor(e,t=[],n,i=new $e,r=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=i,this.errors=r,this.expectedType=n}parse(e,t,n,i,r={}){return t?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}_parse(e,t){function n(e,t,n){return"assert"===n?new xt(t,[e]):"coerce"===n?new Tt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[i];if(r){let i=r.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,r=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else i=n(i,e,t.typeAnnotation||"coerce");else i=n(i,e,t.typeAnnotation||"assert")}if(!(i instanceof _t)&&"resolvedImage"!==i.type.kind&&Jt(i)){const t=new Ct;try{i=new _t(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new Kt(this.registry,i,t||null,r,this.errors)}error(e,...t){const n=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new We(n,e))}checkSubtype(e,t){const n=ot(e,t);return n&&this.error(n),n}}function Jt(e){if(e instanceof Yt)return Jt(e.boundExpression);if(e instanceof Pt&&"error"===e.name)return!1;if(e instanceof Mt)return!1;if(e instanceof Zt)return!1;const t=e instanceof Tt||e instanceof xt;let n=!0;return e.eachChild((e=>{n=t?n&&Jt(e):n&&e instanceof _t})),!!n&&Ht(e)&&Xt(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function en(e,t){const n=e.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=e[a],r=e[a+1],i<=t){if(a===n||t<r)return a;o=a+1}else{if(!(i>t))throw new vt("Input is not a number.");s=a-1}return 0}class tn{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,Ze);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let n=1;n<e.length;n+=2){const o=1===n?-1/0:e[n],s=e[n+1],a=n,l=n+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([o,c])}return new tn(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[en(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}function nn(e,t,n){return e*(1-n)+t*n}var rn=Object.freeze({__proto__:null,number:nn,color:function(e,t,n){return new ut(nn(e.r,t.r,n),nn(e.g,t.g,n),nn(e.b,t.b,n),nn(e.a,t.a,n))},array:function(e,t,n){return e.map(((e,i)=>nn(e,t[i],n)))}});const on=.95047,sn=1.08883,an=4/29,ln=6/29,cn=3*ln*ln,un=Math.PI/180,hn=180/Math.PI;function dn(e){return e>.008856451679035631?Math.pow(e,1/3):e/cn+an}function fn(e){return e>ln?e*e*e:cn*(e-an)}function pn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function An(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function mn(e){const t=An(e.r),n=An(e.g),i=An(e.b),r=dn((.4124564*t+.3575761*n+.1804375*i)/on),o=dn((.2126729*t+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-dn((.0193339*t+.119192*n+.9503041*i)/sn)),alpha:e.a}}function gn(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,i=isNaN(e.b)?t:t-e.b/200;return t=1*fn(t),n=on*fn(n),i=sn*fn(i),new ut(pn(3.2404542*n-1.5371385*t-.4985314*i),pn(-.969266*n+1.8760108*t+.041556*i),pn(.0556434*n-.2040259*t+1.0572252*i),e.alpha)}function yn(e,t,n){const i=t-e;return e+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const _n={forward:mn,reverse:gn,interpolate:function(e,t,n){return{l:nn(e.l,t.l,n),a:nn(e.a,t.a,n),b:nn(e.b,t.b,n),alpha:nn(e.alpha,t.alpha,n)}}},vn={forward:function(e){const{l:t,a:n,b:i}=mn(e),r=Math.atan2(i,n)*hn;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:t,alpha:e.a}},reverse:function(e){const t=e.h*un,n=e.c;return gn({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:yn(e.h,t.h,n),c:nn(e.c,t.c,n),l:nn(e.l,t.l,n),alpha:nn(e.alpha,t.alpha,n)}}};var bn=Object.freeze({__proto__:null,lab:_n,hcl:vn});class xn{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let o=0;if("exponential"===e.name)o=wn(t,e.base,i,r);else if("linear"===e.name)o=wn(t,1,i,r);else if("cubic-bezier"===e.name){const s=e.controlPoints;o=new n(s[0],s[1],s[2],s[3]).solve(wn(t,1,i,r))}return o}static parse(e,t){let[n,i,r,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,Ze),!r)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=Xe:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const n=o[e],i=o[e+1],r=e+3,l=e+4;if("number"!=typeof n)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=n)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(i,l,a);if(!c)return null;a=a||c.type,s.push([n,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new xn(a,n,i,r,s):t.error(`Type ${it(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const o=en(t,i),s=xn.interpolationFactor(this.interpolation,i,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);return"interpolate"===this.operator?rn[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?vn.reverse(vn.interpolate(vn.forward(a),vn.forward(l),s)):_n.reverse(_n.interpolate(_n.forward(a),_n.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function wn(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}class En{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const i of e.slice(1)){const e=t.parse(i,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}const o=i&&r.some((e=>ot(i,e.type)));return new En(o?Ke:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(e),n&&n instanceof pt&&!n.available&&(t||(t=n.name),n=null,i===this.args.length&&(n=t)),null!==n)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class Sn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let i=1;i<e.length-1;i+=2){const r=e[i];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=t.parse(e[i+1],i+1);if(!o)return null;n.push([r,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new Sn(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}class Tn{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ze),i=t.parse(e[2],2,nt(t.expectedType||Ke));return n&&i?new Tn(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new vt(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new vt(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new vt(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class kn{constructor(e,t){this.type=Qe,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ke),i=t.parse(e[2],2,Ke);return n&&i?st(n.type,[Qe,He,Ze,qe,Ke])?new kn(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${it(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!at(t,["boolean","string","number","null"]))throw new vt(`Expected first argument to be of type boolean, string, number or null, but found ${it(gt(t))} instead.`);if(!at(n,["string","array"]))throw new vt(`Expected second argument to be of type array or string, but found ${it(gt(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Cn{constructor(e,t,n){this.type=Ze,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ke),i=t.parse(e[2],2,Ke);if(!n||!i)return null;if(!st(n.type,[Qe,He,Ze,qe,Ke]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${it(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Ze);return r?new Cn(n,i,r):null}return new Cn(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!at(t,["boolean","string","number","null"]))throw new vt(`Expected first argument to be of type boolean, string, number or null, but found ${it(gt(t))} instead.`);if(!at(n,["string","array"]))throw new vt(`Expected second argument to be of type array or string, but found ${it(gt(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Pn{constructor(e,t,n,i,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,gt(e)))return null}else n=gt(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(l,s,i);if(!u)return null;i=i||u.type,o.push(u)}const s=t.parse(e[1],1,Ke);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,i);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new Pn(n,i,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(gt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const e of t){const t=i[this.cases[e]];void 0===t?(i[this.cases[e]]=n.length,n.push([this.cases[e],[e]])):n[t][1].push(e)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,i]of n)e.push(1===i.length?r(i[0]):i.map(r)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class Mn{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,Qe);if(!o)return null;const s=t.parse(e[r+1],r+1,n);if(!s)return null;i.push([o,s]),n=n||s.type}const r=t.parse(e[e.length-1],e.length-1,n);return r?new Mn(n,i,r):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class In{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ke),i=t.parse(e[2],2,Ze);if(!n||!i)return null;if(!st(n.type,[nt(Ke),He,Ke]))return t.error(`Expected first argument to be of type array or string, but found ${it(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Ze);return r?new In(n.type,n,i,r):null}return new In(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!at(t,["string","array"]))throw new vt(`Expected first argument to be of type array or string, but found ${it(gt(t))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ln(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Rn(e,t,n,i){return 0===i.compare(t,n)}function zn(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=Qe,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,Ke);if(!o)return null;if(!Ln(n,o.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${it(o.type)}'.`);let s=t.parse(e[2],2,Ke);if(!s)return null;if(!Ln(n,s.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${it(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${it(o.type)}' and '${it(s.type)}'.`);i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new xt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new xt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Je),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=gt(o),n=gt(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new vt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const e=gt(o),n=gt(s);if("string"!==e.kind||"string"!==n.kind)return t(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Dn=zn("==",(function(e,t,n){return t===n}),Rn),On=zn("!=",(function(e,t,n){return t!==n}),(function(e,t,n,i){return!Rn(0,t,n,i)})),Bn=zn("<",(function(e,t,n){return t<n}),(function(e,t,n,i){return i.compare(t,n)<0})),Fn=zn(">",(function(e,t,n){return t>n}),(function(e,t,n,i){return i.compare(t,n)>0})),Nn=zn("<=",(function(e,t,n){return t<=n}),(function(e,t,n,i){return i.compare(t,n)<=0})),Un=zn(">=",(function(e,t,n){return t>=n}),(function(e,t,n,i){return i.compare(t,n)>=0}));class jn{constructor(e,t,n,i,r){this.type=He,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Ze);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parse(i.locale,1,He),!r))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,He),!o))return null;let s=null;if(i["min-fraction-digits"]&&(s=t.parse(i["min-fraction-digits"],1,Ze),!s))return null;let a=null;return i["max-fraction-digits"]&&(a=t.parse(i["max-fraction-digits"],1,Ze),!a)?null:new jn(n,r,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Vn{constructor(e){this.type=Ze,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${it(n.type)} instead.`):new Vn(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new vt(`Expected value to be of type string or array, but found ${it(gt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Gn={"==":Dn,"!=":On,">":Fn,"<":Bn,">=":Un,"<=":Nn,array:xt,at:Tn,boolean:xt,case:Mn,coalesce:En,collator:Mt,format:wt,image:Et,in:kn,"index-of":Cn,interpolate:xn,"interpolate-hcl":xn,"interpolate-lab":xn,length:Vn,let:Sn,literal:_t,match:Pn,number:xt,"number-format":jn,object:xt,slice:In,step:tn,string:xt,"to-boolean":Tt,"to-color":Tt,"to-number":Tt,"to-string":Tt,var:Yt,within:Zt};function Wn(e,[t,n,i,r]){t=t.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const o=r?r.evaluate(e):1,s=At(t,n,i,o);if(s)throw new vt(s);return new ut(t/255*o,n/255*o,i/255*o,o)}function $n(e,t){return e in t}function qn(e,t){const n=t[e];return void 0===n?null:n}function Zn(e){return{type:e}}function Hn(e){return{result:"success",value:e}}function Qn(e){return{result:"error",value:e}}function Xn(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Yn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Kn(e){return!!e.expression&&e.expression.interpolated}function Jn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function ei(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function ti(e){return e}function ni(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),o=e.type||(Kn(t)?"exponential":"interval");if(n&&((e=je({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],ut.parse(e[1])]))),e.default=ut.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!bn[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=si;else if("interval"===o)s=oi;else if("categorical"===o){s=ri,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=ai}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,ni(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:xn.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:({zoom:n},i)=>si({stops:r,base:e.base},t,n).evaluate(n,i)}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:xn.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:n})=>s(e,t,n,a,l)}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?ii(e.default,t.default):s(e,t,r,a,l)}}}function ii(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function ri(e,t,n,i,r){return ii(typeof n===r?i[n]:void 0,e.default,t.default)}function oi(e,t,n){if("number"!==Jn(n))return ii(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=en(e.stops.map((e=>e[0])),n);return e.stops[r][1]}function si(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==Jn(n))return ii(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const o=en(e.stops.map((e=>e[0])),n),s=function(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=rn[t.type]||ti;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=bn[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),n=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==n)return c(t,n,s)}}:c(a,l,s)}function ai(e,t,n){return"color"===t.type?n=ut.parse(n):"formatted"===t.type?n=ft.fromString(n.toString()):"resolvedImage"===t.type?n=pt.fromString(n.toString()):Jn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),ii(n,e.default,t.default)}Pt.register(Gn,{error:[{kind:"error"},[He],(e,[t])=>{throw new vt(t.evaluate(e))}],typeof:[He,[Ke],(e,[t])=>it(gt(t.evaluate(e)))],"to-rgba":[nt(Ze,4),[Xe],(e,[t])=>t.evaluate(e).toArray()],rgb:[Xe,[Ze,Ze,Ze],Wn],rgba:[Xe,[Ze,Ze,Ze,Ze],Wn],has:{type:Qe,overloads:[[[He],(e,[t])=>$n(t.evaluate(e),e.properties())],[[He,Ye],(e,[t,n])=>$n(t.evaluate(e),n.evaluate(e))]]},get:{type:Ke,overloads:[[[He],(e,[t])=>qn(t.evaluate(e),e.properties())],[[He,Ye],(e,[t,n])=>qn(t.evaluate(e),n.evaluate(e))]]},"feature-state":[Ke,[He],(e,[t])=>qn(t.evaluate(e),e.featureState||{})],properties:[Ye,[],e=>e.properties()],"geometry-type":[He,[],e=>e.geometryType()],id:[Ke,[],e=>e.id()],zoom:[Ze,[],e=>e.globals.zoom],"heatmap-density":[Ze,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ze,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Ze,[],e=>e.globals.skyRadialProgress||0],accumulated:[Ke,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ze,Zn(Ze),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[Ze,Zn(Ze),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:Ze,overloads:[[[Ze,Ze],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[Ze],(e,[t])=>-t.evaluate(e)]]},"/":[Ze,[Ze,Ze],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[Ze,[Ze,Ze],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[Ze,[],()=>Math.LN2],pi:[Ze,[],()=>Math.PI],e:[Ze,[],()=>Math.E],"^":[Ze,[Ze,Ze],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[Ze,[Ze],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ze,[Ze],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ze,[Ze],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ze,[Ze],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ze,[Ze],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ze,[Ze],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ze,[Ze],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ze,[Ze],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ze,[Ze],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ze,[Ze],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ze,Zn(Ze),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Ze,Zn(Ze),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Ze,[Ze],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ze,[Ze],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ze,[Ze],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ze,[Ze],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Qe,[He,Ke],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[Qe,[Ke],(e,[t])=>e.id()===t.value],"filter-type-==":[Qe,[He],(e,[t])=>e.geometryType()===t.value],"filter-<":[Qe,[He,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[Qe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<i}],"filter->":[Qe,[He,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[Qe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>i}],"filter-<=":[Qe,[He,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[Qe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<=i}],"filter->=":[Qe,[He,Ke],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[Qe,[Ke],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>=i}],"filter-has":[Qe,[Ke],(e,[t])=>t.value in e.properties()],"filter-has-id":[Qe,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Qe,[nt(He)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Qe,[nt(Ke)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Qe,[He,nt(Ke)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Qe,[He,nt(Ke)],(e,[t,n])=>function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Qe,overloads:[[[Qe,Qe],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Zn(Qe),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Qe,overloads:[[[Qe,Qe],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Zn(Qe),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Qe,[Qe],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Qe,[He],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[He,[He],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[He,[He],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[He,Zn(Ke),(e,t)=>t.map((t=>yt(t.evaluate(e)))).join("")],"resolved-locale":[He,[Je],(e,[t])=>t.evaluate(e).resolvedLocale()]});class li{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ct,this._defaultValue=t?function(e){return"color"===e.type&&ei(e.default)?new ut(0,0,0,0):"color"===e.type?ut.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new vt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function ci(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Gn}function ui(e,t){const n=new Kt(Gn,[],t?function(e){const t={color:Xe,string:He,number:Ze,enum:He,boolean:Qe,formatted:et,resolvedImage:tt};return"array"===e.type?nt(t[e.value]||Ke,e.length):t[e.type]}(t):void 0),i=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?Hn(new li(i,t)):Qn(n.errors)}class hi{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Qt(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}}class di{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Qt(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}interpolationFactor(e,t,n){return this.interpolationType?xn.interpolationFactor(this.interpolationType,e,t,n):0}}function fi(e,t){if("error"===(e=ui(e,t)).result)return e;const n=e.value.expression,i=Ht(n);if(!i&&!Xn(t))return Qn([new We("","data expressions not supported")]);const r=Xt(n,["zoom"]);if(!r&&!Yn(t))return Qn([new We("","zoom expressions not supported")]);const o=Ai(n);return o||r?o instanceof We?Qn([o]):o instanceof xn&&!Kn(t)?Qn([new We("",'"interpolate" expressions cannot be used with this property')]):Hn(o?new di(i?"camera":"composite",e.value,o.labels,o instanceof xn?o.interpolation:void 0):new hi(i?"constant":"source",e.value)):Qn([new We("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pi{constructor(e,t){this._parameters=e,this._specification=t,je(this,ni(this._parameters,this._specification))}static deserialize(e){return new pi(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ai(e){let t=null;if(e instanceof Sn)t=Ai(e.result);else if(e instanceof En){for(const n of e.args)if(t=Ai(n),t)break}else(e instanceof tn||e instanceof xn)&&e.input instanceof Pt&&"zoom"===e.input.name&&(t=e);return t instanceof We||e.eachChild((e=>{const n=Ai(e);n instanceof We?t=n:!t&&n?t=new We("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new We("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function mi(e){const t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=Jn(n);if("object"!==l)return[new Ne(t,n,`object expected, ${l} found`)];for(const e in n){const l=e.split(".")[0],c=i[l]||i["*"];let u;if(r[l])u=r[l];else if(i[l])u=$i;else if(r["*"])u=r["*"];else{if(!i["*"]){a.push(new Ne(t,n[e],`unknown property "${e}"`));continue}u=$i}a=a.concat(u({key:(t?`${t}.`:t)+e,value:n[e],valueSpec:c,style:o,styleSpec:s,object:n,objectKey:e},n))}for(const e in i)r[e]||i[e].required&&void 0===i[e].default&&void 0===n[e]&&a.push(new Ne(t,n,`missing required property "${e}"`));return a}function gi(e){const t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||$i;if("array"!==Jn(t))return[new Ne(o,t,`array expected, ${Jn(t)} found`)];if(n.length&&t.length!==n.length)return[new Ne(o,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ne(o,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let a={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};r.$version<7&&(a.function=n.function),"object"===Jn(n.value)&&(a=n.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:i,styleSpec:r,key:`${o}[${e}]`}));return l}function yi(e){const t=e.key,n=e.value,i=e.valueSpec;let r=Jn(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new Ne(t,n,`number expected, ${r} found`)];if("minimum"in i){let r=i.minimum;if("array"===Jn(i.minimum)&&(r=i.minimum[e.arrayIndex]),n<r)return[new Ne(t,n,`${n} is less than the minimum value ${r}`)]}if("maximum"in i){let r=i.maximum;if("array"===Jn(i.maximum)&&(r=i.maximum[e.arrayIndex]),n>r)return[new Ne(t,n,`${n} is greater than the maximum value ${r}`)]}return[]}function _i(e){const t=e.valueSpec,n=Ve(e.value.type);let i,r,o,s={};const a="categorical"!==n&&void 0===e.value.property,l=!a,c="array"===Jn(e.value.stops)&&"array"===Jn(e.value.stops[0])&&"object"===Jn(e.value.stops[0][0]),u=mi({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new Ne(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const i=e.value;return t=t.concat(gi({key:e.key,value:i,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Jn(i)&&0===i.length&&t.push(new Ne(e.key,i,"array must have at least one stop")),t},default:function(e){return $i({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&a&&u.push(new Ne(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new Ne(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!Kn(e.valueSpec)&&u.push(new Ne(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Xn(e.valueSpec)?u.push(new Ne(e.key,e.value,"property functions not supported")):a&&!Yn(e.valueSpec)&&u.push(new Ne(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new Ne(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const i=e.value,a=e.key;if("array"!==Jn(i))return[new Ne(a,i,`array expected, ${Jn(i)} found`)];if(2!==i.length)return[new Ne(a,i,`array length 2 expected, length ${i.length} found`)];if(c){if("object"!==Jn(i[0]))return[new Ne(a,i,`object expected, ${Jn(i[0])} found`)];if(void 0===i[0].zoom)return[new Ne(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new Ne(a,i,"object stop key must have value")];if(o&&o>Ve(i[0].zoom))return[new Ne(a,i[0].zoom,"stop zoom values must appear in ascending order")];Ve(i[0].zoom)!==o&&(o=Ve(i[0].zoom),r=void 0,s={}),n=n.concat(mi({key:`${a}[0]`,value:i[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:yi,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:i[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},i));return ci(Ge(i[1]))?n.concat([new Ne(`${a}[1]`,i[1],"expressions are not allowed in function stops.")]):n.concat($i({key:`${a}[1]`,value:i[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Jn(e.value),l=Ve(e.value),c=null!==e.value?e.value:o;if(i){if(a!==i)return[new Ne(e.key,c,`${a} stop domain type must match previous stop domain type ${i}`)]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Ne(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i=`number expected, ${a} found`;return Xn(t)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ne(e.key,c,i)]}return"categorical"!==n||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&void 0!==r&&l<r?[new Ne(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in s?[new Ne(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Ne(e.key,c,`integer expected, found ${l}`)]}}function vi(e){const t=("property"===e.expressionContext?fi:ui)(Ge(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Ne(`${e.key}${t.key}`,e.value,t.message)));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Ne(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Qt(n))return[new Ne(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Qt(n))return[new Ne(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Xt(n,["zoom","feature-state"]))return[new Ne(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Ht(n))return[new Ne(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bi(e){const t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(Ve(n))&&r.push(new Ne(t,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(Ve(n))&&r.push(new Ne(t,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function xi(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!xi(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const wi={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ei(e){if(null==e)return{filter:()=>!0,needGeometry:!1};xi(e)||(e=ki(e));const t=ui(e,wi);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,n,i)=>t.value.evaluate(e,n,{},i),needGeometry:Ti(e)}}function Si(e,t){return e<t?-1:e>t?1:0}function Ti(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(Ti(e[t]))return!0;return!1}function ki(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Ci(e[1],e[2],"=="):"!="===t?Ii(Ci(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Ci(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(ki))):"all"===t?["all"].concat(e.slice(1).map(ki)):"none"===t?["all"].concat(e.slice(1).map(ki).map(Ii)):"in"===t?Pi(e[1],e.slice(2)):"!in"===t?Ii(Pi(e[1],e.slice(2))):"has"===t?Mi(e[1]):"!has"===t?Ii(Mi(e[1])):"within"!==t||e;var n}function Ci(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function Pi(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Si)]]:["filter-in-small",e,["literal",t]]}}function Mi(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ii(e){return["!",e]}function Li(e){return xi(Ge(e.value))?vi(je({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ri(e)}function Ri(e){const t=e.value,n=e.key;if("array"!==Jn(t))return[new Ne(n,t,`array expected, ${Jn(t)} found`)];const i=e.styleSpec;let r,o=[];if(t.length<1)return[new Ne(n,t,"filter array must have at least 1 element")];switch(o=o.concat(bi({key:`${n}[0]`,value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ve(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Ve(t[1])&&o.push(new Ne(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Ne(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=Jn(t[1]),"string"!==r&&o.push(new Ne(`${n}[1]`,t[1],`string expected, ${r} found`)));for(let s=2;s<t.length;s++)r=Jn(t[s]),"$type"===Ve(t[1])?o=o.concat(bi({key:`${n}[${s}]`,value:t[s],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Ne(`${n}[${s}]`,t[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let i=1;i<t.length;i++)o=o.concat(Ri({key:`${n}[${i}]`,value:t[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Jn(t[1]),2!==t.length?o.push(new Ne(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Ne(`${n}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=Jn(t[1]),2!==t.length?o.push(new Ne(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Ne(`${n}[1]`,t[1],`object expected, ${r} found`))}return o}function zi(e,t){const n=e.key,i=e.style,r=e.styleSpec,o=e.value,s=e.objectKey,a=r[`${t}_${e.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===t&&l&&a[l[1]]&&a[l[1]].transition)return $i({key:n,value:o,valueSpec:r.transition,style:i,styleSpec:r});const c=e.valueSpec||a[s];if(!c)return[new Ne(n,o,`unknown property "${s}"`)];let u;if("string"===Jn(o)&&Xn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Ne(n,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===s&&i&&!i.glyphs&&h.push(new Ne(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&ei(Ge(o))&&"identity"===Ve(o.type)&&h.push(new Ne(n,o,'"text-font" does not support identity functions'))),h.concat($i({key:e.key,value:o,valueSpec:c,style:i,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:s}))}function Di(e){return zi(e,"paint")}function Oi(e){return zi(e,"layout")}function Bi(e){let t=[];const n=e.value,i=e.key,r=e.style,o=e.styleSpec;n.type||n.ref||t.push(new Ne(i,n,'either "type" or "ref" is required'));let s=Ve(n.type);const a=Ve(n.ref);if(n.id){const o=Ve(n.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];Ve(e.id)===o&&t.push(new Ne(i,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&t.push(new Ne(i,n[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{Ve(t.id)===a&&(e=t)})),e?e.ref?t.push(new Ne(i,n.ref,"ref cannot reference another ref layer")):s=Ve(e.type):t.push(new Ne(i,n.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(n.source){const e=r.sources&&r.sources[n.source],o=e&&Ve(e.type);e?"vector"===o&&"raster"===s?t.push(new Ne(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===o&&"raster"!==s?t.push(new Ne(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Ne(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Ne(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ne(i,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ne(i,n.source,`source "${n.source}" not found`))}else t.push(new Ne(i,n,'missing required property "source"'));return t=t.concat(mi({key:i,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${i}.type`,value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:Li,layout:e=>mi({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Oi(je({layerType:s},e))}}),paint:e=>mi({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Di(je({layerType:s},e))}})}})),t}function Fi(e){const t=e.value,n=e.key,i=Jn(t);return"string"!==i?[new Ne(n,t,`string expected, ${i} found`)]:[]}const Ni={promoteId:function({key:e,value:t}){if("string"===Jn(t))return Fi({key:e,value:t});{const n=[];for(const i in t)n.push(...Fi({key:`${e}.${i}`,value:t[i]}));return n}}};function Ui(e){const t=e.value,n=e.key,i=e.styleSpec,r=e.style;if(!t.type)return[new Ne(n,t,'"type" is required')];const o=Ve(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=mi({key:n,value:t,valueSpec:i[`source_${o.replace("-","_")}`],style:e.style,styleSpec:i,objectElementValidators:Ni}),s;case"geojson":if(s=mi({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:Ni}),t.cluster)for(const e in t.clusterProperties){const[i,r]=t.clusterProperties[e],o="string"==typeof i?[i,["accumulated"],["get",e]]:i;s.push(...vi({key:`${n}.${e}.map`,value:r,expressionContext:"cluster-map"})),s.push(...vi({key:`${n}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return mi({key:n,value:t,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return mi({key:n,value:t,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new Ne(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return bi({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:i})}}function ji(e){const t=e.value,n=e.styleSpec,i=n.light,r=e.style;let o=[];const s=Jn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ne("light",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&i[s[1]]&&i[s[1]].transition?$i({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n}):i[e]?$i({key:e,value:t[e],valueSpec:i[e],style:r,styleSpec:n}):[new Ne(e,t[e],`unknown property "${e}"`)])}return o}function Vi(e){const t=e.value,n=e.key,i=e.style,r=e.styleSpec,o=r.terrain;let s=[];const a=Jn(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new Ne("terrain",t,`object expected, ${a} found`)]),s;for(const e in t){const n=e.match(/^(.*)-transition$/);s=s.concat(n&&o[n[1]]&&o[n[1]].transition?$i({key:e,value:t[e],valueSpec:r.transition,style:i,styleSpec:r}):o[e]?$i({key:e,value:t[e],valueSpec:o[e],style:i,styleSpec:r}):[new Ne(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=i.sources&&i.sources[t.source],r=e&&Ve(e.type);e?"raster-dem"!==r&&s.push(new Ne(n,t.source,`terrain cannot be used with a source of type ${r}, it only be used with a "raster-dem" source type`)):s.push(new Ne(n,t.source,`source "${t.source}" not found`))}else s.push(new Ne(n,t,'terrain is missing required property "source"'));return s}function Gi(e){const t=e.value,n=e.style,i=e.styleSpec,r=i.fog;let o=[];const s=Jn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ne("fog",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?$i({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i}):r[e]?$i({key:e,value:t[e],valueSpec:r[e],style:n,styleSpec:i}):[new Ne(e,t[e],`unknown property "${e}"`)])}return o}const Wi={"*":()=>[],array:gi,boolean:function(e){const t=e.value,n=e.key,i=Jn(t);return"boolean"!==i?[new Ne(n,t,`boolean expected, ${i} found`)]:[]},number:yi,color:function(e){const t=e.key,n=e.value,i=Jn(n);return"string"!==i?[new Ne(t,n,`color expected, ${i} found`)]:null===ct.parseCSSColor(n)?[new Ne(t,n,`color expected, "${n}" found`)]:[]},constants:Ue,enum:bi,filter:Li,function:_i,layer:Bi,object:mi,source:Ui,light:ji,terrain:Vi,fog:Gi,string:Fi,formatted:function(e){return 0===Fi(e).length?[]:vi(e)},resolvedImage:function(e){return 0===Fi(e).length?[]:vi(e)}};function $i(e){const t=e.value,n=e.valueSpec,i=e.styleSpec;return n.expression&&ei(Ve(t))?_i(e):n.expression&&ci(Ge(t))?vi(e):n.type&&Wi[n.type]?Wi[n.type](e):mi(je({},e,{valueSpec:n.type?i[n.type]:n}))}function qi(e){const t=e.value,n=e.key,i=Fi(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new Ne(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new Ne(n,t,'"glyphs" url must include a "{range}" token'))),i}function Zi(e,t=Fe){let n=[];return n=n.concat($i({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:qi,"*":()=>[]}})),e.constants&&(n=n.concat(Ue({key:"constants",value:e.constants,style:e,styleSpec:t}))),Hi(n)}function Hi(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Qi(e){return function(...t){return Hi(e.apply(this,t))}}Zi.source=Qi(Ui),Zi.light=Qi(ji),Zi.terrain=Qi(Vi),Zi.fog=Qi(Gi),Zi.layer=Qi(Bi),Zi.filter=Qi(Li),Zi.paintProperty=Qi(Di),Zi.layoutProperty=Qi(Oi);const Xi=Zi,Yi=Xi.light,Ki=Xi.fog,Ji=Xi.paintProperty,er=Xi.layoutProperty;function tr(e,t){let n=!1;if(t&&t.length)for(const i of t)e.fire(new Oe(new Error(i.message))),n=!0;return n}var nr=ir;function ir(e,t,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[3+o],a=r[3+o+1];i.push(s===a?null:r.subarray(s,a))}var l=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var u=n/t*e;this.min=-u,this.max=e+u}ir.prototype.insert=function(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},ir.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ir.prototype._insertCell=function(e,t,n,i,r,o){this.cells[r].push(o)},ir.prototype.query=function(e,t,n,i,r){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=i&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,n,i,this._queryCell,a,{},r),a},ir.prototype._queryCell=function(e,t,n,i,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var f=4*d;(a?a(u[f+0],u[f+1],u[f+2],u[f+3]):e<=u[f+2]&&t<=u[f+3]&&n>=u[f+0]&&i>=u[f+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},ir.prototype._forEachCell=function(e,t,n,i,r,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i),d=l;d<=u;d++)for(var f=c;f<=h;f++){var p=this.d*f+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(f),this._convertFromCellCoord(d+1),this._convertFromCellCoord(f+1)))&&r.call(this,e,t,n,i,p,o,s,a))return}},ir.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ir.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ir.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(t+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];r[3+s]=o,r.set(a,o),o+=a.length}return r[3+e.length]=o,r.set(this.keys,o),r[3+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};const{ImageData:rr,ImageBitmap:or}=s,sr={};function ar(e,t,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),sr[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}ar("Object",Object),nr.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},nr.deserialize=function(e){return new nr(e.buffer)},ar("Grid",nr),ar("Color",ut),ar("Error",Error),ar("ResolvedImage",pt),ar("StylePropertyFunction",pi),ar("StyleExpression",li,{omit:["_evaluator"]}),ar("ZoomDependentExpression",di),ar("ZoomConstantExpression",hi),ar("CompoundExpression",Pt,{omit:["_evaluate"]});for(const e in Gn)Gn[e]._classRegistryKey||ar(`Expression_${e}`,Gn[e]);function lr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function cr(e){return or&&e instanceof or}function ur(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(lr(e)||cr(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.push(n.buffer),n}if(e instanceof rr)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push(ur(i,t));return n}if("object"==typeof e){const n=e.constructor,i=n._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class");const r=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const n in e){if(!e.hasOwnProperty(n))continue;if(sr[i].omit.indexOf(n)>=0)continue;const o=e[n];r[n]=sr[i].shallow.indexOf(n)>=0?o:ur(o,t)}e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function hr(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||lr(e)||cr(e)||ArrayBuffer.isView(e)||e instanceof rr)return e;if(Array.isArray(e))return e.map(hr);if("object"==typeof e){const t=e.$name||"Object",{klass:n}=sr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const n of Object.keys(e)){if("$name"===n)continue;const r=e[n];i[n]=sr[t].shallow.indexOf(n)>=0?r:hr(r)}return i}throw new Error("can't deserialize object of type "+typeof e)}class dr{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const fr=e=>e>=1536&&e<=1791,pr=e=>e>=1872&&e<=1919,Ar=e=>e>=2208&&e<=2303,mr=e=>e>=11904&&e<=12031,gr=e=>e>=12032&&e<=12255,yr=e=>e>=12272&&e<=12287,_r=e=>e>=12288&&e<=12351,vr=e=>e>=12352&&e<=12447,br=e=>e>=12448&&e<=12543,xr=e=>e>=12544&&e<=12591,wr=e=>e>=12704&&e<=12735,Er=e=>e>=12736&&e<=12783,Sr=e=>e>=12784&&e<=12799,Tr=e=>e>=12800&&e<=13055,kr=e=>e>=13056&&e<=13311,Cr=e=>e>=13312&&e<=19903,Pr=e=>e>=19968&&e<=40959,Mr=e=>e>=40960&&e<=42127,Ir=e=>e>=42128&&e<=42191,Lr=e=>e>=44032&&e<=55215,Rr=e=>e>=63744&&e<=64255,zr=e=>e>=64336&&e<=65023,Dr=e=>e>=65040&&e<=65055,Or=e=>e>=65072&&e<=65103,Br=e=>e>=65104&&e<=65135,Fr=e=>e>=65136&&e<=65279,Nr=e=>e>=65280&&e<=65519;function Ur(e){for(const t of e)if(Gr(t.charCodeAt(0)))return!0;return!1}function jr(e){for(const t of e)if(!Vr(t.charCodeAt(0)))return!1;return!0}function Vr(e){return!(fr(e)||pr(e)||Ar(e)||zr(e)||Fr(e))}function Gr(e){return!(746!==e&&747!==e&&(e<4352||!(wr(e)||xr(e)||Or(e)&&!(e>=65097&&e<=65103)||Rr(e)||kr(e)||mr(e)||Er(e)||!(!_r(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Cr(e)||Pr(e)||Tr(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||Lr(e)||vr(e)||yr(e)||(e=>e>=12688&&e<=12703)(e)||gr(e)||Sr(e)||br(e)&&12540!==e||!(!Nr(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Br(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||Dr(e)||(e=>e>=19904&&e<=19967)(e)||Mr(e)||Ir(e))))}function Wr(e){return!(Gr(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||_r(e)||br(e)||(e=>e>=57344&&e<=63743)(e)||Or(e)||Br(e)||Nr(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function $r(e){return e>=1424&&e<=2303||zr(e)||Fr(e)}function qr(e,t){return!(!t&&$r(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(e=>e>=6016&&e<=6143)(e))}function Zr(e){for(const t of e)if($r(t.charCodeAt(0)))return!0;return!1}const Hr="deferred",Qr="loading",Xr="loaded";let Yr=null,Kr="unavailable",Jr=null;const eo=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Kr="error"),Yr&&Yr(e)};function to(){no.fire(new De("pluginStateChange",{pluginStatus:Kr,pluginURL:Jr}))}const no=new Be,io=function(){return Kr},ro=function(){if(Kr!==Hr||!Jr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Kr=Qr,to(),Jr&&Se({url:Jr},(e=>{e?eo(e):(Kr=Xr,to())}))},oo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Kr===Xr||null!=oo.applyArabicShaping,isLoading:()=>Kr===Qr,setState(e){Kr=e.pluginStatus,Jr=e.pluginURL},isParsed:()=>null!=oo.applyArabicShaping&&null!=oo.processBidirectionalText&&null!=oo.processStyledBidirectionalText,getPluginURL:()=>Jr};class so{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dr,this.transition={})}isSupportedScript(e){return function(e,t){for(const n of e)if(!qr(n.charCodeAt(0),t))return!1;return!0}(e,oo.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class ao{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(ei(e))return new pi(e,t);if(ci(e)){const n=fi(e,t);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=ut.parse(e)),{kind:"constant",evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class lo{constructor(e){this.property=e,this.value=new ao(e,void 0)}transitioned(e,t){return new uo(this.property,this.value,t,_({},e.transition,this.transition),e.now)}untransitioned(){return new uo(this.property,this.value,null,{},0)}}class co{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return P(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new lo(this._values[e].property)),this._values[e].value=new ao(this._values[e].property,null===t?void 0:P(t))}getTransition(e){return P(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new lo(this._values[e].property)),this._values[e].transition=P(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const n=new ho(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new ho(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class uo{constructor(e,t,n,i,r){const o=i.delay||0,s=i.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+s,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),r,d(s))}}return r}}class ho{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Ao(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return P(this._values[e].value)}setValue(e,t){this._values[e]=new ao(this._values[e].property,null===t?void 0:P(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Ao(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class po{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Ao{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class mo{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=rn[this.specification.type];return i?i(e,t,n):e}}class go{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new po(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new po(this,{kind:"constant",value:void 0},e.parameters);const i=rn[this.specification.type];return i?new po(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,r,o){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,o)}}class yo extends go{possiblyEvaluate(e,t,n,i){if(void 0===e.value)return new po(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i),o="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,t);return new po(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const n=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new po(this,{kind:"constant",value:n},t)}return new po(this,e.expression,t)}evaluate(e,t,n,i,r,o){if("source"===e.kind){const s=e.evaluate(t,n,i,r,o);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,i),e.evaluate({zoom:Math.floor(t.zoom)},n,i),e.evaluate({zoom:Math.floor(t.zoom)+1},n,i),t):e.value}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t,other:n}:{from:n,to:t,other:e}}interpolate(e){return e}}class _o{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){if(void 0!==e.value){if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i);return this._calculate(r,r,r,t)}return this._calculate(e.expression.evaluate(new so(Math.floor(t.zoom-1),t)),e.expression.evaluate(new so(Math.floor(t.zoom),t)),e.expression.evaluate(new so(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class vo{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class bo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const n=e[t];n.specification.overridable&&this.overridableProperties.push(t);const i=this.defaultPropertyValues[t]=new ao(n,void 0),r=this.defaultTransitionablePropertyValues[t]=new lo(n);this.defaultTransitioningPropertyValues[t]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=i.possiblyEvaluate({})}}}function xo(e,t){return 256*(e=A(Math.floor(e),0,255))+A(Math.floor(t),0,255)}ar("DataDrivenProperty",go),ar("DataConstantProperty",mo),ar("CrossFadedDataDrivenProperty",yo),ar("CrossFadedProperty",_o),ar("ColorRampProperty",vo);const wo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Eo{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class So{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function To(e,t=1){let n=0,i=0;return{members:e.map((e=>{const r=wo[e.type].BYTES_PER_ELEMENT,o=n=ko(n,Math.max(t,r)),s=e.components||1;return i=Math.max(i,r),n+=r*s,{name:e.name,type:e.type,components:s,offset:o}})),size:ko(n,Math.max(i,t)),alignment:t}}function ko(e,t){return Math.ceil(e/t)*t}class Co extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}Co.prototype.bytesPerElement=4,ar("StructArrayLayout2i4",Co);class Po extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,e}}Po.prototype.bytesPerElement=8,ar("StructArrayLayout4i8",Po);class Mo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}Mo.prototype.bytesPerElement=12,ar("StructArrayLayout2i4ub1f12",Mo);class Io extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}Io.prototype.bytesPerElement=12,ar("StructArrayLayout3f12",Io);class Lo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,i,r,o,s,a,l,c)}emplace(e,t,n,i,r,o,s,a,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}Lo.prototype.bytesPerElement=20,ar("StructArrayLayout10ui20",Lo);class Ro extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,i,r,o,s,a)}emplace(e,t,n,i,r,o,s,a,l){const c=8*e;return this.uint16[c+0]=t,this.uint16[c+1]=n,this.uint16[c+2]=i,this.uint16[c+3]=r,this.uint16[c+4]=o,this.uint16[c+5]=s,this.uint16[c+6]=a,this.uint16[c+7]=l,e}}Ro.prototype.bytesPerElement=16,ar("StructArrayLayout8ui16",Ro);class zo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m){const g=16*e;return this.int16[g+0]=t,this.int16[g+1]=n,this.int16[g+2]=i,this.int16[g+3]=r,this.uint16[g+4]=o,this.uint16[g+5]=s,this.uint16[g+6]=a,this.uint16[g+7]=l,this.int16[g+8]=c,this.int16[g+9]=u,this.int16[g+10]=h,this.int16[g+11]=d,this.int16[g+12]=f,this.int16[g+13]=p,this.int16[g+14]=A,this.int16[g+15]=m,e}}zo.prototype.bytesPerElement=32,ar("StructArrayLayout4i4ui4i4i32",zo);class Do extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Do.prototype.bytesPerElement=4,ar("StructArrayLayout1ul4",Do);class Oo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,i,r,o,s,a,l,c,u,h,d)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f){const p=20*e,A=10*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.int16[p+4]=o,this.float32[A+3]=s,this.float32[A+4]=a,this.float32[A+5]=l,this.float32[A+6]=c,this.int16[p+14]=u,this.uint32[A+8]=h,this.uint16[p+18]=d,this.uint16[p+19]=f,e}}Oo.prototype.bytesPerElement=40,ar("StructArrayLayout5i4f1i1ul2ui40",Oo);class Bo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,r,o,s)}emplace(e,t,n,i,r,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}Bo.prototype.bytesPerElement=16,ar("StructArrayLayout3i2i2i16",Bo);class Fo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.int16[a+6]=r,this.int16[a+7]=o,e}}Fo.prototype.bytesPerElement=16,ar("StructArrayLayout2f1f2i16",Fo);class No extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[s+1]=i,this.float32[s+2]=r,e}}No.prototype.bytesPerElement=12,ar("StructArrayLayout2ub2f12",No);class Uo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}Uo.prototype.bytesPerElement=6,ar("StructArrayLayout3ui6",Uo);class jo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v,b){const x=30*e,w=15*e,E=60*e;return this.int16[x+0]=t,this.int16[x+1]=n,this.int16[x+2]=i,this.float32[w+2]=r,this.float32[w+3]=o,this.uint16[x+8]=s,this.uint16[x+9]=a,this.uint32[w+5]=l,this.uint32[w+6]=c,this.uint32[w+7]=u,this.uint16[x+16]=h,this.uint16[x+17]=d,this.uint16[x+18]=f,this.float32[w+10]=p,this.float32[w+11]=A,this.uint8[E+48]=m,this.uint8[E+49]=g,this.uint8[E+50]=y,this.uint32[w+13]=_,this.int16[x+28]=v,this.uint8[E+58]=b,e}}jo.prototype.bytesPerElement=60,ar("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",jo);class Vo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v,b,x,w,E,S,T,k,C,P){const M=this.length;return this.resize(M+1),this.emplace(M,e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v,b,x,w,E,S,T,k,C,P)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v,b,x,w,E,S,T,k,C,P,M){const I=38*e,L=19*e;return this.int16[I+0]=t,this.int16[I+1]=n,this.int16[I+2]=i,this.float32[L+2]=r,this.float32[L+3]=o,this.int16[I+8]=s,this.int16[I+9]=a,this.int16[I+10]=l,this.int16[I+11]=c,this.int16[I+12]=u,this.int16[I+13]=h,this.uint16[I+14]=d,this.uint16[I+15]=f,this.uint16[I+16]=p,this.uint16[I+17]=A,this.uint16[I+18]=m,this.uint16[I+19]=g,this.uint16[I+20]=y,this.uint16[I+21]=_,this.uint16[I+22]=v,this.uint16[I+23]=b,this.uint16[I+24]=x,this.uint16[I+25]=w,this.uint16[I+26]=E,this.uint16[I+27]=S,this.uint16[I+28]=T,this.uint32[L+15]=k,this.float32[L+16]=C,this.float32[L+17]=P,this.float32[L+18]=M,e}}Vo.prototype.bytesPerElement=76,ar("StructArrayLayout3i2f6i15ui1ul3f76",Vo);class Go extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Go.prototype.bytesPerElement=4,ar("StructArrayLayout1f4",Go);class Wo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}Wo.prototype.bytesPerElement=6,ar("StructArrayLayout3i6",Wo);class $o extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=n,this.uint16[o+3]=i,this.uint16[o+4]=r,e}}$o.prototype.bytesPerElement=12,ar("StructArrayLayout1ul3ui12",$o);class qo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}qo.prototype.bytesPerElement=4,ar("StructArrayLayout2ui4",qo);class Zo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Zo.prototype.bytesPerElement=2,ar("StructArrayLayout1ui2",Zo);class Ho extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.float32[s+3]=r,this.float32[s+4]=o,e}}Ho.prototype.bytesPerElement=20,ar("StructArrayLayout5f20",Ho);class Qo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}Qo.prototype.bytesPerElement=8,ar("StructArrayLayout2f8",Qo);class Xo extends So{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,e}}Xo.prototype.bytesPerElement=16,ar("StructArrayLayout4f16",Xo);class Yo extends Eo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Yo.prototype.size=40;class Ko extends Oo{get(e){return new Yo(this,e)}}ar("CollisionBoxArray",Ko);class Jo extends Eo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Jo.prototype.size=60;class es extends jo{get(e){return new Jo(this,e)}}ar("PlacedSymbolArray",es);class ts extends Eo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ts.prototype.size=76;class ns extends Vo{get(e){return new ts(this,e)}}ar("SymbolInstanceArray",ns);class is extends Go{getoffsetX(e){return this.float32[1*e+0]}}ar("GlyphOffsetArray",is);class rs extends Wo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ar("SymbolLineVertexArray",rs);class os extends Eo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}os.prototype.size=12;class ss extends $o{get(e){return new os(this,e)}}ar("FeatureIndexArray",ss);class as extends Eo{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}as.prototype.size=4;class ls extends qo{get(e){return new as(this,e)}}ar("FillExtrusionCentroidArray",ls);const cs=To([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),us=To([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var hs=lt((function(e){e.exports=function(e,t){var n,i,r,o,s,a,l,c;for(i=e.length-(n=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}})),ds=lt((function(e){e.exports=function(e,t){for(var n,i=e.length,r=t^i,o=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}})),fs=hs,ps=ds;fs.murmur3=hs,fs.murmur2=ps;class As{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(ms(e)),this.positions.push(t,n,i)}getPositions(e){const t=ms(e);let n=0,i=this.ids.length-1;for(;n<i;){const e=n+i>>1;this.ids[e]>=t?i=e:n=e+1}const r=[];for(;this.ids[n]===t;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return gs(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(e){const t=new As;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function ms(e){const t=+e;return!isNaN(t)&&t<=a?t:fs(String(e))}function gs(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let o=n-1,s=i+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;ys(e,o,s),ys(t,3*o,3*s),ys(t,3*o+1,3*s+1),ys(t,3*o+2,3*s+2)}s-n<i-s?(gs(e,t,n,s),n=s+1):(gs(e,t,s+1,i),i=s)}}function ys(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}ar("FeaturePositionMap",As);class _s{constructor(e,t){this.gl=e.gl,this.location=t}}class vs extends _s{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class bs extends _s{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class xs extends _s{constructor(e,t){super(e,t),this.current=ut.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ws=new Float32Array(16),Es=new Float32Array(9);function Ss(e){return[xo(255*e.r,255*e.g),xo(255*e.b,255*e.a)]}class Ts{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return"color"===this.type?new xs(e,t):new vs(e,t)}}class ks{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,n,i){const r="u_pattern_to"===i||"u_dash_to"===i?this.patternTo:"u_pattern_from"===i||"u_dash_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&e.set(r)}getBinding(e,t,n){return"u_pattern_from"===n||"u_pattern_to"===n||"u_dash_from"===n||"u_dash_to"===n?new bs(e,t):new vs(e,t)}}class Cs{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r){const o=this.paintVertexArray.length,s=this.expression.evaluate(new so(0),t,{},i,[],r);this.paintVertexArray.resize(e),this._setPaintValue(o,e,s)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(e,t,r)}_setPaintValue(e,t,n){if("color"===this.type){const i=Ss(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ps{constructor(e,t,n,i,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,r){const o=this.expression.evaluate(new so(this.zoom),t,{},i,[],r),s=this.expression.evaluate(new so(this.zoom+1),t,{},i,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(a,e,o,s)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),o=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(e,t,r,o)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=Ss(n),o=Ss(i);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,i=A(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(i)}getBinding(e,t,n){return new vs(e,t)}}class Ms{constructor(e,t,n,i,r,o,s){this.expression=e,this.type=n,this.useIntegerZoom=i,this.zoom=r,this.layerId=s,this.paintVertexAttributes=("array"===n?us:cs).members;for(let e=0;e<t.length;++e);this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o}populatePaintArray(e,t,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(e,t,n,i){if(!i||!n)return;const{min:r,mid:o,max:s}=n,a=i[r],l=i[o],c=i[s];if(a&&l&&c)for(let n=e;n<t;n++)this._setPaintValue(this.zoomInPaintVertexArray,n,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,n,l,c)}_setPaintValue(e,t,n,i){e.emplace(t,n.tl[0],n.tl[1],n.br[0],n.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],n.pixelRatio,i.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Is{constructor(e,t,n=(()=>!0)){this.binders={},this._buffers=[];const i=[];for(const r in e.paint._values){if(!n(r))continue;const o=e.paint.get(r);if(!(o instanceof po&&Xn(o.property.specification)))continue;const s=zs(r,e.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,d="line-dasharray"===String(r)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||h){const n=Bs(r,l,"source");this.binders[r]=h?new Ms(a,s,l,c,t,n,e.id):new Cs(a,s,l,n),i.push(`/a_${r}`)}else{const e=Bs(r,l,"composite");this.binders[r]=new Ps(a,s,l,c,t,e),i.push(`/z_${r}`)}else this.binders[r]=h?new ks(a.value,s):new Ts(a.value,s,l),i.push(`/u_${r}`)}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Cs||t instanceof Ps?t.maxValue:0}populatePaintArrays(e,t,n,i,r){for(const o in this.binders){const s=this.binders[o];(s instanceof Cs||s instanceof Ps||s instanceof Ms)&&s.populatePaintArray(e,t,n,i,r)}}setConstantPatternPositions(e,t){for(const n in this.binders){const i=this.binders[n];i instanceof ks&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,i,r){let o=!1;for(const s in e){const a=t.getPositions(s);for(const t of a){const a=n.feature(t.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof Cs||l instanceof Ps||l instanceof Ms)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(t.start,t.end,a,e[s],r),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Ts||n instanceof ks)&&e.push(...n.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Cs||n instanceof Ps||n instanceof Ms)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Ts||n instanceof ks||n instanceof Ps)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Ts||r instanceof ks||r instanceof Ps)for(const o of r.uniformNames)if(t[o]){const s=r.getBinding(e,t[o],o);n.push({name:o,property:i,binding:s})}}return n}setUniforms(e,t,n,i){for(const{name:e,property:r,binding:o}of t)this.binders[r].setUniform(o,i,n.get(r),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof Ms){const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(n instanceof Cs||n instanceof Ps)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Cs||n instanceof Ps||n instanceof Ms)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Cs||t instanceof Ps||t instanceof Ms)&&t.destroy()}}}class Ls{constructor(e,t,n=(()=>!0)){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Is(i,t,n);this.needsUpload=!1,this._featureMap=new As,this._bufferOffset=0}populatePaintArrays(e,t,n,i,r,o){for(const n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(e,t,i,r,o);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(e,this._featureMap,t,r,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Rs={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function zs(e,t){return Rs[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Ds={"line-pattern":{source:Lo,composite:Lo},"fill-pattern":{source:Lo,composite:Lo},"fill-extrusion-pattern":{source:Lo,composite:Lo},"line-dasharray":{source:Ro,composite:Ro}},Os={color:{source:Qo,composite:Xo},number:{source:Go,composite:Qo}};function Bs(e,t,n){const i=Ds[e];return i&&i[n]||Os[t][n]}ar("ConstantBinder",Ts),ar("CrossFadedConstantBinder",ks),ar("SourceExpressionBinder",Cs),ar("CrossFadedCompositeBinder",Ms),ar("CompositeExpressionBinder",Ps),ar("ProgramConfiguration",Is,{omit:["_buffers"]}),ar("ProgramConfigurationSet",Ls);const Fs="-transition";class Ns extends Be{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new fo(t.layout)),t.paint)){this._transitionablePaint=new co(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ao(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){null!=t&&this._validate(er,`layers.${this.id}.layout.${e}`,e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return T(e,Fs)?this._transitionablePaint.getTransition(e.slice(0,-Fs.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(null!=t&&this._validate(Ji,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(T(e,Fs))return this._transitionablePaint.setTransition(e.slice(0,-Fs.length),t||void 0),!1;{const n=this._transitionablePaint._values[e],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(e,o,s)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),C(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,n,i,r={}){return(!r||!1!==r.validate)&&tr(this,e.call(Xi,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof po&&Xn(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const Us=To([{name:"a_pos",components:2,type:"Int16"}],4),{members:js}=Us;class Vs{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>Vs.MAX_VERTEX_ARRAY_LENGTH&&I(`Max vertices per segment is ${Vs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!r||r.vertexLength+e>Vs.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new Vs([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}Vs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ar("SegmentVector",Vs);var Gs=8192;const Ws=Math.pow(2,14)-1,$s=-Ws-1;function qs(e){const t=Gs/e.extent,n=e.loadGeometry();for(let e=0;e<n.length;e++){const i=n[e];for(let e=0;e<i.length;e++){const n=i[e],r=Math.round(n.x*t),o=Math.round(n.y*t);n.x=A(r,$s,Ws),n.y=A(o,$s,Ws),(r<n.x||r>n.x+1||o<n.y||o>n.y+1)&&I("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Zs(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?qs(e):[]}}function Hs(e,t,n,i,r){e.emplaceBack(2*t+(i+1)/2,2*n+(r+1)/2)}class Qs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Co,this.indexArray=new Uo,this.segments=new Vs,this.programConfigurations=new Ls(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){const i=this.layers[0],r=[];let o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));for(const{feature:t,id:i,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Zs(t,e);if(!this.layers[0]._featureFilter.filter(new so(this.zoom),l,n))continue;const c=o?o.evaluate(l,{},n):void 0,u={id:i,properties:t.properties,type:t.type,sourceLayerIndex:a,index:s,geometry:e?l.geometry:qs(t),patterns:{},sortKey:c};r.push(u)}o&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of r){const{geometry:r,index:o,sourceLayerIndex:s}=i,a=e[o].feature;this.addFeature(i,r,o,n),t.featureIndex.insert(a,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,js),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i){for(const n of t)for(const t of n){const n=t.x,i=t.y;if(n<0||n>=Gs||i<0||i>=Gs)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),o=r.vertexLength;Hs(this.layoutVertexArray,n,i,-1,-1),Hs(this.layoutVertexArray,n,i,1,-1),Hs(this.layoutVertexArray,n,i,1,1),Hs(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i)}}function Xs(e,t){for(let n=0;n<e.length;n++)if(oa(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(oa(e,t[n]))return!0;return!!ea(e,t)}function Ys(e,t,n){return!!oa(e,t)||!!na(t,e,n)}function Ks(e,t){if(1===e.length)return ra(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(oa(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(ra(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(ea(e,t[n]))return!0;return!1}function Js(e,t,n){if(e.length>1){if(ea(e,t))return!0;for(let i=0;i<t.length;i++)if(na(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(na(e[i],t,n))return!0;return!1}function ea(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(ta(i,r,t[e],t[e+1]))return!0}return!1}function ta(e,t,n,i){return L(e,n,i)!==L(t,n,i)&&L(e,t,n)!==L(e,t,i)}function na(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let n=1;n<t.length;n++)if(ia(e,t[n-1],t[n])<i)return!0;return!1}function ia(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function ra(e,t){let n,i,r,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)i=n[e],r=n[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function oa(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const o=e[i],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function sa(e,t,n,i,o){for(const r of e)if(t<=r.x&&n<=r.y&&i>=r.x&&o>=r.y)return!0;const s=[new r(t,n),new r(t,o),new r(i,o),new r(i,n)];if(e.length>2)for(const t of s)if(oa(e,t))return!0;for(let t=0;t<e.length-1;t++)if(aa(e[t],e[t+1],s))return!0;return!1}function aa(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const o=L(e,t,n[0]);return o!==L(e,t,n[1])||o!==L(e,t,n[2])||o!==L(e,t,n[3])}function la(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function ca(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ua(e,t,n,i,o){if(!t[0]&&!t[1])return e;const s=r.convert(t)._mult(o);"viewport"===n&&s._rotate(-i);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(s));return a}function ha(e,t,n,i){const o=r.convert(e)._mult(i);return"viewport"===t&&o._rotate(-n),o}ar("CircleBucket",Qs,{omit:["layers"]});const da=new bo({"circle-sort-key":new go(Fe.layout_circle["circle-sort-key"])});var fa={paint:new bo({"circle-radius":new go(Fe.paint_circle["circle-radius"]),"circle-color":new go(Fe.paint_circle["circle-color"]),"circle-blur":new go(Fe.paint_circle["circle-blur"]),"circle-opacity":new go(Fe.paint_circle["circle-opacity"]),"circle-translate":new mo(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new mo(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mo(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mo(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new go(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new go(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new go(Fe.paint_circle["circle-stroke-opacity"])}),layout:da},pa="undefined"!=typeof Float32Array?Float32Array:Array;function Aa(){var e=new pa(9);return pa!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ma(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ga(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],A=t[12],m=t[13],g=t[14],y=t[15],_=n[0],v=n[1],b=n[2],x=n[3];return e[0]=_*i+v*a+b*h+x*A,e[1]=_*r+v*l+b*d+x*m,e[2]=_*o+v*c+b*f+x*g,e[3]=_*s+v*u+b*p+x*y,e[4]=(_=n[4])*i+(v=n[5])*a+(b=n[6])*h+(x=n[7])*A,e[5]=_*r+v*l+b*d+x*m,e[6]=_*o+v*c+b*f+x*g,e[7]=_*s+v*u+b*p+x*y,e[8]=(_=n[8])*i+(v=n[9])*a+(b=n[10])*h+(x=n[11])*A,e[9]=_*r+v*l+b*d+x*m,e[10]=_*o+v*c+b*f+x*g,e[11]=_*s+v*u+b*p+x*y,e[12]=(_=n[12])*i+(v=n[13])*a+(b=n[14])*h+(x=n[15])*A,e[13]=_*r+v*l+b*d+x*m,e[14]=_*o+v*c+b*f+x*g,e[15]=_*s+v*u+b*p+x*y,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ya=ga;function _a(){var e=new pa(3);return pa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function va(e){return Math.hypot(e[0],e[1],e[2])}function ba(e,t,n){var i=new pa(3);return i[0]=e,i[1]=t,i[2]=n,i}function xa(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function wa(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Ea(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function Sa(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Ta(e,t,n){var i=n[0],r=n[1],o=n[2],s=t[0],a=t[1],l=t[2],c=r*l-o*a,u=o*s-i*l,h=i*a-r*s,d=r*h-o*u,f=o*c-i*h,p=i*u-r*c,A=2*n[3];return u*=A,h*=A,f*=2,p*=2,e[0]=s+(c*=A)+(d*=2),e[1]=a+u+f,e[2]=l+h+p,e}var ka,Ca=xa,Pa=wa,Ma=va;function Ia(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}function La(){var e=new pa(4);return pa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ra(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function za(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-i*a,e}function Da(e,t,n,i,r,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);for(const c of t)for(const t of c){const c=t.add(a),u=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(c.x,c.y,!0):0,h=o?c:Oa(c,u,i),d=o?e.tilespaceRays.map((e=>Na(e,u))):e.queryGeometry.screenGeometry,f=Ia([],[t.x,t.y,u,1],i);if(!s&&o?l*=f[3]/n.cameraToCenterDistance:s&&!o&&(l*=n.cameraToCenterDistance/f[3]),Ys(d,h,l))return!0}return!1}function Oa(e,t,n){const i=Ia([],[e.x,e.y,t,1],n);return new r(i[0]/i[3],i[1]/i[3])}_a(),ka=new pa(4),pa!=Float32Array&&(ka[0]=0,ka[1]=0,ka[2]=0,ka[3]=0),_a(),ba(1,0,0),ba(0,1,0),La(),La(),Aa();const Ba=ba(0,0,0),Fa=ba(0,0,1);function Na(e,t){const n=_a();return Ba[2]=t,e.intersectsPlane(Ba,Fa,n),new r(n[0],n[1])}class Ua extends Qs{}function ja(e,{width:t,height:n},i,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*n*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*n*i);return e.width=t,e.height=n,e.data=r,e}function Va(e,{width:t,height:n},i){if(t===e.width&&n===e.height)return;const r=ja({},{width:t,height:n},i);Ga(e,r,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,n)},i),e.width=t,e.height=n,e.data=r.data}function Ga(e,t,n,i,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<r.height;l++){const c=((n.y+l)*e.width+n.x)*o,u=((i.y+l)*t.width+i.x)*o;for(let e=0;e<r.width*o;e++)a[u+e]=s[c+e]}return t}ar("HeatmapBucket",Ua,{omit:["layers"]});class Wa{constructor(e,t){ja(this,e,1,t)}resize(e){Va(this,e,1)}clone(){return new Wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){Ga(e,t,n,i,r,1)}}class $a{constructor(e,t){ja(this,e,4,t)}resize(e){Va(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new $a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){Ga(e,t,n,i,r,4)}}ar("AlphaImage",Wa),ar("RGBAImage",$a);var qa={paint:new bo({"heatmap-radius":new go(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new go(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mo(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vo(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mo(Fe.paint_heatmap["heatmap-opacity"])})};function Za(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new $a({width:n,height:i}),o=(n,i,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);r.data[n+i+0]=Math.floor(255*s.r/s.a),r.data[n+i+1]=Math.floor(255*s.g/s.a),r.data[n+i+2]=Math.floor(255*s.b/s.a),r.data[n+i+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,r=0;t<i;++t,r+=4*n)for(let i=0,s=0;i<n;i++,s+=4){const a=i/(n-1),{start:l,end:c}=e.clips[t];o(r,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<n;e++,t+=4)o(0,t,e/(n-1));return r}var Ha={paint:new bo({"hillshade-illumination-direction":new mo(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mo(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mo(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mo(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mo(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mo(Fe.paint_hillshade["hillshade-accent-color"])})};const Qa=To([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xa}=Qa;var Ya=Ja,Ka=Ja;function Ja(e,t,n){n=n||2;var i,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=el(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(u&&(d=function(e,t,n,i){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=el(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),a.push(hl(s));for(a.sort(al),r=0;r<a.length;r++)ll(a[r],n),n=tl(n,n.next);return n}(e,t,d,n)),e.length>80*n){i=o=e[0],r=s=e[1];for(var p=n;p<h;p+=n)(a=e[p])<i&&(i=a),(l=e[p+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-i,s-r))?1/c:0}return nl(d,f,n,i,r,c),f}function el(e,t,n,i,r){var o,s;if(r===El(e,t,n,i)>0)for(o=t;o<n;o+=i)s=bl(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=bl(o,e[o],e[o+1],s);return s&&Al(s,s.next)&&(xl(s),s=s.next),s}function tl(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Al(i,i.next)&&0!==pl(i.prev,i,i.next))i=i.next;else{if(xl(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function nl(e,t,n,i,r,o,s){if(e){!s&&o&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=ul(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?rl(e,i,r,o):il(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),xl(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?nl(e=ol(tl(e),t,n),t,n,i,r,o,2):2===s&&sl(e,t,n,i,r,o):nl(tl(e),t,n,i,r,o,1);break}}}function il(e){var t=e.prev,n=e,i=e.next;if(pl(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(dl(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&pl(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function rl(e,t,n,i){var r=e.prev,o=e,s=e.next;if(pl(r,o,s)>=0)return!1;for(var a=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,l=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,c=ul(r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,t,n,i),u=ul(a,l,t,n,i),h=e.prevZ,d=e.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==e.prev&&h!==e.next&&dl(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&pl(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==e.prev&&d!==e.next&&dl(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&pl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==e.prev&&h!==e.next&&dl(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&pl(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==e.prev&&d!==e.next&&dl(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&pl(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function ol(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!Al(r,o)&&ml(r,i,i.next,o)&&_l(r,o)&&_l(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),xl(i),xl(i.next),i=e=o),i=i.next}while(i!==e);return tl(i)}function sl(e,t,n,i,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&fl(s,a)){var l=vl(s,a);return s=tl(s,s.next),l=tl(l,l.next),nl(s,t,n,i,r,o),void nl(l,t,n,i,r,o)}a=a.next}s=s.next}while(s!==e)}function al(e,t){return e.x-t.x}function ll(e,t){if(t=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s){if(s=a,a===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===s)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&dl(o<h?r:s,o,u,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),_l(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&cl(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t)){var n=vl(t,e);tl(t,t.next),tl(n,n.next)}}function cl(e,t){return pl(e.prev,e,t.prev)<0&&pl(t.next,e,e.next)<0}function ul(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function hl(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function dl(e,t,n,i,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function fl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ml(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(_l(e,t)&&_l(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(pl(e.prev,e,t.prev)||pl(e,t.prev,t))||Al(e,t)&&pl(e.prev,e,e.next)>0&&pl(t.prev,t,t.next)>0)}function pl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Al(e,t){return e.x===t.x&&e.y===t.y}function ml(e,t,n,i){var r=yl(pl(e,t,n)),o=yl(pl(e,t,i)),s=yl(pl(n,i,e)),a=yl(pl(n,i,t));return r!==o&&s!==a||!(0!==r||!gl(e,n,t))||!(0!==o||!gl(e,i,t))||!(0!==s||!gl(n,e,i))||!(0!==a||!gl(n,t,i))}function gl(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function yl(e){return e>0?1:e<0?-1:0}function _l(e,t){return pl(e.prev,e,e.next)<0?pl(e,t,e.next)>=0&&pl(e,e.prev,t)>=0:pl(e,t,e.prev)<0||pl(e,e.next,t)<0}function vl(e,t){var n=new wl(e.i,e.x,e.y),i=new wl(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function bl(e,t,n,i){var r=new wl(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function xl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function wl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function El(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}function Sl(e,t,n,i,r){Tl(e,t,n||0,i||e.length-1,r||Cl)}function Tl(e,t,n,i,r){for(;i>n;){if(i-n>600){var o=i-n+1,s=t-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Tl(e,t,Math.max(n,Math.floor(t-s*l/o+c)),Math.min(i,Math.floor(t+(o-s)*l/o+c)),r)}var u=e[t],h=n,d=i;for(kl(e,n,t),r(e[i],u)>0&&kl(e,n,i);h<d;){for(kl(e,h,d),h++,d--;r(e[h],u)<0;)h++;for(;r(e[d],u)>0;)d--}0===r(e[n],u)?kl(e,n,d):kl(e,++d,i),d<=t&&(n=d+1),t<=d&&(i=d-1)}}function kl(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function Cl(e,t){return e<t?-1:e>t?1:0}function Pl(e,t){const n=e.length;if(n<=1)return[e];const i=[];let r,o;for(let t=0;t<n;t++){const n=R(e[t]);0!==n&&(e[t].area=Math.abs(n),void 0===o&&(o=n<0),o===n<0?(r&&i.push(r),r=[e[t]]):r.push(e[t]))}if(r&&i.push(r),t>1)for(let e=0;e<i.length;e++)i[e].length<=t||(Sl(i[e],t,1,i[e].length-1,Ml),i[e]=i[e].slice(0,t));return i}function Ml(e,t){return t.area-e.area}function Il(e,t,n){const i=n.patternDependencies;let r=!1;for(const n of t){const t=n.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const o=t.constantOr(null);o&&(r=!0,i[o.to]=!0,i[o.from]=!0)}return r}function Ll(e,t,n,i,r){const o=r.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i-1},n,{},r.availableImages),a=t.evaluate({zoom:i},n,{},r.availableImages),l=t.evaluate({zoom:i+1},n,{},r.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[e]=!0,o[a]=!0,o[l]=!0,n.patterns[s.id]={min:e,mid:a,max:l}}}return n}Ja.deviation=function(e,t,n,i){var r=t&&t.length,o=Math.abs(El(e,0,r?t[0]*n:e.length,n));if(r)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(El(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n));var l=0;for(s=0;s<i.length;s+=3){var c=i[s]*n,u=i[s+1]*n,h=i[s+2]*n;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Ja.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&n.holes.push(i+=e[r-1].length)}return n},Ya.default=Ka;class Rl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Co,this.indexArray=new Uo,this.indexArray2=new qo,this.programConfigurations=new Ls(e.layers,e.zoom),this.segments=new Vs,this.segments2=new Vs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Il("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),r=[];for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Zs(o,e);if(!this.layers[0]._featureFilter.filter(new so(this.zoom),c,n))continue;const u=i?i.evaluate(c,{},n,t.availableImages):void 0,h={id:s,properties:o.properties,type:o.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:qs(o),patterns:{},sortKey:u};r.push(h)}i&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of r){const{geometry:r,index:o,sourceLayerIndex:s}=i;if(this.hasPattern){const e=Ll("fill",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,r,o,n,{});t.featureIndex.insert(e[o].feature,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xa),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,r){for(const e of Pl(t,500)){let t=0;for(const n of e)t+=n.length;const n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),i=n.vertexLength,r=[],o=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&o.push(r.length/2);const n=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),i=n.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(i+t.length-1,i),r.push(t[0].x),r.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(i+e-1,i+e),r.push(t[e].x),r.push(t[e].y);n.vertexLength+=t.length,n.primitiveLength+=t.length}const s=Ya(r,o);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(i+s[e],i+s[e+1],i+s[e+2]);n.vertexLength+=t,n.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}}ar("FillBucket",Rl,{omit:["layers","patternFeatures"]});const zl=new bo({"fill-sort-key":new go(Fe.layout_fill["fill-sort-key"])});var Dl={paint:new bo({"fill-antialias":new mo(Fe.paint_fill["fill-antialias"]),"fill-opacity":new go(Fe.paint_fill["fill-opacity"]),"fill-color":new go(Fe.paint_fill["fill-color"]),"fill-outline-color":new go(Fe.paint_fill["fill-outline-color"]),"fill-translate":new mo(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new mo(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new yo(Fe.paint_fill["fill-pattern"])}),layout:zl};const Ol=To([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Bl=To([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Fl}=Ol;var Nl=Ul;function Ul(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(jl,this,t)}function jl(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function Vl(e){for(var t,n,i=0,r=0,o=e.length,s=o-1;r<o;s=r++)i+=((n=e[s]).x-(t=e[r]).x)*(t.y+n.y);return i}Ul.types=["Unknown","Point","LineString","Polygon"],Ul.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,o=0,s=0,a=0,l=[];e.pos<n;){if(o<=0){var c=e.readVarint();i=7&c,o=c>>3}if(o--,1===i||2===i)s+=e.readSVarint(),a+=e.readSVarint(),1===i&&(t&&l.push(t),t=[]),t.push(new r(s,a));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&l.push(t),l},Ul.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,c]},Ul.prototype.toGeoJSON=function(e,t,n){var i,r,o=this.extent*Math.pow(2,n),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=Ul.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],o=0;o<t;o++){var s=Vl(e[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Gl=Wl;function Wl(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields($l,this,t),this.length=this._features.length}function $l(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}function ql(e,t,n){if(3===e){var i=new Gl(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}Wl.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Nl(this._pbf,t,this.extent,this._keys,this._values)};var Zl={VectorTile:function(e,t){this.layers=e.readFields(ql,{},t)},VectorTileFeature:Nl,VectorTileLayer:Gl};const Hl=Zl.VectorTileFeature.types,Ql=Math.pow(2,13);function Xl(e,t,n,i,r,o,s,a){e.emplaceBack((t<<1)+s,(n<<1)+o,(Math.floor(i*Ql)<<1)+r,Math.round(a))}class Yl{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(e.x,e.y),this.max=new r(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);let n=!!this.borders;const i=this.min,r=this.max;e.x<i.x?(i.x=e.x,n=!0):e.x>r.x&&(r.x=e.x,n=!0),e.y<i.y?(i.y=e.y,n=!0):e.y>r.y&&(r.y=e.y,n=!0),((0===e.x||e.x===Gs)&&e.x===t.x)!=((0===e.y||e.y===Gs)&&e.y===t.y)&&this.processBorderOverlap(e,t),n&&this.checkBorderIntersection(e,t)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,nn(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Gs!=e.x>Gs&&this.addBorderIntersection(1,nn(t.y,e.y,(Gs-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,nn(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Gs!=e.y>Gs&&this.addBorderIntersection(3,nn(t.x,e.x,(Gs-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class Kl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Po,this.centroidVertexArray=new ls,this.indexArray=new Uo,this.programConfigurations=new Ls(e.layers,e.zoom),this.segments=new Vs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,n){this.features=[],this.hasPattern=Il("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/Gs/(1<<e.z)}(n);for(const{feature:i,id:r,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,a=Zs(i,e);if(!this.layers[0]._featureFilter.filter(new so(this.zoom),a,n))continue;const l={id:r,sourceLayerIndex:s,index:o,geometry:e?a.geometry:qs(i),properties:i.properties,type:i.type,patterns:{}},c=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ll("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,o,n,{}),t.featureIndex.insert(i,l.geometry,o,s,this.index,c)}this.sortBorders()}addFeatures(e,t,n){for(const e of this.features){const{geometry:i}=e;this.addFeature(e,i,e.index,t,n)}this.sortBorders()}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fl),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Bl.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,r){const o=this.enableTerrain?new Yl:null;for(const n of Pl(t,500)){let t=0,i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===n.length||(s=n[0]).every((e=>e.x<=0))||s.every((e=>e.x>=Gs))||s.every((e=>e.y<=0))||s.every((e=>e.y>=Gs)))continue;for(let e=0;e<n.length;e++){const r=n[e];if(0===r.length)continue;t+=r.length;let s=0;o&&o.startRing(r[0]);for(let e=0;e<r.length;e++){const t=r[e];if(e>=1){const n=r[e-1];if(!Jl(t,n)){o&&o.append(t,n),i.vertexLength+4>Vs.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=t.sub(n)._perp(),r=e.x/(Math.abs(e.x)+Math.abs(e.y)),a=e.y>0?1:0,l=n.dist(t);s+l>32768&&(s=0),Xl(this.layoutVertexArray,t.x,t.y,r,a,0,0,s),Xl(this.layoutVertexArray,t.x,t.y,r,a,0,1,s),s+=l,Xl(this.layoutVertexArray,n.x,n.y,r,a,0,0,s),Xl(this.layoutVertexArray,n.x,n.y,r,a,0,1,s);const c=i.vertexLength;this.indexArray.emplaceBack(c,c+2,c+1),this.indexArray.emplaceBack(c+1,c+2,c+3),i.vertexLength+=4,i.primitiveLength+=2}}}}if(i.vertexLength+t>Vs.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==Hl[e.type])continue;const r=[],a=[],l=i.vertexLength;for(let e=0;e<n.length;e++){const t=n[e];if(0!==t.length){t!==n[0]&&a.push(r.length/2);for(let e=0;e<t.length;e++){const n=t[e];Xl(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),r.push(n.x),r.push(n.y),o&&o.currentPolyCount.top++}}}const c=Ya(r,a);for(let e=0;e<c.length;e+=3)this.indexArray.emplaceBack(l+c[e],l+c[e+2],l+c[e+1]);i.primitiveLength+=c.length/3,i.vertexLength+=t}var s;if(o&&o.polyCount.length>0){if(o.borders){o.vertexArrayOffset=this.centroidVertexArray.length;const e=o.borders,t=this.featuresOnBorder.push(o)-1;for(let n=0;n<4;n++)e[n][0]!==Number.MAX_VALUE&&this.borders[n].push(t)}this.encodeCentroid(o.borders?void 0:o.centroid(),o)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0]))}encodeCentroid(e,t,n=!0){let i,r;if(e)if(0!==e.y){const n=t.span()._mult(this.tileToMeter);i=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(n.x/10)),r=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(n.y/10))}else i=Math.ceil(7*(e.x+450)),r=0;else i=0,r=+n;let o=n?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(o++,0,r),this.centroidVertexArray.emplace(o++,i,r);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(o++,i,r)}}}function Jl(e,t){return e.x===t.x&&(e.x<0||e.x>Gs)||e.y===t.y&&(e.y<0||e.y>Gs)}ar("FillExtrusionBucket",Kl,{omit:["layers","features"]}),ar("PartMetadata",Yl);var ec={paint:new bo({"fill-extrusion-opacity":new mo(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new go(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mo(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mo(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yo(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new go(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new go(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mo(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function tc(e,t){return e.x*t.x+e.y*t.y}function nc(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=r.sub(i),l=o.sub(i),c=s.sub(i),u=tc(a,a),h=tc(a,l),d=tc(l,l),f=tc(c,a),p=tc(c,l),A=u*d-h*h,m=(d*f-h*p)/A,g=(u*p-h*f)/A,y=i.z*(1-m-g)+r.z*m+o.z*g;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function ic(e){const t=new r(e[0],e[1]);return t.z=e[2],t}function rc(e,t,n,i,r,o,s,a){const l=s*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,n){const i=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*i),s=10*(t[1]-8*r),a=e.getElevationAt(i,r,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(i,r),d=2*c+1,f=2*u+1,p=function(e,t,n,i,r){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+r,n,!0),e.getElevationAtPixel(t,n+r,!0),e.getElevationAtPixel(t+i,n+r,!0)]}(e,h.x-c,h.y-u,d,f),A=Math.abs(p[0]-p[1]),m=Math.abs(p[2]-p[3]),g=Math.abs(p[0]-p[2])+Math.abs(p[1]-p[3]),y=Math.min(.25,.5*l*(A+m)/d),_=Math.min(.25,.5*l*g/f);return a+Math.max(y*o,_*s)}(r,o,a):l;return{base:l+(0===n)?-1:n,top:c?Math.max(u+i,l+n+2):l+i}}const oc=To([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:sc}=oc,ac=To([{name:"a_packed",components:3,type:"Float32"}]),{members:lc}=ac,cc=Zl.VectorTileFeature.types,uc=Math.cos(Math.PI/180*37.5);class hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Mo,this.layoutVertexArray2=new Io,this.indexArray=new Uo,this.programConfigurations=new Ls(e.layers,e.zoom),this.segments=new Vs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Il("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),r=[];for(const{feature:t,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Zs(t,e);if(!this.layers[0]._featureFilter.filter(new so(this.zoom),l,n))continue;const c=i?i.evaluate(l,{},n):void 0,u={id:o,properties:t.properties,type:t.type,sourceLayerIndex:a,index:s,geometry:e?l.geometry:qs(t),patterns:{},sortKey:c};r.push(u)}i&&r.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:o,featureIndex:s}=t,a=this.addConstantDashes(o);for(const i of r){const{geometry:r,index:l,sourceLayerIndex:c}=i;if(a&&this.addFeatureDashes(i,o),this.hasPattern){const e=Ll("line",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,r,l,n,o.positions);s.insert(e[l].feature,r,l,c,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==r.kind)t=!0;else{const t=r.value,n=i.value;if(!n)continue;e.addDash(n.from,t),e.addDash(n.to,t),n.other&&e.addDash(n.other,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a,l,c,u,h;if("constant"===r.kind){const e=r.value;if(!e)continue;s=e.other||e.to,a=e.to,l=e.from}else s=r.evaluate({zoom:n-1},e),a=r.evaluate({zoom:n},e),l=r.evaluate({zoom:n+1},e);"constant"===o.kind?c=u=h=o.value:(c=o.evaluate({zoom:n-1},e),u=o.evaluate({zoom:n},e),h=o.evaluate({zoom:n+1},e)),t.addDash(s,c),t.addDash(a,u),t.addDash(l,h);const d=t.getKey(s,c),f=t.getKey(a,u),p=t.getKey(l,h);e.patterns[i.id]={min:d,mid:f,max:p}}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,lc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r){const o=this.layers[0].layout,s=o.get("line-join").evaluate(e,{}),a=o.get("line-cap").evaluate(e,{}),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const n of t)this.addLine(n,e,s,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}addLine(e,t,n,i,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===cc[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,f,p,A;this.e1=this.e2=-1,s&&(h=e[a-2],A=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(f=t===a-1?s?e[l+1]:void 0:e[t+1],f&&e[t].equals(f))continue;A&&(p=A),h&&(d=h),h=e[t],A=f?f.sub(h)._unit()._perp():p,p=p||A;let m=p.add(A);0===m.x&&0===m.y||m._unit();const g=p.x*A.x+p.y*A.y,y=m.x*A.x+m.y*A.y,_=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),b=y<uc&&d&&f,x=p.x*A.y-p.y*A.x>0;if(b&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,p,0,0,u),d=t}}const w=d&&f;let E=w?n:s?"butt":i;if(w&&"round"===E&&(_<o?E="miter":_<=2&&(E="fakeround")),"miter"===E&&_>r&&(E="bevel"),"bevel"===E&&(_>2&&(E="flipbevel"),_<r&&(E="miter")),d&&this.updateDistance(d,h),"miter"===E)m._mult(_),this.addCurrentVertex(h,m,0,0,u);else if("flipbevel"===E){if(_>100)m=A.mult(-1);else{const e=_*p.add(A).mag()/p.sub(A).mag();m._perp()._mult(e*(x?-1:1))}this.addCurrentVertex(h,m,0,0,u),this.addCurrentVertex(h,m.mult(-1),0,0,u)}else if("bevel"===E||"fakeround"===E){const e=-Math.sqrt(_*_-1),t=x?e:0,n=x?0:e;if(d&&this.addCurrentVertex(h,p,t,n,u),"fakeround"===E){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)))}const i=A.sub(p)._mult(n)._add(p)._unit()._mult(x?-1:1);this.addHalfVertex(h,i.x,i.y,!1,x,0,u)}}f&&this.addCurrentVertex(h,A,-t,-n,u)}else if("butt"===E)this.addCurrentVertex(h,m,0,0,u);else if("square"===E){const e=d?1:-1;d||this.addCurrentVertex(h,m,e,e,u),this.addCurrentVertex(h,m,0,0,u),d&&this.addCurrentVertex(h,m,e,e,u)}else"round"===E&&(d&&(this.addCurrentVertex(h,p,0,0,u),this.addCurrentVertex(h,p,1,1,u,!0)),f&&(this.addCurrentVertex(h,A,-1,-1,u,!0),this.addCurrentVertex(h,A,0,0,u)));if(b&&t<a-1){const e=h.dist(f);if(e>2*c){const t=h.add(f.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,A,0,0,u),h=t}}}}addCurrentVertex(e,t,n,i,r,o=!1){const s=t.y*i-t.x,a=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,r),this.addHalfVertex(e,s,a,o,!0,-i,r)}addHalfVertex({x:e,y:t},n,i,r,o,s,a){this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}ar("LineBucket",hc,{omit:["layers","patternFeatures"]});const dc=new bo({"line-cap":new go(Fe.layout_line["line-cap"]),"line-join":new go(Fe.layout_line["line-join"]),"line-miter-limit":new mo(Fe.layout_line["line-miter-limit"]),"line-round-limit":new mo(Fe.layout_line["line-round-limit"]),"line-sort-key":new go(Fe.layout_line["line-sort-key"])});var fc={paint:new bo({"line-opacity":new go(Fe.paint_line["line-opacity"]),"line-color":new go(Fe.paint_line["line-color"]),"line-translate":new mo(Fe.paint_line["line-translate"]),"line-translate-anchor":new mo(Fe.paint_line["line-translate-anchor"]),"line-width":new go(Fe.paint_line["line-width"]),"line-gap-width":new go(Fe.paint_line["line-gap-width"]),"line-offset":new go(Fe.paint_line["line-offset"]),"line-blur":new go(Fe.paint_line["line-blur"]),"line-dasharray":new yo(Fe.paint_line["line-dasharray"]),"line-pattern":new yo(Fe.paint_line["line-pattern"]),"line-gradient":new vo(Fe.paint_line["line-gradient"])}),layout:dc};const pc=new class extends go{possiblyEvaluate(e,t){return t=new so(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=_({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(fc.paint.properties["line-width"].specification);function Ac(e,t){return t>0?t+2*e:e}pc.useIntegerZoom=!0;const mc=To([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),gc=To([{name:"a_projected_pos",components:3,type:"Float32"}],4);To([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yc=To([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),_c=To([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);To([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vc=To([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bc=To([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);To([{name:"triangle",components:3,type:"Uint16"}]),To([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),To([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),To([{type:"Float32",name:"offsetX"}]),To([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var xc=24;const wc=128;function Ec(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new so(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[r],a=t[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new so(s)),maxSize:n.evaluate(new so(a)),interpolationType:i}}}function Sc(e,{uSize:t,uSizeT:n},{lowerSize:i,upperSize:r}){return"source"===e.kind?i/wc:"composite"===e.kind?nn(i/wc,r/wc,n):t}function Tc(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=e,a=r?A(xn.interpolationFactor(r,t,o,s),0,1):0;"camera"===e.kind?i=nn(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:i}}var kc=Object.freeze({__proto__:null,getSizeData:Ec,evaluateSizeForFeature:Sc,evaluateSizeForZoom:Tc,SIZE_PACK_FACTOR:wc});function Cc(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),oo.applyArabicShaping&&(e=oo.applyArabicShaping(e)),e}(e.text,t,n)})),e}const Pc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function Mc(e){return"︶"===e||"﹈"===e||"︸"===e||"﹄"===e||"﹂"===e||"︾"===e||"︼"===e||"︺"===e||"︘"===e||"﹀"===e||"︐"===e||"︓"===e||"︔"===e||"｀"===e||"￣"===e||"︑"===e||"︒"===e}function Ic(e){return"︵"===e||"﹇"===e||"︷"===e||"﹃"===e||"﹁"===e||"︽"===e||"︻"===e||"︹"===e||"︗"===e||"︿"===e}var Lc=function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-u)-1,f>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),o-=c}return(f?-1:1)*s*Math.pow(2,o-i)},Rc=function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,p=i?1:-1,A=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+f]=255&a,f+=p,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+f]=255&s,f+=p,s/=256,c-=8);e[n+f-p]|=128*A},zc=Dc;function Dc(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Dc.Varint=0,Dc.Fixed64=1,Dc.Bytes=2,Dc.Fixed32=5;var Oc=4294967296,Bc=1/Oc,Fc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Nc(e){return e.type===Dc.Bytes?e.readVarint()+e.pos:e.pos+1}function Uc(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function jc(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function Vc(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Gc(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Wc(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function $c(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function qc(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Zc(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function Hc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function Qc(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function Xc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Yc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Kc(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Jc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function eu(e,t,n){t.glyphs=[],1===e&&n.readMessage(tu,t)}function tu(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:o,left:s,top:a,advance:l}=n.readMessage(nu,{});t.glyphs.push({id:e,bitmap:new Wa({width:r+6,height:o+6},i),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function nu(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function iu(e){let t=0,n=0;for(const i of e)t+=i.w*i.h,n=Math.max(n,i.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,o=0;for(const t of e)for(let e=i.length-1;e>=0;e--){const n=i[e];if(!(t.w>n.w||t.h>n.h)){if(t.x=n.x,t.y=n.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===n.w&&t.h===n.h){const t=i.pop();e<i.length&&(i[e]=t)}else t.h===n.h?(n.x+=t.w,n.w-=t.w):t.w===n.w?(n.y+=t.h,n.h-=t.h):(i.push({x:n.x+t.w,y:n.y,w:n.w-t.w,h:t.h}),n.y+=t.h,n.h-=t.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}Dc.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,e(r,t,this),this.pos===o&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Yc(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Jc(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Yc(this.buf,this.pos)+Yc(this.buf,this.pos+4)*Oc;return this.pos+=8,e},readSFixed64:function(){var e=Yc(this.buf,this.pos)+Jc(this.buf,this.pos+4)*Oc;return this.pos+=8,e},readFloat:function(){var e=Lc(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Lc(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128)return Uc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<3,r<128)return Uc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<10,r<128)return Uc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<17,r<128)return Uc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<24,r<128)return Uc(e,i,t);if(i|=(1&(r=o[n.pos++]))<<31,r<128)return Uc(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Fc?function(e,t,n){return Fc.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var i="",r=t;r<n;){var o,s,a,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[r+2],128==(192&(o=e[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[r+2],a=e[r+3],128==(192&(o=e[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Dc.Bytes)return e.push(this.readVarint(t));var n=Nc(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Dc.Bytes)return e.push(this.readSVarint());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Dc.Bytes)return e.push(this.readBoolean());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Dc.Bytes)return e.push(this.readFloat());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Dc.Bytes)return e.push(this.readDouble());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Dc.Bytes)return e.push(this.readFixed32());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Dc.Bytes)return e.push(this.readSFixed32());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Dc.Bytes)return e.push(this.readFixed64());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Dc.Bytes)return e.push(this.readSFixed64());var t=Nc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Dc.Varint)for(;this.buf[this.pos++]>127;);else if(t===Dc.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Dc.Fixed32)this.pos+=4;else{if(t!==Dc.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Kc(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Kc(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Kc(this.buf,-1&e,this.pos),Kc(this.buf,Math.floor(e*Bc),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Kc(this.buf,-1&e,this.pos),Kc(this.buf,Math.floor(e*Bc),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,o=0;o<t.length;o++){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&jc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Rc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Rc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&jc(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,Dc.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Vc,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Gc,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,qc,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Wc,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,$c,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Zc,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Hc,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Qc,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Xc,t)},writeBytesField:function(e,t){this.writeTag(e,Dc.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Dc.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Dc.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Dc.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Dc.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Dc.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Dc.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Dc.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Dc.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Dc.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class ru{constructor(e,{pixelRatio:t,version:n,stretchX:i,stretchY:r,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=r,this.content=o,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ou{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,n,r),this.addImages(t,i,r);const{w:o,h:s}=iu(r),a=new $a({width:o||1,height:s||1});for(const t in e){const i=e[t],r=n[t].paddedRect;$a.copy(i.data,a,{x:0,y:0},{x:r.x+1,y:r.y+1},i.data)}for(const e in t){const n=t[e],r=i[e].paddedRect,o=r.x+1,s=r.y+1,l=n.data.width,c=n.data.height;$a.copy(n.data,a,{x:0,y:0},{x:o,y:s},n.data),$a.copy(n.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),$a.copy(n.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),$a.copy(n.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),$a.copy(n.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const r=e[i],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(o),t[i]=new ru(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl;n.update(t.data,void 0,{x:i,y:r})}}ar("ImagePosition",ru),ar("ImageAtlas",ou);const su={horizontal:1,vertical:2,horizontalOnly:3};class au{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new au;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new au;return t.imageName=e,t}}class lu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new lu;for(let i=0;i<e.sections.length;i++){const r=e.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,o=e.charCodeAt(i-1)||null;n+=!t&&(r&&Wr(r)&&!Pc[e[i+1]]||o&&Wr(o)&&!Pc[e[i-1]])||!Pc[e[i]]?e[i]:Pc[e[i]]}return n}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&uu[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&uu[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new lu;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(au.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void I("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(au.forImage(t)),this.sectionIndex.push(this.sections.length-1)):I("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function cu(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){const m=lu.fromFeature(e,r);let g;h===su.vertical&&m.verticalizePunctuation(d);const{processBidirectionalText:y,processStyledBidirectionalText:_}=oo;if(y&&1===m.sections.length){g=[];const e=y(m.toString(),gu(m,c,o,t,i,f,p));for(const t of e){const e=new lu;e.text=t,e.sections=m.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);g.push(e)}}else if(_){g=[];const e=_(m.text,m.sectionIndex,gu(m,c,o,t,i,f,p));for(const t of e){const e=new lu;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const n=[],i=e.text;let r=0;for(const i of t)n.push(e.substring(r,i)),r=i;return r<i.length&&n.push(e.substring(r,i.length)),n}(m,gu(m,c,o,t,i,f,p));const v=[],b={positionedLines:v,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,n,i,r,o,s,a,l,c,u,h){let d=0,f=0,p=0;const A="right"===a?1:"left"===a?0:.5;let m=!1;for(const e of r){const n=e.getSections();for(const e of n){if(e.imageName)continue;const n=t[e.fontStack];if(n&&(m=void 0!==n.ascender&&void 0!==n.descender,!m))break}if(!m)break}let g=0;for(const s of r){s.trim();const r=s.getMaxScale(),a=(r-1)*xc,_={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=_;const v=_.positionedGlyphs;let b=0;if(!s.length()){f+=o,++g;continue}let x=0,w=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),p=s.getSectionIndex(o),A=s.getCharCode(o);let g=a.scale,_=null,E=null,S=null,T=xc,k=0;const C=!(l===su.horizontal||!u&&!Gr(A)||u&&(uu[A]||(y=A,fr(y)||pr(y)||Ar(y)||zr(y)||Fr(y))));if(a.imageName){const t=i[a.imageName];if(!t)continue;S=a.imageName,e.iconsInText=e.iconsInText||!0,E=t.paddedRect;const n=t.displaySize;g=g*xc/h,_={width:n[0],height:n[1],left:1,top:-3,advance:C?n[1]:n[0],localGlyph:!1},k=m?-_.height*g:r*xc-17-n[1]*g,T=_.advance;const o=(C?n[0]:n[1])*g-xc*r;o>0&&o>b&&(b=o)}else{const e=n[a.fontStack];if(!e)continue;e[A]&&(E=e[A]);const i=t[a.fontStack];if(!i)continue;const o=i.glyphs[A];if(!o)continue;if(_=o.metrics,T=8203!==A?xc:0,m){const e=void 0!==i.ascender?Math.abs(i.ascender):0,t=void 0!==i.descender?Math.abs(i.descender):0,n=(e+t)*g;x<n&&(x=n,w=(e-t)/2*g),k=-e*g}else k=(r-g)*xc-17}C?(e.verticalizable=!0,v.push({glyph:A,imageName:S,x:d,y:f+k,vertical:C,scale:g,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:p,metrics:_,rect:E}),d+=T*g+c):(v.push({glyph:A,imageName:S,x:d,y:f+k,vertical:C,scale:g,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:p,metrics:_,rect:E}),d+=_.advance*g+c)}0!==v.length&&(p=Math.max(d-c,p),m?_u(v,A,b,w,o*r/2):_u(v,A,b,0,o/2)),d=0;const E=o*r+b;_.lineOffset=Math.max(b,a),f+=E,++g}var y;const _=f,{horizontalAlign:v,verticalAlign:b}=yu(s);(function(e,t,n,i,r,o){const s=(t-n)*r,a=-o*i;for(const t of e)for(const e of t.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,A,v,b,p,_),e.top+=-b*_,e.bottom=e.top+_,e.left+=-v*p,e.right=e.left+p,e.hasBaseline=m}(b,t,n,i,g,s,a,l,h,c,d,A),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(v)&&b}const uu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function du(e,t,n,i,r,o){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*xc/o+r:0}{const i=n[t.fontStack],o=i&&i.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function fu(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function pu(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function Au(e,t,n,i,r,o){let s=null,a=fu(t,n,r,o);for(const e of i){const i=fu(t-e.x,n,r,o)+e.badness;i<=a&&(s=e,a=i)}return{index:e,x:t,priorBreak:s,badness:a}}function mu(e){return e?mu(e.priorBreak).concat(e.index):[]}function gu(e,t,n,i,r,o,s){if("point"!==o)return[];if(!e)return[];const a=[],l=function(e,t,n,i,r,o){let s=0;for(let n=0;n<e.length();n++){const a=e.getSection(n);s+=du(e.getCharCode(n),a,i,r,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,i,r,s),c=e.text.indexOf("​")>=0;let u=0;for(let n=0;n<e.length();n++){const o=e.getSection(n),d=e.getCharCode(n);if(uu[d]||(u+=du(d,o,i,r,t,s)),n<e.length()-1){const t=!((h=d)<11904||!(wr(h)||xr(h)||Or(h)||Rr(h)||kr(h)||mr(h)||Er(h)||_r(h)||Cr(h)||Pr(h)||Tr(h)||Nr(h)||vr(h)||yr(h)||gr(h)||Sr(h)||br(h)||Dr(h)||Ir(h)||Mr(h)));(hu[d]||t||o.imageName)&&a.push(Au(n+1,u,l,a,pu(d,e.getCharCode(n+1),t&&c),!1))}}var h;return mu(Au(e.length(),u,l,a,0,!0))}function yu(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function _u(e,t,n,i,r){if(!(t||n||i||r))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let t=0;t<=o;t++)e[t].x-=a,e[t].y+=n+i+r}function vu(e,t,n){const{horizontalAlign:i,verticalAlign:r}=yu(n),o=t[0]-e.displaySize[0]*i,s=t[1]-e.displaySize[1]*r;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function bu(e,t,n,i,r,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,f;"width"===n||"both"===n?(f=r[0]+l-i[3],h=r[0]+c+i[1]):(f=r[0]+(l+c-s.displaySize[0])/2,h=f+s.displaySize[0]);const p=t.top*o,A=t.bottom*o;return"height"===n||"both"===n?(u=r[1]+p-i[0],d=r[1]+A+i[2]):(u=r[1]+(p+A-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:f,collisionPadding:a}}class xu extends r{constructor(e,t,n,i,r){super(e,t),this.angle=i,this.z=n,void 0!==r&&(this.segment=r)}clone(){return new xu(this.x,this.y,this.z,this.angle,this.segment)}}function wu(e,t,n,i,r){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(n)}return!0}function Eu(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Su(e,t,n){return e?.6*t*n:0}function Tu(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ku(e,t,n,i,r,o){const s=Su(n,r,o),a=Tu(n,i)*o;let l=0;const c=Eu(e)/2;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1],o=i.dist(r);if(l+o>c){const u=(c-l)/o,h=nn(i.x,r.x,u),d=nn(i.y,r.y,u),f=new xu(h,d,0,r.angleTo(i),n);return!s||wu(e,f,a,s,t)?f:void 0}l+=o}}function Cu(e,t,n,i,r,o,s,a,l){const c=Su(i,o,s),u=Tu(i,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Pu(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function Pu(e,t,n,i,r,o,s,a,l){const c=o/2,u=Eu(e);let h=0,d=t-n,f=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],p=s.dist(a),A=a.angleTo(s);for(;d+n<h+p;){d+=n;const m=(d-h)/p,g=nn(s.x,a.x,m),y=nn(s.y,a.y,m);if(g>=0&&g<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const n=new xu(g,y,0,A,t);n._round(),i&&!wu(e,n,o,i,r)||f.push(n)}}h+=p}return a||f.length||s||(f=Pu(e,h/2,n,i,r,o,s,!0,l)),f}function Mu(e,t,n,i,o){const s=[];for(let a=0;a<e.length;a++){const l=e[a];let c;for(let e=0;e<l.length-1;e++){let a=l[e],u=l[e+1];a.x<t&&u.x<t||(a.x<t?a=new r(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<t&&(u=new r(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<n&&u.y<n||(a.y<n?a=new r(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round():u.y<n&&(u=new r(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round()),a.x>=i&&u.x>=i||(a.x>=i?a=new r(i,a.y+(i-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=i&&(u=new r(i,a.y+(i-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=o&&u.y>=o||(a.y>=o?a=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round():u.y>=o&&(u=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}ar("Anchor",xu);const Iu=1e20;function Lu(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)Ru(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)Ru(e,c*o+t,1,i,s,a,l)}function Ru(e,t,n,i,r,o,s){o[0]=0,s[0]=-Iu,s[1]=Iu,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=Iu}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}const zu={none:0,ideographs:1,all:2};class Du{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const n=[];for(const t in e)for(const i of e[t])n.push({stack:t,id:i});g(n,(({stack:e,id:t},n)=>{let i=this.entries[e];i||(i=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=i.glyphs[t];if(void 0!==r)return void n(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(i,e,t),r)return i.glyphs[t]=r,void n(null,{stack:e,id:t,glyph:r});const o=Math.floor(t/256);if(256*o>65535)return void n(new Error("glyphs > 65535 not supported"));if(i.ranges[o])return void n(null,{stack:e,id:t,glyph:r});let s=i.requests[o];s||(s=i.requests[o]=[],Du.loadGlyphRange(e,o,this.url,this.requestManager,((e,t)=>{if(t){i.ascender=t.ascender,i.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(i.glyphs[+e]=t.glyphs[+e]);i.ranges[o]=!0}for(const n of s)n(e,t);delete i.requests[o]}))),s.push(((i,r)=>{i?n(i):r&&n(null,{stack:e,id:t,glyph:r.glyphs[t]||null})}))}),((e,n)=>{if(e)t(e);else if(n){const e={};for(const{stack:t,id:i,glyph:r}of n)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[i]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==zu.none&&(this.localGlyphMode===zu.all?!!this.localFontFamily:!!this.localFontFamily&&(Pr(e)||Lr(e)||vr(e)||br(e))||_r(e))}_tinySDF(e,t,n){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(n))return;let r=e.tinySDF;if(!r){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),r=e.tinySDF=new Du.TinySDF({fontFamily:i,fontWeight:n,fontSize:48,buffer:6,radius:16}),r.fontWeight=n}if(this.localGlyphs[r.fontWeight][n])return this.localGlyphs[r.fontWeight][n];const o=String.fromCharCode(n),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:f}=r.draw(o);return this.localGlyphs[r.fontWeight][n]={id:n,bitmap:new Wa({width:a,height:l},s),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:f/2,localGlyph:!0}}}}function Ou(e,t,n,i){const o=[],s=e.image,a=s.pixelRatio,l=s.paddedRect.w-2,c=s.paddedRect.h-2,u=e.right-e.left,h=e.bottom-e.top,d=s.stretchX||[[0,l]],f=s.stretchY||[[0,c]],p=(e,t)=>e+t[1]-t[0],A=d.reduce(p,0),m=f.reduce(p,0),g=l-A,y=c-m;let _=0,v=A,b=0,x=m,w=0,E=g,S=0,T=y;if(s.content&&i){const e=s.content;_=Bu(d,0,e[0]),b=Bu(f,0,e[1]),v=Bu(d,e[0],e[2]),x=Bu(f,e[1],e[3]),w=e[0]-_,S=e[1]-b,E=e[2]-e[0]-v,T=e[3]-e[1]-x}const k=(i,o,l,c)=>{const d=Nu(i.stretch-_,v,u,e.left),f=Uu(i.fixed-w,E,i.stretch,A),p=Nu(o.stretch-b,x,h,e.top),g=Uu(o.fixed-S,T,o.stretch,m),y=Nu(l.stretch-_,v,u,e.left),k=Uu(l.fixed-w,E,l.stretch,A),C=Nu(c.stretch-b,x,h,e.top),P=Uu(c.fixed-S,T,c.stretch,m),M=new r(d,p),I=new r(y,p),L=new r(y,C),R=new r(d,C),z=new r(f/a,g/a),D=new r(k/a,P/a),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),n=[t,-e,e,t];M._matMult(n),I._matMult(n),R._matMult(n),L._matMult(n)}const B=i.stretch+i.fixed,F=o.stretch+o.fixed;return{tl:M,tr:I,bl:R,br:L,tex:{x:s.paddedRect.x+1+B,y:s.paddedRect.y+1+F,w:l.stretch+l.fixed-B,h:c.stretch+c.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:z,pixelOffsetBR:D,minFontScaleX:E/a/u,minFontScaleY:T/a/h,isSDF:n}};if(i&&(s.stretchX||s.stretchY)){const e=Fu(d,g,A),t=Fu(f,y,m);for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)o.push(k(i,t[e],r,t[e+1]))}}else o.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function Bu(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function Fu(e,t,n){const i=[{fixed:-1,stretch:0}];for(const[t,n]of e){const e=i[i.length-1];i.push({fixed:t-e.stretch,stretch:e.stretch}),i.push({fixed:t-e.stretch,stretch:e.stretch+(n-t)})}return i.push({fixed:t+1,stretch:n}),i}function Nu(e,t,n,i){return e/t*n+i}function Uu(e,t,n,i){return e-t*n/i}function ju(e,t,n,i){const r=t+e.positionedLines[i].lineOffset;return 0===i?n+r/2:n+(r+(t+e.positionedLines[i-1].lineOffset))/2}Du.loadGlyphRange=function(e,t,n,i,r){const o=256*t,s=o+255,a=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),be.Glyphs);Se(a,((e,t)=>{if(e)r(e);else if(t){const e={},n=function(e){return new zc(e).readFields(eu,{})}(t);for(const t of n.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}}))},Du.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}){this.buffer=t,this.cutoff=i,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.floor(n),a=Math.min(this.size-this.buffer,Math.ceil(o-r)),l=Math.min(this.size-this.buffer,Math.ceil(n)+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=c*u,d=new Uint8ClampedArray(h),f={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return f;const{ctx:p,buffer:A,gridInner:m,gridOuter:g}=this;p.clearRect(A,A,a,l),p.fillText(e,A,A+s+1);const y=p.getImageData(A,A,a,l);g.fill(Iu,0,h),m.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const n=y.data[4*(e*a+t)+3]/255;if(0===n)continue;const i=(e+A)*c+t+A;if(1===n)g[i]=0,m[i]=Iu;else{const e=.5-n;g[i]=e>0?e*e:0,m[i]=e<0?e*e:0}}Lu(g,0,0,c,u,c,this.f,this.v,this.z),Lu(m,A,A,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(g[e])-Math.sqrt(m[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return f}};class Vu{constructor(e=[],t=Gu){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),o=t[i];const s=i+1;if(s<this.length&&n(t[s],o)<0&&(i=s,o=t[s]),n(o,r)>=0)break;t[e]=o,e=i}t[e]=r}}function Gu(e,t){return e<t?-1:e>t?1:0}function Wu(e,t=1,n=!1){let i=1/0,o=1/0,s=-1/0,a=-1/0;const l=e[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<i)&&(i=t.x),(!e||t.y<o)&&(o=t.y),(!e||t.x>s)&&(s=t.x),(!e||t.y>a)&&(a=t.y)}const c=Math.min(s-i,a-o);let u=c/2;const h=new Vu([],$u);if(0===c)return new r(i,o);for(let t=i;t<s;t+=c)for(let n=o;n<a;n+=c)h.push(new qu(t+u,n+u,u,e));let d=function(e){let t=0,n=0,i=0;const r=e[0];for(let e=0,o=r.length,s=o-1;e<o;s=e++){const o=r[e],a=r[s],l=o.x*a.y-a.x*o.y;n+=(o.x+a.x)*l,i+=(o.y+a.y)*l,t+=3*l}return new qu(n/t,i/t,0,e)}(e),f=h.length;for(;h.length;){const i=h.pop();(i.d>d.d||!d.d)&&(d=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,f)),i.max-d.d<=t||(u=i.h/2,h.push(new qu(i.p.x-u,i.p.y-u,u,e)),h.push(new qu(i.p.x+u,i.p.y-u,u,e)),h.push(new qu(i.p.x-u,i.p.y+u,u,e)),h.push(new qu(i.p.x+u,i.p.y+u,u,e)),f+=4)}return n&&(console.log(`num probes: ${f}`),console.log(`best distance: ${d.d}`)),d.p}function $u(e,t){return t.max-e.max}function qu(e,t,n,i){this.p=new r(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,ia(e,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const Zu=Number.POSITIVE_INFINITY,Hu=Math.sqrt(2);function Qu(e,t){return t[1]!==Zu?function(e,t,n){let i=0,r=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":r=n-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-n}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}return[i,r]}(e,t[0],t[1]):function(e,t){let n=0,i=0;t<0&&(t=0);const r=t/Hu;switch(e){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-t;break;case"top":i=t-7}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=t;break;case"right":n=-t}return[n,i]}(e,t[0])}function Xu(e,t,n,i,r,o,s,a){e.createArrays(),e.tilePixelRatio=Gs/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const l=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,u={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;u.compositeTextSizes=[c["text-size"].possiblyEvaluate(new so(t),s),c["text-size"].possiblyEvaluate(new so(n),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;u.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new so(t),s),c["icon-size"].possiblyEvaluate(new so(n),s)]}u.layoutTextSize=c["text-size"].possiblyEvaluate(new so(a+1),s),u.layoutIconSize=c["icon-size"].possiblyEvaluate(new so(a+1),s),u.textMaxSize=c["text-size"].possiblyEvaluate(new so(18),s);const h="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-size");for(const o of e.features){const a=l.get("text-font").evaluate(o,{},s).join(","),c=d.evaluate(o,{},s),f=u.layoutTextSize.evaluate(o,{},s),p=(u.layoutIconSize.evaluate(o,{},s),{horizontal:{},vertical:void 0}),A=o.text;let m,g=[0,0];if(A){const i=A.toString(),u=l.get("text-letter-spacing").evaluate(o,{},s)*xc,d=l.get("text-line-height").evaluate(o,{},s)*xc,m=jr(i)?u:0,y=l.get("text-anchor").evaluate(o,{},s),_=l.get("text-variable-anchor");if(!_){const e=l.get("text-radial-offset").evaluate(o,{},s);g=e?Qu(y,[e*xc,Zu]):l.get("text-offset").evaluate(o,{},s).map((e=>e*xc))}let v=h?"center":l.get("text-justify").evaluate(o,{},s);const b=l.get("symbol-placement"),x="point"===b,w="point"===b?l.get("text-max-width").evaluate(o,{},s)*xc:0,E=o=>{e.allowVerticalPlacement&&Ur(i)&&(p.vertical=cu(A,t,n,r,a,w,d,y,o,m,g,su.vertical,!0,b,f,c))};if(!h&&_){const e="auto"===v?_.map((e=>Yu(e))):[v];let i=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!p.horizontal[s])if(i)p.horizontal[s]=p.horizontal[0];else{const e=cu(A,t,n,r,a,w,d,"center",s,m,g,su.horizontal,!1,b,f,c);e&&(p.horizontal[s]=e,i=1===e.positionedLines.length)}}E("left")}else{if("auto"===v&&(v=Yu(y)),x||l.get("text-writing-mode").indexOf("horizontal")>=0||!Ur(i)){const e=cu(A,t,n,r,a,w,d,y,v,m,g,su.horizontal,!1,b,f,c);e&&(p.horizontal[v]=e)}E("point"===b?"left":v)}}let y=!1;if(o.icon&&o.icon.name){const t=i[o.icon.name];t&&(m=vu(r[o.icon.name],l.get("icon-offset").evaluate(o,{},s),l.get("icon-anchor").evaluate(o,{},s)),y=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&I("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const _=th(p.horizontal)||p.vertical;e.iconsInText||(e.iconsInText=!!_&&_.iconsInText),(_||m)&&Ku(e,o,p,m,i,u,f,0,g,y,s)}o&&e.generateCollisionDebugBuffers(a,e.collisionBoxArray)}function Yu(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ku(e,t,n,i,r,o,s,a,l,c,h){let d=o.textMaxSize.evaluate(t,{},h);void 0===d&&(d=s);const f=e.layers[0].layout,p=f.get("icon-offset").evaluate(t,{},h),A=th(n.horizontal)||n.vertical,m=s/24,g=e.tilePixelRatio*d/24,y=e.tilePixelRatio*f.get("symbol-spacing"),_=f.get("text-padding")*e.tilePixelRatio,v=f.get("icon-padding")*e.tilePixelRatio,b=u(f.get("text-max-angle")),x="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),w="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),E=f.get("symbol-placement"),S=y/2,T=f.get("icon-text-fit");let k;i&&"none"!==T&&(e.allowVerticalPlacement&&n.vertical&&(k=bu(i,n.vertical,T,f.get("icon-text-fit-padding"),p,m)),A&&(i=bu(i,A,T,f.get("icon-text-fit-padding"),p,m)));const C=(s,a)=>{a.x<0||a.x>=Gs||a.y<0||a.y>=Gs||function(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v,b,x,w){const E=e.addToLineVertexArray(t,i);let S,T,k,C,P,M,L,R=0,z=0,D=0,O=0,B=-1,F=-1;const N={};let U=fs(""),j=0,V=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[j,V]=l.layout.get("text-offset").evaluate(v,{},w).map((e=>e*xc)):(j=l.layout.get("text-radial-offset").evaluate(v,{},w)*xc,V=Zu),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(p)M=ih(e),a&&(L=ih(a));else{const i=l.layout.get("text-rotate").evaluate(v,{},w)+90;k=nh(c,n,t,u,h,d,e,f,i,A),a&&(C=nh(c,n,t,u,h,d,a,g,i))}}if(o){const i=l.layout.get("icon-rotate").evaluate(v,{},w),r="none"!==l.layout.get("icon-text-fit"),s=Ou(o,i,x,r),f=a?Ou(a,i,x,r):void 0;T=nh(c,n,t,u,h,d,o,g,i),R=4*s.length;const p=e.iconSizeData;let A=null;"source"===p.kind?(A=[wc*l.layout.get("icon-size").evaluate(v,{},w)],A[0]>Ju&&I(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===p.kind&&(A=[wc*b.compositeIconSizes[0].evaluate(v,{},w),wc*b.compositeIconSizes[1].evaluate(v,{},w)],(A[0]>Ju||A[1]>Ju)&&I(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,A,_,y,v,!1,n,t,E.lineStartIndex,E.lineLength,-1,w),B=e.icon.placedSymbolArray.length-1,f&&(z=4*f.length,e.addSymbols(e.icon,f,A,_,y,v,su.vertical,n,t,E.lineStartIndex,E.lineLength,-1,w),F=e.icon.placedSymbolArray.length-1)}for(const i in r.horizontal){const o=r.horizontal[i];S||(U=fs(o.text),p?P=ih(o):S=nh(c,n,t,u,h,d,o,f,l.layout.get("text-rotate").evaluate(v,{},w),A));const a=1===o.positionedLines.length;if(D+=eh(e,n,t,o,s,l,p,v,A,E,r.vertical?su.horizontal:su.horizontalOnly,a?Object.keys(r.horizontal):[i],N,B,b,w),a)break}r.vertical&&(O+=eh(e,n,t,r.vertical,s,l,p,v,A,E,su.vertical,["vertical"],N,F,b,w));let G=-1;const W=(e,t)=>e?Math.max(e,t):t;G=W(P,G),G=W(M,G),G=W(L,G);const $=G>-1?1:0;e.glyphOffsetArray.length>=dh.MAX_GLYPHS&&I("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,v.sortKey),e.symbolInstances.emplaceBack(n.x,n.y,n.z,t.x,t.y,N.right>=0?N.right:-1,N.center>=0?N.center:-1,N.left>=0?N.left:-1,N.vertical>=0?N.vertical:-1,B,F,U,void 0!==S?S:e.collisionBoxArray.length,void 0!==S?S+1:e.collisionBoxArray.length,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,void 0!==T?T:e.collisionBoxArray.length,void 0!==T?T+1:e.collisionBoxArray.length,C||e.collisionBoxArray.length,C?C+1:e.collisionBoxArray.length,u,D,O,R,z,$,0,j,V,G)}(e,a,a,s,n,i,r,k,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,_,x,l,0,v,w,p,t,o,c,h)};if("line"===E)for(const r of Mu(t.geometry,0,0,Gs,Gs)){const t=Cu(r,y,b,n.vertical||A,i,24,g,e.overscaling,Gs);for(const n of t){const t=A;t&&rh(e,t.text,S,n)||C(r,n)}}else if("line-center"===E){for(const e of t.geometry)if(e.length>1){const t=ku(e,b,n.vertical||A,i,24,g);t&&C(e,t)}}else if("Polygon"===t.type)for(const e of Pl(t.geometry,0)){const t=Wu(e,16);C(e[0],new xu(t.x,t.y,0,0,void 0))}else if("LineString"===t.type)for(const e of t.geometry)C(e,new xu(e[0].x,e[0].y,0,0,void 0));else if("Point"===t.type)for(const e of t.geometry)for(const t of e)C([t],new xu(t.x,t.y,0,0,void 0))}const Ju=32640;function eh(e,t,n,i,o,s,a,l,c,u,h,d,f,p,A,m){const g=function(e,t,n,i,o,s,a,l){const c=[];if(0===t.positionedLines.length)return c;const u=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,h=function(e){const t=e[0],n=e[1],i=t*n;return i>0?[t,-n]:i<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let d=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)d-=e.lineOffset;const f=t.positionedLines.length,p=d/f;let A=t.top-n[1];for(let e=0;e<f;++e){const i=t.positionedLines[e];A=ju(t,p,A,e);for(const e of i.positionedGlyphs){if(!e.rect)continue;const i=e.rect||{};let s=4,d=!0,f=1,p=0;if(e.imageName){const t=a[e.imageName];if(!t)continue;if(t.sdf){I("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,f=t.pixelRatio,s=1/f}const m=(o||l)&&e.vertical,g=e.metrics.advance*e.scale/2,y=e.metrics,_=e.rect;if(null===_)continue;l&&t.verticalizable&&(p=e.imageName?g-e.metrics.width*e.scale/2:0);const v=o?[e.x+g,e.y]:[0,0];let b=[0,0],x=[0,0],w=!1;o||(m?(x=[e.x+g+h[0],e.y+h[1]-p],w=!0):b=[e.x+g+n[0],e.y+n[1]-p]);const E=_.w*e.scale/(f*(e.localGlyph?2:1)),S=_.h*e.scale/(f*(e.localGlyph?2:1));let T,k,C,P;if(m){const t=e.y-A,n=new r(-g,g-t),i=-Math.PI/2,o=new r(...x);T=new r(-g+b[0],b[1]),T._rotateAround(i,n)._add(o),T.x+=-t+g,T.y-=(y.left-s)*e.scale;const a=e.imageName?y.advance*e.scale:xc*e.scale,l=String.fromCharCode(e.glyph);Mc(l)?T.x+=(1-s)*e.scale:Ic(l)?T.x+=a-y.height*e.scale+(-s-1)*e.scale:T.x+=e.imageName||y.width+2*s===_.w&&y.height+2*s===_.h?(a-S)/2:(a-(y.height+2*s)*e.scale)/2,k=new r(T.x,T.y-E),C=new r(T.x+S,T.y),P=new r(T.x+S,T.y-E)}else{const t=(y.left-s)*e.scale-g+b[0],n=(-y.top-s)*e.scale+b[1],i=t+E,o=n+S;T=new r(t,n),k=new r(i,n),C=new r(t,o),P=new r(i,o)}if(u){let e;e=o?new r(0,0):w?new r(h[0],h[1]):new r(n[0],n[1]),T._rotateAround(u,e),k._rotateAround(u,e),C._rotateAround(u,e),P._rotateAround(u,e)}const M=new r(0,0),L=new r(0,0);c.push({tl:T,tr:k,bl:C,br:P,tex:i,writingMode:t.writingMode,glyphOffset:v,sectionIndex:e.sectionIndex,isSDF:d,pixelOffsetTL:M,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}}return c}(0,i,c,s,a,l,o,e.allowVerticalPlacement),y=e.textSizeData;let _=null;"source"===y.kind?(_=[wc*s.layout.get("text-size").evaluate(l,{},m)],_[0]>Ju&&I(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===y.kind&&(_=[wc*A.compositeTextSizes[0].evaluate(l,{},m),wc*A.compositeTextSizes[1].evaluate(l,{},m)],(_[0]>Ju||_[1]>Ju)&&I(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,g,_,c,a,l,h,t,n,u.lineStartIndex,u.lineLength,p,m);for(const t of d)f[t]=e.text.placedSymbolArray.length-1;return 4*g.length}function th(e){for(const t in e)return e[t];return null}function nh(e,t,n,i,o,s,a,l,c,h){let d=a.top,f=a.bottom,p=a.left,A=a.right;const m=a.collisionPadding;if(m&&(p-=m[0],d-=m[1],A+=m[2],f+=m[3]),c){const e=new r(p,d),t=new r(A,d),n=new r(p,f),i=new r(A,f),o=u(c);let s=new r(0,0);h&&(s=new r(h[0],h[1])),e._rotateAround(o,s),t._rotateAround(o,s),n._rotateAround(o,s),i._rotateAround(o,s),p=Math.min(e.x,t.x,n.x,i.x),A=Math.max(e.x,t.x,n.x,i.x),d=Math.min(e.y,t.y,n.y,i.y),f=Math.max(e.y,t.y,n.y,i.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,p,d,A,f,l,i,o,s),e.length-1}function ih(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function rh(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}const oh=Zl.VectorTileFeature.types,sh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ah(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){const m=u?Math.min(Ju,Math.round(u[0])):0,g=u?Math.min(Ju,Math.round(u[1])):0;e.emplaceBack(t,n,Math.round(32*s),Math.round(32*a),l,c,(m<<1)+(h?1:0),g,16*d,16*f,256*p,256*A,i,r,o,0)}function lh(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function ch(e){for(const t of e.sections)if(Zr(t.text))return!0;return!1}class uh{constructor(e){this.layoutVertexArray=new zo,this.indexArray=new Uo,this.programConfigurations=e,this.segments=new Vs,this.dynamicLayoutVertexArray=new Io,this.opacityVertexArray=new Do,this.placedSymbolArray=new es}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,gc.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sh,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ar("SymbolBuffers",uh);class hh{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new Vs,this.collisionVertexArray=new No,this.collisionVertexArrayExt=new Io}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,yc.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_c.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ar("CollisionBuffers",hh);class dh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ma([]),this.placementViewportMatrix=ma([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ec(this.zoom,t["text-size"]),this.iconSizeData=Ec(this.zoom,t["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map((e=>su[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID}createArrays(){this.text=new uh(new Ls(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new uh(new Ls(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new is,this.lineVertexArray=new rs,this.symbolInstances=new ns}calculateGlyphDependencies(e,t,n,i,r){for(let n=0;n<e.length;n++)if(t[e.charCodeAt(n)]=!0,i&&r){const i=Pc[e.charAt(n)];i&&(t[i.charCodeAt(0)]=!0)}}populate(e,t,n){const i=this.layers[0],r=i.layout,o=r.get("text-font"),s=r.get("text-field"),a=r.get("icon-image"),l=("constant"!==s.value.kind||s.value.value instanceof ft&&!s.value.value.isEmpty()||s.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==a.value.kind||!!a.value.value||Object.keys(a.parameters).length>0,u=r.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const h=t.iconDependencies,d=t.glyphDependencies,f=t.availableImages,p=new so(this.zoom);for(const{feature:t,id:s,index:a,sourceLayerIndex:A}of e){const e=i._featureFilter.needGeometry,m=Zs(t,e);if(!i._featureFilter.filter(p,m,n))continue;let g,y;if(e||(m.geometry=qs(t)),l){const e=i.getValueAndResolveTokens("text-field",m,n,f),t=ft.factory(e);ch(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===io()||this.hasRTLText&&oo.isParsed())&&(g=Cc(t,i,m))}if(c){const e=i.getValueAndResolveTokens("icon-image",m,n,f);y=e instanceof pt?e:pt.fromString(e)}if(!g&&!y)continue;const _=this.sortFeaturesByKey?u.evaluate(m,{},n):void 0;if(this.features.push({id:s,text:g,icon:y,index:a,sourceLayerIndex:A,geometry:m.geometry,properties:t.properties,type:oh[t.type],sortKey:_}),y&&(h[y.name]=!0),g){const e=o.evaluate(m,{},n).join(","),t="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(su.vertical)>=0;for(const n of g.sections)if(n.image)h[n.image.name]=!0;else{const i=Ur(g.toString()),r=n.fontStack||e,o=d[r]=d[r]||{};this.calculateGlyphDependencies(n.text,o,t,this.allowVerticalPlacement,i)}}}"line"===r.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function o(t){i.push(e[t]),r++}function s(e,t,r){const o=n[e];return delete n[e],n[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function a(e,n,r){const o=t[n];return delete t[n],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return`${e}:${i.x}:${i.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const f=l(d,h),p=l(d,h,!0);if(f in n&&p in t&&n[f]!==t[p]){const e=a(f,p,h),r=s(f,p,i[e].geometry);delete t[f],delete n[p],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else f in n?s(f,p,h):p in t?a(f,p,h):(o(c),t[f]=r-1,n[p]=r-1)}return i.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment){let n=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]);const r={};for(let i=e.segment+1;i<t.length;i++)r[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:n},i<t.length-1&&(n+=t[i+1].dist(t[i]));for(let n=e.segment||0;n>=0;n--)r[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:i},n>0&&(i+=t[n-1].dist(t[n]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,r,o,s,a,l,c,u,h,d){const f=e.indexArray,p=e.layoutVertexArray,A=e.segments.prepareSegment(4*t.length,p,f,this.canOverlap?o.sortKey:void 0),m=this.glyphOffsetArray.length,g=A.vertexLength,y=this.allowVerticalPlacement&&s===su.vertical?Math.PI/2:0,_=o.text&&o.text.sections;for(let i=0;i<t.length;i++){const{tl:r,tr:s,bl:c,br:u,tex:h,pixelOffsetTL:m,pixelOffsetBR:g,minFontScaleX:v,minFontScaleY:b,glyphOffset:x,isSDF:w,sectionIndex:E}=t[i],S=A.vertexLength,T=x[1];ah(p,a.x,a.y,a.z,l.x,l.y,r.x,T+r.y,h.x,h.y,n,w,m.x,m.y,v,b),ah(p,a.x,a.y,a.z,l.x,l.y,s.x,T+s.y,h.x+h.w,h.y,n,w,g.x,m.y,v,b),ah(p,a.x,a.y,a.z,l.x,l.y,c.x,T+c.y,h.x,h.y+h.h,n,w,m.x,g.y,v,b),ah(p,a.x,a.y,a.z,l.x,l.y,u.x,T+u.y,h.x+h.w,h.y+h.h,n,w,g.x,g.y,v,b),lh(e.dynamicLayoutVertexArray,a,y),f.emplaceBack(S,S+1,S+2),f.emplaceBack(S+1,S+2,S+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),i!==t.length-1&&E===t[i+1].sectionIndex||e.programConfigurations.populatePaintArrays(p.length,o,o.index,{},d,_&&_[E])}e.placedSymbolArray.emplaceBack(a.x,a.y,a.z,l.x,l.y,m,this.glyphOffsetArray.length-m,g,c,u,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,n,i,r,o,s){e.emplaceBack(t,n,i,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,n,i,o,s,a){const l=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),c=l.vertexLength,u=a.tileAnchorX,h=a.tileAnchorY;for(let e=0;e<4;e++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,i,o,s,u,h,new r(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,o,s,u,h,new r(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,o,s,u,h,new r(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,o,s,u,h,new r(e.x1,e.y2)),l.vertexLength+=4;const d=n.indexArray;d.emplaceBack(c,c+1),d.emplaceBack(c+1,c+2),d.emplaceBack(c+2,c+3),d.emplaceBack(c+3,c),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(i,r,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceIconSize(e,t,s);this._addCollisionDebugVertices(i,r,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hh(Bo,vc.members,qo),this.iconCollisionBox=new hh(Bo,vc.members,qo);const n=Tc(this.iconSizeData,e),i=Tc(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,n,i){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),o=Sc(this.textSizeData,e,r)/xc;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),r=Sc(this.iconSizeData,e,i);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,i,r,o){for(let s=i;s<r;s++){const i=n.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,i.padding)}}_updateIconDebugCollisionBoxes(e,t,n,i,r){for(let o=i;o<r;o++){const i=n.get(o),r=this.getSymbolInstanceIconSize(e,t,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,i.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Tc(this.iconSizeData,e),i=Tc(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(i,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,o,s,a,l){const c={};for(let i=t;i<n;i++){const t=e.get(i);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,projectedAnchorX:t.projectedAnchorX,projectedAnchorY:t.projectedAnchorY,projectedAnchorZ:t.projectedAnchorZ,tileAnchorX:t.tileAnchorX,tileAnchorY:t.tileAnchorY},c.textFeatureIndex=t.featureIndex;break}for(let t=i;t<r;t++){const n=e.get(t);c.verticalTextBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,padding:n.padding,projectedAnchorX:n.projectedAnchorX,projectedAnchorY:n.projectedAnchorY,projectedAnchorZ:n.projectedAnchorZ,tileAnchorX:n.tileAnchorX,tileAnchorY:n.tileAnchorY},c.verticalTextFeatureIndex=n.featureIndex;break}for(let t=o;t<s;t++){const n=e.get(t);c.iconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,padding:n.padding,projectedAnchorX:n.projectedAnchorX,projectedAnchorY:n.projectedAnchorY,projectedAnchorZ:n.projectedAnchorZ,tileAnchorX:n.tileAnchorX,tileAnchorY:n.tileAnchorY},c.iconFeatureIndex=n.featureIndex;break}for(let t=a;t<l;t++){const n=e.get(t);c.verticalIconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,padding:n.padding,projectedAnchorX:n.projectedAnchorX,projectedAnchorY:n.projectedAnchorY,projectedAnchorZ:n.projectedAnchorZ,tileAnchorX:n.tileAnchorX,tileAnchorY:n.tileAnchorY},c.verticalIconFeatureIndex=n.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let t=n.vertexStartIndex;t<i;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);i.push(0|Math.round(t*s.tileAnchorX+n*s.tileAnchorY)),r.push(s.featureIndex)}return o.sort(((e,t)=>i[e]-i[t]||r[t]-r[e])),o}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,n)=>{e>=0&&n.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ar("SymbolBucket",dh,{omit:["layers","collisionBoxArray","features","compareText"]}),dh.MAX_GLYPHS=65535,dh.addDynamicAttributes=lh;const fh=new bo({"symbol-placement":new mo(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new mo(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mo(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new go(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mo(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mo(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new mo(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new mo(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mo(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new go(Fe.layout_symbol["icon-size"]),"icon-text-fit":new mo(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mo(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new go(Fe.layout_symbol["icon-image"]),"icon-rotate":new go(Fe.layout_symbol["icon-rotate"]),"icon-padding":new mo(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new mo(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new go(Fe.layout_symbol["icon-offset"]),"icon-anchor":new go(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mo(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mo(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mo(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new go(Fe.layout_symbol["text-field"]),"text-font":new go(Fe.layout_symbol["text-font"]),"text-size":new go(Fe.layout_symbol["text-size"]),"text-max-width":new go(Fe.layout_symbol["text-max-width"]),"text-line-height":new go(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new go(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new go(Fe.layout_symbol["text-justify"]),"text-radial-offset":new go(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mo(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new go(Fe.layout_symbol["text-anchor"]),"text-max-angle":new mo(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new mo(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new go(Fe.layout_symbol["text-rotate"]),"text-padding":new mo(Fe.layout_symbol["text-padding"]),"text-keep-upright":new mo(Fe.layout_symbol["text-keep-upright"]),"text-transform":new go(Fe.layout_symbol["text-transform"]),"text-offset":new go(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new mo(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new mo(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new mo(Fe.layout_symbol["text-optional"])});var ph={paint:new bo({"icon-opacity":new go(Fe.paint_symbol["icon-opacity"]),"icon-color":new go(Fe.paint_symbol["icon-color"]),"icon-halo-color":new go(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new go(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new go(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new mo(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new mo(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new go(Fe.paint_symbol["text-opacity"]),"text-color":new go(Fe.paint_symbol["text-color"],{runtimeType:Xe,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new go(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new go(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new go(Fe.paint_symbol["text-halo-blur"]),"text-translate":new mo(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new mo(Fe.paint_symbol["text-translate-anchor"])}),layout:fh};class Ah{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:qe,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ar("FormatSectionOverride",Ah,{omit:["defaultValue"]});class mh extends Ns{constructor(e){super(e,ph)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||ci(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>n in e?String(e[n]):""))}(t.properties,r)}createBucket(e){return new dh(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ph.paint.overridableProperties){if(!mh.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new Ah(t),i=new li(n,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new hi("source",i):new di("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new po(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&mh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=ph.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof ft)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof _t&&gt(t.value)===et?o(t.value.sections):t instanceof wt?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramConfiguration(e){return new Is(this,e)}}var gh={paint:new bo({"background-color":new mo(Fe.paint_background["background-color"]),"background-pattern":new _o(Fe.paint_background["background-pattern"]),"background-opacity":new mo(Fe.paint_background["background-opacity"])})},yh={paint:new bo({"raster-opacity":new mo(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new mo(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mo(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mo(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new mo(Fe.paint_raster["raster-saturation"]),"raster-contrast":new mo(Fe.paint_raster["raster-contrast"]),"raster-resampling":new mo(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new mo(Fe.paint_raster["raster-fade-duration"])})};class _h extends Ns{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var vh={paint:new bo({"sky-type":new mo(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new mo(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new mo(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new mo(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new mo(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new vo(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new mo(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new mo(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new mo(Fe.paint_sky["sky-opacity"])})};function bh(e,t,n){const i=ba(0,0,1),r=Ra(La());return function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l-o*a,e[1]=r*l+s*a,e[2]=o*l+i*a,e[3]=s*l-r*a}(r,r,n?-u(e)+Math.PI:u(e)),za(r,r,-u(t)),Ta(i,i,r),Sa(i,i)}const xh={circle:class extends Ns{constructor(e){super(e,fa)}createBucket(e){return new Qs(e)}queryRadius(e){const t=e;return la("circle-radius",this,t)+la("circle-stroke-width",this,t)+ca(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=ha(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Da(e,i,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Is(this,e)}},heatmap:class extends Ns{createBucket(e){return new Ua(e)}constructor(e){super(e,qa),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Za({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return la("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,o,s,a,l){const c=this.paint.get("heatmap-radius").evaluate(t,n);return Da(e,i,s,a,l,!0,!0,new r(0,0),c)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Is(this,e)}},hillshade:class extends Ns{constructor(e){super(e,Ha)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(e){return new Is(this,e)}},fill:class extends Ns{constructor(e){super(e,Dl)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(e){return new Is(this,e)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Rl(e)}queryRadius(){return ca(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,o){return!e.queryGeometry.isAboveHorizon&&Ks(ua(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends Ns{constructor(e){super(e,ec)}createBucket(e){return new Kl(e)}queryRadius(){return ca(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Is(this,e)}queryIntersectsFeature(e,t,n,i,o,s,a,l,c){const u=ha(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(t,n),d=this.paint.get("fill-extrusion-base").evaluate(t,n),f=[0,0],p=l&&s.elevation,A=s.elevation?s.elevation.exaggeration():1;if(p){const t=e.tile.getBucket(this).centroidVertexArray,n=c+1;if(n<t.length){const e=t.get(n);f[0]=e.a_centroid_pos0,f[1]=e.a_centroid_pos1}}if(0===f[0]&&1===f[1])return!1;const m=function(e,t,n,i,o,s,a,l,c){return s?function(e,t,n,i,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],f=[];for(const c of d){const u=c.x+i.x,d=c.y+i.y,p=rc(u,d,t,n,o,s,a,l);h[0]=u,h[1]=d,h[2]=p.base,h[3]=1,Ia(h,h,r),h[3]=Math.max(h[3],1e-5);const A=ic([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=d,h[2]=p.top,h[3]=1,Ia(h,h,r),h[3]=Math.max(h[3],1e-5);const m=ic([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);e.push(A),f.push(m)}c.push(e),u.push(f)}return[c,u]}(e,t,n,i,o,s,a,l,c):function(e,t,n,i,o){const s=[],a=[],l=o[8]*t,c=o[9]*t,u=o[10]*t,h=o[11]*t,d=o[8]*n,f=o[9]*n,p=o[10]*n,A=o[11]*n;for(const t of e){const e=[],n=[];for(const s of t){const t=s.x+i.x,a=s.y+i.y,m=o[0]*t+o[4]*a+o[12],g=o[1]*t+o[5]*a+o[13],y=o[2]*t+o[6]*a+o[14],_=o[3]*t+o[7]*a+o[15],v=m+l,b=g+c,x=y+u,w=Math.max(_+h,1e-5),E=m+d,S=g+f,T=y+p,k=Math.max(_+A,1e-5),C=new r(v/w,b/w);C.z=x/w,e.push(C);const P=new r(E/k,S/k);P.z=T/k,n.push(P)}s.push(e),a.push(n)}return[s,a]}(e,t,n,i,o)}(i,d,h,u,a,p?l:null,f,A,s.center.lat),g=e.queryGeometry;return function(e,t,n){let i=1/0;Ks(n,t)&&(i=nc(n,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];Xs(n,r)&&(i=Math.min(i,nc(n,r)))}}return i!==1/0&&i}(m[0],m[1],g.isPointQuery()?g.screenBounds:g.screenGeometry)}},line:class extends Ns{constructor(e){super(e,fc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof tn,this.gradientVersion=(this.gradientVersion+1)%a}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=pc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new hc(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new Is(this,e)}queryRadius(e){const t=e,n=Ac(la("line-width",this,t),la("line-gap-width",this,t)),i=la("line-offset",this,t);return n/2+Math.abs(i)+ca(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,o,s){if(e.queryGeometry.isAboveHorizon)return!1;const a=ua(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*Ac(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),c=this.paint.get("line-offset").evaluate(t,n);return c&&(i=function(e,t){const n=[],i=new r(0,0);for(let r=0;r<e.length;r++){const o=e[r],s=[];for(let e=0;e<o.length;e++){const n=o[e-1],r=o[e],a=o[e+1],l=0===e?i:r.sub(n)._unit()._perp(),c=e===o.length-1?i:a.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),s.push(u._mult(t)._add(r))}n.push(s)}return n}(i,c*e.pixelToTileUnitsFactor)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(oa(e,r[t]))return!0;if(Js(e,r,n))return!0}return!1}(a,i,l)}isTileClipped(){return!0}},symbol:mh,background:class extends Ns{constructor(e){super(e,gh)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ns{constructor(e){super(e,yh)}getProgramIds(){return["raster"]}},sky:class extends Ns{constructor(e){super(e,vh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Za({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}}getCenter(e,t){const n=this.paint.get("sky-type");if("atmosphere"===n){const n=this.paint.get("sky-atmosphere-sun"),i=!n,r=e.style.light,o=r.properties.get("position");return i&&"viewport"===r.properties.get("anchor")&&I("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?bh(o.azimuthal,90-o.polar,t):bh(n[0],90-n[1],t)}if("gradient"===n){const e=this.paint.get("sky-gradient-center");return bh(e[0],90-e[1],t)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}},{HTMLImageElement:wh,HTMLCanvasElement:Eh,HTMLVideoElement:Sh,ImageData:Th,ImageBitmap:kh}=s;class Ch{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,n){const{width:i,height:r}=e,o=!(this.size&&this.size[0]===i&&this.size[1]===r||n),{context:s}=this,{gl:a}=s;if(this.useMipmap=Boolean(t&&t.useMipmap),a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!t||!1!==t.premultiply)),o)this.size=[i,r],e instanceof wh||e instanceof Eh||e instanceof Sh||e instanceof Th||kh&&e instanceof kh?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,e):a.texImage2D(a.TEXTURE_2D,0,this.format,i,r,0,this.format,a.UNSIGNED_BYTE,e.data);else{const{x:t,y:o}=n||{x:0,y:0};e instanceof wh||e instanceof Eh||e instanceof Sh||e instanceof Th||kh&&e instanceof kh?a.texSubImage2D(a.TEXTURE_2D,0,t,o,a.RGBA,a.UNSIGNED_BYTE,e):a.texSubImage2D(a.TEXTURE_2D,0,t,o,i,r,a.RGBA,a.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ph{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ih?new Ih(e.lng,e.lat):Ih.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ih?new Ih(e.lng,e.lat):Ih.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,r;if(e instanceof Ih)i=e,r=e;else{if(!(e instanceof Ph))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ph.convert(e)):this.extend(Ih.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Ih(i.lng,i.lat),this._ne=new Ih(r.lng,r.lat)),this}getCenter(){return new Ih((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ih(this.getWest(),this.getNorth())}getSouthEast(){return new Ih(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Ih.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){return!e||e instanceof Ph?e:new Ph(e)}}const Mh=6371008.8;class Ih{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ih(m(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Mh*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new Ph(new Ih(this.lng-n,this.lat-t),new Ih(this.lng+n,this.lat+t))}static convert(e){if(e instanceof Ih)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Ih(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Ih(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Lh=2*Math.PI*Mh;function Rh(e){return Lh*Math.cos(e*Math.PI/180)}function zh(e){return(180+e)/360}function Dh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Oh(e,t){return e/Rh(t)}function Bh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Fh(e,t){return e*Rh(Bh(t))}class Nh{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=Ih.convert(e);return new Nh(zh(n.lng),Dh(n.lat),Oh(t,n.lat))}toLngLat(){return new Ih(360*this.x-180,Bh(this.y))}toAltitude(){return Fh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Lh*(e=Bh(this.y),1/Math.cos(e*Math.PI/180));var e}}class Uh{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Wa({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=w(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;i.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];r=a*n,a+=l,o=a*n,i.push({left:r,right:o,isDash:s,zeroLength:0===l})}return i}addRoundDash(e,t,n){const i=t/2;for(let t=-n;t<=n;t++){const r=this.width*(this.nextRow+n+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/n*(i+1);if(s.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.image.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const n=e[t],i=e[t+1];n.zeroLength?e.splice(t,1):i&&i.isDash===n.isDash&&(i.left=n.left,e.splice(t,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const r=this.width*this.nextRow;let o=0,s=e[o];for(let n=0;n<this.width;n++){n/s.right>1&&(s=e[++o]);const i=Math.abs(n-s.left),a=Math.abs(n-s.right),l=Math.min(i,a);this.image.data[r+n]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,r=i?7:0,o=2*r+1;if(this.nextRow+o>this.height)return I("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(I("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const n=this.width/s,o=this.getDashRanges(e,this.width,n);i?this.addRoundDash(o,n,r):this.addRegularDash(o,"square"===t?.5*n:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[n]=l,l}}ar("LineAtlas",Uh);class jh{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}const Vh=s.performance;function Gh(e){const t=e?e.url.toString():void 0;return Vh.getEntriesByName(t)}class Wh{constructor(){this.tasks={},this.taskQueue=[],S(["process"],this),this.invoker=new jh(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function({type:e,isSymbolTile:t,zoom:n}){return n=n||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-n:"maybePrepare"===e&&t?400-n:500:200-n:100-n}(t);if(0===i){z();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){z();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let n=0;n<this.taskQueue.length;n++){const i=this.tasks[this.taskQueue[n]];i.priority<t&&(t=i.priority,e=n)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}function $h(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}class qh{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Qh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=(r=this.y,o=this.z,s=$h(256*(i=this.x),256*(r=Math.pow(2,o)-r-1),o),a=$h(256*(i+1),256*(r+1),o),s[0]+","+s[1]+","+a[0]+","+a[1]);var i,r,o,s,a;const l=function(e,t,n){let i,r="";for(let o=e;o>0;o--)i=1<<o-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}getTilePoint(e){const t=Math.pow(2,this.z);return new r((e.x*t-this.x)*Gs,(e.y*t-this.y)*Gs)}getTileVec3(e){const t=Math.pow(2,this.z);return ba((e.x*t-this.x)*Gs,(e.y*t-this.y)*Gs,Fh(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Qh(e,t.z,t.z,t.x,t.y)}}class Hh{constructor(e,t,n,i,r){this.overscaledZ=e,this.wrap=t,this.canonical=new qh(n,+i,+r),this.key=0===t&&e===n?this.canonical.key:Qh(t,e,n,i,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Hh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Qh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Qh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Hh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Hh(t,this.wrap,t,n,i),new Hh(t,this.wrap,t,n+1,i),new Hh(t,this.wrap,t,n,i+1),new Hh(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Nh(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new Nh(e.x-this.wrap,e.y,e.z))}}function Qh(e,t,n,i,r){const o=1<<Math.min(n,22);let s=o*(r%o)+i%o;return e&&n<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*s+n)+(t-n)}ar("CanonicalTileID",qh),ar("OverscaledTileID",Hh,{omit:["projMatrix"]});class Xh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Yh{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=i,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}var Kh=To([{name:"a_pos",type:"Int16",components:2}]);class Jh{constructor(e,t,n){this.tileID=e,this.uid=b(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const t=e+this.timeAdded;t<V.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(e,t,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)n[t.id]=i}}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof dh){if(this.hasSymbolBuckets=!0,!n)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof dh&&t.hasRTLText){this.hasRTLText=!0,oo.isLoading()||oo.isLoaded()||"deferred"!==io()||ro();break}}this.queryPadding=0;for(const e in this.buckets){const n=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(n))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ko}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const n=this.buckets[t];n.uploadPending()&&n.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ch(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ch(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ch(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,i,r,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:s,transform:o,params:r},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),r=t?t.sourceLayer:"",o=i._geojsonTileLayer||i[r];if(!o)return;const s=Ei(t&&t.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let t=0;t<o.length;t++){const i=o.feature(t);if(s.needGeometry){const e=Zs(i,!0);if(!s.filter(new so(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new so(this.tileID.overscaledZ),i))continue;const h=n.getId(i,r),d=new Yh(i,a,l,c,h);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=D(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let n=!1;if(this.expirationTime>e)n=!1;else if(t)if(this.expirationTime<t)n=!0;else{const i=this.expirationTime-t;i?this.expirationTime=e+Math.max(i,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!t.style.hasLayer(i))continue;const r=this.buckets[i],o=r.layers[0].sourceLayer||"_geojsonTileLayer",s=n[o],a=e[o];if(!s||!a||0===Object.keys(a).length)continue;r.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=t&&t.style&&t.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<V.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=V.now()+e}setDependencies(e,t){const n={};for(const e of t)n[e]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}}class ed{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},_(this.stateChanges[e][i],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==i&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const t in this.state[e][i])n[t]||(this.deletedStates[e][i][t]=null)}else for(const t in n)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][t]&&delete this.deletedStates[e][i][t]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),i=_({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const n=this.deletedStates[e][t];if(null===n)return{};for(const e in n)delete i[e]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const n in this.stateChanges[e])this.state[e][n]||(this.state[e][n]={}),_(this.state[e][n],this.stateChanges[e][n]),t[n]=this.state[e][n];n[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const n in this.state[e])t[n]={},this.state[e][n]={};else for(const n in this.deletedStates[e]){if(null===this.deletedStates[e][n])this.state[e][n]={};else for(const t of Object.keys(this.deletedStates[e][n]))delete this.state[e][n][t];t[n]=this.state[e][n]}n[e]=n[e]||{},_(n[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const i in e)e[i].setFeatureState(n,t)}}class td{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function nd(e,t,n,i){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(i[s])<1e-15){if(n[s]<e[s]||n[s]>t[s])return null}else{const a=1/i[s];let l=(e[s]-n[s])*a,c=(t[s]-n[s])*a;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function id(e,t,n,i,r,o,s,a,l,c,u){const h=i-e,d=r-t,f=o-n,p=s-e,A=a-t,m=l-n,g=u[1]*m-u[2]*A,y=u[2]*p-u[0]*m,_=u[0]*A-u[1]*p,v=h*g+d*y+f*_;if(Math.abs(v)<1e-15)return null;const b=1/v,x=c[0]-e,w=c[1]-t,E=c[2]-n,S=(x*g+w*y+E*_)*b;if(S<0||S>1)return null;const T=w*f-E*d,k=E*h-x*f,C=x*d-w*h,P=(u[0]*T+u[1]*k+u[2]*C)*b;return P<0||S+P>1?null:(p*T+A*k+m*C)*b}function rd(e,t,n){return(e-t)/(n-t)}function od(e,t,n,i,r,o,s,a,l){const c=1<<n,u=o-i,h=s-r,d=(e+1)/c*u+i,f=(t+0)/c*h+r,p=(t+1)/c*h+r;a[0]=(e+0)/c*u+i,a[1]=f,l[0]=d,l[1]=p}class sd{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let i=Math.ceil(Math.pow(2,t));const r=1/i,o=(e,t,n,i,r)=>{const o=i?1:0,s=(e+1)*n-o,a=t*n,l=(t+1)*n-o;r[0]=e*n,r[1]=a,r[2]=s,r[3]=l};let s=new td(i);const a=[];for(let t=0;t<i*i;t++){o(t%i,Math.floor(t/i),r,!1,a);const n=ld(a[0],a[1],e),l=ld(a[2],a[1],e),c=ld(a[2],a[3],e),u=ld(a[0],a[3],e);s.minimums.push(Math.min(n,l,c,u)),s.maximums.push(Math.max(n,l,c,u)),s.leaves.push(1)}for(n.push(s),i/=2;i>=1;i/=2){const e=n[n.length-1];s=new td(i);for(let t=0;t<i*i;t++){o(t%i,Math.floor(t/i),2,!0,a);const n=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),f=e.isLeaf(a[0],a[3]),p=Math.min(n.min,r.min,l.min,c.min),A=Math.max(n.max,r.max,l.max,c.max),m=u&&h&&d&&f;s.maximums.push(A),s.minimums.push(p),s.leaves.push(A-p<=5&&m?1:0)}n.push(s)}return n}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,r,o,s=1){return nd([e,t,-100],[n,i,this.maximums[0]*s],r,o)}raycast(e,t,n,i,r,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,n,i,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:f,nodex:p,nodey:A,depth:m}=d.pop();if(this.leaves[a]){od(p,A,m,e,t,n,i,u,h);const a=1<<m,l=(p+0)/a,c=(p+1)/a,d=(A+0)/a,g=(A+1)/a,y=ld(l,d,this.dem)*s,_=ld(c,d,this.dem)*s,v=ld(c,g,this.dem)*s,b=ld(l,g,this.dem)*s,x=id(u[0],u[1],y,h[0],u[1],_,h[0],h[1],v,r,o),w=id(h[0],h[1],v,u[0],h[1],b,u[0],u[1],y,r,o),E=Math.min(null!==x?x:Number.MAX_VALUE,null!==w?w:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const e=Ea([],r,o,f);if(ad(y,_,b,v,rd(e[0],u[0],h[0]),rd(e[1],u[1],h[1]))>=e[2])return f}continue}let g=0;for(let d=0;d<this._siblingOffset.length;d++){od((p<<1)+this._siblingOffset[d][0],(A<<1)+this._siblingOffset[d][1],m+1,e,t,n,i,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const f=nd(u,h,r,o);if(null!=f){const e=f;l[d]=e;let t=!1;for(let n=0;n<g&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,d),t=!0);t||(c[g]=d),g++}}for(let e=0;e<g;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(p<<1)+this._siblingOffset[t][0],nodey:(A<<1)+this._siblingOffset[t][1],depth:m+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,r){if(1===e[i].isLeaf(t,n))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=i-1,s=e[o];let a,l=0;for(let e=0;e<this._siblingOffset.length;e++){const i=2*t+this._siblingOffset[e][0],r=2*n+this._siblingOffset[e][1],o=s.getElevation(i,r),c=s.isLeaf(i,r),u=this._addNode(o.min,o.max,c);c&&(l|=1<<e),a||(a=u)}for(let i=0;i<this._siblingOffset.length;i++)l&1<<i||this._construct(e,2*t+this._siblingOffset[i][0],2*n+this._siblingOffset[i][1],o,a+i)}}function ad(e,t,n,i,r,o){return nn(nn(e,n,o),nn(t,i,o),r)}function ld(e,t,n){const i=n.dim,r=A(e*i-.5,0,i-1),o=A(t*i-.5,0,i-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,i-1),c=Math.min(a+1,i-1);return ad(n.get(s,a),n.get(l,a),n.get(s,c),n.get(l,c),r-s,o-a)}const cd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ud{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,i=!1,r=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return I(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const o=this.dim=t.height-2;if(this.data=new Uint32Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=i,!i){for(let e=0;e<o;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(o,e)]=this.data[this._idx(o-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,o)]=this.data[this._idx(e,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new sd(this)}get(e,t,n=!1){const i=new Uint8Array(this.data.buffer);n&&(e=A(e,-1,this.dim),t=A(t,-1,this.dim));const r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(i[r],i[r+1],i[r+2])}static getUnpackVector(e){return cd[e]}get unpackVector(){return cd[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,n){return(256*e*256+256*t+n)/10-1e4}_unpackTerrarium(e,t,n){return 256*e+t+n/256-32768}static pack(e,t){const n=[0,0,0,0],i=ud.getUnpackVector(t);let r=Math.floor((e+i[3])/i[2]);return n[2]=r%256,r=Math.floor(r/256),n[1]=r%256,r=Math.floor(r/256),n[0]=r,n}getPixels(){return new $a({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let t=o;t<s;t++)for(let n=i;n<r;n++)this.data[this._idx(n,t)]=e.data[this._idx(n+a,t+l)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}ar("DEMData",ud),ar("DemMinMaxQuadTree",sd,{omit:["dem"]});class hd{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const e of t)this.remove(e.value.tileID,e)}}class dd{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}dd.ReadOnly=!1,dd.ReadWrite=!0,dd.disabled=new dd(519,dd.ReadOnly,[0,1]);const fd=7680;class pd{constructor(e,t,n,i,r,o){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}pd.disabled=new pd({func:519,mask:0},0,0,fd,fd,fd);class Ad{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}Ad.Replace=[1,0],Ad.disabled=new Ad(Ad.Replace,ut.transparent,[!1,!1,!1,!1]),Ad.unblended=new Ad(Ad.Replace,ut.transparent,[!0,!0,!0,!0]),Ad.alphaBlended=new Ad([1,771],ut.transparent,[!0,!0,!0,!0]);const md=1029,gd=2305;class yd{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}yd.disabled=new yd(!1,md,gd),yd.backCCW=new yd(!0,md,gd),yd.backCW=new yd(!0,md,2304),yd.frontCW=new yd(!0,1028,2304),yd.frontCCW=new yd(!0,1028,gd);class _d extends Be{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new hd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ed}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return y(this._tiles).map((e=>e.tileID)).sort(vd).map((e=>e.key))}getRenderableIds(e){const t=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&t.push(this._tiles[n]);return e?t.sort(((e,t)=>{const n=e.tileID,i=t.tileID,o=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),s=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(vd).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new Oe(i,{tile:e})):this.update(this.transform));e.timeAdded=V.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new De("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,r=Math.floor(n*i*5),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let i;this.updateCacheSize(e,t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Hh(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(i=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter((e=>this._source.hasTile(e))))):i=[];const r=this._updateRetainedTiles(i);if(bd(this._source.type)&&0!==i.length){const e={},t={},n=Object.keys(r);for(const i of n){const n=r[i],o=this._tiles[i];if(!o||o.fadeEndTime&&o.fadeEndTime<=V.now())continue;const s=this.findLoadedParent(n,Math.max(n.overscaledZ-_d.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),t[i]=n}const o=i[i.length-1].overscaledZ;for(const e in this._tiles){const n=this._tiles[e];if(r[e]||!n.hasData())continue;let i=n.tileID;for(;i.overscaledZ>o;){i=i.scaledTo(i.overscaledZ-1);const o=this._tiles[i.key];if(o&&o.hasData()&&t[i.key]){r[e]=n.tileID;break}}}for(const t in e)r[t]||(this._coveredTiles[t]=!0,r[t]=e[t])}for(const e in r)this._tiles[e].clearFadeHold();const o=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n}(this._tiles,r);for(const e of o){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e[e.length-1].overscaledZ,r=e[0].overscaledZ,o=Math.max(r-_d.maxOverzooming,this._source.minzoom),s=Math.max(r+_d.maxUnderzooming,this._source.minzoom),a={};for(const n of e){const e=this._addTile(n);t[n.key]=n,e.hasData()||i<this._source.maxzoom&&(a[n.key]=n)}this._retainLoadedChildren(a,i,s,t);for(const i of e){let e=this._tiles[i.key];if(e.hasData())continue;if(i.canonical.z>=this._source.maxzoom){const e=i.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=i.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let s=i.overscaledZ-1;s>=o;--s){const o=i.scaledTo(s);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&r&&(e=this._addTile(o)),e&&(t[o.key]=o,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);return n||(t=new Jh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))),t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new De("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,t,n){const i=[],r=this.transform;if(!r)return i;for(const o in this._tiles){const s=this._tiles[o];if(n&&s.clearQueryDebugViz(),s.holdingForFade())continue;const a=e.containsTile(s,r,t);a&&i.push(a)}return i}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(bd(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=V.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter((n=>!n.hasDependency(e,t)))}}function vd(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function bd(e){return"raster"===e||"image"===e||"video"===e}_d.maxOverzooming=10,_d.maxUnderzooming=3;class xd{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const r=i.dem,o=i.tileID,s=1<<t.canonical.z-o.canonical.z;return new xd(i,i.tileSize/Gs/s,[(t.canonical.x/s-o.canonical.x)*r.dim,(t.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),o=Math.floor(n);return new r(i,o)}getElevationAt(e,t,n,i){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return i=!!i,n?nn(nn(l.get(s,a,i),l.get(s,a+1,i),o-a),nn(l.get(s+1,a,i),l.get(s+1,a+1,i),o-a),r-s):l.get(s,a,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Oh(1,e)*this._dem.stride}}class wd{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new nr(Gs,16,0),this.featureIndexArray=new ss,this.promoteId=t}insert(e,t,n,i,r,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r,o);const a=this.grid;for(let e=0;e<t.length;e++){const n=t[e],i=[1/0,1/0,-1/0,-1/0];for(let e=0;e<n.length;e++){const t=n[e];i[0]=Math.min(i[0],t.x),i[1]=Math.min(i[1],t.y),i[2]=Math.max(i[2],t.x),i[3]=Math.max(i[3],t.y)}i[0]<Gs&&i[1]<Gs&&i[2]>=0&&i[3]>=0&&a.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Zl.VectorTile(new zc(this.rawTileData)).layers,this.sourceLayerCoder=new Xh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,n,i){this.loadVTLayers();const r=e.params||{},o=Ei(r.filter),s=e.tileResult,a=e.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,n,i)=>sa(s.bufferedTilespaceGeometry,e,t,n,i)));c.sort(Sd);let u=null;a.elevation&&c.length>0&&(u=xd.create(a.elevation,this.tileID));const h={};let d;for(let a=0;a<c.length;a++){const l=c[a];if(l===d)continue;d=l;const f=this.featureIndexArray.get(l);let p=null;this.loadMatchingFeature(h,f,o,r.layers,r.availableImages,t,n,i,((t,n,i,r=0)=>(p||(p=qs(t)),n.queryIntersectsFeature(s,t,i,p,this.z,e.transform,e.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(e,t,n,i,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,f=this.bucketLayerIDs[u];if(i&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(i,f))return;const p=this.sourceLayerCoder.decode(h),A=this.vtLayers[p].feature(c);if(n.needGeometry){const e=Zs(A,!0);if(!n.filter(new so(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new so(this.tileID.overscaledZ),A))return;const m=this.getId(A,p);for(let t=0;t<f.length;t++){const n=f[t];if(i&&i.indexOf(n)<0)continue;const u=o[n];if(!u)continue;let h={};void 0!==m&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",m));const p=_({},s[n]);p.paint=Ed(p.paint,u.paint,A,h,r),p.layout=Ed(p.layout,u.layout,A,h,r);const g=!l||l(A,u,h,d);if(!g)continue;const y=new Yh(A,this.z,this.x,this.y,m);y.layer=p;let v=e[n];void 0===v&&(v=e[n]=[]),v.push({featureIndex:c,feature:y,intersectionZ:g})}}lookupSymbolFeatures(e,t,n,i,r,o,s,a){const l={};this.loadVTLayers();const c=Ei(r);for(const r of e)this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:i,featureIndex:r,layoutVertexArrayOffset:0},c,o,s,a,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof n&&(n=Number(n))),n}}function Ed(e,t,n,i,r){return k(e,((e,o)=>{const s=t instanceof Ao?t.get(o):null;return s&&s.evaluate?s.evaluate(n,i,r):s}))}function Sd(e,t){return t-e}ar("FeatureIndex",wd,{omit:["rawTileData","sourceLayerCoder"]});class Td{constructor(e){const t={},n=[];for(const i in e){const r=e[i],o=t[i]={};for(const e in r.glyphs){const t=r.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i=t.metrics.localGlyph?2:1,s={x:0,y:0,w:t.bitmap.width+2*i,h:t.bitmap.height+2*i};n.push(s),o[e]=s}}const{w:i,h:r}=iu(n),o=new Wa({width:i||1,height:r||1});for(const n in e){const i=e[n];for(const e in i.glyphs){const r=i.glyphs[+e];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const s=t[n][e],a=r.metrics.localGlyph?2:1;Wa.copy(r.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},r.bitmap)}}this.image=o,this.positions=t}}ar("GlyphAtlas",Td);class kd{constructor(e){this.tileID=new Hh(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,t,n,i,r){this.status="parsing",this.data=e,this.collisionBoxArray=new Ko;const o=new Xh(Object.keys(e.layers).sort()),s=new wd(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Uh(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n},u=t.familiesBySource[this.source];for(const t in u){const i=e.layers[t];if(!i)continue;let r=!1,l=!1;for(const e of u[t])"symbol"===e[0].type?r=!0:l=!0;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!l)continue;1===i.version&&I(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=o.encode(t),d=[];for(let e=0;e<i.length;e++){const n=i.feature(e),r=s.getId(n,t);d.push({feature:n,id:r,index:e,sourceLayerIndex:h})}for(const e of u[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Cd(e,this.zoom,n),(a[t.id]=t.createBucket({index:s.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(d,c,this.tileID.canonical),s.bucketLayerIDs.push(e.map((e=>e.id))))}}let h,d,f,p;l.trim();const A={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},m=k(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(m).length?i.send("getGlyphs",{uid:this.uid,stacks:m},((e,t)=>{h||(h=e,d=t,v.call(this))}),void 0,!1,A):d={};const g=Object.keys(c.iconDependencies);g.length?i.send("getImages",{icons:g,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,f=t,v.call(this))}),void 0,!1,A):f={};const _=Object.keys(c.patternDependencies);function v(){if(h)return r(h);if(d&&f&&p){const e=new Td(d),t=new ou(f,p);for(const i in a){const r=a[i];r instanceof dh?(Cd(r.layers,this.zoom,n),Xu(r,d,e.positions,f,t.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):r.hasPattern&&(r instanceof hc||r instanceof Rl||r instanceof Kl)&&(Cd(r.layers,this.zoom,n),r.addFeatures(c,this.tileID.canonical,t.patternPositions))}this.status="done",r(null,{buckets:y(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}_.length?i.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,p=t,v.call(this))}),void 0,!1,A):p={},v.call(this)}}function Cd(e,t,n){const i=new so(t);for(const t of e)t.recalculate(i,n)}class Pd{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,n]=r.result;return this.scheduler?this.scheduler.add((()=>{i(e,n)}),t):i(e,n),()=>{}}return r.callbacks.push(i),r.cancel||(r.cancel=n(((n,i)=>{r.result=[n,i];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(n,i)}),t):e(n,i);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==i)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function Md(e,t,n){const i=JSON.stringify(e.request);return e.data&&(this.deduped.entries[i]={result:[null,e.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const i=Se(e.request,((e,i,r,o)=>{e?t(e):i&&t(null,{vectorTile:n?void 0:new Zl.VectorTile(new zc(i)),rawData:i,cacheControl:r,expires:o})}));return()=>{i.cancel(),t()}}),t)}e.ARRAY_TYPE=pa,e.AUTH_ERR_MSG=K,e.Actor=class{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},S(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=z()?e:s,this.scheduler=new Wh}send(e,t,n,i,r=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=U(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:i,mustQueue:r,sourceMapId:this.mapId,data:ur(t,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||z()){const e=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add((()=>this.processTask(n,t)),e&&e.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(hr(t.error)):n(null,hr(t.data)))}else{const n=U(this.globalScope)?void 0:[],i=t.hasCallback?(t,i)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?ur(t):null,data:ur(i,n)},n)}:e=>{},r=hr(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,i);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source)[e[1]](r,i)}else i(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.CanonicalTileID=qh,e.Color=ut,e.ColorMode=Ad,e.CullFaceMode=yd,e.DEMData=ud,e.DataConstantProperty=mo,e.DedupedRequest=Pd,e.DepthMode=dd,e.EXTENT=Gs,e.Elevation=class{getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,n=!0){null==t&&(t=null);const i=this._source();if(!i)return t;if(e.y<0||e.y>1)return t;const r=i.getSource().maxzoom,o=1<<r,s=Math.floor(e.x),a=e.x-s,l=new Hh(r,s,r,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,f=(e.y*h-c.tileID.canonical.y)*u.dim,p=Math.floor(d),A=Math.floor(f);return(n?this.exaggeration():1)*nn(nn(u.get(p,A),u.get(p,A+1),f-A),nn(u.get(p+1,A),u.get(p+1,A+1),f-A),d-p)}getAtTileOffset(e,t,n){const i=1<<e.canonical.z;return this.getAtPointOrZero(new Nh(e.wrap+(e.canonical.x+t/Gs)/i,(e.canonical.y+n/Gs)/i))}getForTilePoints(e,t,n,i){const r=xd.create(this,e,i);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],n)})),!0)}getMinMaxForTile(e){const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,i=t.tileID,r=1<<e.canonical.z-i.canonical.z;let o=e.canonical.x/r-i.canonical.x,s=e.canonical.y/r-i.canonical.y,a=0;for(let t=0;t<e.canonical.z-i.canonical.z&&!n.leaves[a];t++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=Oe,e.EvaluationParameters=so,e.Event=De,e.Evented=Be,e.GlyphManager=Du,e.ImagePosition=ru,e.LineAtlas=Uh,e.LngLat=Ih,e.LngLatBounds=Ph,e.LocalGlyphMode=zu,e.MAX_SAFE_INTEGER=a,e.MercatorCoordinate=Nh,e.ONE_EM=xc,e.OverscaledTileID=Hh,e.Properties=bo,e.RGBAImage=$a,e.RequestManager=class{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Y,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!J(e))return e;const n=ne(e);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!J(e))return e;const n=ne(e);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t){if(!J(e))return e;const n=ne(e);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,i){const r=ne(e);return J(e)?(r.path=`/styles/v1${r.path}/sprite${t}${n}`,this._makeAPIURL(r,this._customAccessToken||i)):(r.path+=`${t}${n}`,ie(r))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!J(e))return e;const i=ne(e);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||n&&"raster"!==i.authority&&512===n?"@2x":""}${$.supported?".webp":"$1"}`),"raster"===i.authority?i.path=`/${W.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${W.TILE_URL_VERSION}${i.path}`);const r=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||W.ACCESS_TOKEN;return W.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,r)}canonicalizeTileURL(e,t){const n=ne(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+=`raster/${n.path.replace(`/${W.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${n.path.replace(`/${W.TILE_URL_VERSION}/`,"")}`;let r=n.params;return t&&(r=r.filter((e=>!e.match(/^access_token=/)))),r.length&&(i+=`?${r.join("&")}`),i}canonicalizeTileset(e,t){const n=!!t&&J(t),i=[];for(const t of e.tiles||[])ee(t)?i.push(this.canonicalizeTileURL(t,n)):i.push(t);return i}_makeAPIURL(e,t){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",i=ne(W.API_URL);if(e.protocol=i.protocol,e.authority=i.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==i.path&&(e.path=`${i.path}${e.path}`),!W.REQUIRE_ACCESS_TOKEN)return ie(e);if(t=t||W.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),ie(e)}},e.ResourceType=be,e.SegmentVector=Vs,e.SourceCache=_d,e.StencilMode=pd,e.StructArrayLayout1ui2=Zo,e.StructArrayLayout2f1f2i16=Fo,e.StructArrayLayout2i4=Co,e.StructArrayLayout2ui4=qo,e.StructArrayLayout3f12=Io,e.StructArrayLayout3ui6=Uo,e.StructArrayLayout4i8=Po,e.Texture=Ch,e.Tile=Jh,e.Transitionable=co,e.Uniform1f=vs,e.Uniform1i=class extends _s{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.Uniform2f=class extends _s{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.Uniform3f=class extends _s{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.Uniform4f=bs,e.UniformColor=xs,e.UniformMatrix3f=class extends _s{constructor(e,t){super(e,t),this.current=Es}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},e.UniformMatrix4f=class extends _s{constructor(e,t){super(e,t),this.current=ws}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.UnwrappedTileID=Zh,e.ValidationError=Ne,e.VectorTileWorkerSource=class extends Be{constructor(e,t,n,i,r){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=r||Md,this.loading={},this.loaded={},this.deduped=new Pd(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler}loadTile(e,t){const n=e.uid,i=e&&e.request,r=i&&i.collectResourceTiming,o=this.loading[n]=new kd(e);o.abort=this.loadVectorData(e,((s,a)=>{const l=!this.loading[n];if(delete this.loading[n],l||s||!a)return o.status="done",l||(this.loaded[n]=o),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new Zl.VectorTile(new zc(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,n)=>{if(e||!n)return t(e);const o={};if(r){const e=Gh(i);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,_({rawTileData:c.slice(0)},n,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[n]=o}))}reloadTile(e,t){const n=this.loaded,i=e.uid,r=this;if(n&&n[i]){const o=n[i];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain;const s=(e,n)=>{const i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,i)),t(e,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}},e.WritingMode=su,e.ZoomHistory=dr,e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},e.addDynamicAttributes=lh,e.altitudeFromMercatorZ=Fh,e.asyncAll=g,e.bezier=f,e.bindAll=S,e.bufferConvexPolygon=function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=m(i-1,-1,e.length-1),o=m(i+1,-1,e.length-1),s=e[i],a=e[o],l=e[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(s.add(h))}return n},e.cacheEntryPossiblyAdded=function(e){ve++,ve>ge&&(e.getActor().send("enforceCacheSizeLimit",me),ve=0)},e.clamp=A,e.clearTileCache=function(e){const t=s.caches.delete(fe);e&&t.catch(e).then((()=>e()))},e.clipLine=Mu,e.clone=function(e){var t=new pa(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.clone$1=function(e){var t=new pa(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$2=P,e.collisionCircleLayout=bc,e.config=W,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.create=_a,e.create$1=function(){var e=new pa(16);return pa!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$2=Aa,e.createExpression=ui,e.createFilter=Ei,e.createLayout=To,e.createStyleLayer=function(e){return"custom"===e.type?new _h(e):new xh[e.type](e)},e.cross=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e},e.degToRad=u,e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.ease=p,e.easeCubicInOut=d,e.emitValidationErrors=tr,e.endsWith=T,e.enforceCacheSizeLimit=function(e){ye(),pe&&pe.then((t=>{t.keys().then((n=>{for(let i=0;i<n.length-e;i++)t.delete(n[i])}))}))},e.evaluateSizeForFeature=Sc,e.evaluateSizeForZoom=Tc,e.evaluateVariableOffset=Qu,e.evented=no,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=V,e.exported$1=$,e.extend=_,e.filterObject=C,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,f=r*a,p=r*l,A=o*s,m=o*a,g=o*l;return e[0]=1-h-p,e[1]=u+g,e[2]=d-m,e[3]=0,e[4]=u-g,e[5]=1-c-p,e[6]=f+A,e[7]=0,e[8]=d+m,e[9]=f-A,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return h[t]},e.getAABBPointSquareDist=function(e,t,n){let i=0;for(let r=0;r<2;++r){const o=n?n[r]:0;e[r]>o&&(i+=(e[r]-o)*(e[r]-o)),t[r]<o&&(i+=(o-t[r])*(o-t[r]))}return i},e.getAnchorAlignment=yu,e.getAnchorJustification=Yu,e.getBounds=function(e){let t=1/0,n=1/0,i=-1/0,o=-1/0;for(const r of e)t=Math.min(t,r.x),n=Math.min(n,r.y),i=Math.max(i,r.x),o=Math.max(o,r.y);return{min:new r(t,n),max:new r(i,o)}},e.getImage=Le,e.getJSON=function(e,t){return Ee(_(e,{type:"json"}),t)},e.getMapSessionAPI=he,e.getPerformanceMeasurement=Gh,e.getRTLTextPluginStatus=io,e.getReferrer=we,e.getVideo=function(e,t){const n=s.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let t=0;t<e.length;t++){const i=s.document.createElement("source");Ce(e[t])||(n.crossOrigin="Anonymous"),i.src=e[t],n.appendChild(i)}return{cancel:()=>{}}},e.identity=ma,e.identity$1=Ra,e.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],A=t[13],m=t[14],g=t[15],y=n*a-i*s,_=n*l-r*s,v=n*c-o*s,b=i*l-r*a,x=i*c-o*a,w=r*c-o*l,E=u*A-h*p,S=u*m-d*p,T=u*g-f*p,k=h*m-d*A,C=h*g-f*A,P=d*g-f*m,M=y*P-_*C+v*k+b*T-x*S+w*E;return M?(e[0]=(a*P-l*C+c*k)*(M=1/M),e[1]=(r*C-i*P-o*k)*M,e[2]=(A*w-m*x+g*b)*M,e[3]=(d*x-h*w-f*b)*M,e[4]=(l*T-s*P-c*S)*M,e[5]=(n*P-r*T+o*S)*M,e[6]=(m*v-p*w-g*_)*M,e[7]=(u*w-d*v+f*_)*M,e[8]=(s*C-a*T+c*E)*M,e[9]=(i*T-n*C-o*E)*M,e[10]=(p*x-A*v+g*y)*M,e[11]=(h*v-u*x-f*y)*M,e[12]=(a*S-s*k-l*E)*M,e[13]=(n*k-i*S+r*E)*M,e[14]=(A*_-p*b-m*y)*M,e[15]=(u*b-h*_+d*y)*M,e):null},e.isMapAuthenticated=function(e){return de.has(e)},e.isMapboxURL=J,e.latFromMercatorY=Bh,e.len=Ma,e.length=va,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.loadVectorTile=Md,e.makeRequest=Ee,e.mercatorXfromLng=zh,e.mercatorYfromLat=Dh,e.mercatorZfromAltitude=Oh,e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},e.mul$1=ya,e.mul$2=Pa,e.multiply=ga,e.multiply$1=wa,e.nextPowerOfTwo=w,e.normalize=Sa,e.normalize$1=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=o*s,e},e.number=nn,e.ortho=function(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e},e.pbf=zc,e.perspective=function(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(o=1/(i-r)),e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e},e.pick=function(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n},e.plugin=oo,e.pointGeometry=r,e.polygonIntersectsBox=sa,e.polygonIntersectsPolygon=Xs,e.polygonizeBounds=function(e,t,n=0,i=!0){const o=new r(n,n),s=e.sub(o),a=t.add(o),l=[s,new r(a.x,s.y),a,new r(s.x,a.y)];return i&&l.push(s),l},e.posAttributes=Kh,e.postMapLoadEvent=ce,e.postTurnstileEvent=ae,e.potpack=iu,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=function(e){return e*c},e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:Kr,pluginURL:Jr}),no.on("pluginStateChange",e),e},e.removeAuthState=function(e){de.delete(e)},e.renderColorRamp=Za,e.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e},e.rotateX$1=za,e.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r,e},e.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e},e.rotateZ$1=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},e.scale$1=function(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scale$2=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.scaleAndAdd=Ea,e.setCacheLimits=function(e,t){me=e,ge=t},e.setRTLTextPlugin=function(e,t,n=!1){if(Kr===Hr||Kr===Qr||Kr===Xr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Jr=V.resolveURL(e),Kr=Hr,Yr=t,to(),n||ro()},e.smoothstep=function(e,t,n){return(n=A((n-e)/(t-e),0,1))*n*(3-2*n)},e.spec=Fe,e.storeAuthState=function(e,t){t?de.add(e):de.delete(e)},e.sub=Ca,e.subtract=xa,e.symbolSize=kc,e.transformMat3=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e},e.transformMat4=Ia,e.transformMat4$1=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e},e.transformQuat=Ta,e.translate=function(e,t,n){var i,r,o,s,a,l,c,u,h,d,f,p,A=n[0],m=n[1],g=n[2];return t===e?(e[12]=t[0]*A+t[4]*m+t[8]*g+t[12],e[13]=t[1]*A+t[5]*m+t[9]*g+t[13],e[14]=t[2]*A+t[6]*m+t[10]*g+t[14],e[15]=t[3]*A+t[7]*m+t[11]*g+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=i=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=i*A+a*m+h*g+t[12],e[13]=r*A+l*m+d*g+t[13],e[14]=o*A+c*m+f*g+t[14],e[15]=s*A+u*m+p*g+t[15]),e},e.triggerPluginCompletionEvent=eo,e.uniqueId=b,e.validateCustomStyleLayer=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateFog=Ki,e.validateLight=Yi,e.validateStyle=Xi,e.values=y,e.vectorTile=Zl,e.version=t,e.warnOnce=I,e.window=s,e.wrap=m})),i(["./shared"],(function(e){function t(e){const n=typeof e;if("number"===n||"boolean"===n||"string"===n||null==e)return JSON.stringify(e);if(Array.isArray(e)){let n="[";for(const i of e)n+=`${t(i)},`;return`${n}]`}const i=Object.keys(e).sort();let r="{";for(let n=0;n<i.length;n++)r+=`${JSON.stringify(i[n])}:${t(e[i[n]])},`;return`${r}}`}function n(n){let i="";for(const r of e.refProperties)i+=`/${t(n[r])}`;return i}class i{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,i){for(const n of t){this._layerConfigs[n.id]=n;const t=this._layers[n.id]=e.createStyleLayer(n);t._featureFilter=e.createFilter(t.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=function(e,t){const i={};for(let r=0;r<e.length;r++){const o=t&&t[e[r].id]||n(e[r]);t&&(t[e[r].id]=o);let s=i[o];s||(s=i[o]=[]),s.push(e[r])}const r=[];for(const e in i)r.push(i[e]);return r}(e.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}const{ImageBitmap:r}=e.window;class o{loadTile(t,n){const{uid:i,encoding:o,rawImageData:s,padding:a,buildQuadTree:l}=t,c=r&&s instanceof r?this.getImageData(s,a):s;n(null,new e.DEMData(i,c,o,a<1,l))}getImageData(t,n){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-n,-n,t.width+2*n,t.height+2*n);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:i.width,height:i.height},i.data)}}var s=function e(t,n){var i,r=t&&t.type;if("FeatureCollection"===r)for(i=0;i<t.features.length;i++)e(t.features[i],n);else if("GeometryCollection"===r)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],n);else if("Feature"===r)e(t.geometry,n);else if("Polygon"===r)a(t.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<t.coordinates.length;i++)a(t.coordinates[i],n);return t};function a(e,t){if(0!==e.length){l(e[0],t);for(var n=1;n<e.length;n++)l(e[n],!t)}}function l(e,t){for(var n=0,i=0,r=e.length,o=r-1;i<r;o=i++)n+=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]);n>=0!=!!t&&e.reverse()}const c=e.vectorTile.VectorTileFeature.prototype.toGeoJSON;class u{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.pointGeometry(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.pointGeometry(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return c.call(this,e,t,n)}}class h{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(e){return new u(this._features[e])}}var d=e.vectorTile.VectorTileFeature,f=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function A(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new A(this.features[e],this.options.extent)},A.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var n=0;n<t.length;n++){for(var i=t[n],r=[],o=0;o<i.length;o++)r.push(new e.pointGeometry(i[o][0],i[o][1]));this.geometry.push(r)}return this.geometry},A.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[t,i,n,r]},A.prototype.toGeoJSON=d.prototype.toGeoJSON;var m=y,g=f;function y(t){var n=new e.pbf;return function(e,t){for(var n in e.layers)t.writeMessage(3,_,e.layers[n])}(t,n),n.finish()}function _(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)i.feature=e.feature(n),t.writeMessage(2,v,i);var r=i.keys;for(n=0;n<r.length;n++)t.writeStringField(3,r[n]);var o=i.values;for(n=0;n<o.length;n++)t.writeMessage(4,S,o[n])}function v(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,b,e),t.writeVarintField(3,n.type),t.writeMessage(4,E,n)}function b(e,t){var n=e.feature,i=e.keys,r=e.values,o=e.keycache,s=e.valuecache;for(var a in n.properties){var l=o[a];void 0===l&&(i.push(a),o[a]=l=i.length-1),t.writeVarint(l);var c=n.properties[a],u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,d=s[h];void 0===d&&(r.push(c),s[h]=d=r.length-1),t.writeVarint(d)}}function x(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function E(e,t){for(var n=e.loadGeometry(),i=e.type,r=0,o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=1;1===i&&(c=l.length),t.writeVarint(x(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&t.writeVarint(x(2,u-1));var d=l[h].x-r,f=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(f)),r+=d,o+=f}3===i&&t.writeVarint(x(7,1))}}function S(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function T(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;k(e,t,s,i,r,o%2),T(e,t,n,i,s-1,o+1),T(e,t,n,s+1,r,o+1)}function k(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);k(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(C(e,t,i,n),t[2*r+o]>s&&C(e,t,i,r);a<l;){for(C(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?C(e,t,i,l):(l++,C(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function C(e,t,n,i){P(e,n,i),P(t,2*n,2*i),P(t,2*n+1,2*i+1)}function P(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function M(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}m.fromVectorTileJs=y,m.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var i in e)n[i]=new f(e[i].features,t),n[i].name=i,n[i].version=t.version,n[i].extent=t.extent;return y({layers:n})},m.GeoJSONWrapper=g;const I=e=>e[0],L=e=>e[1];class R{constructor(e,t=I,n=L,i=64,r=Float64Array){this.nodeSize=i,this.points=e;const o=e.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(e.length),a=this.coords=new r(2*e.length);for(let i=0;i<e.length;i++)s[i]=i,a[2*i]=t(e[i]),a[2*i+1]=n(e[i]);T(s,a,i,0,s.length-1,0)}range(e,t,n,i){return function(e,t,n,i,r,o,s){const a=[0,e.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),f=a.pop();if(d-f<=s){for(let s=f;s<=d;s++)c=t[2*s],u=t[2*s+1],c>=n&&c<=r&&u>=i&&u<=o&&l.push(e[s]);continue}const p=Math.floor((f+d)/2);c=t[2*p],u=t[2*p+1],c>=n&&c<=r&&u>=i&&u<=o&&l.push(e[p]);const A=(h+1)%2;(0===h?n<=c:i<=u)&&(a.push(f),a.push(p-1),a.push(A)),(0===h?r>=c:o>=u)&&(a.push(p+1),a.push(d),a.push(A))}return l}(this.ids,this.coords,e,t,n,i,this.nodeSize)}within(e,t,n){return function(e,t,n,i,r,o){const s=[0,e.length-1,0],a=[],l=r*r;for(;s.length;){const c=s.pop(),u=s.pop(),h=s.pop();if(u-h<=o){for(let r=h;r<=u;r++)M(t[2*r],t[2*r+1],n,i)<=l&&a.push(e[r]);continue}const d=Math.floor((h+u)/2),f=t[2*d],p=t[2*d+1];M(f,p,n,i)<=l&&a.push(e[d]);const A=(c+1)%2;(0===c?n-r<=f:i-r<=p)&&(s.push(h),s.push(d-1),s.push(A)),(0===c?n+r>=f:i+r>=p)&&(s.push(d+1),s.push(u),s.push(A))}return a}(this.ids,this.coords,e,t,n,this.nodeSize)}}const z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},D=Math.fround||(O=new Float32Array(1),e=>(O[0]=+e,O[0]));var O;class B{constructor(e){this.options=$(Object.create(z),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:n,maxZoom:i,nodeSize:r}=this.options;t&&console.time("total time");const o=`prepare ${e.length} points`;t&&console.time(o),this.points=e;let s=[];for(let t=0;t<e.length;t++)e[t].geometry&&s.push(N(e[t],t));this.trees[i+1]=new R(s,q,Z,r,Float32Array),t&&console.timeEnd(o);for(let e=i;e>=n;e--){const n=+Date.now();s=this._cluster(s,e),this.trees[e]=new R(s,q,Z,r,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,s.length,+Date.now()-n)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(V(n),G(o),V(r),G(i)),l=[];for(const e of a){const t=s.points[e];l.push(t.numPoints?U(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.points[t];if(!o)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(o.x,o.y,s),l=[];for(const t of a){const n=r.points[t];n.parentId===e&&l.push(n.numPoints?U(n):this.points[n.index])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.points,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.points,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.points,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=i?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,n,i,r):r<i?r++:e.push(t),e.length===n)break}return r}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=t[s],a=e.numPoints;let l,c,u;if(a)l=j(e),c=e.x,u=e.y;else{const t=this.points[e.index];l=t.properties,c=V(t.geometry.coordinates[0]),u=G(t.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;a?d=e.id:this.options.generateId?d=e.index:this.points[e.index].id&&(d=this.points[e.index].id),void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,t){const n=[],{radius:i,extent:r,reduce:o,minPoints:s}=this.options,a=i/(r*Math.pow(2,t));for(let i=0;i<e.length;i++){const r=e[i];if(r.zoom<=t)continue;r.zoom=t;const l=this.trees[t+1],c=l.within(r.x,r.y,a),u=r.numPoints||1;let h=u;for(const e of c){const n=l.points[e];n.zoom>t&&(h+=n.numPoints||1)}if(h>=s){let e=r.x*u,s=r.y*u,a=o&&u>1?this._map(r,!0):null;const d=(i<<5)+(t+1)+this.points.length;for(const n of c){const i=l.points[n];if(i.zoom<=t)continue;i.zoom=t;const c=i.numPoints||1;e+=i.x*c,s+=i.y*c,i.parentId=d,o&&(a||(a=this._map(r,!0)),o(a,this._map(i)))}r.parentId=d,n.push(F(e/h,s/h,d,h,a))}else if(n.push(r),h>1)for(const e of c){const i=l.points[e];i.zoom<=t||(i.zoom=t,n.push(i))}}return n}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?$({},e.properties):e.properties;const n=this.points[e.index].properties,i=this.options.map(n);return t&&i===n?$({},i):i}}function F(e,t,n,i,r){return{x:D(e),y:D(t),zoom:1/0,id:n,parentId:-1,numPoints:i,properties:r}}function N(e,t){const[n,i]=e.geometry.coordinates;return{x:D(V(n)),y:D(G(i)),zoom:1/0,index:t,parentId:-1}}function U(e){return{type:"Feature",id:e.id,properties:j(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),W(e.y)]}};var t}function j(e){const t=e.numPoints,n=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return $($({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function V(e){return e/360+.5}function G(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function W(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function $(e,t){for(const n in t)e[n]=t[n];return e}function q(e){return e.x}function Z(e){return e.y}function H(e,t,n,i){for(var r,o=i,s=n-t>>1,a=n-t,l=e[t],c=e[t+1],u=e[n],h=e[n+1],d=t+3;d<n;d+=3){var f=Q(e[d],e[d+1],l,c,u,h);if(f>o)r=d,o=f;else if(f===o){var p=Math.abs(d-s);p<a&&(r=d,a=p)}}o>i&&(r-t>3&&H(e,t,r,i),e[r+2]=o,n-r>3&&H(e,r,n,i))}function Q(e,t,n,i,r,o){var s=r-n,a=o-i;if(0!==s||0!==a){var l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return(s=e-n)*s+(a=t-i)*a}function X(e,t,n,i){var r={id:void 0===e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)Y(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<t.length;i++)Y(e,t[i]);else if("MultiPolygon"===n)for(i=0;i<t.length;i++)for(var r=0;r<t[i].length;r++)Y(e,t[i][r])}(r),r}function Y(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function K(e,t,n,i){if(t.geometry){var r=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===o)J(r,a);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)J(r[c],a);else if("LineString"===o)ee(r,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<r.length;c++)ee(r[c],a=[],s,!1),e.push(X(l,"LineString",a,t.properties));return}te(r,a,s,!1)}else if("Polygon"===o)te(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)K(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];te(r[c],u,s,!0),a.push(u)}}e.push(X(l,o,a,t.properties))}}function J(e,t){t.push(ne(e[0])),t.push(ie(e[1])),t.push(0)}function ee(e,t,n,i){for(var r,o,s=0,a=0;a<e.length;a++){var l=ne(e[a][0]),c=ie(e[a][1]);t.push(l),t.push(c),t.push(0),a>0&&(s+=i?(r*c-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-o,2))),r=l,o=c}var u=t.length-3;t[2]=1,H(t,0,u,n),t[u+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function te(e,t,n,i){for(var r=0;r<e.length;r++){var o=[];ee(e[r],o,n,i),t.push(o)}}function ne(e){return e/360+.5}function ie(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function re(e,t,n,i,r,o,s,a){if(i/=t,o>=(n/=t)&&s<i)return e;if(s<n||o>=i)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,f=0===r?u.minX:u.minY,p=0===r?u.maxX:u.maxY;if(f>=n&&p<i)l.push(u);else if(!(p<n||f>=i)){var A=[];if("Point"===d||"MultiPoint"===d)oe(h,A,n,i,r);else if("LineString"===d)se(h,A,n,i,r,!1,a.lineMetrics);else if("MultiLineString"===d)le(h,A,n,i,r,!1);else if("Polygon"===d)le(h,A,n,i,r,!0);else if("MultiPolygon"===d)for(var m=0;m<h.length;m++){var g=[];le(h[m],g,n,i,r,!0),g.length&&A.push(g)}if(A.length){if(a.lineMetrics&&"LineString"===d){for(m=0;m<A.length;m++)l.push(X(u.id,d,A[m],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===A.length?(d="LineString",A=A[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===A.length?"Point":"MultiPoint"),l.push(X(u.id,d,A,u.tags))}}}return l.length?l:null}function oe(e,t,n,i,r){for(var o=0;o<e.length;o+=3){var s=e[o+r];s>=n&&s<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function se(e,t,n,i,r,o,s){for(var a,l,c=ae(e),u=0===r?ue:he,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],p=e[d+1],A=e[d+2],m=e[d+3],g=e[d+4],y=0===r?f:p,_=0===r?m:g,v=!1;s&&(a=Math.sqrt(Math.pow(f-m,2)+Math.pow(p-g,2))),y<n?_>n&&(l=u(c,f,p,m,g,n),s&&(c.start=h+a*l)):y>i?_<i&&(l=u(c,f,p,m,g,i),s&&(c.start=h+a*l)):ce(c,f,p,A),_<n&&y>=n&&(l=u(c,f,p,m,g,n),v=!0),_>i&&y<=i&&(l=u(c,f,p,m,g,i),v=!0),!o&&v&&(s&&(c.end=h+a*l),t.push(c),c=ae(e)),s&&(h+=a)}var b=e.length-3;f=e[b],p=e[b+1],A=e[b+2],(y=0===r?f:p)>=n&&y<=i&&ce(c,f,p,A),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&ce(c,c[0],c[1],c[2]),c.length&&t.push(c)}function ae(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function le(e,t,n,i,r,o){for(var s=0;s<e.length;s++)se(e[s],t,n,i,r,o,!1)}function ce(e,t,n,i){e.push(t),e.push(n),e.push(i)}function ue(e,t,n,i,r,o){var s=(o-t)/(i-t);return e.push(o),e.push(n+(r-n)*s),e.push(1),s}function he(e,t,n,i,r,o){var s=(o-n)/(r-n);return e.push(t+(i-t)*s),e.push(o),e.push(1),s}function de(e,t){for(var n=[],i=0;i<e.length;i++){var r,o=e[i],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)r=fe(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){r=[];for(var a=0;a<o.geometry.length;a++)r.push(fe(o.geometry[a],t))}else if("MultiPolygon"===s)for(r=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(fe(o.geometry[a][c],t));r.push(l)}n.push(X(o.id,s,r,o.tags))}return n}function fe(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function pe(e,t){if(e.transformed)return e;var n,i,r,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(Ae(c[i],c[i+1],t,o,s,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(Ae(c[i][r],c[i][r+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function Ae(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function me(e,t,n,i,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,ge(s,e[a],o,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function ge(e,t,n,i){var r=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ye(s,r,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)ye(s,r[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)ye(s,c[a],e,n,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function ye(e,t,n,i,r,o){var s=i*i;if(i>0&&t.size<(r?s:i))n.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var s=e[i],a=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=s,e[r-1-i]=a}}(a,o),e.push(a)}}function _e(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)K(n,e.features[i],t,i);else K(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(e,t){var n=t.buffer/t.extent,i=e,r=re(e,1,-1-n,n,0,-1,2,t),o=re(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=re(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=de(r,1).concat(i)),o&&(i=i.concat(de(o,-1)))),i}(i,t)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ve(e,t,n){return 32*((1<<e)*n+t)+e}function be(e,t){const n=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return t(null,null);const r=new h(i.features);let o=m(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:r,rawData:o.buffer})}_e.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_e.prototype.splitTile=function(e,t,n,i,r,o,s){for(var a=[e,t,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=ve(t,n,i),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=me(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var p=1<<r-t;if(n!==Math.floor(o/p)||i!==Math.floor(s/p))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var A,m,g,y,_,v,b=.5*l.buffer/l.extent,x=.5-b,w=.5+b,E=1+b;A=m=g=y=null,_=re(e,u,n-b,n+w,0,d.minX,d.maxX,l),v=re(e,u,n+x,n+E,0,d.minX,d.maxX,l),e=null,_&&(A=re(_,u,i-b,i+w,1,d.minY,d.maxY,l),m=re(_,u,i+x,i+E,1,d.minY,d.maxY,l),_=null),v&&(g=re(v,u,i-b,i+w,1,d.minY,d.maxY,l),y=re(v,u,i+x,i+E,1,d.minY,d.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(A||[],t+1,2*n,2*i),a.push(m||[],t+1,2*n,2*i+1),a.push(g||[],t+1,2*n+1,2*i),a.push(y||[],t+1,2*n+1,2*i+1)}}},_e.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,o=i.debug;if(e<0||e>24)return null;var s=1<<e,a=ve(e,t=(t%s+s)%s,n);if(this.tiles[a])return pe(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[ve(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?pe(this.tiles[a],r):null):null};class xe extends e.VectorTileWorkerSource{constructor(e,t,n,i,r){super(e,t,n,i,be),r&&(this.loadGeoJSON=r)}loadData(t,n){const i=t&&t.request,r=i&&i.collectResourceTiming;this.loadGeoJSON(t,((o,a)=>{if(o||!a)return n(o);if("object"!=typeof a)return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{s(a,!0);try{if(t.filter){const n=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const i=a.features.filter((e=>n.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:i}}this._geoJSONIndex=t.cluster?new B(function({superclusterOptions:t,clusterProperties:n}){if(!n||!t)return t;const i={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(n);for(const t of a){const[o,s]=n[t],a=e.createExpression(s),l=e.createExpression("string"==typeof o?[o,["accumulated"],["get",t]]:o);i[t]=a.value,r[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=i[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=r[t].evaluate(o,s)},t}(t)).load(a.features):function(e,t){return new _e(e,t)}(a,t.geojsonVtOptions)}catch(o){return n(o)}this.loaded={};const l={};if(r){const n=e.getPerformanceMeasurement(i);n&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(n)))}n(null,l)}}))}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.getJSON(t.request,n);else{if("string"!=typeof t.data)return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class we{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:xe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,n){this.isSpriteLoaded=n;for(const i in this.workerSources[t]){const r=this.workerSources[t][i];for(const t in r)r[t]instanceof e.VectorTileWorkerSource&&(r[t].isSpriteLoaded=n,r[t].fire(new e.Event("isSpriteLoaded")))}}setImages(e,t,n){this.availableImages[e]=t;for(const n in this.workerSources[e]){const i=this.workerSources[e][n];for(const e in i)i[e].availableImages=t}n()}enableTerrain(e,t,n){this.terrain=t,n()}setLayers(e,t,n){this.getLayerIndex(e).replace(t),n()}updateLayers(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()}loadTile(t,n,i){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(t,n.type,n.source).loadTile(r,i)}loadDEMTile(t,n,i){const r=this.enableTerrain?e.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(t,n.source).loadTile(r,i)}reloadTile(t,n,i){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(t,n.type,n.source).reloadTile(r,i)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)}removeSource(e,t,n){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,i){try{e.plugin.setState(n);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const n=e.plugin.isParsed();i(n?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),n)}}catch(e){i(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new i),t}getWorkerSource(e,t,n){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][n]||(this.workerSources[e][t][n]=new this.workerSourceTypes[t]({send:(t,n,i,r,o,s)=>{this.actor.send(t,n,i,e,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded)),this.workerSources[e][t][n]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new o),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,n){e.enforceCacheSizeLimit(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new we(self)),we})),i(["./shared"],(function(e){var t=n;function n(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{t=new Worker(i),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(i),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===i[t=e&&e.failIfMajorPerformanceCaveat]&&(i[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),i[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var i={};function r(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!r(e[n],t[n]))return!1;return!0}return e===t}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const o={create:function(t,n,i){const r=e.window.document.createElement(t);return void 0!==n&&(r.className=n),i&&i.appendChild(r),r},createNS:function(t,n){return e.window.document.createElementNS(t,n)}},s=e.window.document&&e.window.document.documentElement.style,a=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let l;o.disableDrag=function(){s&&a&&(l=s[a],s[a]="none")},o.enableDrag=function(){s&&a&&(s[a]=l)},o.setTransform=function(e,t){e.style.transform=t};let c=!1;try{const t=Object.defineProperty({},"passive",{get(){c=!0}});e.window.addEventListener("test",t,t),e.window.removeEventListener("test",t,t)}catch(e){c=!1}o.addEventListener=function(e,t,n,i={}){e.addEventListener(t,n,"passive"in i&&c?i:i.capture)},o.removeEventListener=function(e,t,n,i={}){e.removeEventListener(t,n,"passive"in i&&c?i:i.capture)};const u=function(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",u,!0)};function h(t,n,i){const r=t.offsetWidth===n.width?1:t.offsetWidth/n.width;return new e.pointGeometry((i.clientX-n.left)*r,(i.clientY-n.top)*r)}o.suppressClick=function(){e.window.addEventListener("click",u,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",u,!0)}),0)},o.mousePos=function(e,t){const n=e.getBoundingClientRect();return h(e,n,t)},o.touchPos=function(e,t){const n=e.getBoundingClientRect(),i=[];for(let r=0;r<t.length;r++)i.push(h(e,n,t[r]));return i},o.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},o.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};class d{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,n,i){const r=e.dot(n,this.dir);if(Math.abs(r)<1e-6)return!1;const o=e.dot(e.sub(e.create(),t,this.pos),n)/r,s=e.scaleAndAdd(e.create(),this.pos,this.dir,o);return e.copy(i,s),!0}}class f{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(t,n,i){const r=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=e.transformMat4([],i,t),s=1/o[3]/n*r;return e.mul(o,o,[s,s,1/o[3],s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const n=e.sub([],o[t[0]],o[t[1]]),i=e.sub([],o[t[2]],o[t[1]]),r=e.normalize([],e.cross([],n,i)),s=-e.dot(r,o[t[1]]);return r.concat(s)}));return new f(o,s)}}class p{constructor(t,n){this.min=t,this.max=n,this.center=e.scale([],e.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],i=e.clone(this.min),r=e.clone(this.max);for(let e=0;e<n.length;e++)i[e]=n[e]?this.min[e]:this.center[e],r[e]=n[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new p(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let i=!0;for(let r=0;r<t.planes.length;r++){const o=t.planes[r];let s=0;for(let t=0;t<n.length;t++)s+=e.dot$1(o,n[t])>=0;if(0===s)return 0;s!==n.length&&(i=!1)}if(i)return 2;for(let e=0;e<3;e++){let n=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let r=0;r<t.points.length;r++){const o=t.points[r][e]-this.min[e];n=Math.min(n,o),i=Math.max(i,o)}if(i<0||n>this.max[e]-this.min[e])return 0}return 1}}function A(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class m extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let n=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(n=!1);this.isLoaded()||n?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,n){const i={};for(const n of t){this.images[n]||this.fire(new e.Event("styleimagemissing",{id:n}));const t=this.images[n];t?i[n]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,i)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const n=this.patterns[t],i=this.getImage(t);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new e.ImagePosition(n,i);this.patterns[t]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:n,h:i}=e.potpack(t),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const t in this.patterns){const{bin:n}=this.patterns[t],i=n.x+1,o=n.y+1,s=this.images[t].data,a=s.width,l=s.height;e.RGBAImage.copy(s,r,{x:0,y:0},{x:i,y:o},{width:a,height:l}),e.RGBAImage.copy(s,r,{x:0,y:l-1},{x:i,y:o-1},{width:a,height:1}),e.RGBAImage.copy(s,r,{x:0,y:0},{x:i,y:o+l},{width:a,height:1}),e.RGBAImage.copy(s,r,{x:a-1,y:0},{x:i-1,y:o},{width:1,height:l}),e.RGBAImage.copy(s,r,{x:0,y:0},{x:i+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];A(e)&&this.updateImage(t,e)}}}const g=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position}possiblyEvaluate(t,n){return function([t,n,i]){const r=e.degToRad(n+90),o=e.degToRad(i);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:n,polar:i}}(t.expression.evaluate(n))}interpolate(t,n,i){return{x:e.number(t.x,n.x,i),y:e.number(t.y,n.y,i),z:e.number(t.z,n.z,i),azimuthal:e.number(t.azimuthal,n.azimuthal,i),polar:e.number(t.polar,n.polar,i)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),y="-transition";class _ extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(g),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(e.validateLight,t,n))for(const n in t){const i=t[n];e.endsWith(n,y)?this._transitionable.setTransition(n.slice(0,-y.length),i):this._transitionable.setValue(n,i)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}const v=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)}),b="-transition";class x extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(v),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const n in t){const i=t[n];e.endsWith(n,b)?this._transitionable.setTransition(n.slice(0,-b.length),i):this._transitionable.setValue(n,i)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function w(t,n,i,r){const o=e.smoothstep(45,65,i),[s,a]=E(t,r),l=e.length(n);let c=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*t.alpha}function E(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}const S=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"])}),T="-transition";class k extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(S),this.set(t),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n={}){if(!this._validate(e.validateFog,t,n))for(const n in t){const i=t[n];e.endsWith(n,T)?this._transitionable.setTransition(n.slice(0,-T.length),i):this._transitionable.setValue(n,i)}}getOpacity(t){const n=this.properties&&this.properties.get("color")||1;return e.smoothstep(45,65,t)*n.a}getOpacityAtLatLng(t,n){return function(t,n,i){const r=e.MercatorCoordinate.fromLngLat(n),o=i.elevation?i.elevation.getAtPointOrZero(r):0,s=[r.x,r.y,o];return e.transformMat4$1(s,s,i.mercatorFogMatrix),w(t,s,i.pitch,i._fov)}(this.state,t,n)}getFovAdjustedRange(e){return E(this.state,e)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,n,i){return(!i||!1!==i.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class C{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const i=this.workerPool.acquire(this.id);for(let e=0;e<i.length;e++){const t=new C.Actor(i[e],n,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,n,i){e.asyncAll(this.actors,((e,i)=>{e.send(t,n,i)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function P(t,n,i){return n*(e.EXTENT/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}C.Actor=e.Actor;class M{constructor(e,t,n,i){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map((e=>i.pointCoordinate3D(e))),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,n){let i,r;if(t instanceof e.pointGeometry||"number"==typeof t[0]){const o=e.pointGeometry.convert(t);i=[e.pointGeometry.convert(t)],r=n.isPointAboveHorizon(o)}else{const o=e.pointGeometry.convert(t[0]),s=e.pointGeometry.convert(t[1]);i=[o,s],r=e.polygonizeBounds(o,s).every((e=>n.isPointAboveHorizon(e)))}return new M(i,n.getCameraPoint(),r,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],i=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],r=e.polygonizeBounds(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),e.bufferConvexPolygon(r,t)}containsTile(t,n,i){const r=t.queryPadding+1,o=i?this._bufferedCameraMercator(r,n).map((e=>t.tileID.getTilePoint(e))):this._bufferedScreenMercator(r,n).map((e=>t.tileID.getTilePoint(e))),s=this.screenGeometryMercator.map((e=>t.tileID.getTileVec3(e))),a=s.map((t=>new e.pointGeometry(t[0],t[1]))),l=n.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),c=t.tileID.getTileVec3(l),u=s.map((t=>{const n=e.sub(t,t,c);return e.normalize(n,n),new d(c,n)})),h=P(t,1,n.zoom);if(e.polygonIntersectsBox(o,0,0,e.EXTENT,e.EXTENT))return{queryGeometry:this,tilespaceGeometry:a,tilespaceRays:u,bufferedTilespaceGeometry:o,bufferedTilespaceBounds:(f=e.getBounds(o),f.min.x=e.clamp(f.min.x,0,e.EXTENT),f.min.y=e.clamp(f.min.y,0,e.EXTENT),f.max.x=e.clamp(f.max.x,0,e.EXTENT),f.max.y=e.clamp(f.max.y,0,e.EXTENT),f),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:h};var f}_bufferedScreenMercator(e,t){const n=I(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{const i=this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e)));return this._screenRaycastCache[n]=i,i}}_bufferedCameraMercator(e,t){const n=I(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{const i=this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e)));return this._cameraRaycastCache[n]=i,i}}}function I(e){return 100*e|0}function L(t,n,i){const r=function(r,o){if(r)return i(r);if(o){const r=e.pick(e.extend(o,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(r.vectorLayers=o.vector_layers,r.vectorLayerIds=r.vectorLayers.map((e=>e.id))),r.tiles=n.canonicalizeTileset(r,t.url),i(null,r)}};return t.url?e.getJSON(n.transformRequest(n.normalizeSourceURL(t.url),e.ResourceType.Source),r):e.exported.frame((()=>r(null,t)))}class R{constructor(t,n,i){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),i=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*n),r=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*n),s=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=i&&t.x<o&&t.y>=r&&t.y<s}}class z{constructor(e,t,n){this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const D={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class O{constructor(e,t,n,i){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[D[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class B{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class F extends B{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class N extends B{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class U extends B{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class j extends B{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class V extends B{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class G extends B{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class W extends B{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class $ extends B{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class q extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Z extends B{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class H extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class Q extends B{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class X extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Y extends B{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class K extends B{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class J extends B{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ee extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class te extends B{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ne extends B{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ie extends B{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class re extends B{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class oe extends B{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class se extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ae extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class le extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ce extends B{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ue extends B{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class he extends B{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class de extends B{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class fe extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class pe extends B{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ae extends B{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class me extends Ae{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ge extends Ae{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ye extends ge{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class _e{constructor(e,t,n,i){this.context=e,this.width=t,this.height=n;const r=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new me(e,r),i&&(this.depthAttachment=new ge(e,r))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class ve{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new F(this),this.clearDepth=new N(this),this.clearStencil=new U(this),this.colorMask=new j(this),this.depthMask=new V(this),this.stencilMask=new G(this),this.stencilFunc=new W(this),this.stencilOp=new $(this),this.stencilTest=new q(this),this.depthRange=new Z(this),this.depthTest=new H(this),this.depthFunc=new Q(this),this.blend=new X(this),this.blendFunc=new Y(this),this.blendColor=new K(this),this.blendEquation=new J(this),this.cullFace=new ee(this),this.cullFaceSide=new te(this),this.frontFace=new ne(this),this.program=new ie(this),this.activeTexture=new re(this),this.viewport=new oe(this),this.bindFramebuffer=new se(this),this.bindRenderbuffer=new ae(this),this.bindTexture=new le(this),this.bindVertexBuffer=new ce(this),this.bindElementBuffer=new ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new he(this),this.pixelStoreUnpack=new de(this),this.pixelStoreUnpackPremultiplyAlpha=new fe(this),this.pixelStoreUnpackFlipY=new pe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new z(this,e,t)}createVertexBuffer(e,t,n){return new O(this,e,t,n)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n){return new _e(this,e,t,n)}clear({color:e,depth:t,stencil:n}){const i=this.gl;let r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==n&&(r|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),i.clear(r)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r(t.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class be extends e.Evented{constructor(t,n,i,r){super(),this.id=t,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},n),e.extend(this,e.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=L(this._options,this.map._requestManager,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):n&&(e.extend(this,n),n.bounds&&(this.tileBounds=new R(n.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(n.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,n){const i=e.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),((i,r,o,s)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(r){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s});const i=this.map.painter.context,a=i.gl;t.texture=this.map.painter.getTileTexture(r.width),t.texture?t.texture.update(r,{useMipmap:!0}):(t.texture=new e.Texture(i,r,a.RGBA,{useMipmap:!0}),t.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),n(null)}}))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}let xe;var we=e.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ee extends e.Evented{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=t}load(t,n){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((i,r)=>{this._loaded=!0,i?this.fire(new e.ErrorEvent(i)):r&&(this.image=e.exported.getImageData(r),t&&(this.coordinates=t),n&&n(),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}setCoordinates(t){this.coordinates=t;const n=t.map(e.MercatorCoordinate.fromLngLat);this.tileID=function(t){let n=1/0,i=1/0,r=-1/0,o=-1/0;for(const e of t)n=Math.min(n,e.x),i=Math.min(i,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y);const s=Math.max(r-n,o-i),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new e.CanonicalTileID(a,Math.floor((n+r)/2*l),Math.floor((i+o)/2*l))}(n),this.minzoom=this.maxzoom=this.tileID.z;const i=n.map((e=>this.tileID.getTilePoint(e)._round()));return this._boundsArray=new e.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,e.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,e.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,e.EXTENT,e.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,we.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new e.Texture(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Se={vector:class extends e.Evented{constructor(t,n,i,r){if(super(),this.id=t,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(n,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=L(this._options,this.map._requestManager,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):n&&(e.extend(this,n),n.bounds&&(this.tileBounds=new R(n.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e();const t=this.map.style._getSourceCaches(this.id);for(const e of t)e.clearTiles();this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",r,o.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const n=e.loadVectorTile.call({deduped:this._deduped},r,((e,n)=>{e||!n?o.call(this,e):(r.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,o.bind(this),void 0,!0))}),!0);t.request={cancel:n}}function o(i,r){return delete t.request,t.aborted?n(null):i&&404!==i.status?n(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:be,"raster-dem":class extends be{constructor(t,n,i,r){super(t,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(t,n){const i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,i){e&&(t.state="errored",n(e)),i&&(t.dem=i,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.getImage(this.map._requestManager.transformRequest(i,e.ResourceType.Tile),function(i,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const n=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap&&(null==xe&&(xe=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),xe),i=1-(o.width-e.prevPowerOfTwo(o.width))/2;i<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?o:e.exported.getImageData(o,i),c={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:i};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const n=t.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,o=0===n.x?t.wrap-1:t.wrap,s=(n.x+1+i)%i,a=n.x+1===i?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,o,n.z,r,n.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,o,n.z,r,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new e.OverscaledTileID(t.overscaledZ,o,n.z,r,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,n,i,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=e.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.extend({},this.workerOptions),n=this._data;"string"==typeof n?(t.request=this.map._requestManager.transformRequest(e.exported.resolveURL(n),e.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,n)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(t.resourceTiming=n.resourceTiming[this.id]),this.fire(new e.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,n){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(i,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,r)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):e?n(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===i),n(null)))),void 0,"loadTile"===i)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ee{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,e.ResourceType.Source).url);e.getVideo(this.urls,((t,n)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):n&&(this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,we.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ee,canvas:class extends Ee{constructor(t,n,i,r){super(t,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,we.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(n,this.canvas,i.RGBA,{premultiply:!0});for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}},Te=function(t,n,i,r){const o=new Se[n.type](t,n,i,r);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],o),o};function ke(t,n){const i=e.identity([]);return e.scale$1(i,i,[.5*t.width,.5*-t.height,1]),e.translate(i,i,[1,-1,0]),e.multiply(i,i,t.calculateProjMatrix(n.toUnwrapped()))}function Ce(e,t,n,i,r,o,s,a=!1){const l=e.tilesIn(i,s,a);l.sort(Me);const c=[];for(const i of l)c.push({wrappedTileID:i.tile.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(t,n,e._state,i,r,o,ke(e.transform,i.tile.tileID),a)});const u=function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in e){const i=e[n],r=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const n=t.feature,i=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}));return u}function Pe(e,t){const n=e.getRenderableIds().map((t=>e.getTileByID(t))),i=[],r={};for(let e=0;e<n.length;e++){const o=n[e],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(i,t))}return i}function Me(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function Ie(){return null!=qr.workerClass?new qr.workerClass:new e.window.Worker(qr.workerUrl)}const Le="mapboxgl_preloaded_worker_pool";class Re{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Re.workerCount;)this.workers.push(new Ie);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Le]}numActive(){return Object.keys(this.active).length}}let ze;function De(){return ze||(ze=new Re),ze}function Oe(t,n){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return e.refProperties.forEach((e=>{e in n&&(i[e]=n[e])})),i}function Be(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=Oe(e[n],t[e[n].ref]));return e}Re.workerCount=2;const Fe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Ne(e,t,n){n.push({command:Fe.addSource,args:[e,t[e]]})}function Ue(e,t,n){t.push({command:Fe.removeSource,args:[e]}),n[e]=!0}function je(e,t,n,i){Ue(e,n,i),Ne(e,t,n)}function Ve(e,t,n){let i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!r(e[n][i],t[n][i]))return!1;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!r(e[n][i],t[n][i]))return!1;return!0}function Ge(e,t,n,i,o,s){let a;for(a in t=t||{},e=e||{})e.hasOwnProperty(a)&&(r(e[a],t[a])||n.push({command:s,args:[i,a,t[a],o]}));for(a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(r(e[a],t[a])||n.push({command:s,args:[i,a,t[a],o]}))}function We(e){return e.id}function $e(e,t){return e[t.id]=t,e}class qe{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let n=1,i=this._distances[n];const r=t*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const o=n-1,s=this._distances[o],a=i-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}class Ze{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let e=0;e<this.xCellCount*this.yCellCount;e++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,n,i,r,o){this.circleCells[r].push(o)}_query(e,t,n,i,r,o){if(n<0||e>this.width||i<0||t>this.height)return!r&&[];const s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}return o?s.filter(o):s}return this._forEachCell(e,t,n,i,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(e,t,n,i,r){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!i&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),i?c.length>0:c}query(e,t,n,i,r){return this._query(e,t,n,i,!1,r)}hitTest(e,t,n,i,r){return this._query(e,t,n,i,!0,r)}hitTestCircle(e,t,n,i){return this._queryCircle(e,t,n,!0,i)}_queryCell(e,t,n,i,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&n>=r[c+0]&&i>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,n,i)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],n=r[u+2];o.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,i,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,o){const s=i-e,a=r-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,i,r,o,s){const a=(o-i)/2,l=Math.abs(e-(i+a));if(l>a+n)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}const He=Math.tan(85*Math.PI/180);function Qe(t,n,i,r,o){const s=e.create$1();return n?(e.scale$1(s,s,[1/o,1/o,1]),i||e.rotateZ(s,s,r.angle)):e.multiply(s,r.labelPlaneMatrix,t),s}function Xe(t,n,i,r,o){if(n){const n=e.clone$1(t);return e.scale$1(n,n,[o,o,1]),i||e.rotateZ(n,n,-r.angle),n}return r.glCoordMatrix}function Ye(t,n,i=0){const r=[t.x,t.y,i,1];i?e.transformMat4(r,r,n):ct(r,r,n);const o=r[3];return{point:new e.pointGeometry(r[0]/o,r[1]/o),signedDistanceFromCamera:o}}function Ke(e,t){return Math.min(.5+e/t*.5,1.5)}function Je(e,t){const n=e[0]/e[3],i=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&i>=-t[1]&&i<=t[1]}function et(t,n,i,r,o,s,a,l,c){const u=r?t.textSizeData:t.iconSizeData,h=e.evaluateSizeForZoom(u,i.transform.zoom),d=[256/i.width*2+1,256/i.height*2+1],f=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;f.clear();const p=t.lineVertexArray,A=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,m=i.transform.width/i.transform.height;let g=!1;for(let r=0;r<A.length;r++){const y=A.get(r);if(y.writingMode!==e.WritingMode.vertical||g||0!==r&&A.get(r-1).writingMode===e.WritingMode.horizontal||(g=!0),y.hidden||y.writingMode===e.WritingMode.vertical&&!g){lt(y.numGlyphs,f);continue}g=!1;const _=new e.pointGeometry(y.tileAnchorX,y.tileAnchorY),v=c?c(_):0,b=[_.x,_.y,v],x=[...b,1];if(e.transformMat4(x,x,n),!Je(x,d)){lt(y.numGlyphs,f);continue}const w=Ke(i.transform.cameraToCenterDistance,x[3]),E=e.evaluateSizeForFeature(u,h,y),S=a?E/w:E*w,T=Ye(new e.pointGeometry(b[0],b[1]),o,b[2]);if(T.signedDistanceFromCamera<=0){lt(y.numGlyphs,f);continue}let k={};const C=a?null:c,P=it(y,S,!1,l,n,o,s,t.glyphOffsetArray,p,f,T.point,_,k,m,C);g=P.useVertical,C&&P.needsFlipping&&(k={}),(P.notEnoughRoom||g||P.needsFlipping&&it(y,S,!0,l,n,o,s,t.glyphOffsetArray,p,f,T.point,_,k,m,C).notEnoughRoom)&&lt(y.numGlyphs,f)}r?t.text.dynamicLayoutVertexBuffer.updateData(f):t.icon.dynamicLayoutVertexBuffer.updateData(f)}function tt(e,t,n,i,r,o,s,a,l,c,u,h,d){const f=a.glyphStartIndex+a.numGlyphs,p=a.lineStartIndex,A=a.lineStartIndex+a.lineLength,m=t.getoffsetX(a.glyphStartIndex),g=t.getoffsetX(f-1),y=st(e*m,n,i,r,o,s,a.segment,p,A,l,c,u,h,d,!0);if(!y)return null;const _=st(e*g,n,i,r,o,s,a.segment,p,A,l,c,u,h,d,!0);return _?{first:y,last:_}:null}function nt(t,n,i,r){return t.writingMode===e.WritingMode.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:t.writingMode===e.WritingMode.vertical?n.y<i.y?{needsFlipping:!0}:null:0!==t.flipState&&function(e,t,n){const i=(t.x-e.x)*n;return 0===i||Math.abs((t.y-e.y)/i)>He}(n,i,r)?1===t.flipState?{needsFlipping:!0}:null:n.x>i.x?{needsFlipping:!0}:null}function it(t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){const m=n/24,g=t.lineOffsetX*m,y=t.lineOffsetY*m;let _;if(t.numGlyphs>1){const e=t.glyphStartIndex+t.numGlyphs,n=t.lineStartIndex,o=t.lineStartIndex+t.lineLength,u=tt(m,l,g,y,i,h,d,t,c,s,f,A,!1);if(!u)return{notEnoughRoom:!0};const v=Ye(u.first.point,a).point,b=Ye(u.last.point,a).point;if(r&&!i){const e=nt(t,v,b,p);if(t.flipState=e&&e.needsFlipping?1:2,e)return e}_=[u.first];for(let r=t.glyphStartIndex+1;r<e-1;r++)_.push(st(m*l.getoffsetX(r),g,y,i,h,d,t.segment,n,o,c,s,f,A,!1,!1));_.push(u.last)}else{if(r&&!i){const n=Ye(d,o).point,i=t.lineStartIndex+t.segment+1,r=new e.pointGeometry(c.getx(i),c.gety(i)),s=Ye(r,o),a=nt(t,n,s.signedDistanceFromCamera>0?s.point:ot(d,r,n,1,o,void 0),p);if(t.flipState=a&&a.needsFlipping?1:2,a)return a}const n=st(m*l.getoffsetX(t.glyphStartIndex),g,y,i,h,d,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,s,f,A,!1,!1);if(!n)return{notEnoughRoom:!0};_=[n]}for(const t of _)e.addDynamicAttributes(u,t.point,t.angle);return{}}function rt(t,n,i){const r={x:t.x,y:t.y,z:0};if(!i)return Ye(r,n,r.z);const o=i(t);return Ye(new e.pointGeometry(r.x,r.y),n,r.z+o)}function ot(e,t,n,i,r,o){const s=rt(e.add(e.sub(t)._unit()),r,o).point,a=n.sub(s);return n.add(a._mult(i/a.mag()))}function st(t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){const m=r?t-n:t+n;let g=m>0?1:-1,y=0;r&&(g*=-1,y=Math.PI),g<0&&(y+=Math.PI);let _=g>0?l+a:l+a+1,v=o,b=o,x=0,w=0;const E=Math.abs(m),S=[],T=[];let k=s;const C=()=>{const t=_-g;return 0===x?s:new e.pointGeometry(u.getx(t),u.gety(t))},P=()=>ot(C(),k,b,E-x+1,h,f);for(;x+w<=E;){if(_+=g,_<l||_>=c)return null;if(b=v,S.push(v),p&&T.push(k||C()),v=d[_],void 0===v){k=new e.pointGeometry(u.getx(_),u.gety(_));const t=rt(k,h,f);v=t.signedDistanceFromCamera>0?d[_]=t.point:P()}else k=null;x+=w,w=b.dist(v)}A&&f&&(k=k||new e.pointGeometry(u.getx(_),u.gety(_)),d[_]=v=void 0===d[_]?v:P(),w=b.dist(v));const M=(E-x)/w,I=v.sub(b),L=I.mult(M)._add(b);i&&L._add(I._unit()._perp()._mult(i*g));const R=y+Math.atan2(v.y-b.y,v.x-b.x);return S.push(L),p&&(k=k||new e.pointGeometry(u.getx(_),u.gety(_)),T.push(function(t,n,i){const r=1-i;return new e.pointGeometry(t.x*r+n.x*i,t.y*r+n.y*i)}(T.length>0?T[T.length-1]:k,k,M))),{point:L,angle:R,path:S,tilePath:T}}const at=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function lt(e,t){for(let n=0;n<e;n++){const e=t.length;t.resize(e+4),t.float32.set(at,3*e)}}function ct(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15],e}const ut=100;class ht{constructor(e,t,n=new Ze(e.width+200,e.height+200,25),i=new Ze(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ut,this.screenBottomBoundary=e.height+ut,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,n,i,r,o,s){let a=t.projectedAnchorZ;t.elevation&&(a+=t.elevation);const l=this.projectAndGetPerspectiveRatio(o,t.projectedAnchorX,t.projectedAnchorY,a,t.tileID),c=r*l.perspectiveRatio,u=(t.x1*e+n.x-t.padding)*c+l.point.x,h=(t.y1*e+n.y-t.padding)*c+l.point.y,d=(t.x2*e+n.x+t.padding)*c+l.point.x,f=(t.y2*e+n.y+t.padding)*c+l.point.y,p=l.perspectiveRatio<=.55||l.aboveHorizon;return!this.isInsideGrid(u,h,d,f)||!i&&this.grid.hitTest(u,h,d,f,s)||p?{box:[],offscreen:!1}:{box:[u,h,d,f],offscreen:this.isOffscreen(u,h,d,f)}}placeCollisionCircles(t,n,i,r,o,s,a,l,c,u,h,d,f,p){const A=[],m=this.transform.elevation,g=m?e=>m.getAtTileOffset(p,e.x,e.y):e=>0,y=new e.pointGeometry(n.tileAnchorX,n.tileAnchorY),_=g(y),v=this.projectAndGetPerspectiveRatio(s,y.x,y.y,_,p),{perspectiveRatio:b}=v,x=(u?o/b:o*b)/e.ONE_EM,w=Ye(y,a,_).point,E=v.signedDistanceFromCamera>0?tt(x,r,n.lineOffsetX*x,n.lineOffsetY*x,!1,w,y,n,i,a,{},m&&!u?g:null,u&&!!m):null;let S=!1,T=!1,k=!0;if(E&&!v.aboveHorizon){const n=.5*d*b+f,i=new e.pointGeometry(-100,-100),r=new e.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new qe,s=E.first,a=E.last;let u=[];for(let e=s.path.length-1;e>=1;e--)u.push(s.path[e]);for(let e=1;e<a.path.length;e++)u.push(a.path[e]);const p=2.5*n;if(l){const e=u.map(m?(e,t)=>{const n=g(t<s.path.length-1?s.tilePath[s.path.length-1-t]:a.tilePath[t-s.path.length+2]);return Ye(e,l,n)}:e=>Ye(e,l));u=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let y=[];if(u.length>0){const t=u[0].clone(),n=u[0].clone();for(let e=1;e<u.length;e++)t.x=Math.min(t.x,u[e].x),t.y=Math.min(t.y,u[e].y),n.x=Math.max(n.x,u[e].x),n.y=Math.max(n.y,u[e].y);y=t.x>=i.x&&n.x<=r.x&&t.y>=i.y&&n.y<=r.y?[u]:n.x<i.x||t.x>r.x||n.y<i.y||t.y>r.y?[]:e.clipLine([u],i.x,i.y,r.x,r.y)}for(const e of y){o.reset(e,.25*n);let i=0;i=o.length<=.5*n?1:Math.ceil(o.paddedLength/p)+1;for(let e=0;e<i;e++){const r=e/Math.max(i-1,1),s=o.lerp(r),a=s.x+ut,l=s.y+ut;A.push(a,l,n,0);const u=a-n,d=l-n,f=a+n,p=l+n;if(k=k&&this.isOffscreen(u,d,f,p),T=T||this.isInsideGrid(u,d,f,p),!t&&this.grid.hitTestCircle(a,l,n,h)&&(S=!0,!c))return{circles:[],offscreen:!1,collisionDetected:S}}}}return{circles:!c&&S||!T?[]:A,offscreen:k,collisionDetected:S}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.pointGeometry(a.x+ut,a.y+ut);i=Math.min(i,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),n.push(t)}const a=this.grid.query(i,r,o,s).concat(this.ignoredGrid.query(i,r,o,s)),l={},c={};for(const t of a){const i=t.key;if(void 0===l[i.bucketInstanceId]&&(l[i.bucketInstanceId]={}),l[i.bucketInstanceId][i.featureIndex])continue;const r=[new e.pointGeometry(t.x1,t.y1),new e.pointGeometry(t.x2,t.y1),new e.pointGeometry(t.x2,t.y2),new e.pointGeometry(t.x1,t.y2)];e.polygonIntersectsPolygon(n,r)&&(l[i.bucketInstanceId][i.featureIndex]=!0,void 0===c[i.bucketInstanceId]&&(c[i.bucketInstanceId]=[]),c[i.bucketInstanceId].push(i.featureIndex))}return c}insertCollisionBox(e,t,n,i,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:i,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:i,collisionGroupID:r};for(let t=0;t<e.length;t+=4)o.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,n,i,r,o){const s=[n,i,r||0,1];let a=!1;if(r||this.transform.pitch>0){e.transformMat4(s,s,t);let l=!1;this.fogState&&o&&(l=function(t,n,i,r,o,s){const a=s.calculateFogTileMatrix(o),l=[n,i,r];return e.transformMat4$1(l,l,a),w(t,l,s.pitch,s._fov)}(this.fogState,n,i,r||0,o.toUnwrapped(),this.transform)>.9),a=s[2]>s[3]||l}else ct(s,s,t);return{point:new e.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+ut,(-s[1]/s[3]+1)/2*this.transform.height+ut),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/s[3]*.5,1.5),signedDistanceFromCamera:s[3],aboveHorizon:a}}isOffscreen(e,t,n,i){return n<ut||e>=this.screenRightBoundary||i<ut||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}class dt{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class ft{constructor(e,t,n,i,r){this.text=new dt(e?e.text:null,t,n,r),this.icon=new dt(e?e.icon:null,t,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pt{constructor(e,t,n){this.text=e,this.icon=t,this.skipFade=n}}class At{constructor(){this.invProjMatrix=e.create$1(),this.viewportMatrix=e.create$1(),this.circles=[]}}class mt{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class gt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function yt(t,n,i,r,o){const{horizontalAlign:s,verticalAlign:a}=e.getAnchorAlignment(t),l=-(s-.5)*n,c=-(a-.5)*i,u=e.evaluateVariableOffset(t,r);return new e.pointGeometry(l+u[0]*o,c+u[1]*o)}function _t(t,n,i,r,o){const s=new e.pointGeometry(t,n);return i&&s._rotate(r?o:-o),s}class vt{constructor(e,t,n,i,r){this.transform=e.clone(),this.collisionIndex=new ht(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new gt(n),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,i,r){const o=i.getBucket(n),s=i.latestFeatureIndex;if(!o||!s||n.id!==o.layerIds[0])return;const a=i.collisionBoxArray,l=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),u=i.tileSize/e.EXTENT,h=this.transform.calculateProjMatrix(i.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),f="map"===l.get("text-rotation-alignment"),p=P(i,1,this.transform.zoom),A=Qe(h,d,f,this.transform,p);let m=null;if(d){const t=Xe(h,d,f,this.transform,p);m=e.multiply([],this.transform.labelPlaneMatrix,t)}this.retainedQueryData[o.bucketInstanceId]=new mt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,i.tileID);const g={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:A,labelToScreenMatrix:m,scale:c,textPixelRatio:u,holdingForFade:i.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const e of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=e;t.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:g})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:g})}attemptAnchorPlacement(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m,g){const y=[h.textOffset0,h.textOffset1],_=yt(e,n,i,y,r),v=this.collisionIndex.placeCollisionBox(r,t,_t(_.x,_.y,o,s,this.transform.angle),u,a,l,c.predicate);if((!A||0!==this.collisionIndex.placeCollisionBox(f.getSymbolInstanceIconSize(g,this.transform.zoom,d),A,_t(_.x,_.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)&&v.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(t=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:y,width:n,height:i,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(f,e,h,p),f.allowVerticalPlacement&&(this.markUsedOrientation(f,p,h),this.placedOrientations[h.crossTileID]=p),{shift:_,placedGlyphBoxes:v}}}placeLayerBucketPart(t,n,i,r){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:p,collisionGroup:A}=t.parameters,m=s.get("text-optional"),g=s.get("icon-optional"),y=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),v="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),x="none"!==s.get("icon-text-fit"),w="viewport-y"===s.get("symbol-z-order"),E=y&&(_||!o.hasIconData()||g),S=_&&(y||!o.hasTextData()||m);!o.collisionArrays&&d&&o.deserializeCollisionBoxes(d),i&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,d);const T=(t,r,d)=>{if(n[t.crossTileID])return;if(h)return void(this.placements[t.crossTileID]=new pt(!1,!1,!1));let w=!1,T=!1,k=!0,C=null,P={box:null,offscreen:null},M={box:null,offscreen:null},I=null,L=null,R=null,z=0,D=0,O=0;d.textFeatureIndex?z=d.textFeatureIndex:t.useRuntimeCollisionCircles&&(z=t.featureIndex),d.verticalTextFeatureIndex&&(D=d.verticalTextFeatureIndex);const B=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID,(this.transform.elevation||e.elevation)&&(e.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[o.bucketInstanceId].tileID,e.tileAnchorX,e.tileAnchorY):0)},F=d.textBox;if(F){B(F);const n=n=>{let i=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!n&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,i=e,this.markUsedOrientation(o,i,t))}return i},i=(n,i)=>{if(o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const t of o.writingModes)if(t===e.WritingMode.vertical?(P=i(),M=P):P=n(),P&&P.box&&P.box.length)break}else P=n()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[t.crossTileID]){const e=this.prevPlacement.variableOffsets[t.crossTileID];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,n,i)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),c=(e.x2-e.x1)*s+2*e.padding,h=(e.y2-e.y1)*s+2*e.padding,d=x&&!_?n:null;d&&B(d);let m={box:[],offscreen:!1};const g=y?2*l.length:l.length;for(let n=0;n<g;++n){const g=this.attemptAnchorPlacement(l[n%l.length],e,c,h,s,v,b,u,a,A,n>=l.length,t,r,o,i,d,f,p);if(g&&(m=g.placedGlyphBoxes,m&&m.box&&m.box.length)){w=!0,C=g.shift;break}}return m};i((()=>c(F,d.iconBox,e.WritingMode.horizontal)),(()=>{const n=d.verticalTextBox;return n&&B(n),o.allowVerticalPlacement&&!(P&&P.box&&P.box.length)&&t.numVerticalGlyphVertices>0&&n?c(n,d.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null}})),P&&(w=P.box,k=P.offscreen);const h=n(P&&P.box);if(!w&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(o,e.anchor,t,h))}}else{const s=(n,i)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(s,n,new e.pointGeometry(0,0),y,u,a,A.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,i,t),this.placedOrientations[t.crossTileID]=i),l};i((()=>s(F,e.WritingMode.horizontal)),(()=>{const n=d.verticalTextBox;return o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?(B(n),s(n,e.WritingMode.vertical)):{box:null,offscreen:null}})),n(P&&P.box&&P.box.length)}}if(I=P,w=I&&I.box&&I.box.length>0,k=I&&I.offscreen,t.useRuntimeCollisionCircles){const n=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.evaluateSizeForFeature(o.textSizeData,f,n),u=s.get("text-padding");L=this.collisionIndex.placeCollisionCircles(y,n,o.lineVertexArray,o.glyphOffsetArray,r,a,l,c,i,b,A.predicate,t.collisionCircleDiameter*r/e.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),w=y||L.circles.length>0&&!L.collisionDetected,k=k&&L.offscreen}if(d.iconFeatureIndex&&(O=d.iconFeatureIndex),d.iconBox){const t=t=>{B(t);const n=x&&C?_t(C.x,C.y,v,b,this.transform.angle):new e.pointGeometry(0,0),i=o.getSymbolInstanceIconSize(p,this.transform.zoom,r);return this.collisionIndex.placeCollisionBox(i,t,n,_,u,a,A.predicate)};M&&M.box&&M.box.length&&d.verticalIconBox?(R=t(d.verticalIconBox),T=R.box.length>0):(R=t(d.iconBox),T=R.box.length>0),k=k&&R.offscreen}const N=m||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,U=g||0===t.numIconVertices;if(N||U?U?N||(T=T&&w):w=T&&w:T=w=T&&w,w&&I&&I.box&&this.collisionIndex.insertCollisionBox(I.box,s.get("text-ignore-placement"),o.bucketInstanceId,M&&M.box&&D?D:z,A.ID),T&&R&&this.collisionIndex.insertCollisionBox(R.box,s.get("icon-ignore-placement"),o.bucketInstanceId,O,A.ID),L&&(w&&this.collisionIndex.insertCollisionCircles(L.circles,s.get("text-ignore-placement"),o.bucketInstanceId,z,A.ID),i)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new At);for(let e=0;e<L.circles.length;e+=4)t.circles.push(L.circles[e+0]),t.circles.push(L.circles[e+1]),t.circles.push(L.circles[e+2]),t.circles.push(L.collisionDetected?1:0)}this.placements[t.crossTileID]=new pt(w||E,T||S,k||o.justReloaded),n[t.crossTileID]=!0};if(w){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const n=e[t];T(o.symbolInstances.get(n),n,o.collisionArrays[n])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)T(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(i&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.invert(t.invProjMatrix,a),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,n,i,r){let o;o=r===e.WritingMode.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(n)];const s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const e of s)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=o>=0&&e!==o?0:i.crossTileID)}markUsedOrientation(t,n,i){const r=n===e.WritingMode.horizontal||n===e.WritingMode.horizontalOnly?n:0,o=n===e.WritingMode.vertical?n:0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const e of s)t.text.placedSymbolArray.get(e).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=r[e];o?(this.opacities[e]=new ft(o,i,t.text,t.icon),n=n||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new ft(null,i,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new ft(t,i,!1,!1);r.isHidden()||(this.opacities[e]=r,n=n||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n={};for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,n,i.collisionBoxArray)}}updateBucketOpacities(t,n,i){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,o=new ft(null,0,!1,!1,!0),s=r.get("text-allow-overlap"),a=r.get("icon-allow-overlap"),l=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),u="map"===r.get("text-pitch-alignment"),h="none"!==r.get("icon-text-fit"),d=new ft(null,0,s&&(a||!t.hasIconData()||r.get("icon-optional")),a&&(s||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const f=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n)};for(let i=0;i<t.symbolInstances.length;i++){const r=t.symbolInstances.get(i),{numHorizontalGlyphVertices:s,numVerticalGlyphVertices:a,crossTileID:p}=r;let A=this.opacities[p];n[p]?A=o:A||(A=d,this.opacities[p]=A),n[p]=!0;const m=r.numIconVertices>0,g=this.placedOrientations[r.crossTileID],y=g===e.WritingMode.vertical,_=g===e.WritingMode.horizontal||g===e.WritingMode.horizontalOnly;if(s>0||a>0){const e=Pt(A.text);f(t.text,s,y?Mt:e),f(t.text,a,_?Mt:e);const n=A.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=n||y?1:0)})),r.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=n||_?1:0);const i=this.variableOffsets[r.crossTileID];i&&this.markUsedJustification(t,i.anchor,r,g);const o=this.placedOrientations[r.crossTileID];o&&(this.markUsedJustification(t,"left",r,o),this.markUsedOrientation(t,o,r))}if(m){const e=Pt(A.icon);r.placedIconSymbolIndex>=0&&(f(t.icon,r.numIconVertices,y?Mt:e),t.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=A.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(f(t.icon,r.numVerticalIconVertices,_?Mt:e),t.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=A.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[i];if(n){let i=new e.pointGeometry(0,0);if(n.textBox||n.verticalTextBox){let e=!0;if(l){const t=this.variableOffsets[p];t?(i=yt(t.anchor,t.width,t.height,t.textOffset,t.textScale),c&&i._rotate(u?this.transform.angle:-this.transform.angle)):e=!1}n.textBox&&bt(t.textCollisionBox.collisionVertexArray,A.text.placed,!e||y,i.x,i.y),n.verticalTextBox&&bt(t.textCollisionBox.collisionVertexArray,A.text.placed,!e||_,i.x,i.y)}const r=Boolean(!_&&n.verticalIconBox);n.iconBox&&bt(t.iconCollisionBox.collisionVertexArray,A.icon.placed,r,h?i.x:0,h?i.y:0),n.verticalIconBox&&bt(t.iconCollisionBox.collisionVertexArray,A.icon.placed,!r,h?i.x:0,h?i.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function bt(e,t,n,i,r){e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0),e.emplaceBack(t?1:0,n?1:0,i||0,r||0)}const xt=Math.pow(2,25),wt=Math.pow(2,24),Et=Math.pow(2,17),St=Math.pow(2,16),Tt=Math.pow(2,9),kt=Math.pow(2,8),Ct=Math.pow(2,1);function Pt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*xt+t*wt+n*Et+t*St+n*Tt+t*kt+n*Ct+t}const Mt=0;class It{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,n,i,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class Lt{constructor(e,t,n,i,r,o,s,a){this.placement=new vt(e,r,o,s,a),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,n,i){const r=e.exported.now(),o=()=>{const t=e.exported.now()-r;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=n[t[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=r)&&(!e.maxzoom||e.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new It(e)),this._inProgressLayer.continuePlacement(i[e.source],this.placement,this._showCollisionBoxes,e,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Rt=512/e.EXTENT/2;class zt{constructor(e,t,n){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(let n=0;n<t.length;n++){const i=t.get(n),r=i.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,e)})}}getScaledCoordinates(t,n){const i=Rt/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*e.EXTENT+t.tileAnchorX)*i),y:Math.floor((n.canonical.y*e.EXTENT+t.tileAnchorY)*i)}}findMatches(e,t,n){const i=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const o=e.get(r);if(o.crossTileID)continue;const s=this.indexedSymbolInstances[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,t);for(const e of s)if(Math.abs(e.coord.x-a.x)<=i&&Math.abs(e.coord.y-a.y)<=i&&!n[e.crossTileID]){n[e.crossTileID]=!0,o.crossTileID=e.crossTileID;break}}}}class Dt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ot{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const n=this.indexes[e],i={};for(const e in n){const r=n[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[e]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const i=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const r=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in r){const o=r[n];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=r[e.scaledTo(Number(n)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=n.generate(),i[r.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new zt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n in t.indexedSymbolInstances)for(const i of t.indexedSymbolInstances[n])delete this.usedCrossTileIDs[e][i.crossTileID]}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class Bt{constructor(){this.layerIndexes={},this.crossTileIDs=new Dt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new Ot);let r=!1;const o={};i.handleWrapJump(n);for(const n of t){const t=n.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(n.tileID,t,this.crossTileIDs)&&(r=!0),o[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(r=!0),r}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Ft=(t,n)=>e.emitValidationErrors(t,n&&n.filter((e=>"source.canvas"!==e.identifier))),Nt=e.pick(Fe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Ut=e.pick(Fe,["setCenter","setZoom","setBearing","setPitch"]),jt=function(){const t={},n=e.spec.$version;for(const i in e.spec.$root){const r=e.spec.$root[i];if(r.required){let e=null;e="version"===i?n:"array"===r.type?[]:{},null!=e&&(t[i]=e)}}return t}(),Vt={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Gt extends e.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new C(De(),this),this.imageManager=new m,this.imageManager.setEventedParent(this),this.glyphManager=new e.GlyphManager(t._requestManager,n.localFontFamily?e.LocalGlyphMode.all:n.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,n.localFontFamily||n.localIdeographFontFamily),this.lineAtlas=new e.LineAtlas(256,512),this.crossTileSymbolIndex=new Bt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const i=this;this._rtlTextPluginCallback=Gt.registerForPluginStateChange((t=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,n)=>{if(e.triggerPluginCompletionEvent(t),n&&n.every((e=>e)))for(const e in i._sourceCaches){const t=i._sourceCaches[e],n=t.getSource().type;"vector"!==n&&"geojson"!==n||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const n=this._layers[e];n.source===t.id&&this._validateLayer(n)}}))}loadURL(t,n={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const i="boolean"==typeof n.validate?n.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken);const r=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(r,((t,n)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):n&&this._load(n,i)}))}loadJSON(t,n={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==n.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(jt,!1)}_updateLayerCount(e,t){const n=t?1:-1;e.is3D()&&(this._num3DLayers+=n),"circle"===e.type&&(this._numCircleLayers+=n),"symbol"===e.type&&(this._numSymbolLayers+=n)}_load(t,n){if(n&&Ft(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const i=Be(this.stylesheet.layers);this._order=i.map((e=>e.id)),this._layers={},this._serializedLayers={};for(let t of i)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize(),this._updateLayerCount(t,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(t,n,i){let r,o,s;const a=e.exported.devicePixelRatio>1?"@2x":"";let l=e.getJSON(n.transformRequest(n.normalizeSpriteURL(t,a,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,s||(s=e,r=t,u())})),c=e.getImage(n.transformRequest(n.normalizeSpriteURL(t,a,".png"),e.ResourceType.SpriteImage),((e,t)=>{c=null,s||(s=e,o=t,u())}));function u(){if(s)i(s);else if(r&&o){const t=e.exported.getImageData(o),n={};for(const i in r){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:f}=r[i],p=new e.RGBAImage({width:o,height:s});e.RGBAImage.copy(t,p,{x:a,y:l},{x:0,y:0},{width:o,height:s}),n[i]={data:p,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:f}}i(null,n)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,n)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(n)for(const e in n)this.imageManager.addImage(e,n[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const n=this.getSource(t.source);if(!n)return;const i=t.sourceLayer;i&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&Vt[e.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(e.length||n.length)&&this._updateWorkerLayers(e,n);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const i={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];i[e]=t.used,t.used=!1}for(const e of this._order){const n=this._layers[e];if(n.recalculate(t,this._availableImages),!n.isHidden(t.zoom)){const e=this._getLayerSourceCache(n);e&&(e.used=!0)}const i=this.map.painter;if(i){const e=n.getProgramIds();if(!e)continue;const r=n.getProgramConfiguration(t.zoom);for(const t of e)i.useProgram(t,r)}}for(const t in i){const n=this._sourceCaches[t];i[t]!==n.used&&n.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:n.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Ft(this,e.validateStyle(t)))return!1;(t=e.clone$2(t)).layers=Be(t.layers);const n=function(e,t){if(!e)return[{command:Fe.setStyle,args:[t]}];let n=[];try{if(!r(e.version,t.version))return[{command:Fe.setStyle,args:[t]}];r(e.center,t.center)||n.push({command:Fe.setCenter,args:[t.center]}),r(e.zoom,t.zoom)||n.push({command:Fe.setZoom,args:[t.zoom]}),r(e.bearing,t.bearing)||n.push({command:Fe.setBearing,args:[t.bearing]}),r(e.pitch,t.pitch)||n.push({command:Fe.setPitch,args:[t.pitch]}),r(e.sprite,t.sprite)||n.push({command:Fe.setSprite,args:[t.sprite]}),r(e.glyphs,t.glyphs)||n.push({command:Fe.setGlyphs,args:[t.glyphs]}),r(e.transition,t.transition)||n.push({command:Fe.setTransition,args:[t.transition]}),r(e.light,t.light)||n.push({command:Fe.setLight,args:[t.light]}),r(e.fog,t.fog)||n.push({command:Fe.setFog,args:[t.fog]});const i={},o=[];!function(e,t,n,i){let o;for(o in t=t||{},e=e||{})e.hasOwnProperty(o)&&(t.hasOwnProperty(o)||Ue(o,n,i));for(o in t)t.hasOwnProperty(o)&&(e.hasOwnProperty(o)?r(e[o],t[o])||("geojson"===e[o].type&&"geojson"===t[o].type&&Ve(e,t,o)?n.push({command:Fe.setGeoJSONSourceData,args:[o,t[o].data]}):je(o,t,n,i)):Ne(o,t,n))}(e.sources,t.sources,o,i);const s=[];e.layers&&e.layers.forEach((e=>{i[e.source]?n.push({command:Fe.removeLayer,args:[e.id]}):s.push(e)}));let a=e.terrain;a&&i[a.source]&&(n.push({command:Fe.setTerrain,args:[void 0]}),a=void 0),n=n.concat(o),r(a,t.terrain)||n.push({command:Fe.setTerrain,args:[t.terrain]}),function(e,t,n){t=t||[];const i=(e=e||[]).map(We),o=t.map(We),s=e.reduce($e,{}),a=t.reduce($e,{}),l=i.slice(),c=Object.create(null);let u,h,d,f,p,A,m;for(u=0,h=0;u<i.length;u++)d=i[u],a.hasOwnProperty(d)?h++:(n.push({command:Fe.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(n.push({command:Fe.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,A=l[l.length-u],n.push({command:Fe.addLayer,args:[a[d],A]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],f=s[d],p=a[d],!c[d]&&!r(f,p))if(r(f.source,p.source)&&r(f["source-layer"],p["source-layer"])&&r(f.type,p.type)){for(m in Ge(f.layout,p.layout,n,d,null,Fe.setLayoutProperty),Ge(f.paint,p.paint,n,d,null,Fe.setPaintProperty),r(f.filter,p.filter)||n.push({command:Fe.setFilter,args:[d,p.filter]}),r(f.minzoom,p.minzoom)&&r(f.maxzoom,p.maxzoom)||n.push({command:Fe.setLayerZoomRange,args:[d,p.minzoom,p.maxzoom]}),f)f.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?Ge(f[m],p[m],n,d,m.slice(6),Fe.setPaintProperty):r(f[m],p[m])||n.push({command:Fe.setLayerProperty,args:[d,m,p[m]]}));for(m in p)p.hasOwnProperty(m)&&!f.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?Ge(f[m],p[m],n,d,m.slice(6),Fe.setPaintProperty):r(f[m],p[m])||n.push({command:Fe.setLayerProperty,args:[d,m,p[m]]}))}else n.push({command:Fe.removeLayer,args:[d]}),A=l[l.lastIndexOf(d)+1],n.push({command:Fe.addLayer,args:[p,A]})}(s,t.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:Fe.setStyle,args:[t]}]}return n}(this.serialize(),t).filter((e=>!(e.command in Ut)));if(0===n.length)return!1;const i=n.filter((e=>!(e.command in Nt)));if(i.length>0)throw new Error(`Unimplemented: ${i.map((e=>e.command)).join(", ")}.`);return n.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,i={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.validateStyle.source,`sources.${t}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=Te(t,n,this.dispatcher,this);r.setEventedParent(this,(()=>({isSourceLoaded:this.loaded(),source:r.serialize(),sourceId:t})));const o=n=>{const i=(n?"symbol:":"other:")+t,o=this._sourceCaches[i]=new e.SourceCache(i,r,n);(n?this._symbolSourceCaches:this._otherSourceCaches)[t]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const n=this.getSource(t);if(void 0===n)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${n}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const i=this._getSourceCaches(t);for(const t of i)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}addLayer(t,n,i={}){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let o;if("custom"===t.type){if(Ft(this,e.validateCustomStyleLayer(t)))return;o=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone$2(t),t=e.extend(t,{source:r})),this._validate(e.validateStyle.layer,`layers.${r}`,t,{arrayIndex:-1},i))return;o=e.createStyleLayer(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=n?this._order.indexOf(n):this._order.length;if(n&&-1===s)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[r]&&o.source&&a&&"custom"!==o.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const i=this._order.indexOf(t);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(r,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));n.setEventedParent(null),this._updateLayerCount(n,!1);const i=this._order.indexOf(t);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(t,n,i){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,n,i={}){this._checkLoaded();const o=this.getLayer(t);if(o){if(!r(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.validateStyle.filter,`layers.${o.id}.filter`,n,null,i)||(o.filter=e.clone$2(n),this._updateLayer(o)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return e.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,n,i,o={}){this._checkLoaded();const s=this.getLayer(t);s?r(s.getLayoutProperty(n),i)||(s.setLayoutProperty(n,i,o),this._updateLayer(s)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,n){const i=this.getLayer(t);if(i)return i.getLayoutProperty(n);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,n,i,o={}){this._checkLoaded();const s=this.getLayer(t);s?r(s.getPaintProperty(n),i)||(s.setPaintProperty(n,i,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,n){this._checkLoaded();const i=t.source,r=t.sourceLayer,o=this.getSource(i);if(void 0===o)return void this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&r)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!r)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(i);for(const e of a)e.setFeatureState(r,t.id,n)}removeFeatureState(t,n){this._checkLoaded();const i=t.source,r=this.getSource(i);if(void 0===r)return void this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));const o=r.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(i);for(const e of a)e.removeFeatureState(s,t.id,n)}getFeatureState(t){this._checkLoaded();const n=t.source,i=t.sourceLayer,r=this.getSource(n);if(void 0!==r){if("vector"!==r.type||i)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(i,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const n=this._sourceCaches[e].getSource();t[n.id]||(t[n.id]=n.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,n={},i=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(t(o)){n[o]=r;for(const t of e){const e=t[o];if(e)for(const t of e)i.push(t)}}}i.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(n[t.layer.id]<o)break;r.push(t),i.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)r.push(t.feature)}}return r}queryRenderedFeatures(t,n,i){n&&n.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of n.layers){const n=this._layers[t];if(!n)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[n.source]=!0}}const o=[];n.availableImages=this._availableImages;const s=n&&n.layers?n.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),a=M.createFromScreenPoints(t,i);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;n.layers&&!r[t]||o.push(Ce(this._sourceCaches[e],this._layers,this._serializedLayers,a,n,i,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,n,i,r,o,s){const a={},l=o.queryRenderedSymbols(i),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(Me);for(const n of c){const i=n.featureIndex.lookupSymbolFeatures(l[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in i){const t=a[e]=a[e]||[],r=i[e];r.sort(((e,t)=>{const i=n.featureSortOrder;if(i){const n=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const t in a)a[t].forEach((i=>{const r=i.feature,o=n(e[t]).getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}));return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,n){n&&n.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this._getSourceCaches(t);let r=[];for(const e of i)r=r.concat(Pe(e,n));return r}addSourceType(e,t,n){return Gt.getSourceType(e)?n(new Error(`A source type called "${e}" already exists.`)):(Gt.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const i=this.light.getLight();let o=!1;for(const e in t)if(!r(t[e],i[e])){o=!0;break}if(!o)return;const s={now:e.exported.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(s)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof t.source){const n="terrain-dem-src";this.addSource(n,t.source),t=e.clone$2(t),t=e.extend(t,{source:n})}if(!this._validate(e.validateStyle.terrain,"terrain",t)){if(this.terrain){const n=this.terrain,i=n.get();for(const o in t)if(!r(t[o],i[o])){n.set(t),this.stylesheet.terrain=t;const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const n=this.fog=new k(t);this.stylesheet.fog=t;const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog,i=n.get();for(const o in t)if(!r(t[o],i[o])){n.set(t),this.stylesheet.fog=t;const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const e=this._order.filter((e=>this.isLayerDraped(this._layers[e]))),t=this._order.filter((e=>!this.isLayerDraped(this._layers[e])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(t){const n=this.terrain=new x(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const i={now:e.exported.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(i)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_validate(t,n,i,r,o={}){return(!o||!1!==o.validate)&&Ft(this,t.call(e.validateStyle,e.extend({key:n,style:this.serialize(),value:i,styleSpec:e.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,n,i,r,o=!1){let s=!1,a=!1;const l={};for(const e of this._order){const n=this._layers[e];if("symbol"!==n.type)continue;if(!l[n.source]){const e=this._getLayerSourceCache(n);if(!e)continue;l[n.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const i=this.crossTileSymbolIndex.addLayer(n,l[n.source],t.center.lng);s=s||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===i,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new Lt(t,this._order,o,n,i,r,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,n){this.imageManager.getImages(t.icons,n),this._updateTilesForChangedImages();const i=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};i(this._otherSourceCaches[t.source]),i(this._symbolSourceCaches[t.source])}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)}getResource(t,n,i){return e.makeRequest(n,i)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Gt.getSourceType=function(e){return Se[e]},Gt.setSourceType=function(e,t){Se[e]=t},Gt.registerForPluginStateChange=e.registerForPluginStateChange;var Wt="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",$t="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let qt={},Zt={};qt=Yt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif",!0),Zt=Yt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Ht=Yt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Qt=Wt;var Xt={background:Yt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Yt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Yt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Yt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Yt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Yt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Yt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Yt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Yt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Yt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Yt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Yt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Yt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Yt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Yt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Yt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Yt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:Yt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Yt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:Yt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Yt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Yt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",$t),skyboxGradient:Yt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",$t),skyboxCapture:Yt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:Yt("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Yt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Yt(e,t,n){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=e.match(r),a=t.match(r),l=Wt.match(r);let c=a?a.concat(s):s;n||(qt.staticUniforms&&(c=qt.staticUniforms.concat(c)),Zt.staticUniforms&&(c=Zt.staticUniforms.concat(c))),c&&(c=c.concat(l));const u={};return{fragmentSource:e=e.replace(i,((e,t,n,i,r)=>(u[r]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = u_${r};\n#endif\n`))),vertexSource:t=t.replace(i,((e,t,n,i,r)=>{const o="float"===i?"vec2":"vec4",s=r.match(/color/)?"color":o;return u[r]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${o} a_${r};\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${o} a_${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`})),staticAttributes:o,staticUniforms:c}}class Kt{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,n,i,r,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==i.length;for(let e=0;!l&&e<i.length;e++)this.boundPaintVertexBuffers[e]!==i[e]&&(l=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===n&&!l&&this.boundIndexBuffer===r&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a?(e.bindVertexArrayOES.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind()):this.freshBind(t,n,i,r,o,s,a)}freshBind(e,t,n,i,r,o,s){let a;const l=e.numAttributes,c=this.context,u=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s;else{a=c.currentNumAttributes||0;for(let e=l;e<a;e++)u.disableVertexAttribArray(e)}t.enableAttributes(u,e);for(const t of n)t.enableAttributes(u,e);o&&o.enableAttributes(u,e),s&&s.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,r);for(const t of n)t.bind(),t.setVertexAttribPointers(u,e,r);o&&(o.bind(),o.setVertexAttribPointers(u,e,r)),i&&i.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,e,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Jt(t,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new e.MercatorCoordinate(0,r/i).toLngLat().lat,new e.MercatorCoordinate(0,(r+1)/i).toLngLat().lat]}function en(t,n,i,r,o,s,a){const l=t.context,c=l.gl,u=i.fbo;if(!u)return;t.prepareDrawTile(n);const h=t.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,t,n,i)=>{const r=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color");let a=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a-=e.transform.angle);const l=!e.options.moving;return{u_matrix:i||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:Jt(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:o,u_accent:s}})(t,i,r,t.terrain?n.projMatrix:null);t.prepareDrawProgram(l,h,n.toUnwrapped()),h.draw(l,c.TRIANGLES,o,s,a,e.CullFaceMode.disabled,d,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function tn(t,n,i){if(!n.needsDEMTextureUpload)return;const r=t.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(i.stride);const s=i.getPixels();n.demTexture?n.demTexture.update(s,{premultiply:!1}):n.demTexture=new e.Texture(r,s,o.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function nn(t,n,i,r,o,s){const a=t.context,l=a.gl;if(!n.dem)return;const c=n.dem;if(a.activeTexture.set(l.TEXTURE1),tn(t,n,c),!n.demTexture)return;n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=n.fbo;if(!h){const t=new e.Texture(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=n.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(t.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]),t.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,e.CullFaceMode.disabled,((t,n)=>{const i=n.stride,r=e.create$1();return e.ortho(r,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(r,r,[0,-e.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:t.overscaledZ,u_unpack:n.unpackVector}})(n.tileID,c),i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),n.needsHillshadePrepare=!1}const rn=(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image0:new e.Uniform1i(t,n.u_image0),u_skirt_height:new e.Uniform1f(t,n.u_skirt_height)}),on=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),sn=new class{constructor(){this.operations={}}newMorphing(e,t,n,i,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:i,phase:0,duration:r,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},an={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ln(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const cn=e=>({u_matrix:e});function un(t,n,i,r,o){if(o>0){const s=e.exported.now(),a=(s-t.timeAdded)/o,l=n?(s-n.timeAdded)/o:-1,c=i.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.clamp(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class hn extends e.SourceCache{constructor(e){const t=Te("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new C(De(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,i){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((n,i)=>{if(n[i.key]="",!this._tiles[i.key]){const n=new e.Tile(i,this._source.tileSize*i.overscaleFactor(),t.tileZoom);n.state="loaded",this._tiles[i.key]=n}return n}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dn extends e.OverscaledTileID{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class fn extends e.Elevation{constructor(t,n){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[i,r,o]=function(t){const n=new e.StructArrayLayout4i8,i=new e.StructArrayLayout3ui6,r=131;n.reserve(17161),i.reserve(33800);const o=e.EXTENT/128,s=e.EXTENT+o/2,a=s+o;for(let t=-o;t<a;t+=o)for(let i=-o;i<a;i+=o){const r=i<0||i>s||t<0||t>s?24575:0,o=e.clamp(Math.round(i),0,e.EXTENT),a=e.clamp(Math.round(t),0,e.EXTENT);n.emplaceBack(o+r,a,o,a)}const l=(e,t)=>{const n=t*r+e;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[n,i,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(i,we.members),this.gridIndexBuffer=s.createIndexBuffer(r),this.gridSegments=e.SegmentVector.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,i.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hn(n.map),this.orthoMatrix=e.create$1(),e.ortho(this.orthoMatrix,0,e.EXTENT,0,e.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new e.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency()}update(t,n,i){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const r=t.terrain.properties;this.sourceCache=t._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const o=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.sourceCache.getSource().tileSize/128,i=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(n,t*i,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),n.updateElevation(!i),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=n.getIds().map((e=>{const t=n.getTileByID(e).tileID;return t.projMatrix=i.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,n){const i=n.transform.pointCoordinate(n.transform.getCameraPoint()),r=new e.pointGeometry(i.x,i.y);t.sort(((t,n)=>{if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;const i=new e.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.pointGeometry(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),s=r.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(i)-s.distSqr(o)}))}(r,this.painter),this._previousZoom=i.zoom;const o=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const e in s){const n=s[e];if(!n.used)continue;if(n!==this.sourceCache&&(this._findCoveringTileCache[n.id]={}),this._setupProxiedCoordsForOrtho(n,t[e],o),n.usedForTerrain)continue;const i=t[e];n.getSource().reparseOverscaled&&this._assignTerrainTiles(i)}this.proxiedCoords[n.id]=r.map((e=>new dn(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const n=t.tileID.key;n in a||(this._visibleDemTiles.push(t),a[n]=n)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const i=this.terrainTileForTile[n],r=i.dem;!r||i.demTexture&&!i.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),tn(this.painter,i,r))}}_prepareDemTileUniforms(e,t,n,i){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),s=i||"";return n[`u_dem_tl${s}`]=[r.x*o%1,r.y*o%1],n[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,n)=>{if(!n.dem)return t;const i=n.dem.tree.minimums[0];return i>0&&e++,t+i}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const i=this._getLoadedAreaMinimum(),r={width:1,height:1,data:new Uint8Array(e.DEMData.pack(i,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new e.Texture(t,r,n.RGBA,{premultiply:!1}),o}setupElevationDraw(t,n,i){const r=this.painter.context,o=r.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();let l=null,c=null,u=1;if(i&&i.morphing&&this._useVertexMorphing){const e=i.morphing.srcDemTile,n=i.morphing.dstDemTile;u=i.morphing.phase,e&&n&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(c=e),this._prepareDemTileUniforms(t,n,s)&&(l=n))}if(c&&l?(r.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),r.activeTexture.set(o.TEXTURE4),c.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=u):(l=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,l,s)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST)),i&&i.useDepthForOcclusion&&(r.activeTexture.set(o.TEXTURE3),this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),i&&i.useMeterToDem&&l){const t=(1<<l.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}i&&i.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(r,s)}renderToBackBuffer(t){const n=this.painter,i=this.painter.context;0!==t.length&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),this.renderingToTexture=!1,function(t,n,i,r,o){const s=t.context,a=s.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=(e,n)=>{if(c===e)return;const i=[an[e]];n&&i.push(an[u]),l=t.useProgram("terrainRaster",null,i),c=e},d=t.colorModeForRenderPass(),f=new e.DepthMode(a.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);sn.update(o);const p=t.transform,A=6*Math.pow(1.5,22-p.zoom)*n.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const m=u?a.LINES:a.TRIANGLES,[g,y]=u?n.getWirefameBuffer():[n.gridIndexBuffer,n.gridSegments];for(const c of r){const r=i.getTile(c),b=e.StencilMode.disabled,x=n.prevTerrainTileForTile[c.key],w=n.terrainTileForTile[c.key];v=w,null!=(_=x)&&null!=v&&_.hasData()&&v.hasData()&&null!=_.demTexture&&null!=v.demTexture&&_.tileID.key!==v.tileID.key&&sn.newMorphing(c.key,x,w,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const E=sn.getMorphValuesForProxy(c.key),S=E?1:0;let T;E&&(T={morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.easeCubicInOut(E.phase)}});const k=on(c.projMatrix,ln(c.canonical,p.renderWorldCopies)?A/10:A);h(S,u),n.setupElevationDraw(r,l,T),t.prepareDrawProgram(s,l,c.toUnwrapped()),l.draw(s,m,f,b,d,e.CullFaceMode.backCCW,k,"terrain_raster",n.gridBuffer,g,y)}var _,v}))}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],s=this._drapedRenderBatches.shift(),a=[],l=n.style.order;let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],f=void 0!==h;if(o.texture=d.tex,f&&!d.dirty){a.push(o.tileID);continue}let p;i.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(i.clear({color:e.Color.transparent}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=n.style._layers[l[e]];if(t.isHidden(n.transform.zoom))continue;const r=n.style._getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;i.viewport.set([0,0,d.fb.width,d.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),p=r?r.id:null),n.renderLayer(n,r,t,s)}this.renderedToTile?(d.dirty=!0,a.push(o.tileID)):f||--c,5===c&&(c=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),s.end+1}postRender(){}renderCacheEfficiency(e){const t=e.order.length;if(0===t)return{efficiency:100};let n,i=0,r=0,o=!1;for(let s=0;s<t;++s){const t=e._layers[e.order[s]];this._style.isLayerDraped(t)?(o&&++i,++r):o||(o=!0,n=t.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-i/r),firstUndrapedLayer:n}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter((e=>e.dem)).map((i=>{const r=i.tileID,o=Math.pow(2,r.overscaledZ),{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:i.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:i}}));i.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of i){if(null==r.t)return null;const i=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,n);if(null!=i)return i}return null}_createFBO(){const t=this.painter.context,n=t.gl,i=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const r=new e.Texture(t,{width:i[0],height:i[1],data:null},n.RGBA);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=t.createFramebuffer(i[0],i[1],!1);return o.colorAttachment.set(r.texture),o.depthAttachment=new ye(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._layers[e],n=t.isHidden(this.painter.transform.zoom),i=t.getCrossfadeParameters(),r=!!i&&1!==i.t,o=t.hasTransition();return"custom"!==t.type&&!n&&(r||o)}))}_clearRasterFadeFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof be){e=!0;break}if(e)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],n=t.isHidden(this.painter.transform.zoom),i=this._style._getLayerSourceCache(t);if("raster"!==t.type||n||!i)continue;const r=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][i.id];if(t)for(const e of t){const t=un(i.getTile(e),i.findLoadedParent(e,0),i,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(i.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const n=[];let i,r=0,o=this._style._layers[e[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<t;)o=this._style._layers[e[r]];for(;r<t;++r){const t=this._style._layers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===i&&(i=r):void 0!==i&&(n.push({start:i,end:r-1}),i=void 0))}void 0!==i&&n.push({start:i,end:r-1}),this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const i=Object.values(e[n]);t.renderCachePool.push(...i)}}return}this._clearRasterFadeFromRenderCache();const n=this.proxyCoords,i=this._tilesDirty;for(let r=n.length-1;r>=0;r--){const o=n[r];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const n=e[o.key],r=this.proxyToSource[o.key];let s=0;for(const e in r){const t=r[e],o=n[e];if(!o||o.length!==t.length||t.some(((t,n)=>t!==o[n]||i[e]&&i[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=s<0||s!==Object.values(n).length}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of r)for(const i of n){if(t.proxyCachedFBO[i.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[i.key]={},t.proxyCachedFBO[i.key][e.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,n){const i=this.painter,r=this.painter.context,o=r.gl;i._tileClippingMaskIDs={},r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const s=i.useProgram("clippingMask");for(const a of t){const t=i._tileClippingMaskIDs[a.key]=--n;s.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,cn(a.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const i=[t.x,t.y,1,1];e.transformMat4(i,i,n.pixelMatrixInverse),e.scale$2(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;const r=n._camera.position,o=e.mercatorZfromAltitude(1,n.center.lat),s=[r[0],r[1],r[2]/o,0],a=e.subtract([],i.slice(0,3),s);e.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const t=this.painter,n=t.context,i=this.proxySourceCache,r=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const t=n.gl,i=n.createFramebuffer(r,o,!0);n.activeTexture.set(t.TEXTURE0);const s=new e.Texture(n,{width:r,height:o,data:null},t.RGBA);s.bind(t.NEAREST,t.CLAMP_TO_EDGE),i.colorAttachment.set(s.texture);const a=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,r,o);i.depthAttachment.set(a),this._depthFBO=i,this._depthTexture=s}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,r,o]),function(t,n,i,r){const o=t.context,s=o.gl;o.clear({depth:1});const a=t.useProgram("terrainDepth"),l=new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of r){const r=i.getTile(t),c=on(t.projMatrix,0);n.setupElevationDraw(r,a),a.draw(o,s.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,c,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}(t,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,n){if(e.getSource()instanceof Ee)return this._setupProxiedCoordsForImageSource(e,t,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const i=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let t=0;t<r.length;t++){const o=r[t],s=this._findTileCoveringTileID(o,e);if(s){const t=this._createProxiedId(o,s,n[o.key]&&n[o.key][e.id]);i.push(t),this.proxyToSource[o.key][e.id]=[t]}}let o=!1;for(let r=0;r<t.length;r++){const s=e.getTile(t[r]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const t=this.proxyToSource[a.tileID.key][e.id],r=this._createProxiedId(a.tileID,s,n[a.tileID.key]&&n[a.tileID.key][e.id]);t?t.splice(t.length-1,0,r):this.proxyToSource[a.tileID.key][e.id]=[r],i.push(r),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(t,n,i){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=new e.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-a.x),e.min.y=Math.min(e.min.y,t.y-a.y),e.max.x=Math.max(e.max.x,t.x-a.x),e.max.y=Math.max(e.max.y,t.y-a.y),e)),{min:new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,n)=>{const i=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),o=e.EXTENT/(1<<t.canonical.z),s=n.wrap+n.canonical.x/(1<<n.canonical.z),a=n.canonical.y/(1<<n.canonical.z);return i+o<s+l.min.x||i>s+l.max.x||r+o<a+l.min.y||r>a+l.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<n.length;e++){const o=t.getTile(n[e]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,i[s.key]&&i[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],r.push(a)}}}_createProxiedId(t,n,i){let r=this.orthoMatrix;if(i){const e=i.find((e=>e.key===n.tileID.key));if(e)return e}if(n.tileID.key!==t.key){const i=t.canonical.z-n.tileID.canonical.z;let o,s,a;r=e.create$1();const l=n.tileID.wrap-t.wrap<<t.overscaledZ;i>0?(o=e.EXTENT>>i,s=o*((n.tileID.canonical.x<<i)-t.canonical.x+l),a=o*((n.tileID.canonical.y<<i)-t.canonical.y)):(o=e.EXTENT<<-i,s=e.EXTENT*(n.tileID.canonical.x-(t.canonical.x+l<<-i)),a=e.EXTENT*(n.tileID.canonical.y-(t.canonical.y<<-i))),e.ortho(r,0,o,0,o,0,1),e.translate(r,r,[s,a,0])}return new dn(n.tileID,t.key,r)}_findTileCoveringTileID(t,n){let i=n.getTile(t);if(i&&i.hasData())return i;const r=this._findCoveringTileCache[n.id],o=r[t.key];if(i=o?n.getTileByID(o):null,i&&i.hasData()||null===o)return i;let s=i?i.tileID:t,a=s.overscaledZ;const l=n.getSource().minzoom,c=[];if(!o){const r=n.getSource().maxzoom;if(t.canonical.z>=r){const i=t.canonical.z-r;n.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,n.transform.tileZoom),s=new e.OverscaledTileID(a,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i)):0!==i&&(a=r,s=new e.OverscaledTileID(a,t.wrap,r,t.canonical.x>>i,t.canonical.y>>i))}s.key!==t.key&&(c.push(s.key),i=n.getTile(s))}const u=e=>{c.forEach((t=>{r[t]=e})),c.length=0};for(a-=1;a>=l&&(!i||!i.hasData());a--){i&&u(i.tileID.key);const e=s.calculateScaledKey(a);if(i=n.getTileByID(e),i&&i.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):i=n.getTileByID(t)}return u(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(e){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(t){let n,i,r;const o=new e.StructArrayLayout2ui4,s=131;for(i=1;i<129;i++){for(n=1;n<129;n++)r=i*s+n,o.emplaceBack(r,r+1),o.emplaceBack(r,r+s),o.emplaceBack(r+1,r+s),128===i&&o.emplaceBack(r+s,r+s+1);o.emplaceBack(r+1,r+1+s)}return o}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function pn(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const i=e[n].split(" ");t.push(i.pop())}return t}class An{static cacheKey(e,t,n){let i=`${e}${n?n.cacheKey:""}`;for(const e of t)i+=`/${e}`;return i}constructor(t,n,i,r,o,s){const a=t.gl;this.program=a.createProgram();const l=pn(i.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=i.staticUniforms?pn(i.staticUniforms):[],d=r?r.getBinderUniforms():[],f=h.concat(d),p=[];for(const e of f)p.indexOf(e)<0&&p.push(e);let A=r?r.defines():[];A=A.concat(s.map((e=>`#define ${e}`)));const m=A.concat(Ht.fragmentSource,Qt,Zt.fragmentSource,i.fragmentSource).join("\n"),g=A.concat(Ht.vertexSource,Qt,Zt.vertexSource,qt.vertexSource,i.vertexSource).join("\n"),y=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(y,m),a.compileShader(y),a.attachShader(this.program,y);const _=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_),this.attributes={};const v={};this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(a.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);a.linkProgram(this.program),a.deleteShader(_),a.deleteShader(y);for(let e=0;e<p.length;e++){const t=p[e];if(t&&!v[t]){const e=a.getUniformLocation(this.program,t);e&&(v[t]=e)}}this.fixedUniforms=o(t,v),this.binderUniforms=r?r.getUniforms(t,v):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms=((t,n)=>({u_dem:new e.Uniform1i(t,n.u_dem),u_dem_prev:new e.Uniform1i(t,n.u_dem_prev),u_dem_unpack:new e.Uniform4f(t,n.u_dem_unpack),u_dem_tl:new e.Uniform2f(t,n.u_dem_tl),u_dem_scale:new e.Uniform1f(t,n.u_dem_scale),u_dem_tl_prev:new e.Uniform2f(t,n.u_dem_tl_prev),u_dem_scale_prev:new e.Uniform1f(t,n.u_dem_scale_prev),u_dem_size:new e.Uniform1f(t,n.u_dem_size),u_dem_lerp:new e.Uniform1f(t,n.u_dem_lerp),u_exaggeration:new e.Uniform1f(t,n.u_exaggeration),u_depth:new e.Uniform1i(t,n.u_depth),u_depth_size_inv:new e.Uniform2f(t,n.u_depth_size_inv),u_meter_to_dem:new e.Uniform1f(t,n.u_meter_to_dem),u_label_plane_matrix_inv:new e.UniformMatrix4f(t,n.u_label_plane_matrix_inv),u_tile_tl_up:new e.Uniform3f(t,n.u_tile_tl_up),u_tile_tr_up:new e.Uniform3f(t,n.u_tile_tr_up),u_tile_br_up:new e.Uniform3f(t,n.u_tile_br_up),u_tile_bl_up:new e.Uniform3f(t,n.u_tile_bl_up),u_tile_up_scale:new e.Uniform1f(t,n.u_tile_up_scale)}))(t,v)),-1!==s.indexOf("FOG")&&(this.fogUniforms=((t,n)=>({u_fog_matrix:new e.UniformMatrix4f(t,n.u_fog_matrix),u_fog_range:new e.Uniform2f(t,n.u_fog_range),u_fog_color:new e.Uniform4f(t,n.u_fog_color),u_fog_horizon_blend:new e.Uniform1f(t,n.u_fog_horizon_blend),u_fog_temporal_offset:new e.Uniform1f(t,n.u_fog_temporal_offset)}))(t,v))}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].location&&n[e].set(t[e])}}draw(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){const m=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(i),e.setColorMode(r),e.setCullFace(o);for(const e in this.fixedUniforms)this.fixedUniforms[e].set(s[e]);f&&f.setUniforms(e,this.binderUniforms,h,{zoom:d});const g={[m.LINES]:2,[m.TRIANGLES]:3,[m.LINE_STRIP]:1}[t];for(const n of u.get()){const i=n.vaos||(n.vaos={});(i[a]||(i[a]=new Kt)).bind(e,this,l,f?f.getPaintVertexBuffers():[],c,n.vertexOffset,p,A),m.drawElements(t,n.primitiveLength*g,m.UNSIGNED_SHORT,n.primitiveOffset*g*2)}}}function mn(e,t,n){const i=1/P(n,1,t.transform.tileZoom),r=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,t.transform.tileZoom)/r,s=o*(n.tileID.canonical.x+n.tileID.wrap*r),a=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const gn=(t,n,i,r)=>{const o=n.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=e.create$2();"viewport"===o.properties.get("anchor")&&(e.fromRotation(l,-n.transform.angle),e.transformMat3(a,a,l));const c=o.properties.get("color");return{u_matrix:t,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+i,u_opacity:r}},yn=(t,n,i,r,o,s,a)=>e.extend(gn(t,n,i,r),mn(s,n,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),_n=e=>({u_matrix:e}),vn=(t,n,i,r)=>e.extend(_n(t),mn(i,n,r)),bn=(e,t)=>({u_matrix:e,u_world:t}),xn=(t,n,i,r,o)=>e.extend(vn(t,n,i,r),{u_world:o}),wn=(t,n,i,r)=>{const o=t.transform;let s;if("map"===r.paint.get("circle-pitch-alignment")){const e=P(i,1,o.zoom);s=[e,e]}else s=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_matrix:t.translatePosMatrix(n.projMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:s}},En=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},Sn=(t,n,i)=>{const r=e.EXTENT/i.tileSize;return{u_matrix:t,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/r,n.pixelsToGLUnits[1]/r]}},Tn=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),kn=(e,t,n,i)=>({u_matrix:e,u_extrude_scale:P(t,1,n),u_intensity:i}),Cn=(t,n,i,r,o,s)=>{const a=t.transform,l={u_matrix:In(t,n,i,o),u_ratio:1/P(n,1,a.zoom),u_device_pixel_ratio:e.exported.devicePixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Rn(i)){const e=Mn(n,t.transform);l.u_texsize=n.lineAtlasTexture.size,l.u_scale=[e,r.fromScale,r.toScale],l.u_mix=r.t}return l},Pn=(t,n,i,r,o)=>{const s=t.transform,a=Mn(n,s);return{u_matrix:In(t,n,i,o),u_texsize:n.imageAtlasTexture.size,u_ratio:1/P(n,1,s.zoom),u_device_pixel_ratio:e.exported.devicePixelRatio,u_image:0,u_scale:[a,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}};function Mn(e,t){return 1/P(e,1,t.tileZoom)}function In(e,t,n,i){return e.translatePosMatrix(i||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ln=e=>{const t=[];return Rn(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),t};function Rn(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const zn=(e,t,n,i,r)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Dn(r.paint.get("raster-hue-rotate"))};var o,s};function Dn(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const On=(e,t,n,i,r,o,s,a,l,c)=>{const u=r.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:u.width/u.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+i,u_texsize:c,u_texture:0}},Bn=(t,n,i,r,o,s,a,l,c,u,h)=>{const{cameraToCenterDistance:d,_pitch:f}=o.transform;return e.extend(On(t,n,i,r,o,s,a,l,c,u),{u_gamma_scale:r?d*Math.cos(o.terrain?0:f):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+h})},Fn=(t,n,i,r,o,s,a,l,c,u)=>e.extend(Bn(t,n,i,r,o,s,a,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),Nn=(e,t,n)=>({u_matrix:e,u_opacity:t,u_color:n}),Un=(t,n,i,r,o,s)=>e.extend(function(e,t,n,i){const r=n.imageManager.getPattern(e.from.toString()),o=n.imageManager.getPattern(e.to.toString()),{width:s,height:a}=n.imageManager.getPixelSize(),l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(i.tileID.canonical.x+i.tileID.wrap*l),h=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:t.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/P(i,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,s,i,o),{u_matrix:t,u_opacity:n}),jn={fillExtrusion:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_opacity:new e.Uniform1f(t,n.u_opacity)}),fillExtrusionPattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,n.u_height_factor),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade),u_opacity:new e.Uniform1f(t,n.u_opacity)}),fill:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),fillPattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}),fillOutline:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world)}),fillOutlinePattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}),circle:(t,n)=>({u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),collisionBox:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale)}),collisionCircle:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,n.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,n.u_viewport_size)}),debug:(t,n)=>({u_color:new e.UniformColor(t,n.u_color),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_overlay:new e.Uniform1i(t,n.u_overlay),u_overlay_scale:new e.Uniform1f(t,n.u_overlay_scale)}),clippingMask:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),heatmap:(t,n)=>({u_extrude_scale:new e.Uniform1f(t,n.u_extrude_scale),u_intensity:new e.Uniform1f(t,n.u_intensity),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}),heatmapTexture:(t,n)=>({u_image:new e.Uniform1i(t,n.u_image),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_opacity:new e.Uniform1f(t,n.u_opacity)}),hillshade:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_latrange:new e.Uniform2f(t,n.u_latrange),u_light:new e.Uniform2f(t,n.u_light),u_shadow:new e.UniformColor(t,n.u_shadow),u_highlight:new e.UniformColor(t,n.u_highlight),u_accent:new e.UniformColor(t,n.u_accent)}),hillshadePrepare:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_dimension:new e.Uniform2f(t,n.u_dimension),u_zoom:new e.Uniform1f(t,n.u_zoom),u_unpack:new e.Uniform4f(t,n.u_unpack)}),line:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_dash_image:new e.Uniform1i(t,n.u_dash_image),u_gradient_image:new e.Uniform1i(t,n.u_gradient_image),u_image_height:new e.Uniform1f(t,n.u_image_height),u_texsize:new e.Uniform2f(t,n.u_texsize),u_scale:new e.Uniform3f(t,n.u_scale),u_mix:new e.Uniform1f(t,n.u_mix)}),linePattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_texsize:new e.Uniform2f(t,n.u_texsize),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_image:new e.Uniform1i(t,n.u_image),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}),raster:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_tl_parent:new e.Uniform2f(t,n.u_tl_parent),u_scale_parent:new e.Uniform1f(t,n.u_scale_parent),u_buffer_scale:new e.Uniform1f(t,n.u_buffer_scale),u_fade_t:new e.Uniform1f(t,n.u_fade_t),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image0:new e.Uniform1i(t,n.u_image0),u_image1:new e.Uniform1i(t,n.u_image1),u_brightness_low:new e.Uniform1f(t,n.u_brightness_low),u_brightness_high:new e.Uniform1f(t,n.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,n.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,n.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,n.u_spin_weights)}),symbolIcon:(t,n)=>({u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture)}),symbolSDF:(t,n)=>({u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}),symbolTextAndIcon:(t,n)=>({u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texsize_icon:new e.Uniform2f(t,n.u_texsize_icon),u_texture:new e.Uniform1i(t,n.u_texture),u_texture_icon:new e.Uniform1i(t,n.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}),background:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_color:new e.UniformColor(t,n.u_color)}),backgroundPattern:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image:new e.Uniform1i(t,n.u_image),u_pattern_tl_a:new e.Uniform2f(t,n.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,n.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,n.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,n.u_pattern_br_b),u_texsize:new e.Uniform2f(t,n.u_texsize),u_mix:new e.Uniform1f(t,n.u_mix),u_pattern_size_a:new e.Uniform2f(t,n.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,n.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,n.u_scale_a),u_scale_b:new e.Uniform1f(t,n.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,n.u_tile_units_to_pixels)}),terrainRaster:rn,terrainDepth:rn,skybox:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_sun_direction:new e.Uniform3f(t,n.u_sun_direction),u_cubemap:new e.Uniform1i(t,n.u_cubemap),u_opacity:new e.Uniform1f(t,n.u_opacity),u_temporal_offset:new e.Uniform1f(t,n.u_temporal_offset)}),skyboxGradient:(t,n)=>({u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_center_direction:new e.Uniform3f(t,n.u_center_direction),u_radius:new e.Uniform1f(t,n.u_radius),u_opacity:new e.Uniform1f(t,n.u_opacity),u_temporal_offset:new e.Uniform1f(t,n.u_temporal_offset)}),skyboxCapture:(t,n)=>({u_matrix_3f:new e.UniformMatrix3f(t,n.u_matrix_3f),u_sun_direction:new e.Uniform3f(t,n.u_sun_direction),u_sun_intensity:new e.Uniform1f(t,n.u_sun_intensity),u_color_tint_r:new e.Uniform4f(t,n.u_color_tint_r),u_color_tint_m:new e.Uniform4f(t,n.u_color_tint_m),u_luminance:new e.Uniform1f(t,n.u_luminance)})};let Vn;function Gn(t,n,i,r,o,s,a){const l=t.context,c=l.gl,u=t.useProgram("collisionBox"),h=[];let d=0,f=0;for(let p=0;p<r.length;p++){const A=r[p],m=n.getTile(A),g=m.getBucket(i);if(!g)continue;let y=A.projMatrix;0===o[0]&&0===o[1]||(y=t.translatePosMatrix(A.projMatrix,m,o,s));const _=a?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){const n=e.create$1(),i=y;e.mul$1(n,g.placementInvProjMatrix,t.transform.glCoordMatrix),e.mul$1(n,n,g.placementViewportMatrix),h.push({circleArray:v,circleOffset:f,transform:i,invTransform:n}),d+=v.length/4,f=d}_&&(t.terrain&&t.terrain.setupElevationDraw(m,u),u.draw(l,c.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,Sn(y,t.transform,m),i.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,t.transform.zoom,null,_.collisionVertexBuffer,_.collisionVertexBufferExt))}if(!a||!h.length)return;const p=t.useProgram("collisionCircle"),A=new e.StructArrayLayout2f1f2i16;A.resize(4*d),A._trim();let m=0;for(const e of h)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],o=e.circleArray[n+2],s=e.circleArray[n+3];A.emplace(m++,i,r,o,s,0),A.emplace(m++,i,r,o,s,1),A.emplace(m++,i,r,o,s,2),A.emplace(m++,i,r,o,s,3)}(!Vn||Vn.length<2*d)&&(Vn=function(t){const n=2*t,i=new e.StructArrayLayout3ui6;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(d));const g=l.createIndexBuffer(Vn,!0),y=l.createVertexBuffer(A,e.collisionCircleLayout.members,!0);for(const n of h){const r={u_matrix:n.transform,u_inv_matrix:n.invTransform,u_camera_to_center_distance:(_=t.transform).cameraToCenterDistance,u_viewport_size:[_.width,_.height]};p.draw(l,c.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,r,i.id,y,g,e.SegmentVector.simpleSegment(0,2*n.circleOffset,n.circleArray.length,n.circleArray.length/2),null,t.transform.zoom,null,null,null)}var _;y.destroy(),g.destroy()}const Wn=e.identity(new Float32Array(16));function $n(t,n,i,r,o,s){const{horizontalAlign:a,verticalAlign:l}=e.getAnchorAlignment(t),c=-(a-.5)*n,u=-(l-.5)*i,h=e.evaluateVariableOffset(t,r);return new e.pointGeometry((c/o+h[0])*s,(u/o+h[1])*s)}function qn(t,n,i,r,o,s,a,l,c,u,h,d){const f=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,A=t.icon.dynamicLayoutVertexArray,m={};p.clear();for(let A=0;A<f.length;A++){const g=f.get(A),y=t.allowVerticalPlacement&&!g.placedOrientation,_=g.hidden||!g.crossTileID||y?null:r[g.crossTileID];if(_){const r=new e.pointGeometry(g.tileAnchorX,g.tileAnchorY),f=d(r),A=Ye(r,i?l:a,f),y=Ke(s.cameraToCenterDistance,A.signedDistanceFromCamera);let v=o.evaluateSizeForFeature(t.textSizeData,u,g)*y/e.ONE_EM;i&&(v*=t.tilePixelRatio/c);const{width:b,height:x,anchor:w,textOffset:E,textScale:S}=_,T=$n(w,b,x,E,S,v),k=i?Ye(r.add(T),a,f).point:A.point.add(n?T.rotate(-s.angle):T),C=t.allowVerticalPlacement&&g.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<g.numGlyphs;t++)e.addDynamicAttributes(p,k,C);h&&g.associatedIconIndex>=0&&(m[g.associatedIconIndex]={shiftedAnchor:k,angle:C})}else lt(g.numGlyphs,p)}if(h){A.clear();const n=t.icon.placedSymbolArray;for(let t=0;t<n.length;t++){const i=n.get(t);if(i.hidden)lt(i.numGlyphs,A);else{const n=m[t];if(n)for(let t=0;t<i.numGlyphs;t++)e.addDynamicAttributes(A,n.shiftedAnchor,n.angle);else lt(i.numGlyphs,A)}}t.icon.dynamicLayoutVertexBuffer.updateData(A)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function Zn(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Hn(t,n,i,r,o,s,a,l,c,u,h,d){const f=t.context,p=f.gl,A=t.transform,m="map"===l,g="map"===c,y=m&&"point"!==i.layout.get("symbol-placement"),_=m&&!g&&!y,v=void 0!==i.layout.get("symbol-sort-key").constantOr(1);let b=!1;const x=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),w=i.layout.get("text-variable-anchor"),E=[],S=t.terrain&&g?["PITCH_WITH_MAP_TERRAIN"]:null;for(const l of r){const r=n.getTile(l),c=r.getBucket(i);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length)continue;const d=h.programConfigurations.get(i.id),f=o||c.sdfIcons,x=o?c.textSizeData:c.iconSizeData,T=g||0!==A.pitch,k=t.useProgram(Zn(f,o,c),d,S),C=e.evaluateSizeForZoom(x,A.zoom);let M,I,L,R,z=[0,0],D=null;if(o){if(I=r.glyphAtlasTexture,L=p.LINEAR,M=r.glyphAtlasTexture.size,c.iconsInText){z=r.imageAtlasTexture.size,D=r.imageAtlasTexture;const e="composite"===x.kind||"camera"===x.kind;R=T||t.options.rotating||t.options.zooming||e?p.LINEAR:p.NEAREST}}else{const e=1!==i.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;I=r.imageAtlasTexture,L=f||t.options.rotating||t.options.zooming||e||T?p.LINEAR:p.NEAREST,M=r.imageAtlasTexture.size}const O=P(r,1,t.transform.zoom),B=Qe(l.projMatrix,g,m,t.transform,O),F=t.terrain&&g&&y?e.invert(new Float32Array(16),B):Wn,N=Xe(l.projMatrix,g,m,t.transform,O),U=w&&c.hasTextData(),j="none"!==i.layout.get("icon-text-fit")&&U&&c.hasIconData();if(y){const e=A.elevation;et(c,l.projMatrix,t,o,B,N,g,u,e?t=>e.getAtTileOffset(l,t.x,t.y):null)}const V=t.translatePosMatrix(l.projMatrix,r,s,a),G=y||o&&w||j?Wn:B,W=t.translatePosMatrix(N,r,s,a,!0),$=f&&0!==i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let q;q=f?c.iconsInText?Fn(x.kind,C,_,g,t,V,G,W,M,z):Bn(x.kind,C,_,g,t,V,G,W,o,M,!0):On(x.kind,C,_,g,t,V,G,W,o,M);const Z={program:k,buffers:h,uniformValues:q,atlasTexture:I,atlasTextureIcon:D,atlasInterpolation:L,atlasInterpolationIcon:R,isSDF:f,hasHalo:$,tile:r,labelPlaneMatrixInv:F};if(v&&c.canOverlap){b=!0;const t=h.segments.get();for(const n of t)E.push({segments:new e.SegmentVector([n]),sortKey:n.sortKey,state:Z})}else E.push({segments:h.segments,sortKey:0,state:Z})}b&&E.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of E){const n=e.state;if(t.terrain&&t.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),f.activeTexture.set(p.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,p.CLAMP_TO_EDGE),n.atlasTextureIcon&&(f.activeTexture.set(p.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,p.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,Qn(n.buffers,e.segments,i,t,n.program,x,h,d,r)),r.u_is_halo=0}Qn(n.buffers,e.segments,i,t,n.program,x,h,d,n.uniformValues)}}function Qn(t,n,i,r,o,s,a,l,c){const u=r.context;o.draw(u,u.gl.TRIANGLES,s,a,l,e.CullFaceMode.disabled,c,i.id,t.layoutVertexBuffer,t.indexBuffer,n,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Xn(t,n,i,r,o,s,a){const l=t.context.gl,c=i.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=i.getCrossfadeParameters();let d,f,p,A,m;a?(f=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=l.LINES):(f=u?"fillPattern":"fill",d=l.TRIANGLES);for(const g of r){const r=n.getTile(g);if(u&&!r.patternsLoaded())continue;const y=r.getBucket(i);if(!y)continue;t.prepareDrawTile(g);const _=y.programConfigurations.get(i.id),v=t.useProgram(f,_);u&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers(h));const b=c.constantOr(null);if(b&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[b.to.toString()],n=e.patternPositions[b.from.toString()];t&&n&&_.setConstantPatternPositions(t,n)}const x=t.translatePosMatrix(g.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(a){A=y.indexBuffer2,m=y.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];p="fillOutlinePattern"===f&&u?xn(x,t,h,r,e):bn(x,e)}else A=y.indexBuffer,m=y.segments,p=u?vn(x,t,h,r):_n(x);t.prepareDrawProgram(t.context,v,g.toUnwrapped()),v.draw(t.context,d,o,t.stencilModeForClipping(g),s,e.CullFaceMode.disabled,p,i.id,y.layoutVertexBuffer,A,m,i.paint,t.transform.zoom,_)}}function Yn(t,n,i,r,o,s,a){const l=t.context,c=l.gl,u=i.paint.get("fill-extrusion-pattern"),h=u.constantOr(1),d=i.getCrossfadeParameters(),f=i.paint.get("fill-extrusion-opacity");for(const p of r){const r=n.getTile(p),A=r.getBucket(i);if(!A)continue;const m=A.programConfigurations.get(i.id),g=t.useProgram(h?"fillExtrusionPattern":"fillExtrusion",m);if(t.terrain){const e=t.terrain;if(!A.enableTerrain)continue;if(e.setupElevationDraw(r,g,{useMeterToDem:!0}),Kn(l,n,p,A,i,e),!A.centroidVertexBuffer){const e=g.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}}h&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),m.updatePaintBuffers(d));const y=u.constantOr(null);if(y&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[y.to.toString()],n=e.patternPositions[y.from.toString()];t&&n&&m.setConstantPatternPositions(t,n)}const _=t.translatePosMatrix(p.projMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),v=i.paint.get("fill-extrusion-vertical-gradient"),b=h?yn(_,t,v,f,p,d,r):gn(_,t,v,f);t.prepareDrawProgram(l,g,p.toUnwrapped()),g.draw(l,l.gl.TRIANGLES,o,s,a,e.CullFaceMode.backCCW,b,i.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,i.paint,t.transform.zoom,m,t.terrain?A.centroidVertexBuffer:null)}}function Kn(t,n,i,r,o,s){const a=[t=>{let n=t.canonical.x-1,i=t.wrap;return n<0&&(n=(1<<t.canonical.z)-1,i--),new e.OverscaledTileID(t.overscaledZ,i,t.canonical.z,n,t.canonical.y)},t=>{let n=t.canonical.x+1,i=t.wrap;return n===1<<t.canonical.z&&(n=0,i++),new e.OverscaledTileID(t.overscaledZ,i,t.canonical.z,n,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=n.getSource().maxzoom,i=e=>{const t=n.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)};let r,s,a;return(e.overscaledZ===e.canonical.z||e.overscaledZ>=t)&&(r=i(e.key)),e.overscaledZ>=t&&(s=i(e.calculateScaledKey(e.overscaledZ+1))),e.overscaledZ>t&&(a=i(e.calculateScaledKey(e.overscaledZ-1))),r||s||a},c=[0,0,0],u=(t,n)=>(c[0]=Math.min(t.min.y,n.min.y),c[1]=Math.max(t.max.y,n.max.y),c[2]=e.EXTENT-n.min.x>t.max.x?n.min.x-e.EXTENT:t.max.x,c),h=(t,n)=>(c[0]=Math.min(t.min.x,n.min.x),c[1]=Math.max(t.max.x,n.max.x),c[2]=e.EXTENT-n.min.y>t.max.y?n.min.y-e.EXTENT:t.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],f=new e.pointGeometry(0,0);let p,A,m;const g=(t,n,r,o,a)=>{const l=[[o?r:t,o?t:r,0],[o?r:n,o?n:r,0]],c=a<0?e.EXTENT+a:a,u=[o?c:(t+n)/2,o?(t+n)/2:c,0];return 0===r&&a<0||0!==r&&a>0?s.getForTilePoints(m,[u],!0,A):l.push(u),s.getForTilePoints(i,l,!0,p),Math.max(l[0][2],l[1][2],u[2])/s.exaggeration()};for(let t=0;t<4;t++){const n=r.borders[t];if(0===n.length&&(r.borderDone[t]=!0),r.borderDone[t])continue;const o=m=a[t](i),c=l(o);if(!c||!c.enableTerrain)continue;if(A=s.findDEMTileFor(o),!A||!A.dem)continue;if(!p){const e=s.findDEMTileFor(i);if(!e||!e.dem)return;p=e}const u=(t<2?1:5)-t,h=c.borders[u];let y=0;for(let i=0;i<n.length;i++){const o=r.featuresOnBorder[n[i]],s=o.borders[t];let a;for(;y<h.length&&(a=c.featuresOnBorder[h[y]],!(a.borders[u][1]>s[0]+3));)c.borderDone[u]||c.encodeCentroid(void 0,a,!1),y++;if(a&&y<h.length){const n=y;let i=0;for(;!(a.borders[u][0]>s[1]-3)&&(i++,++y!==h.length);)a=c.featuresOnBorder[h[y]];if(a=c.featuresOnBorder[h[n]],o.intersectsCount()>1||a.intersectsCount()>1||1!==i){1!==i&&(y=n),r.encodeCentroid(void 0,o,!1),c.borderDone[u]||c.encodeCentroid(void 0,a,!1);continue}const l=d[t](o,a),p=t%2?e.EXTENT-1:0;f.x=g(l[0],Math.min(e.EXTENT-1,l[1]),p,t<2,l[2]),f.y=0,r.encodeCentroid(f,o,!1),c.borderDone[u]||c.encodeCentroid(f,a,!1)}else r.encodeCentroid(void 0,o,!1)}r.borderDone[t]=r.needsCentroidUpdate=!0,c.borderDone[u]||(c.borderDone[u]=c.needsCentroidUpdate=!0)}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const Jn=new e.Color(1,0,0,1),ei=new e.Color(0,1,0,1),ti=new e.Color(0,0,1,1),ni=new e.Color(1,0,1,1),ii=new e.Color(0,1,1,1);function ri(e,t,n,i){si(e,0,t+n/2,e.transform.width,n,i)}function oi(e,t,n,i){si(e,t-n/2,0,n,e.transform.height,i)}function si(t,n,i,r,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.exported.devicePixelRatio,i*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,o*e.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}function ai(t,n,i){const r=t.context,o=r.gl,s=i.projMatrix,a=t.useProgram("debug"),l=n.getTileByID(i.key);t.terrain&&t.terrain.setupElevationDraw(l,a);const c=e.DepthMode.disabled,u=e.StencilMode.disabled,h=t.colorModeForRenderPass(),d="$debug";r.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.draw(r,o.LINE_STRIP,c,u,h,e.CullFaceMode.disabled,Tn(s,e.Color.red),d,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);const f=l.latestRawTileData,p=Math.floor((f&&f.byteLength||0)/1024),A=n.getTile(i).tileSize,m=512/Math.min(A,512)*(i.overscaledZ/t.transform.zoom)*.5;let g=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(g+=` => ${i.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(t,`${g} ${p}kb`),a.draw(r,o.TRIANGLES,c,u,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,Tn(s,e.Color.transparent,m),d,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}const li=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ci}=li;function ui(e,t,n,i){e.emplaceBack(t,n,i)}class hi{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,ui(this.vertexArray,-1,-1,1),ui(this.vertexArray,1,-1,1),ui(this.vertexArray,-1,1,1),ui(this.vertexArray,1,1,1),ui(this.vertexArray,-1,-1,-1),ui(this.vertexArray,1,-1,-1),ui(this.vertexArray,-1,1,-1),ui(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ci),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function di(t,n,i,r,o,s){const a=t.gl,l=n.paint.get("sky-atmosphere-color"),c=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,n,i,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[i.r,i.g,i.b,i.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.fromMat4([],r),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,n.skyboxTexture,0),i.draw(t,a.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const fi={symbol:function(t,n,i,r,o){if("translucent"!==t.renderPass)return;const s=e.StencilMode.disabled,a=t.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(t,n,i,r,o,s,a){const l=n.transform,c="map"===o,u="map"===s;for(const o of t){const t=r.getTile(o),s=t.getBucket(i);if(!s||!s.text||!s.text.segments.get().length)continue;const h=e.evaluateSizeForZoom(s.textSizeData,l.zoom),d=P(t,1,n.transform.zoom),f=Qe(o.projMatrix,u,c,n.transform,d),p="none"!==i.layout.get("icon-text-fit")&&s.hasIconData();if(h){const n=Math.pow(2,l.zoom-t.tileID.overscaledZ),i=l.elevation;qn(s,c,u,a,e.symbolSize,l,f,o.projMatrix,n,h,p,i?e=>i.getAtTileOffset(o,e.x,e.y):e=>0)}}}(r,t,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),o),0!==i.paint.get("icon-opacity").constantOr(1)&&Hn(t,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),s,a),0!==i.paint.get("text-opacity").constantOr(1)&&Hn(t,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),s,a),n.map.showCollisionBoxes&&(Gn(t,n,i,r,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),Gn(t,n,i,r,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(t,n,i,r){if("translucent"!==t.renderPass)return;const o=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),l=void 0!==i.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=t.context,u=c.gl,h=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),d=e.StencilMode.disabled,f=t.colorModeForRenderPass(),p=[];for(let o=0;o<r.length;o++){const s=r[o],a=n.getTile(s),c=a.getBucket(i);if(!c)continue;const u=c.programConfigurations.get(i.id),h=En(i),d={programConfiguration:u,program:t.useProgram("circle",u,h),layoutVertexBuffer:c.layoutVertexBuffer,indexBuffer:c.indexBuffer,uniformValues:wn(t,s,a,i),tile:a};if(l){const t=c.segments.get();for(const n of t)p.push({segments:new e.SegmentVector([n]),sortKey:n.sortKey,state:d})}else p.push({segments:c.segments,sortKey:0,state:d})}l&&p.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of p){const{programConfiguration:r,program:o,layoutVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:p}=n.state,A=n.segments;t.terrain&&t.terrain.setupElevationDraw(p,o,{useDepthForOcclusion:!0}),t.prepareDrawProgram(c,o,p.tileID.toUnwrapped()),o.draw(c,u.TRIANGLES,h,d,f,e.CullFaceMode.disabled,l,i.id,s,a,A,i.paint,t.transform.zoom,r)}},heatmap:function(t,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=e.StencilMode.disabled,l=new e.ColorMode([s.ONE,s.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,n){const i=e.gl;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);let r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),e.bindFramebuffer.set(r.framebuffer);else{const o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,n,i){const r=e.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width/4,t.height/4,0,r.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),i.colorAttachment.set(n)}(e,t,o,r)}}(o,t,i),o.clear({color:e.Color.transparent});for(let c=0;c<r.length;c++){const u=r[c];if(n.hasRenderableParent(u))continue;const h=n.getTile(u),d=h.getBucket(i);if(!d)continue;const f=d.programConfigurations.get(i.id),p=t.useProgram("heatmap",f),{zoom:A}=t.transform;t.terrain&&t.terrain.setupElevationDraw(h,p),t.prepareDrawProgram(o,p,u.toUnwrapped()),p.draw(o,s.TRIANGLES,e.DepthMode.disabled,a,l,e.CullFaceMode.disabled,kn(u.projMatrix,h,A,i.paint.get("heatmap-intensity")),i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,i.paint,t.transform.zoom,f)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){const i=t.context,r=i.gl,o=n.heatmapFbo;if(!o)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let s=n.colorRampTexture;s||(s=n.colorRampTexture=new e.Texture(i,n.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(i,r.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((e,t,n,i)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}(t,i))},line:function(t,n,i,r){if("translucent"!==t.renderPass)return;const o=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),c=i.paint.get("line-dasharray"),u=c.constantOr(1),h=i.layout.get("line-cap"),d=i.paint.get("line-pattern"),f=d.constantOr(1),p=i.paint.get("line-gradient"),A=i.getCrossfadeParameters(),m=f?"linePattern":"line",g=t.context,y=g.gl;for(const o of r){const r=n.getTile(o);if(f&&!r.patternsLoaded())continue;const s=r.getBucket(i);if(!s)continue;t.prepareDrawTile(o);const _=s.programConfigurations.get(i.id),v=Ln(i),b=t.useProgram(m,_,v),x=d.constantOr(null);if(x&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[x.to.toString()],n=e.patternPositions[x.from.toString()];t&&n&&_.setConstantPatternPositions(t,n)}const w=c.constantOr(null),E=h.constantOr(null);if(!f&&w&&E&&r.lineAtlas){const e=r.lineAtlas,t=e.getDash(w.to,E),n=e.getDash(w.from,E);t&&n&&_.setConstantPatternPositions(t,n)}const S=t.terrain?o.projMatrix:null,T=f?Pn(t,r,i,A,S):Cn(t,r,i,A,S,s.lineClipsArray.length);if(p){const r=s.gradients[i.id];let a=r.texture;if(i.gradientVersion!==r.version){let l=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=o.canonical.z===i?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.clamp(e.nextPowerOfTwo(s.maxLineLength/e.EXTENT*1024*r),256,g.maxTextureSize)}r.gradient=e.renderColorRamp({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.Texture(g,r.gradient,y.RGBA),r.version=i.gradientVersion,a=r.texture}g.activeTexture.set(y.TEXTURE1),a.bind(i.stepInterpolant?y.NEAREST:y.LINEAR,y.CLAMP_TO_EDGE)}u&&(g.activeTexture.set(y.TEXTURE0),r.lineAtlasTexture.bind(y.LINEAR,y.REPEAT),_.updatePaintBuffers(A)),f&&(g.activeTexture.set(y.TEXTURE0),r.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),_.updatePaintBuffers(A)),t.prepareDrawProgram(g,b,o.toUnwrapped()),b.draw(g,y.TRIANGLES,a,t.stencilModeForClipping(o),l,e.CullFaceMode.disabled,T,i.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,i.paint,t.transform.zoom,_,s.layoutVertexBuffer2)}},fill:function(t,n,i,r){const o=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=t.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const o=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);Xn(t,n,i,r,o,a,!1)}if("translucent"===t.renderPass&&i.paint.get("fill-antialias")){const o=t.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);Xn(t,n,i,r,o,a,!0)}},"fill-extrusion":function(t,n,i,r){const o=i.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===t.renderPass){const s=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==o||i.paint.get("fill-extrusion-pattern").constantOr(1))Yn(t,n,i,r,s,e.StencilMode.disabled,e.ColorMode.disabled),Yn(t,n,i,r,s,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const o=t.colorModeForRenderPass();Yn(t,n,i,r,s,e.StencilMode.disabled,o)}}},hillshade:function(t,n,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const o=t.context,s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),a=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[c,u]="translucent"!==t.renderPass||l?[{},r]:t.stencilConfigForOverlap(r);for(const r of u){const o=n.getTile(r);if(o.needsHillshadePrepare&&"offscreen"===t.renderPass)nn(t,o,i,s,e.StencilMode.disabled,a);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(r):c[r.overscaledZ];en(t,r,o,i,s,e,a)}}o.viewport.set([0,0,t.width,t.height])},raster:function(t,n,i,r,o,s){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!r.length)return;const a=t.context,l=a.gl,c=n.getSource(),u=t.useProgram("raster"),h=t.colorModeForRenderPass(),d=t.terrain&&t.terrain.renderingToTexture,[f,p]=c instanceof Ee||d?[{},r]:t.stencilConfigForOverlap(r),A=p[p.length-1].overscaledZ,m=!t.options.moving;for(const r of p){const o=d?e.DepthMode.disabled:t.depthModeForSublayer(r.overscaledZ-A,1===i.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),p=r.toUnwrapped(),g=n.getTile(r);if(d&&(!g||!g.hasData()))continue;const y=d?r.projMatrix:t.transform.calculateProjMatrix(p,m),_=t.terrain&&d?t.terrain.stencilModeForRTTOverlap(r):f[r.overscaledZ],v=s?0:i.paint.get("raster-fade-duration");g.registerFadeDuration(v);const b=n.findLoadedParent(r,0),x=un(g,b,n,t.transform,v);let w,E;t.terrain&&t.terrain.prepareDrawTile(r);const S="nearest"===i.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),g.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),a.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,b.tileID.overscaledZ-g.tileID.overscaledZ),E=[g.tileID.canonical.x*w%1,g.tileID.canonical.y*w%1]):g.texture.bind(S,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST);const T=zn(y,E||[0,0],w||1,x,i);t.prepareDrawProgram(a,u,p),c instanceof Ee?u.draw(a,l.TRIANGLES,o,e.StencilMode.disabled,h,e.CullFaceMode.disabled,T,i.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments):u.draw(a,l.TRIANGLES,o,_,h,e.CullFaceMode.disabled,T,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,n,i,r){const o=i.paint.get("background-color"),s=i.paint.get("background-opacity");if(0===s)return;const a=t.context,l=a.gl,c=t.transform,u=c.tileSize,h=i.paint.get("background-pattern");if(t.isPatternMissing(h))return;const d=!h&&1===o.a&&1===s&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const f=e.StencilMode.disabled,p=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),A=t.colorModeForRenderPass(),m=t.useProgram(h?"backgroundPattern":"background"),g=r||c.coveringTiles({tileSize:u});h&&(a.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));const y=i.getCrossfadeParameters();for(const n of g){const c=n.toUnwrapped(),d=r?n.projMatrix:t.transform.calculateProjMatrix(c);t.prepareDrawTile(n);const g=h?Un(d,s,t,h,{tileID:n,tileSize:u},y):Nn(d,s,o);t.prepareDrawProgram(a,m,c),m.draw(a,l.TRIANGLES,p,f,A,e.CullFaceMode.disabled,g,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}},sky:function(t,n,i){const r=i.paint.get("sky-opacity");if(0===r)return;const o=t.context,s=i.paint.get("sky-type"),a=new e.DepthMode(o.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),l=t.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===t.renderPass?i.needsSkyboxCapture(t)&&(function(t,n,i,r){const o=t.context,s=o.gl;let a=n.skyboxFbo;if(!a){a=n.skyboxFbo=o.createFramebuffer(32,32,!1),n.skyboxGeometry=new hi(o),n.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let e=0;e<6;++e)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=n.getCenter(t,!0),c=t.useProgram("skyboxCapture"),u=new Float64Array(16);e.identity(u),e.rotateY(u,u,.5*-Math.PI),di(o,n,c,u,l,0),e.identity(u),e.rotateY(u,u,.5*Math.PI),di(o,n,c,u,l,1),e.identity(u),e.rotateX(u,u,.5*-Math.PI),di(o,n,c,u,l,2),e.identity(u),e.rotateX(u,u,.5*Math.PI),di(o,n,c,u,l,3),e.identity(u),di(o,n,c,u,l,4),e.identity(u),e.rotateY(u,u,Math.PI),di(o,n,c,u,l,5),o.viewport.set([0,0,t.width,t.height])}(t,i),i.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,n,i,r,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,n.skyboxTexture);const u=((e,t,n,i,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:i,u_temporal_offset:r}))(l.skyboxMatrix,n.getCenter(t,!1),0,r,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,i,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,a,r,l):"gradient"===s&&"sky"===t.renderPass&&function(t,n,i,r,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new hi(s)),s.activeTexture.set(a.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new e.Texture(s,n.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,n,i,r,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.degToRad(i),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),r,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,i,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,i,a,r,l)},debug:function(e,t,n){for(let i=0;i<n.length;i++)ai(e,t,n[i])},custom:function(t,n,i){const r=t.context,o=i.implementation;if("offscreen"===t.renderPass){const e=o.prerender;e&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),e.call(o,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(e.StencilMode.disabled);const n="3d"===o.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);r.setDepthMode(n),o.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}};class pi{constructor(t,n){this.context=new ve(t),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bt,this.gpuTimers={},this.frameCounter=0}updateTerrain(e,t){const n=!!e&&!!e.terrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fn(this,e));const i=this._terrain;this.transform.elevation=n?i:null,i.update(e,this.transform,t)}_updateFog(e){const t=e.fog;if(!t||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,i]=t.getFovAdjustedRange(this.transform._fov);if(n>i)return void(this.transform.fogCullDistSq=null);const r=n+.78*(i-n);this.transform.fogCullDistSq=r*r}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,n){if(this.width=t*e.exported.devicePixelRatio,this.height=n*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._layers[e].resize()}setup(){const t=this.context,n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const r=new e.StructArrayLayout4i8;r.emplaceBack(0,0,0,0),r.emplaceBack(e.EXTENT,0,e.EXTENT,0),r.emplaceBack(0,e.EXTENT,0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(r,we.members),this.rasterBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout2i4;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(-1,1),o.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(o,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const s=new e.StructArrayLayout1ui2;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(s);const a=new e.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=e.create$1();const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now())}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(t,n.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,cn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n,i){if(!(n&&this.currentStencilSource!==n.id&&t.isTileClipped()&&i&&i.length))return;this.currentStencilSource=n.id;const r=this.context,o=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of i){const n=this._tileClippingMaskIDs[t.key]=this.nextStencilID++;s.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},n,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,cn(t.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new e.StencilMode({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new e.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,i=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,o=i[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let i=0;i<o;i++)t[i+r]=new e.StencilMode({func:n.GEQUAL,mask:255},i+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[t,i]}return[{[r]:e.StencilMode.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,n,i){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(i||this.context.gl.LEQUAL,n,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();const i=this.style.order,r=this.style._sourceCaches;for(const e in r){const t=r[e];t.used&&t.prepare(this.context)}const o={},s={},a={};for(const e in r){const t=r[e];o[e]=t.getVisibleCoordinates(),s[e]=o[e].slice().reverse(),a[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<i.length;e++)if(this.style._layers[i[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),!e.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const e of i){const n=this.style._layers[e],i=t._getLayerSourceCache(n);if(!n.hasOffscreenPass()||n.isHidden(this.transform.zoom))continue;const r=i?s[i.id]:void 0;("custom"===n.type||n.isSky()||r&&r.length)&&this.renderLayer(this,i,n,r)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let l=e.Color.transparent;if(this.style.fog&&(l=this.style.fog.properties.get("color")),this.context.clear({color:n.showOverdrawInspector?e.Color.black:l,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[i[this.currentLayer]],n=t._getLayerSourceCache(e);if(e.isSky())continue;const r=n?s[n.id]:void 0;this._renderTileClippingMasks(e,n,r),this.renderLayer(this,n,e,r)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const e=this.style._layers[i[this.currentLayer]],n=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,n,e,n?s[n.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;){const e=this.style._layers[i[this.currentLayer]],n=t._getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=n?("symbol"===e.type?a:s)[n.id]:void 0;this._renderTileClippingMasks(e,n,n?o[n.id]:void 0),this.renderLayer(this,n,e,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let n=null;e.values(this.style._layers).forEach((e=>{const i=t._getLayerSourceCache(e);i&&!e.isHidden(this.transform.zoom)&&(!n||n.getSource().maxzoom<i.getSource().maxzoom)&&(n=i)})),n&&this.options.showTileBoundaries&&fi.debug(this,n,n.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;ri(e,e.transform.height-(t.top||0),3,Jn),ri(e,t.bottom||0,3,ei),oi(e,t.left||0,3,ti),oi(e,e.transform.width-(t.right||0),3,ni);const n=e.transform.centerPoint;!function(e,t,n,i){si(e,t-1,n-10,2,20,i),si(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,ii)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%e.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}renderLayer(e,t,n,i){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||i&&i.length)&&(this.id=n.id,this.gpuTimingStart(n),fi[n.type](e,t,n,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),n.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,n.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){const t={};for(const n in e){const i=e[n],r=this.context.extTimerQuery,o=r.getQueryObjectEXT(i.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i.query),t[n]=o}return t}translatePosMatrix(t,n,i,r,o){if(!i[0]&&!i[1])return t;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}const a=[o?i[0]:P(n,i[0],this.transform.zoom),o?i[1]:P(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,a),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.style&&this.style.fog,n=[];return this.terrain&&!this.terrain.renderingToTexture&&n.push("TERRAIN"),t&&!e&&0!==t.getOpacity(this.transform.pitch)&&n.push("FOG"),e&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(e,t,n){this.cache=this.cache||{};const i=n||[],r=this.currentGlobalDefines().concat(i),o=An.cacheKey(e,r,t);return this.cache[o]||(this.cache[o]=new An(this.context,e,Xt[e],t,jn[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(e){this.terrain&&this.terrain.prepareDrawTile(e)}prepareDrawProgram(e,t,n){if(this.terrain&&this.terrain.renderingToTexture)return;const i=this.style.fog;if(i){const r=i.getOpacity(this.transform.pitch);0!==r&&t.setFogUniformValues(e,((e,t,n,i)=>{const r=t.properties.get("color"),o=e.frameCounter/1e3%1,s=[r.r/r.a,r.g/r.a,r.b/r.a,i];return{u_fog_matrix:n?e.transform.calculateFogTileMatrix(n):e.identityMat,u_fog_range:t.getFovAdjustedRange(e.transform._fov),u_fog_color:s,u_fog_horizon_blend:t.properties.get("horizon-blend"),u_fog_temporal_offset:o}})(this,i,n,r))}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}}class Ai{constructor(e=0,t=0,n=0,i=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(t,n,i){return null!=n.top&&null!=t.top&&(this.top=e.number(t.top,n.top,i)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,n.bottom,i)),null!=n.left&&null!=t.left&&(this.left=e.number(t.left,n.left,i)),null!=n.right&&null!=t.right&&(this.right=e.number(t.right,n.right,i)),this}getCenter(t,n){const i=e.clamp((this.left+t-this.right)/2,0,t),r=e.clamp((this.top+n-this.bottom)/2,0,n);return new e.pointGeometry(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ai(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mi(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function gi(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function yi(t,n){const i=mi(t,3);e.fromQuat(t,n),gi(t,3,i)}function _i(e,t){gi(e,3,[t[0],t[1],t[2],1])}function vi(t,n){const i=e.identity$1([]);return e.rotateZ$1(i,i,-n),e.rotateX$1(i,i,-t),i}function bi(t,n){const i=[t[0],t[1],0],r=[n[0],n[1],0];if(e.length(i)>=1e-15){const t=e.normalize([],i);e.scale(r,t,e.dot(r,t)),n[0]=r[0],n[1]=r[1]}const o=e.cross([],n,t);if(e.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return vi(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}class xi{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(t){if(!t)return;const n=Array.isArray(t)?new e.MercatorCoordinate(t[0],t[1],t[2]):t;return n.x=e.wrap(n.x,0,1),n}(t):t}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const i=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,r=this.position,o=e.MercatorCoordinate.fromLngLat(t,i),s=[o.x-r.x,o.y-r.y,o.z-r.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=bi(s,n)}setPitchBearing(t,n){this.orientation=vi(e.degToRad(t),e.degToRad(-n))}}class wi{constructor(t,n){this._transform=e.identity([]),this._orientation=e.identity$1([]),n&&(this._orientation=n,yi(this._transform,this._orientation)),t&&_i(this._transform,t)}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const e=mi(this._transform,3);return[e[0],e[1],e[2]]}set position(e){_i(this._transform,e)}get orientation(){return this._orientation}set orientation(e){this._orientation=e,yi(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=vi(e,t),yi(this._transform,this._orientation)}forward(){const e=mi(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=mi(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=mi(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(t,n){const i=new Float64Array(16);return e.invert(i,this.getWorldToCamera(t,n)),i}getWorldToCameraPosition(t,n,i){const r=this.position;e.scale(r,r,-t);const o=new Float64Array(16);return e.fromScaling(o,[i,i,i]),e.translate(o,o,r),o[10]*=n,o}getWorldToCamera(t,n){const i=new Float64Array(16),r=new Float64Array(4),o=this.position;return e.conjugate(r,this._orientation),e.scale(o,o,-t),e.fromQuat(i,r),e.translate(i,i,o),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(t,n,i,r){const o=new Float64Array(16);return e.perspective(o,t,n,i,r),o}getDistanceToElevation(t){const n=0===t?0:e.mercatorZfromAltitude(t,this.position[1]),i=this.forward();return(n-this.position[2])/i[2]}clone(){return new wi([...this.position],[...this.orientation])}}class Ei{constructor(t,n,i,r,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ai,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new wi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const e=new Ei(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._cameraZoom=this._cameraZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,e?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(e){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),e&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return e.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-e.wrap(t,-180,180)*Math.PI/180;var i;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(i=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i),function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=i*-a+o*l,e[3]=r*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,n=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(n+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop();let r=0,o=0;for(let s=0;s<n.length;s++){const a=new e.pointGeometry(n[s][0]*this.width,i+n[s][1]*(this.height-i)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const t=this._cameraZoom,n=this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(this.center)),i=e.mercatorZfromAltitude(n,this.center.lat),r=this._mercatorZfromZoom(t),o=this._mercatorZfromZoom(this._maxZoom),s=Math.max(r-i,o);this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let i;i=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const r=e.length(e.sub([],this._camera.position,i));return e.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const i=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new xi;return n.position=new e.MercatorCoordinate(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this._renderWorldCopies,n}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const n=e.transformQuat([],[0,0,-1],t),i=e.transformQuat([],[0,-1,0],t);if(i[2]<0)return!1;const r=bi(n,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.clamp(t[2],r/i,r/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const n=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const i=this.pointCoordinate(new e.pointGeometry(0,0)),r=this.pointCoordinate(new e.pointGeometry(this.width,0)),o=this.pointCoordinate(new e.pointGeometry(this.width,this.height)),s=this.pointCoordinate(new e.pointGeometry(0,this.height)),a=Math.floor(Math.min(i.x,r.x,o.x,s.x)),l=Math.floor(Math.max(i.x,r.x,o.x,s.x)),c=1;for(let i=a-c;i<=l+c;i++)0!==i&&n.push(new e.UnwrappedTileID(i,t))}return n}coveringTiles(t){let n=this.coveringZoomLevel(t);const i=n,r=this.elevation&&!t.isTerrainDEM;if(void 0!==t.minzoom&&n<t.minzoom)return[];void 0!==t.maxzoom&&n>t.maxzoom&&(n=t.maxzoom);const o=e.MercatorCoordinate.fromLngLat(this.center),s=1<<n,a=[s*o.x,s*o.y,0],l=f.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),c=this.pointCoordinate(this.getCameraPoint()),u=s*e.mercatorZfromAltitude(1,this.center.lat),h=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),d=[s*c.x,s*c.y,h],A=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),m=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?n:0,g=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,y=t.isTerrainDEM?-g:this._elevation?this._elevation.getMinElevationBelowMSL():0,_=e=>({aabb:new p([e*s,0,y],[(e+1)*s,s,g]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),v=[];let b=[];const x=n,w=t.reparseOverscaled?i:n,E=e=>{if(!this._elevation||!e.tileID)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=k(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},S=e=>e*e,T=S((h-this._centerAltitude)*u),k=e=>{if(e.zoom<m)return!0;if(e.zoom===x)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(d),n=e.aabb.distanceY(d);let i=T;r&&(i=S(e.aabb.distanceZ(d)*u));const o=t*t+n*n+i;return o<S((1<<x-e.zoom)*A*((e,t)=>{if(t*S(.707)<e)return 1;const n=Math.sqrt(t/e);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(i,T),o))};if(this._renderWorldCopies)for(let e=1;e<=3;e++)v.push(_(-e)),v.push(_(e));for(v.push(_(0));v.length>0;){const i=v.pop(),o=i.x,s=i.y;let c=i.fullyVisible;if(!c){const e=i.aabb.intersects(l);if(0===e)continue;c=2===e}if(i.zoom!==x&&k(i))for(let t=0;t<4;t++){const n=(o<<1)+t%2,a=(s<<1)+(t>>1),l={aabb:i.aabb.quadrant(t),zoom:i.zoom+1,x:n,y:a,wrap:i.wrap,fullyVisible:c,tileID:void 0,shouldSplit:void 0};r&&(l.tileID=new e.OverscaledTileID(i.zoom+1===x?w:i.zoom+1,i.wrap,i.zoom+1,n,a),E(l)),v.push(l)}else{const r=i.zoom===x?w:i.zoom;if(t.minzoom&&t.minzoom>r)continue;const l=a[0]-(.5+o+(i.wrap<<i.zoom))*(1<<n-i.zoom),c=a[1]-.5-s,u=i.tileID?i.tileID:new e.OverscaledTileID(r,i.wrap,i.zoom,o,s);b.push({tileID:u,distanceSq:l*l+c*c})}}if(this.fogCullDistSq){const n=this.fogCullDistSq,i=this.horizonLineFromTop();b=b.filter((r=>{const o=[0,0,0,1],s=[e.EXTENT,e.EXTENT,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.transformMat4(o,o,a),e.transformMat4(s,s,a);const l=e.getAABBPointSquareDist(o,s);if(0===l)return!0;let c=!1;const u=this._elevation;if(u&&l>n&&0!==i){const n=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=u.getMinMaxForTile(r.tileID)),o||(o={min:y,max:g});const s=e.furthestTileCorner(this.bearing),a=[s[0]*e.EXTENT,s[1]*e.EXTENT,o.max];e.transformMat4$1(a,a,n),c=(1-a[1])*this.height*.5<i}return l<n||c}))}return b.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const n=e.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.pointGeometry(e.mercatorXfromLng(t.lng)*this.worldSize,e.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new e.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,n){const i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(t),s=new e.MercatorCoordinate(o.x-(i.x-r.x),o.y-(i.y-r.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(e){this.center=this.coordinateLocation(e),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e){return this._coordinatePoint(this.locationCoordinate(e),!1)}locationPoint3D(e){return this._coordinatePoint(this.locationCoordinate(e),!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t){return e.MercatorCoordinate.fromLngLat(t)}coordinateLocation(e){return e.toLngLat()}pointRayIntersection(t,n){const i=null!=n?n:this._centerAltitude,r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4(r,r,this.pixelMatrixInverse),e.transformMat4(o,o,this.pixelMatrixInverse);const s=o[3];e.scale$2(r,r,1/r[3]),e.scale$2(o,o,1/s);const a=r[2],l=o[2];return{p0:r,p1:o,t:a===l?0:(i-a)/(l-a)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];return e.transformMat4(n,n,this.pixelMatrixInverse),e.transformMat4(i,i,this.pixelMatrixInverse),e.scale$2(n,n,1/n[3]),e.scale$2(i,i,1/i[3]),n[2]=e.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,e.scale$2(n,n,1/this.worldSize),e.scale$2(i,i,1/this.worldSize),new d([n[0],n[1],n[2]],e.normalize([],e.sub([],i,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:i,t:r}=t,o=e.mercatorZfromAltitude(n[2],this._center.lat),s=e.mercatorZfromAltitude(i[2],this._center.lat);return new e.MercatorCoordinate(e.number(n[0],i[0],r)/this.worldSize,e.number(n[1],i[1],r)/this.worldSize,e.number(o,s,r))}pointCoordinate(t,n=this._centerAltitude){const i=this.horizonLineFromTop(!1),r=new e.pointGeometry(t.x,Math.max(i,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(r,n))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const n=this.elevation;let i=this.elevation.pointCoordinate(t);if(i)return new e.MercatorCoordinate(i[0],i[1],i[2]);let r=0,o=this.horizonLineFromTop();if(t.y>o)return this.pointCoordinate(t);const s=.02*o,a=t.clone();for(let t=0;t<10&&o-r>s;t++){a.y=e.number(r,o,.66);const t=n.pointCoordinate(a);t?(o=a.y,i=t):r=a.y}return i?new e.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){if(this.elevation)return!this.elevation.pointCoordinate(e);{const t=this.horizonLineFromTop();return e.y<t}}_coordinatePoint(t,n){const i=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,i+t.toAltitude(),1];return e.transformMat4(r,r,this.pixelMatrix),r[3]>0?new e.pointGeometry(r[0]/r[3],r[1]/r[3]):new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,n){const i=new e.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),r=new e.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),o=new e.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),s=new e.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let a=this.pointCoordinate(i,t),l=this.pointCoordinate(r,t);const c=this.pointCoordinate(o,n),u=this.pointCoordinate(s,n),h=(e,t)=>(t.y-e.y)/(t.x-e.x);return a.y>1&&l.y>=0?a=new e.MercatorCoordinate((1-u.y)/h(u,a)+u.x,1):a.y<0&&l.y<=1&&(a=new e.MercatorCoordinate(-u.y/h(u,a)+u.x,0)),l.y>1&&a.y>=0?l=new e.MercatorCoordinate((1-c.y)/h(c,l)+c.x,1):l.y<0&&a.y<=1&&(l=new e.MercatorCoordinate(-c.y/h(c,l)+c.x,0)),(new e.LngLatBounds).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(c))}_getBounds3D(){const e=this.elevation,t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBounds(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new e.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(e){if(e){const t=e.getEast(),n=e.getWest();this.lngRange=[n,t>n?t:t+360],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(t,n){const i=t.canonical,r=n/this.zoomScale(i.z),o=i.x+Math.pow(2,i.z)*t.wrap,s=e.identity(new Float64Array(16));return e.translate(s,s,[o*r,i.y*r,0]),e.scale$1(s,s,[r/e.EXTENT,r/e.EXTENT,1]),s}calculateFogTileMatrix(t){const n=t.key,i=this._fogTileMatrixCache;if(i[n])return i[n];const r=this.calculatePosMatrix(t,this.cameraWorldSize);return e.multiply(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}calculateProjMatrix(t,n=!1){const i=t.key,r=n?this._alignedProjMatrixCache:this._projMatrixCache;if(r[i])return r[i];const o=this.calculatePosMatrix(t,this.worldSize);return e.multiply(o,n?this.alignedProjMatrix:this.projMatrix,o),r[i]=new Float32Array(o),r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const n=this._camera.position,i=this._camera.forward();if(n[2]<=0||i[2]>=0)return;const r=e.mercatorZfromAltitude(1,this._center.lat);n[2]/=r,i[2]/=r,e.normalize(i,i);const o=t.raycast(n,i,t.exaggeration());if(o){const t=e.scaleAndAdd([],n,i,o),r=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),s=this._camera.position,a=r.z+e.length([r.x-s[0],r.y-s[1],r.z-s[2]]);this._cameraZoom=this._zoomFromMercatorZ(a),this._centerAltitude=r.toAltitude(),this._center=r.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const n=t.getAtPointOrZero(this._camera.mercatorPosition),i=this._minimumHeightOverTerrain()*Math.cos(e.degToRad(this._maxPitch)),r=e.mercatorZfromAltitude(n,this._center.lat),o=this._camera.position[2]-r;if(o<i){const t=e.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),n=this._camera.mercatorPosition,r=[t.x-n.x,t.y-n.y,t.z-n.z],s=e.length(r);r[2]-=i-o;const a=e.length(r);if(0===a)return;e.scale(r,r,s/a),this._camera.position=[t.x-r[0],t.y-r[1],t.z-r[2]],this._camera.orientation=bi(r,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,i,r,o,s=1/0,a=-1/0;const l=this.size,c=this._unmodified;if(this.latRange){const t=this.latRange;s=e.mercatorYfromLat(t[1])*this.worldSize,a=e.mercatorYfromLat(t[0])*this.worldSize,i=a-s<l.y?l.y/(a-s):0}if(this.lngRange){const i=this.lngRange;t=e.mercatorXfromLng(i[0])*this.worldSize,n=e.mercatorXfromLng(i[1])*this.worldSize,r=n-t<l.x?l.x/(n-t):0}const u=this.point,h=Math.max(r||0,i||0);if(h)return this.center=this.unproject(new e.pointGeometry(r?(n+t)/2:u.x,i?(a+s)/2:u.y)),this.zoom+=this.scaleZoom(h),this._unmodified=c,void(this._constraining=!1);if(this.latRange){const e=u.y,t=l.y/2;e-t<s&&(o=s+t),e+t>a&&(o=a-t)}let d=u.x;if(this.lngRange){const e=this.worldSize/2-(t+n)/2;d=(d+e+this.worldSize)%this.worldSize,t+=e,n+=e;const i=l.x/2;d-i<t&&(d=t+i),d+i>n&&(d=n-i),d-=e}d===u.x&&void 0===o||(this.center=this.unproject(new e.pointGeometry(d,void 0!==o?o:u.y))),this._constrainCameraAltitude(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){const t=(e,t)=>Math.log2(e/(this.tileSize*Math.abs(t[1]-t[0])));let n=0;if(this.latRange){const i=this.latRange;n=t(this.height,[e.mercatorYfromLat(i[0]),e.mercatorYfromLat(i[1])])}let i=0;if(this.lngRange){const n=this.lngRange;i=t(this.width,[e.mercatorXfromLng(n[0]),e.mercatorXfromLng(n[1])])}return Math.max(n,i)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const n=this.pixelsPerMeter;this._updateCameraState();const i=Math.PI/2+this._pitch,r=this.fovAboveCenter,o=this.elevation?this.elevation.getMinElevationBelowMSL()*n:0,s=(this._camera.position[2]*this.worldSize-o)/Math.cos(this._pitch),a=Math.sin(r)*s/Math.sin(e.clamp(Math.PI-i-r,.01,Math.PI-.01)),l=this.point,c=l.x,u=l.y,h=Math.cos(Math.PI/2-this._pitch)*a+s,d=Math.min(1.01*h,s*(1/this._horizonShift)),f=this.height/50,p=this._camera.getWorldToCamera(this.worldSize,n),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,f,d);A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height;let m=e.mul$1([],A,p);this.mercatorMatrix=e.scale$1([],m,[this.worldSize,this.worldSize,this.worldSize/n]),this.projMatrix=m,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const g=new Float32Array(16);e.identity(g),e.scale$1(g,g,[1,-1,1]),e.rotateX(g,g,this._pitch),e.rotateZ(g,g,this.angle);const y=e.perspective(new Float32Array(16),this._fov,this.width/this.height,f,d),_=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;y[8]=2*-t.x/this.width,y[9]=2*(t.y+_)/this.height,this.skyboxMatrix=e.multiply(g,y,g);const v=this.width%2/2,b=this.height%2/2,x=Math.cos(this.angle),w=Math.sin(this.angle),E=c-Math.round(c)+x*v+w*b,S=u-Math.round(u)+x*b+w*v,T=new Float64Array(m);if(e.translate(T,T,[E>.5?E-1:E,S>.5?S-1:S,0]),this.alignedProjMatrix=T,m=e.create$1(),e.scale$1(m,m,[this.width/2,-this.height/2,1]),e.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=e.create$1(),e.scale$1(m,m,[1,-1,1]),e.translate(m,m,[-1,-1,0]),e.scale$1(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),m=e.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height,o=[t,t,n];e.scale(o,o,r),e.scale(i,i,-1),e.multiply$1(i,i,o);const s=e.create$1();e.translate(s,s,i),e.scale$1(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,r)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),n=this.cameraToCenterDistance,i=this.point,r=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),o=this.cameraToCenterDistance/r;this._camera.position=[i.x/this.worldSize-t[0]*n/o,i.y/this.worldSize-t[1]*n/o,e.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*n/o]}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=t[2];let r=1;i>0&&(r=Math.min((n-this._camera.position[2])/i,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,r),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(i),s),l=this._zoomFromMercatorZ(a);e.scaleAndAdd(t,t,n,a),this._pitch=e.clamp(i,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(r,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new e.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(t,n){const i=Math.min(t.x,n.x),r=Math.max(t.x,n.x),o=Math.min(t.y,n.y),s=Math.max(t.y,n.y);if(o<this.horizonLineFromTop(!1))return!0;const a=[new e.pointGeometry(i,o),new e.pointGeometry(r,s),new e.pointGeometry(i,s),new e.pointGeometry(r,o)],l=this._renderWorldCopies?-3:0,c=this._renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const n=this.rayIntersectionCoordinate(t);if(n.x<l||n.y<0||n.x>c||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new e.pointGeometry(0,0),new e.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,n){const i=e.length(e.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.pointGeometry(0,t))}}function Si(e,t){let n=!1,i=null;const r=()=>{i=null,n&&(e(),i=setTimeout(r,t),n=!1)};return()=>(n=!0,i||r(),i)}class Ti{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Si(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,l=this._map.getBearing(),c=this._map.getPitch();let u="";if(u+=t?`/${s}/${a}/${i}`:`${i}/${a}/${s}`,(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),this._hashName){const t=this._hashName;let n=!1;const i=e.window.location.hash.slice(1).split("&").map((e=>{const i=e.split("=")[0];return i===t?(n=!0,`${i}=${u}`):e})).filter((e=>e));return n||i.push(`${t}=${u}`),`#${i.join("&")}`}return`#${u}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._getCurrentHash();if(e.length>=3&&!e.some((e=>isNaN(e)))){const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}const ki={linearity:.3,easing:e.bezier(0,0,.3,1)},Ci=e.extend({deceleration:2500,maxSpeed:1400},ki),Pi=e.extend({deceleration:20,maxSpeed:1400},ki),Mi=e.extend({deceleration:1e3,maxSpeed:360},ki),Ii=e.extend({deceleration:1e3,maxSpeed:90},ki);class Li{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=e.exported.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new e.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const o=zi(n.pan.mag(),i,e.extend({},Ci,t||{}));r.offset=n.pan.mult(o.amount/n.pan.mag()),r.center=this._map.transform.center,Ri(r,o)}if(n.zoom){const e=zi(n.zoom,i,Pi);r.zoom=this._map.transform.zoom+e.amount,Ri(r,e)}if(n.bearing){const t=zi(n.bearing,i,Mi);r.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),Ri(r,t)}if(n.pitch){const e=zi(n.pitch,i,Ii);r.pitch=this._map.transform.pitch+e.amount,Ri(r,e)}if(r.zoom||r.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),e.extend(r,{noMoveStart:!0})}}function Ri(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function zi(t,n,i){const{maxSpeed:r,linearity:o,deceleration:s}=i,a=e.clamp(t*o/(n/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:i.easing,duration:1e3*l,amount:a*(l/2)}}class Di extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i,r={}){const s=o.mousePos(n.getCanvasContainer(),i),a=n.unproject(s);super(t,e.extend({point:s,lngLat:a,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Oi extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,i){const r="touchend"===t?i.changedTouches:i.touches,s=o.touchPos(n.getCanvasContainer(),r),a=s.map((e=>n.unproject(e))),l=s.reduce(((e,t,n,i)=>e.add(t.div(i.length))),new e.pointGeometry(0,0));super(t,{points:s,point:l,lngLats:a,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class Bi extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class Fi{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Bi(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Di(e.type,this._map,e))}mouseup(e){this._map.fire(new Di(e.type,this._map,e))}preclick(t){const n=e.extend({},t);n.type="preclick",this._map.fire(new Di(n.type,this._map,n))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Di(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Di(e.type,this._map,e))}mouseover(e){this._map.fire(new Di(e.type,this._map,e))}mouseout(e){this._map.fire(new Di(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Oi(e.type,this._map,e))}touchmove(e){this._map.fire(new Oi(e.type,this._map,e))}touchend(e){this._map.fire(new Oi(e.type,this._map,e))}touchcancel(e){this._map.fire(new Oi(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ni{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Di(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Di("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Di(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ui{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(o.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=o.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const r=Math.min(i.x,n.x),s=Math.max(i.x,n.x),a=Math.min(i.y,n.y),l=Math.max(i.y,n.y);this._map._requestDomTask((()=>{this._box&&(o.setTransform(this._box,`translate(${r}px,${a}px)`),this._box.style.width=s-r+"px",this._box.style.height=l-a+"px")}))}mouseupWindow(t,n){if(!this._active)return;if(0!==t.button)return;const i=this._startPos,r=n;if(this.reset(),o.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(o.remove(this._box),this._box=null),o.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new e.Event(t,{originalEvent:n}))}}function ji(e,t){const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class Vi{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=function(t){const n=new e.pointGeometry(0,0);for(const e of t)n._add(e);return n.div(t.length)}(n),this.touches=ji(i,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=ji(n,t);for(const e in this.touches){const t=this.touches[e],n=i[e];(!n||n.dist(t)>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Gi{constructor(e){this.singleTap=new Vi(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Wi{constructor(){this._zoomIn=new Gi({numTouches:1,numTaps:2}),this._zoomOut=new Gi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $i={0:1,2:2};class qi{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=o.mouseButton(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),function(e,t){const n=$i[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&o.mouseButton(e)===this._eventButton&&(this._moved&&o.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zi extends qi{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Hi extends qi{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){e.preventDefault()}}class Qi extends qi{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){e.preventDefault()}}class Xi{constructor(e){this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active&&!(n.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,n)}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,i){i.length>0&&(this._active=!0);const r=ji(i,n),o=new e.pointGeometry(0,0),s=new e.pointGeometry(0,0);let a=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(o._add(t),s._add(t.sub(n)),a++,r[e]=t)}if(this._touches=r,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();const[i,r]=this._firstTwoTouches,o=Ki(n,t,i),s=Ki(n,t,r);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,s=Ki(n,t,i),a=Ki(n,t,r);s&&a||(this._active&&o.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ki(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function Ji(e,t){return Math.log(e/t)/Math.LN2}class er extends Yi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ji(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ji(this._distance,n),pinchAround:t}}}function tr(e,t){return 180*e.angleWith(t)/Math.PI}class nr extends Yi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tr(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=tr(e,this._startVector);return Math.abs(n)<t}}function ir(e){return Math.abs(e.y)>Math.abs(e.x)}class rr extends Yi{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(e){this._lastPoints=e,ir(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){const i=e[0].sub(this._lastPoints[0]),r=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return ir(e)&&ir(t)&&o}}const or={panStep:100,bearingStep:15,pitchStep:10};class sr{constructor(){const e=or;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:ar,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ar(e){return e*(2-e)}const lr=4.000244140625;class cr{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let n=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=e.exported.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==n&&n%lr==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=o.mousePos(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform,n=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>lr?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==i&&(i=1/i);const r=n(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*i))),"wheel"===this._type&&(this._startZoom=n(),this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),r=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&r&&o){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),n=o(t);s=e.number(r,i,n),t<1?this._frameId||(this._frameId=!0):a=!0}else s=i,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-n(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=e.ease;if(this._prevEase){const t=this._prevEase,i=(e.exported.now()-t.start)/t.duration,r=t.easing(i+.01)-t.easing(i),o=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=e.bezier(o,s,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:n},n}reset(){this._active=!1}}class ur{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hr{constructor(){this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dr{constructor(){this._tap=new Gi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fr{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pr{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ar{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const mr=e=>e.zoom||e.drag||e.pitch||e.rotate;class gr extends e.Event{}class yr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const i=e.sub([],n,t);this.radius=e.length(i[2]<0?e.div([],i,this.constants):[i[0],i[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$2(t,t,this.constants);const n=e.scale([],t,this.radius);if(n[2]>0){const t=e.scale([],[0,0,1],e.dot(n,[0,0,1])),i=e.scale([],e.normalize([],[n[0],n[1],0]),this.radius),r=e.add([],n,e.scale([],e.sub([],e.add([],i,t),n),2));n[0]=r[0],n[1]=r[1]}return n}}function _r(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class vr{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Li(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),e.bindAll(["handleEvent","handleWindowEvent"],this);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,n,i]of this._listeners)o.addEventListener(t,n,t===e.window.document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(const[t,n,i]of this._listeners)o.removeEventListener(t,n,t===e.window.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Fi(t,e));const i=t.boxZoom=new Ui(t,e);this._add("boxZoom",i);const r=new Wi,o=new hr;t.doubleClickZoom=new ur(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new dr;this._add("tapDragZoom",s);const a=t.touchPitch=new rr;this._add("touchPitch",a);const l=new Hi(e),c=new Qi(e);t.dragRotate=new pr(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Zi(e),h=new Xi(e);t.dragPan=new fr(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new nr,f=new er;t.touchZoomRotate=new Ar(n,f,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ni(t));const p=t.scrollZoom=new cr(t,this);this._add("scrollZoom",p,["mousePan"]);const A=t.keyboard=new sr;this._add("keyboard",A);for(const n of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[n]&&t[n].enable(e[n])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(mr(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const n="renderFrame"===e.type,i=n?void 0:e,r={needsRenderFrame:!1},s={},a={},l=e.touches?this._getMapTouches(e.touches):void 0,c=l?o.touchPos(this._el,l):n?void 0:o.mousePos(this._el,e);for(const{handlerName:n,handler:o,allowed:u}of this._handlers){if(!o.isEnabled())continue;let h;this._blockedByActive(a,u,n)?o.reset():o[t||e.type]&&(h=o[t||e.type](e,c,l),this.mergeHandlerResult(r,s,h,n,i),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||o.isActive())&&(a[n]=o)}const u={};for(const e in this._previousActiveHandlers)a[e]||(u[e]=i);this._previousActiveHandlers=a,(Object.keys(u).length||_r(r))&&(this._changes.push([r,s,u]),this._triggerRenderFrame()),(Object.keys(a).length||_r(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=r;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(t,n,i,r,o){if(!i)return;e.extend(t,i);const s={handlerName:r,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(n.zoom=s),void 0!==i.panDelta&&(n.drag=s),void 0!==i.pitchDelta&&(n.pitch=s),void 0!==i.bearingDelta&&(n.rotate=s)}_applyChanges(){const t={},n={},i={};for(const[r,o,s]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.extend(n,o),e.extend(i,s);this._updateMapTransform(t,n,i),this._changes=[]}_updateMapTransform(t,n,i){const r=this._map,o=r.transform,s=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!_r(t)){const e=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",e!==o.zoom&&this._map._update(!0)}if(!_r(t))return this._fireEvents(n,i,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:f}=t;void 0!==f&&(h=f),(e=>n.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const p=[0,0,0];if(a){const e=o.screenPointToMercatorRay(h),t=o.screenPointToMercatorRay(h.sub(a)),n=this._trackingEllipsoid.projectRay(e.dir),i=this._trackingEllipsoid.projectRay(t.dir);p[0]=i[0]-n[0],p[1]=i[1]-n[1]}const A=o.zoom,m=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),n={dir:e.normalize([],e.sub([],t,o._camera.position))},i=o.screenPointToMercatorRay(o.centerPoint);if(n.dir[2]<0){const r=e.altitudeFromMercatorZ(t[2],t[1]),a=o.rayIntersectionCoordinate(o.pointRayIntersection(o.centerPoint,r)),c=o.zoomDeltaToMovement(s(a),l)*(i.dir[2]/n.dir[2]);e.scale(m,n.dir,c)}else if(o._terrainEnabled()){const i=o.zoomDeltaToMovement(t,l);e.scale(m,n.dir,i)}}const g=e.add(p,p,m);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-A)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,i,!0)}_fireEvents(t,n,i){const r=mr(this._eventsInProgress),o=mr(t),s={};for(const e in t){const{originalEvent:n}=t[e];this._eventsInProgress[e]||(s[`${e}start`]=n),this._eventsInProgress[e]=t[e]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:n}=t[e];this._fireEvent(e,n)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=n[t]||i,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=mr(this._eventsInProgress);if(i&&(r||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(n(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new e.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new gr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class br extends e.Evented{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,n,i){return t=e.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},n),i)}panTo(t,n,i){return this.easeTo(e.extend({center:t},n),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,n,i){return this.easeTo(e.extend({zoom:t},n),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,n,i){return this.easeTo(e.extend({bearing:t},n),i)}resetNorth(t,n){return this.rotateTo(0,e.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,n){t=e.LngLatBounds.convert(t);const i=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,n)}_extendCameraOptions(t){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(n,t.padding),t}_cameraForBoxAndBearing(t,n,i,r){const o=this._extendCameraOptions(r),s=this.transform,a=s.padding,l=s.project(e.LngLat.convert(t)),c=s.project(e.LngLat.convert(n)),u=l.rotate(-e.degToRad(i)),h=c.rotate(-e.degToRad(i)),d=new e.pointGeometry(Math.max(u.x,h.x),Math.max(u.y,h.y)),f=new e.pointGeometry(Math.min(u.x,h.x),Math.min(u.y,h.y)),p=d.sub(f),A=(s.width-(a.left+a.right+o.padding.left+o.padding.right))/p.x,m=(s.height-(a.top+a.bottom+o.padding.top+o.padding.bottom))/p.y;if(m<0||A<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const g=Math.min(s.scaleZoom(s.scale*Math.min(A,m)),o.maxZoom),y="number"==typeof o.offset.x?new e.pointGeometry(o.offset.x,o.offset.y):e.pointGeometry.convert(o.offset),_=new e.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(i*Math.PI/180),v=y.add(_).mult(s.scale/s.zoomScale(g));return{center:s.unproject(l.add(c).div(2).sub(v)),zoom:g,bearing:i}}_cameraForBox(t,n,i,r,o){const s=this._extendCameraOptions(o);i=i||0,r=r||0,t=e.LngLat.convert(t),n=e.LngLat.convert(n);const a=this.transform.clone();a.padding=s.padding;const l=this.getFreeCameraOptions(),c=new e.LngLat(.5*(t.lng+n.lng),.5*(t.lat+n.lat)),u=.5*(i+r);if(a._camera.position[2]<e.mercatorZfromAltitude(u,c.lat))return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),a.setFreeCameraOptions(l);const h=e.MercatorCoordinate.fromLngLat(t),d=e.MercatorCoordinate.fromLngLat(n),A=a.pointRayIntersection(a.centerPoint,u),m=[(g=a.rayIntersectionCoordinate(A)).x,g.y,g.z];var g;const y=a.screenPointToMercatorRay(a.centerPoint);let _,v=0;do{const n=Math.floor(a.zoom),o=1<<n,s=Math.min(o*h.x,o*d.x),l=Math.min(o*h.y,o*d.y),c=Math.max(o*h.x,o*d.x),u=Math.max(o*h.y,o*d.y),A=new p([s,l,i],[c,u,r]),g=f.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,n);if(2!==A.intersects(g)){_&&(a._camera.position=e.scaleAndAdd([],a._camera.position,y.dir,-_),a._updateStateFromCamera());break}const v=e.sub([],a._camera.position,m);_=.5*e.length(v),a._camera.position=e.scaleAndAdd([],a._camera.position,y.dir,_);try{a._updateStateFromCamera()}catch(t){return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}_raycastElevationBox(t,n){const i=this.transform.elevation;if(!i)return;const r=new e.pointGeometry(t.x,n.y),o=new e.pointGeometry(n.x,t.y),s=i.pointCoordinate(t);if(!s)return;const a=i.pointCoordinate(n);if(!a)return;const l=i.pointCoordinate(r);if(!l)return;const c=i.pointCoordinate(o);if(!c)return;const u=new e.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new e.MercatorCoordinate(a[0],a[1]).toLngLat(),d=new e.MercatorCoordinate(l[0],l[1]).toLngLat(),f=new e.MercatorCoordinate(c[0],c[1]).toLngLat(),p=Math.min(u.lng,Math.min(h.lng,Math.min(d.lng,f.lng))),A=Math.min(u.lat,Math.min(h.lat,Math.min(d.lat,f.lat))),m=Math.max(u.lng,Math.max(h.lng,Math.max(d.lng,f.lng))),g=Math.max(u.lat,Math.max(h.lat,Math.max(d.lat,f.lat))),y=Math.min(s[3],Math.min(a[3],Math.min(l[3],c[3]))),_=Math.max(s[3],Math.max(a[3],Math.max(l[3],c[3])));return{minLngLat:new e.LngLat(p,A),maxLngLat:new e.LngLat(m,g),minAltitude:y,maxAltitude:_}}fitScreenCoordinates(t,n,i,r,o){let s,a,l,c;const u=e.pointGeometry.convert(t),h=e.pointGeometry.convert(n),d=this._raycastElevationBox(u,h);if(d)s=d.minLngLat,a=d.maxLngLat,l=d.minAltitude,c=d.maxAltitude;else{if(this.transform.isCornerOffEdge(u,h))return this;s=this.transform.pointLocation(u),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry.convert(t)),this.transform.pointLocation(e.pointGeometry.convert(n)),i,r):this._cameraForBox(s,a,l,c,r),r,o)}_fitInternal(t,n,i){return t?(delete(n=e.extend(t,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(t,n){this.stop();const i=this.transform;let r=!1,o=!1,s=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(r=!0,i.zoom=+t.zoom),void 0!==t.center&&(i.center=e.LngLat.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(o=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(s=!0,i.pitch=+t.pitch),null==t.padding||i.isPaddingEqual(t.padding)||(i.padding=t.padding),this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),r&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),o&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),s&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){this.stop();const i=this.transform,r=i.zoom,o=i.pitch,s=i.bearing;i.setFreeCameraOptions(t);const a=r!==i.zoom,l=o!==i.pitch,c=s!==i.bearing;return this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),a&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),c&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),l&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.exported.prefersReducedMotion)&&(t.duration=0);const i=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:i.padding,d=e.pointGeometry.convert(t.offset);let f=i.centerPoint.add(d);const p=i.pointLocation(f),A=e.LngLat.convert(t.center||p);this._normalizeCenter(A);const m=i.project(p),g=i.project(A).sub(m),y=i.zoomScale(l-r);let _,v;t.around&&(_=e.LngLat.convert(t.around),v=i.locationPoint(_));const b={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==r,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||u!==s,this._padding=!i.isPaddingEqual(h),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,b),this._ease((t=>{if(this._zooming&&(i.zoom=e.number(r,l,t)),this._rotating&&(i.bearing=e.number(o,c,t)),this._pitching&&(i.pitch=e.number(s,u,t)),this._padding&&(i.interpolatePadding(a,h,t),f=i.centerPoint.add(d)),_)i.setLocationAtPoint(_,v);else{const e=i.zoomScale(i.zoom-r),n=l>r?Math.min(2,y):Math.max(.5,y),o=Math.pow(n,1-t),s=i.unproject(m.add(g.mult(t*o)).mult(e));i.setLocationAtPoint(i.renderWorldCopies?s.wrap():s,f)}this._fireMoveEvents(n)}),(e=>{i.recenterOnTerrain(),this._afterEase(n,e)}),t),this}_prepareEase(t,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",n||i.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!i.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.transform.cameraElevationReference="ground";const i=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new e.Event("zoomend",t)),r&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,n){if(!t.essential&&e.exported.prefersReducedMotion){const i=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const i=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,i.minZoom,i.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:i.padding,d=i.zoomScale(l-r),f=e.pointGeometry.convert(t.offset);let p=i.centerPoint.add(f);const A=i.pointLocation(p),m=e.LngLat.convert(t.center||A);this._normalizeCenter(m);const g=i.project(A),y=i.project(m).sub(g);let _=t.curve;const v=Math.max(i.width,i.height),b=v/d,x=y.mag();if("minZoom"in t){const n=e.clamp(Math.min(t.minZoom,r,l),i.minZoom,i.maxZoom),o=v/i.zoomScale(n-r);_=Math.sqrt(o/x*2)}const w=_*_;function E(e){const t=(b*b-v*v+(e?-1:1)*w*w*x*x)/(2*(e?b:v)*w*x);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}const k=E(0);let C=function(e){return T(k)/T(k+_*e)},P=function(e){return v*((T(k)*(S(t=k+_*e)/T(t))-S(k))/w)/x;var t},M=(E(1)-k)/_;if(Math.abs(x)<1e-6||!isFinite(M)){if(Math.abs(v-b)<1e-6)return this.easeTo(t,n);const e=b<v?-1:1;M=Math.abs(Math.log(b/v))/_,P=function(){return 0},C=function(t){return Math.exp(e*_*t)}}return t.duration="duration"in t?+t.duration:1e3*M/("screenSpeed"in t?+t.screenSpeed/_:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=o!==c,this._pitching=u!==s,this._padding=!i.isPaddingEqual(h),this._prepareEase(n,!1),this._ease((t=>{const d=t*M,A=1/C(d);i.zoom=1===t?l:r+i.scaleZoom(A),this._rotating&&(i.bearing=e.number(o,c,t)),this._pitching&&(i.pitch=e.number(s,u,t)),this._padding&&(i.interpolatePadding(a,h,t),p=i.centerPoint.add(f));const _=1===t?m:i.unproject(g.add(y.mult(P(d))).mult(A));i.setLocationAtPoint(i.renderWorldCopies?_.wrap():_,p),i._updateCenterElevation(),this._fireMoveEvents(n)}),(()=>this._afterEase(n)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,n,i){!1===i.animate||0===i.duration?(t(1),n()):(this._easeStart=e.exported.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=e.wrap(t,-180,180);const i=Math.abs(t-n);return Math.abs(t-360-n)<i&&(t-=360),Math.abs(t+360-n)<i&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}class xr{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){o.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString(`AttributionControl.${t}`);e.title=n,e.setAttribute("aria-label",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const i=n.reduce(((e,t,i)=>(t.value&&(e+=`${t.key}=${t.value}${i<n.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${i}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const n in t){const i=t[n];if(i.used){const t=i.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class wr{constructor(){e.bindAll(["_updateLogo"],this),e.bindAll(["_updateCompact"],this)}onAdd(e){this._map=e,this._container=o.create("div","mapboxgl-ctrl");const t=o.create("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){o.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Er{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const t of n)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Sr(t,n,i){if(t=new e.LngLat(t.lng,t.lat),n){const r=new e.LngLat(t.lng-360,t.lat),o=new e.LngLat(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-i.center.lng)/360),a=i.locationPoint(t).distSqr(n),l=n.x<0||n.y<0||n.x>i.width||n.y>i.height;i.locationPoint(r).distSqr(n)<a&&(l||Math.abs(r.lng-i.center.lng)<s)?t=r:i.locationPoint(o).distSqr(n)<a&&(l||Math.abs(o.lng-i.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-i.center.lng)>180;){const e=i.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=i.width&&e.y<=i.height)break;t.lng>i.center.lng?t.lng-=360:t.lng+=360}return t}const Tr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class kr extends e.Evented{constructor(t,n){if(super(),(t instanceof e.window.HTMLElement||n)&&(t=e.extend({element:t},n)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=e.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o.create("div"),this._element.setAttribute("aria-label","Map marker");const n=o.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${i}px`),n.setAttributeNS(null,"width",`${r}px`),n.setAttributeNS(null,"viewBox",`0 0 ${r} ${i}`);const s=o.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");const a=o.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=o.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of c){const t=o.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const u=o.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=o.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=o.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const f=o.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(f);const p=o.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"transform","translate(6.0, 7.0)"),p.setAttributeNS(null,"fill","#FFFFFF");const A=o.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(8.0, 8.0)");const m=o.createNS("http://www.w3.org/2000/svg","circle");m.setAttributeNS(null,"fill","#000000"),m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"cx","5.5"),m.setAttributeNS(null,"cy","5.5"),m.setAttributeNS(null,"r","5.4999962");const g=o.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#FFFFFF"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962"),A.appendChild(m),A.appendChild(g),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(p),a.appendChild(A),n.appendChild(a),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=e.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const i=this._element.classList;for(const e in Tr)i.remove(`mapboxgl-marker-anchor-${e}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),o.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}_evaluateOpacity(){const e=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(e))return void this._clearFadeTimer();const t=this._map.unproject(e);let n=!1;if(this._map.getTerrain()){const e=this._map.getFreeCameraOptions();if(e.position){const i=e.position.toLngLat();n=i.distanceTo(t)<.9*i.distanceTo(this._lngLat)}}const i=(1-this._map._queryFogOpacity(t))*(n?.2:1);this._element.style.opacity=`${i}`,this._popup&&this._popup._setOpacity(`${i}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(e){const t=this._map.transform;return!!e&&e.x>=0&&e.x<t.width&&e.y>=0&&e.y<t.height}_update(e){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Sr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let t="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?t=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(t=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),e&&"moveend"!==e.type||(this._pos=this._pos.round()),this._map._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&o.setTransform(this._element,`${Tr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${t}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const e=this._map.transform,t=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&t._rotate(e.angle),"map"===this._pitchAlignment&&(t.y*=Math.cos(e._pitch)),t}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Cr{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const Pr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Mr,HTMLElement:Ir,ImageBitmap:Lr}=e.window,Rr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function zr(e){e.parentNode&&e.parentNode.removeChild(e)}const Dr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Or{constructor(t,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Hi({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,i&&(this.mousePitch=new Qi({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener(n,"mousedown",this.mousedown),o.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),o.addEventListener(n,"touchmove",this.touchmove),o.addEventListener(n,"touchend",this.touchend),o.addEventListener(n,"touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),o.disableDrag()}move(e,t){const n=this.map,i=this.mouseRotate.mousemoveWindow(e,t);if(i&&i.bearingDelta&&n.setBearing(n.getBearing()+i.bearingDelta),this.mousePitch){const i=this.mousePitch.mousemoveWindow(e,t);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}}off(){const e=this.element;o.removeEventListener(e,"mousedown",this.mousedown),o.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),o.removeEventListener(e,"touchmove",this.touchmove),o.removeEventListener(e,"touchend",this.touchend),o.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){o.enableDrag(),o.removeEventListener(e.window,"mousemove",this.mousemove),o.removeEventListener(e.window,"mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),o.mousePos(this.element,t)),o.addEventListener(e.window,"mousemove",this.mousemove),o.addEventListener(e.window,"mouseup",this.mouseup)}mousemove(e){this.move(e,o.mousePos(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=o.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=o.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Br={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Fr,Nr=0,Ur=!1;const jr={maxWidth:100,unit:"metric"};function Vr(e,t,n){const i=n&&n.maxWidth||100,r=e._container.getBoundingClientRect().height/2,o=e.unproject([0,r]),s=e.unproject([i,r]),a=o.distanceTo(s);if(n&&"imperial"===n.unit){const n=3.2808*a;n>5280?Gr(t,i,n/5280,e._getUIString("ScaleControl.Miles"),e):Gr(t,i,n,e._getUIString("ScaleControl.Feet"),e)}else n&&"nautical"===n.unit?Gr(t,i,a/1852,e._getUIString("ScaleControl.NauticalMiles"),e):a>=1e3?Gr(t,i,a/1e3,e._getUIString("ScaleControl.Kilometers"),e):Gr(t,i,a,e._getUIString("ScaleControl.Meters"),e)}function Gr(e,t,n,i,r){const o=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(n),s=o/n;r._requestDomTask((()=>{e.style.width=t*s+"px",e.innerHTML=`${o}&nbsp;${i}`}))}const Wr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$r=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),qr={version:e.version,supported:t,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends br{constructor(t){if(null!=(t=e.extend({},Rr,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ei(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._renderTaskQueue=new Er,this._domRenderTaskQueue=new Er,this._controls=[],this._markers=[],this._mapId=e.uniqueId(),this._locale=e.extend({},Pr,t.locale),this._clickTolerance=t.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Cr(0),this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof Ir))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new vr(this,t),this._hash=t.hash&&new Ti("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.attributionControl&&this.addControl(new xr({customAttribution:t.customAttribution})),this._logoControl=new wr,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){const n=this._containerDimensions(),i=n[0],r=n[1];this._resizeCanvas(i,r),this.transform.resize(i,r),this.painter.resize(Math.ceil(i),Math.ceil(r));const o=!this._moving;return o&&(this.stop(),this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t))),this.fire(new e.Event("resize",t)),o&&this.fire(new e.Event("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.pointGeometry.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const r=r=>{const o=this.getLayer(t)?this.queryRenderedFeatures(r.point,{layers:[t]}):[];o.length?i||(i=!0,n.call(this,new Di(e,this,r.originalEvent,{features:o}))):i=!1};return{layer:t,listener:n,delegates:{mousemove:r,mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const r=r=>{(this.getLayer(t)?this.queryRenderedFeatures(r.point,{layers:[t]}):[]).length?i=!0:i&&(i=!1,n.call(this,new Di(e,this,r.originalEvent)))},o=t=>{i&&(i=!1,n.call(this,new Di(e,this,t.originalEvent)))};return{layer:t,listener:n,delegates:{mousemove:r,mouseout:o}}}{const i=e=>{const i=this.getLayer(t)?this.queryRenderedFeatures(e.point,{layers:[t]}):[];i.length&&(e.features=i,n.call(this,e),delete e.features)};return{layer:t,listener:n,delegates:{[e]:i}}}}on(e,t,n){if(void 0===n)return super.on(e,t);const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const e in i.delegates)this.on(e,i.delegates[e]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);const i=this._createDelegatedListener(e,t,n);for(const e in i.delegates)this.once(e,i.delegates[e]);return this}off(e,t,n){return void 0===n?super.off(e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&(i=>{const r=this._delegatedListeners[e];for(let e=0;e<r.length;e++){const i=r[e];if(i.layer===t&&i.listener===n){for(const e in i.delegates)this.off(e,i.delegates[e]);return r.splice(e,1),this}}})(),this)}queryRenderedFeatures(t,n){return this.style?(void 0!==n||void 0===t||t instanceof e.pointGeometry||Array.isArray(t)||(n=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}queryTerrainElevation(t,n){const i=this.transform.elevation;return i?(n=e.extend({},{exaggerated:!0},n),i.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,n.exaggerated)):null}setStyle(t,n){return!1!==(n=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(t,n))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),e&&(this.style=new Gt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Gt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,n){if("string"==typeof t){const i=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(i,e.ResourceType.Style);e.getJSON(r,((t,i)=>{t?this.fire(new e.ErrorEvent(t)):i&&this._updateDiff(i,n)}))}else"object"==typeof t&&this._updateDiff(t,n)}_updateDiff(t,n){try{this.style.setState(t)&&this._update(!0)}catch(i){e.warnOnce(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(t,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(t){const n=this.style&&this.style._getSourceCaches(t);if(0!==n.length)return n.every((e=>e.loaded()));this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`)))}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,n,{pixelRatio:i=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),n instanceof Mr||Lr&&n instanceof Lr){const{width:l,height:c,data:u}=e.exported.getImageData(n);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},u),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:c,data:u}=n,h=n;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(u)),pixelRatio:i,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:h}),h.onAdd&&h.onAdd(this,t)}}}updateImage(t,n){const i=this.style.getImage(t);if(!i)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof Mr||Lr&&n instanceof Lr?e.exported.getImageData(n):n,{width:o,height:s,data:a}=r;return void 0===o||void 0===s?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==i.data.width||s!==i.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(i.data.replace(a,!(n instanceof Mr||Lr&&n instanceof Lr)),void this.style.updateImage(t,i))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,n){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),((t,i)=>{n(t,i instanceof Mr?e.exported.getImageData(i):i)}))}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}setFilter(e,t,n={}){return this.style.setFilter(e,t,n),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,n,i={}){return this.style.setPaintProperty(e,t,n,i),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,n,i={}){return this.style.setLayoutProperty(e,t,n,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300),[e,t]}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o.create("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o.create("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=o.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);const i=this._controlContainer=o.create("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{r[e]=o.create("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,n){const i=e.exported.devicePixelRatio||1;this._canvas.width=i*Math.ceil(t),this._canvas.height=i*Math.ceil(n),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${n}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const n=e.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);i?(e.storeAuthState(i,!0),this.painter=new pi(i,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(i)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.isMoving()&&this.loaded()?e():this._domRenderTaskQueue.add(e)}_render(t){let n;const i=this.painter.context.extTimerQuery,r=e.exported.now();this.listens("gpu-timing-frame")&&(n=i.createQueryEXT(),i.beginQueryEXT(i.TIME_ELAPSED_EXT,n));let o=this._updateAverageElevation(r);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;let s=!1;const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,n=e.exported.now();this.style.zoomHistory.update(t,n);const i=new e.EvaluationParameters(t,{now:n,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=i.crossFadingFactor();1===r&&r===this._crossFadingFactor||(s=!0,this._crossFadingFactor=r),this.style.update(i)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const t=e.exported.now()-r;i.endQueryEXT(i.TIME_ELAPSED_EXT,n),setTimeout((()=>{const r=i.getQueryObjectEXT(n,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:r}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const n=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:n}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||o;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(o=this._updateAverageElevation(r,!0)),o)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const e of this._markers)e._update()}_updateAverageElevation(e,t=!1){const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);if((t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();isNaN(i)?i=0:this._averageElevationLastSampledAt=e;const r=Math.abs(t-i);if(r>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(i),n(i);this._averageElevation.easeTo(i,e,300)}else if(r>1e-4)return this._averageElevation.jumpTo(i),n(i)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;e.storeAuthState(t,!1),this._logoControl instanceof wr&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,i=n.createFramebuffer();function r(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,n){let i=n[1]-n[0];const r=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);i+=(n[o+2]-n[o+1])*(1-a/r)}return i}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),zr(this._canvasContainer),zr(this._controlContainer),zr(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}_setCacheLimits(t,n){e.setCacheLimits(t,n)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},Dr,t),this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),o.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),o.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=o.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Or(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){o.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const n=o.create("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){const n=this._map._getUIString(`NavigationControl.${t}`);e.title=n,e.setAttribute("aria-label",n)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({},Br,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Si(this._updateMarkerRotation,20)}onAdd(t){var n;return this._map=t,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Fr?n(Fr):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{Fr="denied"!==e.state,n(Fr)})):(Fr=!!e.window.navigator.geolocation,n(Fr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),o.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Nr=0,Ur=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const n=new e.LngLat(t.coords.longitude,t.coords.latitude),i=t.coords.accuracy,r=this._map.getBearing(),o=e.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(i),o,{geolocateSource:!0})}_updateMarker(t){if(t){const n=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map._container.getBoundingClientRect().height/2,t=this._map.unproject([0,e]),n=this._map.unproject([100,e]),i=t.distanceTo(n)/100,r=Math.ceil(2*this._accuracy/i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Ur)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o.create("button","mapboxgl-ctrl-geolocate",this._container),o.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o.create("div","mapboxgl-user-location"),this._dotElement.appendChild(o.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new kr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Nr--,Ur=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Nr++,Nr>1?(t={maximumAge:6e5,timeout:0},Ur=!0):(t=this.options.positionOptions,Ur=!1),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{e.window.addEventListener("ondeviceorientationabsolute"in e.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==e.window.DeviceMotionEvent&&"function"==typeof e.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),e.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),e.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:xr,ScaleControl:class{constructor(t){this.options=e.extend({},jr,t),e.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Vr(this._map,this._container,this.options)}onAdd(e){return this._map=e,this._container=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){o.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(e){this.options.unit=e,Vr(this._map,this._container,this.options)}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){o.remove(this._controlContainer),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o.create("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(Wr),t),e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&o.remove(this._content),this._container&&(o.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const n=e.window.document.createDocumentFragment(),i=e.window.document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)n.appendChild(r);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=o.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._container&&this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._container&&this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=o.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(e){this._update(e.point)}_onMouseMove(e){this._update(e.point)}_onDrag(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._pos,n=this._container.offsetWidth,i=this._container.offsetHeight;let r;return r=t.y+e.bottom.y<i?["top"]:t.y>this._map.transform.height-i?["bottom"]:[],t.x<n/2?r.push("left"):t.x>this._map.transform.width-n/2&&r.push("right"),0===r.length?"bottom":r.join("-")}_updateClassList(){const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),this._container.className=e.join(" ")}_update(t){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=o.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=o.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sr(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t){const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),i=function(t){if(t||(t=new e.pointGeometry(0,0)),"number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{center:new e.pointGeometry(0,0),top:new e.pointGeometry(0,t),"top-left":new e.pointGeometry(n,n),"top-right":new e.pointGeometry(-n,n),bottom:new e.pointGeometry(0,-t),"bottom-left":new e.pointGeometry(n,-n),"bottom-right":new e.pointGeometry(-n,-n),left:new e.pointGeometry(t,0),right:new e.pointGeometry(-t,0)}}if(t instanceof e.pointGeometry||Array.isArray(t)){const n=e.pointGeometry.convert(t);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:e.pointGeometry.convert(t.center||[0,0]),top:e.pointGeometry.convert(t.top||[0,0]),"top-left":e.pointGeometry.convert(t["top-left"]||[0,0]),"top-right":e.pointGeometry.convert(t["top-right"]||[0,0]),bottom:e.pointGeometry.convert(t.bottom||[0,0]),"bottom-left":e.pointGeometry.convert(t["bottom-left"]||[0,0]),"bottom-right":e.pointGeometry.convert(t["bottom-right"]||[0,0]),left:e.pointGeometry.convert(t.left||[0,0]),right:e.pointGeometry.convert(t.right||[0,0])}}(this.options.offset),r=this._anchor=this._getAnchor(i),s=n.add(i[r]).round();this._map._requestDomTask((()=>{this._container&&r&&o.setTransform(this._container,`${Tr[r]} translate(${s.x}px,${s.y}px)`)}))}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector($r);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._content&&(this._content.style.opacity=e),this._tip&&(this._tip.style.opacity=e)}},Marker:kr,Style:Gt,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.pointGeometry,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:xi,Evented:e.Evented,config:e.config,prewarm:function(){De().acquire(Le)},clearPrewarmedResources:function(){const e=ze;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Le),ze=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return Re.workerCount},set workerCount(e){Re.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return qr})),n}()}(kt);var Ct=kt.exports;function Pt(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Mt(e,t){if(e===t)return!0;if(Pt(e)&&Pt(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!Mt(e[n],t[n]))return!1;return!0}return Math.abs(e-t)<=1e-7}function It(e,t,n){return Math.max(t,Math.min(n,e))}function Lt(e,t,n){return Pt(e)?e.map((function(e,i){return Lt(e,t[i],n)})):n*t+(1-n)*e}function Rt(e,t){if(!e)throw new Error(t||"react-map-gl: assertion failed.")}function zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zt(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ot={minZoom:0,maxZoom:24,minPitch:0,maxPitch:85},Bt=0,Ft=0,Nt=1.5,Ut=function(){function e(t){var n=t.width,i=t.height,r=t.latitude,o=t.longitude,s=t.zoom,a=t.bearing,l=void 0===a?Ft:a,c=t.pitch,u=void 0===c?Bt:c,h=t.altitude,d=void 0===h?Nt:h,f=t.maxZoom,p=void 0===f?Ot.maxZoom:f,A=t.minZoom,m=void 0===A?Ot.minZoom:A,g=t.maxPitch,y=void 0===g?Ot.maxPitch:g,_=t.minPitch,v=void 0===_?Ot.minPitch:_,b=t.transitionDuration,x=t.transitionEasing,w=t.transitionInterpolator,E=t.transitionInterruption,S=t.startPanLngLat,T=t.startZoomLngLat,k=t.startRotatePos,C=t.startBearing,P=t.startPitch,M=t.startZoom;ft(this,e),Rt(Number.isFinite(n),"`width` must be supplied"),Rt(Number.isFinite(i),"`height` must be supplied"),Rt(Number.isFinite(o),"`longitude` must be supplied"),Rt(Number.isFinite(r),"`latitude` must be supplied"),Rt(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:n,height:i,latitude:r,longitude:o,zoom:s,bearing:l,pitch:u,altitude:d,maxZoom:p,minZoom:m,maxPitch:y,minPitch:v,transitionDuration:b,transitionEasing:x,transitionInterpolator:w,transitionInterruption:E}),this._state={startPanLngLat:S,startZoomLngLat:T,startRotatePos:k,startBearing:C,startPitch:P,startZoom:M}}return At(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(e){var t=e.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(t)})}},{key:"pan",value:function(e){var t=e.pos,n=e.startPos,i=this._state.startPanLngLat||this._unproject(n);if(!i)return this;var r=N(this._calculateNewLngLat({startPanLngLat:i,pos:t}),2),o=r[0],s=r[1];return this._getUpdatedMapState({longitude:o,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(e){var t=e.pos;return this._getUpdatedMapState({startRotatePos:t,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(e){var t,n=e.pos,i=e.deltaAngleX,r=void 0===i?0:i,o=e.deltaAngleY,s=void 0===o?0:o,a=this._state,l=a.startRotatePos,c=a.startBearing,u=a.startPitch;return Number.isFinite(c)&&Number.isFinite(u)?(t=n?this._calculateNewPitchAndBearing(Dt(Dt({},this._getRotationParams(n,l)),{},{startBearing:c,startPitch:u})):{bearing:c+r,pitch:u+s},this._getUpdatedMapState(t)):this}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(e){var t=e.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(t),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(e){var t=e.pos,n=e.startPos,i=e.scale;Rt(i>0,"`scale` must be a positive number");var r=this._state,o=r.startZoom,s=r.startZoomLngLat;Number.isFinite(o)||(o=this._viewportProps.zoom,s=this._unproject(n)||this._unproject(t)),Rt(s,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var a=this._calculateNewZoom({scale:i,startZoom:o||0}),l=N(new Fe(Object.assign({},this._viewportProps,{zoom:a})).getMapCenterByLngLatPosition({lngLat:s,pos:t}),2),c=l[0],u=l[1];return this._getUpdatedMapState({zoom:a,longitude:c,latitude:u})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new e(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(e){var t=e.maxZoom,n=e.minZoom,i=e.zoom;e.zoom=It(i,n,t);var r=e.maxPitch,o=e.minPitch,s=e.pitch;return e.pitch=It(s,o,r),Object.assign(e,Ne(e)),e}},{key:"_unproject",value:function(e){var t=new Fe(this._viewportProps);return e&&t.unproject(e)}},{key:"_calculateNewLngLat",value:function(e){var t=e.startPanLngLat,n=e.pos;return new Fe(this._viewportProps).getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"_calculateNewZoom",value:function(e){var t=e.scale,n=e.startZoom,i=this._viewportProps,r=i.maxZoom,o=i.minZoom;return It(n+Math.log2(t),o,r)}},{key:"_calculateNewPitchAndBearing",value:function(e){var t=e.deltaScaleX,n=e.deltaScaleY,i=e.startBearing,r=e.startPitch;n=It(n,-1,1);var o=this._viewportProps,s=o.minPitch,a=o.maxPitch,l=r;return n>0?l=r+n*(a-r):n<0&&(l=r-n*(s-r)),{pitch:l,bearing:i+180*t}}},{key:"_getRotationParams",value:function(e,t){var n=e[0]-t[0],i=e[1]-t[1],r=e[1],o=t[1],s=this._viewportProps,a=s.width,l=s.height,c=n/a,u=0;return i>0?Math.abs(l-o)>5&&(u=i/(o-l)*1.2):i<0&&o>5&&(u=1-r/o),{deltaScaleX:c,deltaScaleY:u=Math.min(1,Math.max(-1,u))}}}]),e}();function jt(e){return e[0].toLowerCase()+e.slice(1)}function Vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Wt=t.exports.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),$t=Wt.Provider;Wt.Provider=function(e){var n=e.value,i=e.children,r=N(t.exports.useState(null),2),o=r[0],s=r[1],a=t.exports.useContext(Wt);return n=Gt(Gt({setMap:s},a),{},{map:a&&a.map||o},n),t.exports.createElement($t,{value:n},i)};var qt="undefined"!=typeof window?t.exports.useLayoutEffect:t.exports.useEffect;function Zt(e,t){var n=t.longitude,i=t.latitude;return e&&e.queryTerrainElevation&&e.queryTerrainElevation([n,i])||0}function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xt="A valid API access token is required to use Mapbox data";function Yt(e){var t=e.map,n=e.props,i=e.width,r=e.height,o=Qt(Qt(Qt({},n),n.viewState),{},{width:i,height:r});return o.position=[0,0,Zt(t,o)],new Fe(o)}var Kt={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},Jt=Object.assign({},Tt.propTypes,{width:b.exports.oneOfType([b.exports.number,b.exports.string]),height:b.exports.oneOfType([b.exports.number,b.exports.string]),onResize:b.exports.func,disableTokenWarning:b.exports.bool,visible:b.exports.bool,className:b.exports.string,style:b.exports.object,visibilityConstraints:b.exports.object}),en=Object.assign({},Tt.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:function(){},className:"",style:null,visibilityConstraints:Ot});function tn(){return t.exports.createElement("div",{key:"warning",id:"no-token-warning",style:{position:"absolute",left:0,top:0}},t.exports.createElement("h3",{key:"header"},Xt),t.exports.createElement("div",{key:"text"},"For information on setting up your basemap, read"),t.exports.createElement("a",{key:"link",href:"https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens"},"Note on Map Tokens"))}var nn=t.exports.forwardRef((function(e,n){var i=N(t.exports.useState(!0),2),r=i[0],o=i[1],s=N(t.exports.useState({width:0,height:0}),2),a=s[0],l=s[1],c=t.exports.useRef(null),u=t.exports.useRef(null),h=t.exports.useRef(null),d=t.exports.useRef(null),f=t.exports.useContext(Wt);qt((function(){if(nn.supported()){var t=new Tt(Qt(Qt(Qt({},e),a),{},{mapboxgl:Ct,container:u.current,onError:function(t){401===(t.error&&t.error.status||t.status)&&r&&(console.error(Xt),o(!1)),e.onError(t)}}));c.current=t,f&&f.setMap&&f.setMap(t.getMap());var n=new dt((function(t){if(t[0].contentRect){var n=t[0].contentRect,i=n.width,r=n.height;l({width:i,height:r}),e.onResize({width:i,height:r})}}));return n.observe(h.current),function(){t.finalize(),c.current=null,n.disconnect()}}}),[]),qt((function(){c.current&&c.current.setProps(Qt(Qt({},e),a))}));var p=c.current&&c.current.getMap();t.exports.useImperativeHandle(n,(function(){return function(e){return{getMap:function(){return e.current&&e.current.getMap()},queryRenderedFeatures:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.current&&e.current.getMap();return i&&i.queryRenderedFeatures(t,n)}}}(c)}),[]);var A=t.exports.useCallback((function(e){var t=e.target;t===d.current&&t.scrollTo(0,0)}),[]),m=p&&t.exports.createElement($t,{value:Qt(Qt({},f),{},{viewport:f.viewport||Yt(Qt({map:p,props:e},a)),map:p,container:f.container||h.current})},t.exports.createElement("div",{key:"map-overlays",className:"overlays",ref:d,style:Kt,onScroll:A},e.children)),g=e.className,y=e.width,_=e.height,v=e.style,b=e.visibilityConstraints,x=Object.assign({position:"relative"},v,{width:y,height:_}),w=e.visible&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ot;for(var n in t){var i=n.slice(0,3),r=jt(n.slice(3));if("min"===i&&e[r]<t[n])return!1;if("max"===i&&e[r]>t[n])return!1}return!0}(e.viewState||e,b),E=Object.assign({},Kt,{visibility:w?"inherit":"hidden"});return t.exports.createElement("div",{key:"map-container",ref:h,style:x},t.exports.createElement("div",{key:"map-mapbox",ref:u,style:E,className:g}),m,!r&&!e.disableTokenWarning&&t.exports.createElement(tn,null))}));function rn(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return on(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return on(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function on(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}nn.supported=function(){return Ct&&Ct.supported()},nn.propTypes=Jt,nn.defaultProps=en;var sn=function(){function e(){ft(this,e),v(this,"propNames",[])}return At(e,[{key:"arePropsEqual",value:function(e,t){var n,i=rn(this.propNames||[]);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(!Mt(e[r],t[r]))return!1}}catch(e){i.e(e)}finally{i.f()}return!0}},{key:"initializeProps",value:function(e,t){return{start:e,end:t}}},{key:"interpolateProps",value:function(e,t,n){Rt(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(e,t){return t.transitionDuration}}]),e}();function an(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ln(e,t){return ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ln(e,t)}function cn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}function un(e){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(e)}function hn(e,t){if(t&&("object"===un(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return an(e)}function dn(e){return dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},dn(e)}var fn={longitude:1,bearing:1};function pn(e){return Number.isFinite(e)||Array.isArray(e)}function An(e,t,n){return function(e){return e in fn}(e)&&Math.abs(n-t)>180&&(n=n<0?n+360:n-360),n}function mn(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return gn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gn(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function gn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=dn(e);if(t){var r=dn(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return hn(this,n)}}var _n=["longitude","latitude","zoom","bearing","pitch"],vn=["latitude","longitude","zoom","width","height"],bn=["bearing","pitch"],xn={speed:1.2,curve:1.414};function wn(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return En(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return En(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function En(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Sn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=dn(e);if(t){var r=dn(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return hn(this,n)}}!function(e){cn(n,e);var t=yn(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ft(this,n),v(an(e=t.call(this)),"propNames",_n),e.props=Object.assign({},xn,i),e}At(n,[{key:"initializeProps",value:function(e,t){var n,i={},r={},o=mn(vn);try{for(o.s();!(n=o.n()).done;){var s=n.value,a=e[s],l=t[s];Rt(pn(a)&&pn(l),"".concat(s," must be supplied for transition")),i[s]=a,r[s]=An(s,a,l)}}catch(e){o.e(e)}finally{o.f()}var c,u=mn(bn);try{for(u.s();!(c=u.n()).done;){var h=c.value,d=e[h]||0,f=t[h]||0;i[h]=d,r[h]=An(h,d,f)}}catch(e){u.e(e)}finally{u.f()}return{start:i,end:r}}},{key:"interpolateProps",value:function(e,t,n){var i,r=Ve(e,t,n,this.props),o=mn(bn);try{for(o.s();!(i=o.n()).done;){var s=i.value;r[s]=Lt(e[s],t[s],n)}}catch(e){o.e(e)}finally{o.f()}return r}},{key:"getDuration",value:function(e,t){var n=t.transitionDuration;return"auto"===n&&(n=Ge(e,t,this.props)),n}}])}(sn);var Tn=["longitude","latitude","zoom","bearing","pitch"],kn=function(e){cn(n,e);var t=Sn(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ft(this,n),e=t.call(this),Array.isArray(i)&&(i={transitionProps:i}),e.propNames=i.transitionProps||Tn,i.around&&(e.around=i.around),e}return At(n,[{key:"initializeProps",value:function(e,t){var n={},i={};if(this.around){n.around=this.around;var r=new Fe(e).unproject(this.around);Object.assign(i,t,{around:new Fe(t).project(r),aroundLngLat:r})}var o,s=wn(this.propNames);try{for(s.s();!(o=s.n()).done;){var a=o.value,l=e[a],c=t[a];Rt(pn(l)&&pn(c),"".concat(a," must be supplied for transition")),n[a]=l,i[a]=An(a,l,c)}}catch(e){s.e(e)}finally{s.f()}return{start:n,end:i}}},{key:"interpolateProps",value:function(e,t,n){var i,r={},o=wn(this.propNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;r[s]=Lt(e[s],t[s],n)}}catch(e){o.e(e)}finally{o.f()}if(t.around){var a=N(new Fe(Object.assign({},t,r)).getMapCenterByLngLatPosition({lngLat:t.aroundLngLat,pos:Lt(e.around,t.around,n)}),2),l=a[0],c=a[1];r.longitude=l,r.latitude=c}return r}}]),n}(sn),Cn=function(){};var Pn=1,Mn=2,In=3,Ln=4,Rn={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new kn,transitionInterruption:Pn,onTransitionStart:Cn,onTransitionInterrupt:Cn,onTransitionEnd:Cn},zn=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ft(this,e),v(this,"_animationFrame",null),v(this,"_onTransitionFrame",(function(){t._animationFrame=requestAnimationFrame(t._onTransitionFrame),t._updateViewport()})),this.props=null,this.onViewportChange=n.onViewportChange||Cn,this.onStateChange=n.onStateChange||Cn,this.time=n.getTime||Date.now}return At(e,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(e){var t=this.props;if(this.props=e,!t||this._shouldIgnoreViewportChange(t,e))return!1;if(this._isTransitionEnabled(e)){var n=Object.assign({},t),i=Object.assign({},e);if(this._isTransitionInProgress()&&(t.onTransitionInterrupt(),this.state.interruption===Mn?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===Ln)){var r=this.time(),o=(r-this.state.startTime)/this.state.duration;i.transitionDuration=this.state.duration-(r-this.state.startTime),i.transitionEasing=function(e,t){var n=e(t);return function(i){return 1/(1-n)*(e(i*(1-t)+t)-n)}}(this.state.easing,o),i.transitionInterpolator=n.transitionInterpolator}return i.onTransitionStart(),this._triggerTransition(n,i),!0}return this._isTransitionInProgress()&&(t.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return Boolean(this._animationFrame)}},{key:"_isTransitionEnabled",value:function(e){var t=e.transitionDuration,n=e.transitionInterpolator;return(t>0||"auto"===t)&&Boolean(n)}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return!!this.state.propsInTransition&&this.state.interpolator.arePropsEqual(e,this.state.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(e,t){return!e||(this._isTransitionInProgress()?this.state.interruption===In||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t))}},{key:"_triggerTransition",value:function(e,t){Rt(this._isTransitionEnabled(t)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=t.transitionInterpolator,i=n.getDuration?n.getDuration(e,t):t.transitionDuration;if(0!==i){var r=t.transitionInterpolator.initializeProps(e,t),o={inTransition:!0,isZooming:e.zoom!==t.zoom,isPanning:e.longitude!==t.longitude||e.latitude!==t.latitude,isRotating:e.bearing!==t.bearing||e.pitch!==t.pitch};this.state={duration:i,easing:t.transitionEasing,interpolator:t.transitionInterpolator,interruption:t.transitionInterruption,startTime:this.time(),startProps:r.start,endProps:r.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(o)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var e=this.time(),t=this.state,n=t.startTime,i=t.duration,r=t.easing,o=t.interpolator,s=t.startProps,a=t.endProps,l=!1,c=(e-n)/i;c>=1&&(c=1,l=!0),c=r(c);var u=o.interpolateProps(s,a,c),h=new Ut(Object.assign({},this.props,u));this.state.propsInTransition=h.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),l&&(this._endTransition(),this.props.onTransitionEnd())}}]),e}();v(zn,"defaultProps",Rn);var Dn={exports:{}};
/*! Hammer.JS - v2.0.7 - 2016-04-22
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2016 Jorik Tangelder;
	 * Licensed under the MIT license */!function(e){!function(t,n,i,r){var o,s=["","webkit","Moz","MS","ms","o"],a=n.createElement("div"),l=Math.round,c=Math.abs,u=Date.now;function h(e,t,n){return setTimeout(y(e,n),t)}function d(e,t,n){return!!Array.isArray(e)&&(f(e,n[t],n),!0)}function f(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==r)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function p(e,n,i){var r="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=t.console&&(t.console.warn||t.console.log);return o&&o.call(t.console,r,i),e.apply(this,arguments)}}o="function"!=typeof Object.assign?function(e){if(e===r||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==r&&null!==i)for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o])}return t}:Object.assign;var A=p((function(e,t,n){for(var i=Object.keys(t),o=0;o<i.length;)(!n||n&&e[i[o]]===r)&&(e[i[o]]=t[i[o]]),o++;return e}),"extend","Use `assign`."),m=p((function(e,t){return A(e,t,!0)}),"merge","Use `assign`.");function g(e,t,n){var i,r=t.prototype;(i=e.prototype=Object.create(r)).constructor=e,i._super=r,n&&o(i,n)}function y(e,t){return function(){return e.apply(t,arguments)}}function _(e,t){return"function"==typeof e?e.apply(t&&t[0]||r,t):e}function v(e,t){return e===r?t:e}function b(e,t,n){f(S(t),(function(t){e.addEventListener(t,n,!1)}))}function x(e,t,n){f(S(t),(function(t){e.removeEventListener(t,n,!1)}))}function w(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function E(e,t){return e.indexOf(t)>-1}function S(e){return e.trim().split(/\s+/g)}function T(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function k(e){return Array.prototype.slice.call(e,0)}function C(e,t,n){for(var i=[],r=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];T(r,s)<0&&i.push(e[o]),r[o]=s,o++}return n&&(i=t?i.sort((function(e,n){return e[t]>n[t]})):i.sort()),i}function P(e,t){for(var n,i,o=t[0].toUpperCase()+t.slice(1),a=0;a<s.length;){if((i=(n=s[a])?n+o:t)in e)return i;a++}return r}var M=1;function I(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}var L="ontouchstart"in t,R=P(t,"PointerEvent")!==r,z=L&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),D="touch",O="mouse",B=24,F=["x","y"],N=["clientX","clientY"];function U(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){_(e.options.enable,[e])&&n.handler(t)},this.init()}function j(e,t,n){var i=n.pointers.length,o=n.changedPointers.length,s=1&t&&i-o==0,a=12&t&&i-o==0;n.isFirst=!!s,n.isFinal=!!a,s&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,i=t.pointers,o=i.length;n.firstInput||(n.firstInput=V(t));o>1&&!n.firstMultiple?n.firstMultiple=V(t):1===o&&(n.firstMultiple=!1);var s=n.firstInput,a=n.firstMultiple,l=a?a.center:s.center,h=t.center=G(i);t.timeStamp=u(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=Z(l,h),t.distance=q(l,h),function(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y});t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}(n,t),t.offsetDirection=$(t.deltaX,t.deltaY);var d=W(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=c(d.x)>c(d.y)?d.x:d.y,t.scale=a?(f=a.pointers,p=i,q(p[0],p[1],N)/q(f[0],f[1],N)):1,t.rotation=a?function(e,t){return Z(t[1],t[0],N)+Z(e[1],e[0],N)}(a.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,i,o,s,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(l>25||a.velocity===r)){var u=t.deltaX-a.deltaX,h=t.deltaY-a.deltaY,d=W(l,u,h);i=d.x,o=d.y,n=c(d.x)>c(d.y)?d.x:d.y,s=$(u,h),e.lastInterval=t}else n=a.velocity,i=a.velocityX,o=a.velocityY,s=a.direction;t.velocity=n,t.velocityX=i,t.velocityY=o,t.direction=s}(n,t);var f,p;var A=e.element;w(t.srcEvent.target,A)&&(A=t.srcEvent.target);t.target=A}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function V(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:l(e.pointers[n].clientX),clientY:l(e.pointers[n].clientY)},n++;return{timeStamp:u(),pointers:t,center:G(t),deltaX:e.deltaX,deltaY:e.deltaY}}function G(e){var t=e.length;if(1===t)return{x:l(e[0].clientX),y:l(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:l(n/t),y:l(i/t)}}function W(e,t,n){return{x:t/e||0,y:n/e||0}}function $(e,t){return e===t?1:c(e)>=c(t)?e<0?2:4:t<0?8:16}function q(e,t,n){n||(n=F);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function Z(e,t,n){n||(n=F);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}U.prototype={handler:function(){},init:function(){this.evEl&&b(this.element,this.evEl,this.domHandler),this.evTarget&&b(this.target,this.evTarget,this.domHandler),this.evWin&&b(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(I(this.element),this.evWin,this.domHandler)}};var H={mousedown:1,mousemove:2,mouseup:4},Q="mousedown",X="mousemove mouseup";function Y(){this.evEl=Q,this.evWin=X,this.pressed=!1,U.apply(this,arguments)}g(Y,U,{handler:function(e){var t=H[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:O,srcEvent:e}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},J={2:D,3:"pen",4:O,5:"kinect"},ee="pointerdown",te="pointermove pointerup pointercancel";function ne(){this.evEl=ee,this.evWin=te,U.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}t.MSPointerEvent&&!t.PointerEvent&&(ee="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel"),g(ne,U,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=K[i],o=J[e.pointerType]||e.pointerType,s=o==D,a=T(t,e.pointerId,"pointerId");1&r&&(0===e.button||s)?a<0&&(t.push(e),a=t.length-1):12&r&&(n=!0),a<0||(t[a]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(a,1))}});var ie={touchstart:1,touchmove:2,touchend:4,touchcancel:8},re="touchstart",oe="touchstart touchmove touchend touchcancel";function se(){this.evTarget=re,this.evWin=oe,this.started=!1,U.apply(this,arguments)}function ae(e,t){var n=k(e.touches),i=k(e.changedTouches);return 12&t&&(n=C(n.concat(i),"identifier",!0)),[n,i]}g(se,U,{handler:function(e){var t=ie[e.type];if(1===t&&(this.started=!0),this.started){var n=ae.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:D,srcEvent:e})}}});var le={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ce="touchstart touchmove touchend touchcancel";function ue(){this.evTarget=ce,this.targetIds={},U.apply(this,arguments)}function he(e,t){var n=k(e.touches),i=this.targetIds;if(3&t&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=k(e.changedTouches),a=[],l=this.target;if(o=n.filter((function(e){return w(e.target,l)})),1===t)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),12&t&&delete i[s[r].identifier],r++;return a.length?[C(o.concat(a),"identifier",!0),a]:void 0}g(ue,U,{handler:function(e){var t=le[e.type],n=he.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:D,srcEvent:e})}});function de(){U.apply(this,arguments);var e=y(this.handler,this);this.touch=new ue(this.manager,e),this.mouse=new Y(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function fe(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,pe.call(this,t)):12&e&&pe.call(this,t)}function pe(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)}),2500)}}function Ae(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(t-r.x),s=Math.abs(n-r.y);if(o<=25&&s<=25)return!0}return!1}g(de,U,{handler:function(e,t,n){var i=n.pointerType==D,r=n.pointerType==O;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)fe.call(this,t,n);else if(r&&Ae.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var me=P(a.style,"touchAction"),ge=me!==r,ye="compute",_e="auto",ve="manipulation",be="none",xe="pan-x",we="pan-y",Ee=function(){if(!ge)return!1;var e={},n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){e[i]=!n||t.CSS.supports("touch-action",i)})),e}();function Se(e,t){this.manager=e,this.set(t)}Se.prototype={set:function(e){e==ye&&(e=this.compute()),ge&&this.manager.element.style&&Ee[e]&&(this.manager.element.style[me]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return f(this.manager.recognizers,(function(t){_(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(E(e,be))return be;var t=E(e,xe),n=E(e,we);if(t&&n)return be;if(t||n)return t?xe:we;if(E(e,ve))return ve;return _e}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=E(i,be)&&!Ee.none,o=E(i,we)&&!Ee["pan-y"],s=E(i,xe)&&!Ee["pan-x"];if(r){var a=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(a&&l&&c)return}if(!s||!o)return r||o&&6&n||s&&n&B?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Te=32;function ke(e){this.options=o({},this.defaults,e||{}),this.id=M++,this.manager=null,this.options.enable=v(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ce(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Pe(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Me(e,t){var n=t.manager;return n?n.get(e):e}function Ie(){ke.apply(this,arguments)}function Le(){Ie.apply(this,arguments),this.pX=null,this.pY=null}function Re(){Ie.apply(this,arguments)}function ze(){ke.apply(this,arguments),this._timer=null,this._input=null}function De(){Ie.apply(this,arguments)}function Oe(){Ie.apply(this,arguments)}function Be(){ke.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Fe(e,t){return(t=t||{}).recognizers=v(t.recognizers,Fe.defaults.preset),new Ne(e,t)}ke.prototype={defaults:{},set:function(e){return o(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(d(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Me(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return d(e,"dropRecognizeWith",this)||(e=Me(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(d(e,"requireFailure",this))return this;var t=this.requireFail;return-1===T(t,e=Me(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(d(e,"dropRequireFailure",this))return this;e=Me(e,this);var t=T(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function i(n){t.manager.emit(n,e)}n<8&&i(t.options.event+Ce(n)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),n>=8&&i(t.options.event+Ce(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Te},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=o({},e);if(!_(this.options.enable,[this,t]))return this.reset(),void(this.state=Te);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},g(Ie,ke,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=6&t,r=this.attrTest(e);return i&&(8&n||!r)?16|t:i||r?4&n?8|t:2&t?4|t:2:Te}}),g(Le,Ie,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(we),e&B&&t.push(xe),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,r=e.direction,o=e.deltaX,s=e.deltaY;return r&t.direction||(6&t.direction?(r=0===o?1:o<0?2:4,n=o!=this.pX,i=Math.abs(e.deltaX)):(r=0===s?1:s<0?8:16,n=s!=this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&r&t.direction},attrTest:function(e){return Ie.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Pe(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),g(Re,Ie,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[be]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),g(ze,ke,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[_e]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!i||!n||12&e.eventType&&!r)this.reset();else if(1&e.eventType)this.reset(),this._timer=h((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return Te},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}}),g(De,Ie,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[be]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),g(Oe,Ie,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Le.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:n&B&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&c(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Pe(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),g(Be,ke,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ve]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||q(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=h((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Te},failTimeout:function(){return this._timer=h((function(){this.state=Te}),this.options.interval,this),Te},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Fe.VERSION="2.0.7",Fe.defaults={domEvents:!1,touchAction:ye,enable:!0,inputTarget:null,inputClass:null,preset:[[De,{enable:!1}],[Re,{enable:!1},["rotate"]],[Oe,{direction:6}],[Le,{direction:6},["swipe"]],[Be],[Be,{event:"doubletap",taps:2},["tap"]],[ze]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ne(e,t){var n;this.options=o({},Fe.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(R?ne:z?ue:L?de:Y))(n,j),this.touchAction=new Se(this,this.options.touchAction),Ue(this,!0),f(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Ue(e,t){var n,i=e.element;i.style&&(f(e.options.cssProps,(function(r,o){n=P(i.style,o),t?(e.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ne.prototype={set:function(e){return o(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var i=this.recognizers,r=t.curRecognizer;(!r||r&&8&r.state)&&(r=t.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&14&n.state&&(r=t.curRecognizer=n),o++}},get:function(e){if(e instanceof ke)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(d(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(d(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=T(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==r&&t!==r){var n=this.handlers;return f(S(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==r){var n=this.handlers;return f(S(e),(function(e){t?n[e]&&n[e].splice(T(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var i=n.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<i.length;)i[r](t),r++}},destroy:function(){this.element&&Ue(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(Fe,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Te,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:B,DIRECTION_ALL:30,Manager:Ne,Input:U,TouchAction:Se,TouchInput:ue,MouseInput:Y,PointerEventInput:ne,TouchMouseInput:de,SingleTouchInput:se,Recognizer:ke,AttrRecognizer:Ie,Tap:Be,Pan:Le,Swipe:Oe,Pinch:Re,Rotate:De,Press:ze,on:b,off:x,each:f,merge:m,extend:A,assign:o,inherit:g,bindFn:y,prefixed:P}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=Fe,e.exports?e.exports=Fe:t.Hammer=Fe}(window,document)}(Dn);var On=Dn.exports;const Bn={mousedown:1,mousemove:2,mouseup:4};!function(e){const t=e.prototype.handler;e.prototype.handler=function(e){const n=this.store;e.button>0&&"pointerdown"===e.type&&(function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}(n,(t=>t.pointerId===e.pointerId))||n.push(e)),t.call(this,e)}}(On.PointerEventInput),On.MouseInput.prototype.handler=function(e){let t=Bn[e.type];1&t&&e.button>=0&&(this.pressed=!0),2&t&&0===e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))};const Fn=On.Manager,Nn=On?[[On.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[On.Rotate,{enable:!1}],[On.Pinch,{enable:!1}],[On.Swipe,{enable:!1}],[On.Pan,{threshold:0,enable:!1}],[On.Press,{enable:!1}],[On.Tap,{event:"doubletap",taps:2,enable:!1}],[On.Tap,{event:"anytap",enable:!1}],[On.Tap,{enable:!1}]]:null,Un={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},jn={doubletap:["tap"]},Vn={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Gn={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Wn={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},$n={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},qn="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Zn="undefined"!=typeof window?window:global;let Hn=!1;try{const e={get passive(){return Hn=!0,!0}};Zn.addEventListener("test",e,e),Zn.removeEventListener("test",e,e)}catch(e){}const Qn=-1!==qn.indexOf("firefox"),{WHEEL_EVENTS:Xn}=Gn,Yn="wheel",Kn=4.000244140625;class Jn{constructor(e,t,n={}){this.element=e,this.callback=t,this.options=Object.assign({enable:!0},n),this.events=Xn.concat(n.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((t=>e.addEventListener(t,this.handleEvent,!!Hn&&{passive:!1})))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===Yn&&(this.options.enable=t)}handleEvent(e){if(!this.options.enable)return;let t=e.deltaY;Zn.WheelEvent&&(Qn&&e.deltaMode===Zn.WheelEvent.DOM_DELTA_PIXEL&&(t/=Zn.devicePixelRatio),e.deltaMode===Zn.WheelEvent.DOM_DELTA_LINE&&(t*=40));const n={x:e.clientX,y:e.clientY};0!==t&&t%Kn==0&&(t=Math.floor(t/Kn)),e.shiftKey&&t&&(t*=.25),this._onWheel(e,-t,n)}_onWheel(e,t,n){this.callback({type:Yn,center:n,delta:t,srcEvent:e,pointerType:"mouse",target:e.target})}}const{MOUSE_EVENTS:ei}=Gn,ti="pointermove",ni="pointerover",ii="pointerout",ri="pointerleave";class oi{constructor(e,t,n={}){this.element=e,this.callback=t,this.pressed=!1,this.options=Object.assign({enable:!0},n),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=ei.concat(n.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===ti&&(this.enableMoveEvent=t),e===ni&&(this.enableOverEvent=t),e===ii&&(this.enableOutEvent=t),e===ri&&(this.enableLeaveEvent=t)}handleEvent(e){this.handleOverEvent(e),this.handleOutEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this.callback({type:ni,srcEvent:e,pointerType:"mouse",target:e.target})}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this.callback({type:ii,srcEvent:e,pointerType:"mouse",target:e.target})}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this.callback({type:ri,srcEvent:e,pointerType:"mouse",target:e.target})}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this.callback({type:ti,srcEvent:e,pointerType:"mouse",target:e.target});break;case"mouseup":this.pressed=!1}}}const{KEY_EVENTS:si}=Gn,ai="keydown",li="keyup";class ci{constructor(e,t,n={}){this.element=e,this.callback=t,this.options=Object.assign({enable:!0},n),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=si.concat(n.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=n.tabIndex||0,e.style.outline="none",this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===ai&&(this.enableDownEvent=t),e===li&&(this.enableUpEvent=t)}handleEvent(e){const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:ai,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:li,srcEvent:e,key:e.key,target:e.target}))}}const ui="contextmenu";class hi{constructor(e,t,n={}){this.element=e,this.callback=t,this.options=Object.assign({enable:!0},n),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===ui&&(this.options.enable=t)}handleEvent(e){this.options.enable&&this.callback({type:ui,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const di={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};const fi={srcElement:"root",priority:0};class pi{constructor(e){this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,r=!1){const{handlers:o,handlersByElement:s}=this;n&&("object"!=typeof n||n.addEventListener)&&(n={srcElement:n}),n=n?Object.assign({},fi,n):fi;let a=s.get(n.srcElement);a||(a=[],s.set(n.srcElement,a));const l={type:e,handler:t,srcElement:n.srcElement,priority:n.priority};i&&(l.once=!0),r&&(l.passive=!0),o.push(l),this._active=this._active||!l.passive;let c=a.length-1;for(;c>=0&&!(a[c].priority>=l.priority);)c--;a.splice(c+1,0,l)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.type===e&&o.handler===t){n.splice(r,1);const e=i.get(o.srcElement);e.splice(e.indexOf(o),1),0===e.length&&i.delete(o.srcElement)}}this._active=n.some((e=>!e.passive))}handleEvent(e){if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const i=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},o=[];for(let s=0;s<n.length;s++){const{type:a,handler:l,once:c}=n[s];if(l(Object.assign({},e,{type:a,stopPropagation:i,stopImmediatePropagation:r})),c&&o.push(n[s]),t)break}for(let e=0;e<o.length;e++){const{type:t,handler:n}=o[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.element;return Object.assign({},e,function(e){const t=di[e.srcEvent.type];if(!t)return null;const{buttons:n,button:i,which:r}=e.srcEvent;let o=!1,s=!1,a=!1;return 4===t||2===t&&!Number.isFinite(n)?(o=1===r,s=2===r,a=3===r):2===t?(o=Boolean(1&n),s=Boolean(4&n),a=Boolean(2&n)):1===t&&(o=0===i,s=1===i,a=2===i),{leftButton:o,middleButton:s,rightButton:a}}(e),function(e,t){const{srcEvent:n}=e;if(!e.center&&!Number.isFinite(n.clientX))return null;const i=e.center||{x:n.clientX,y:n.clientY},r=t.getBoundingClientRect(),o=r.width/t.offsetWidth||1,s=r.height/t.offsetHeight||1;return{center:i,offsetCenter:{x:(i.x-r.left-t.clientLeft)/o,y:(i.y-r.top-t.clientTop)/s}}}(e,t),{handled:!1,rootElement:t})}}const Ai={events:null,recognizers:null,recognizerOptions:{},Manager:Fn,touchAction:"none",tabIndex:0};class mi{constructor(e=null,t={}){this.options=Object.assign({},Ai,t),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);const{events:n}=t;n&&this.on(n)}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,n=t.Manager;this.manager=new n(e,{touchAction:t.touchAction,recognizers:t.recognizers||Nn}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(Un).forEach((e=>{const t=this.manager.get(e);t&&Un[e].forEach((e=>{t.recognizeWith(e)}))}));for(const e in t.recognizerOptions){const n=this.manager.get(e);if(n){const i=t.recognizerOptions[e];delete i.enable,n.set(i)}}this.wheelInput=new Jn(e,this._onOtherEvent,{enable:!1}),this.moveInput=new oi(e,this._onOtherEvent,{enable:!1}),this.keyInput=new ci(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new hi(e,this._onOtherEvent,{enable:!1});for(const[e,t]of this.events)t.isEmpty()||(this._toggleRecognizer(t.recognizerName,!0),this.manager.on(e,t.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const r=jn[e];r&&!this.options.recognizers&&r.forEach((r=>{const o=n.get(r);t?(o.requireFailure(e),i.dropRequireFailure(r)):o.dropRequireFailure(e)}))}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,n,i,r){if("string"!=typeof e){n=t;for(const t in e)this._addEventHandler(t,e[t],n,i,r);return}const{manager:o,events:s}=this,a=$n[e]||e;let l=s.get(a);l||(l=new pi(this),s.set(a,l),l.recognizerName=Wn[a]||a,o&&o.on(a,l.handleEvent)),l.add(e,t,n,i,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const t in e)this._removeEventHandler(t,e[t]);return}const{events:n}=this,i=$n[e]||e,r=n.get(i);if(r&&(r.remove(e,t),r.isEmpty())){const{recognizerName:e}=r;let t=!1;for(const i of n.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_onBasicInput(e){const{srcEvent:t}=e,n=Vn[t.type];n&&this.manager.emit(n,e)}_onOtherEvent(e){this.manager.emit(e.type,e)}}function gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gi(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _i={transitionDuration:0},vi={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new kn,transitionInterruption:Pn},bi=300,xi=function(e){return 1-(1-e)*(1-e)},wi=["wheel"],Ei=["panstart","panmove","panend"],Si=["pinchstart","pinchmove","pinchend"],Ti=["tripanstart","tripanmove","tripanend"],ki=["doubletap"],Ci=["keydown"],Pi=function(){function e(){var t=this;ft(this,e),v(this,"events",[]),v(this,"scrollZoom",!0),v(this,"dragPan",!0),v(this,"dragRotate",!0),v(this,"doubleClickZoom",!0),v(this,"touchZoom",!0),v(this,"touchRotate",!1),v(this,"keyboard",!0),v(this,"_interactionState",{isDragging:!1}),v(this,"_events",{}),v(this,"_setInteractionState",(function(e){Object.assign(t._interactionState,e),t.onStateChange&&t.onStateChange(t._interactionState)})),v(this,"_onTransition",(function(e,n){t.onViewportChange(e,t._interactionState,n)})),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new zn({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return At(e,[{key:"handleEvent",value:function(e){this.mapState=this.getMapState();var t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!t&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"getCenter",value:function(e){var t=e.offsetCenter;return[t.x,t.y]}},{key:"isFunctionKeyPressed",value:function(e){var t=e.srcEvent;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}},{key:"blockEvents",value:function(e){var t=this,n=setTimeout((function(){t._eventStartBlocked===n&&(t._eventStartBlocked=null)}),e);this._eventStartBlocked=n}},{key:"updateViewport",value:function(e,t,n){var i=this.mapState instanceof Ut?this.mapState.getViewportProps():this.mapState,r=yi(yi({},e.getViewportProps()),t),o=Object.keys(r).some((function(e){return i[e]!==r[e]}));this._state=e.getState(),this._setInteractionState(n),o&&this.onViewportChange(r,this._interactionState,i)}},{key:"getMapState",value:function(e){return new Ut(yi(yi(yi({},this.mapStateProps),this._state),e))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(e){var t=e.onViewportChange,n=e.onStateChange,i=e.eventManager,r=void 0===i?this.eventManager:i,o=e.isInteractive,s=void 0===o||o,a=e.scrollZoom,l=void 0===a?this.scrollZoom:a,c=e.dragPan,u=void 0===c?this.dragPan:c,h=e.dragRotate,d=void 0===h?this.dragRotate:h,f=e.doubleClickZoom,p=void 0===f?this.doubleClickZoom:f,A=e.touchZoom,m=void 0===A?this.touchZoom:A,g=e.touchRotate,y=void 0===g?this.touchRotate:g,_=e.keyboard,v=void 0===_?this.keyboard:_;this.onViewportChange=t,this.onStateChange=n;var b=this.mapStateProps||{},x=b.height!==e.height||b.width!==e.width;this.mapStateProps=e,x&&(this.mapState=b,this.updateViewport(new Ut(e))),this._transitionManager.processViewportChange(e),this.eventManager!==r&&(this.eventManager=r,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(wi,s&&Boolean(l)),this.toggleEvents(Ei,s&&Boolean(u||d)),this.toggleEvents(Si,s&&Boolean(m||y)),this.toggleEvents(Ti,s&&Boolean(y)),this.toggleEvents(ki,s&&Boolean(p)),this.toggleEvents(Ci,s&&Boolean(v)),this.scrollZoom=l,this.dragPan=u,this.dragRotate=d,this.doubleClickZoom=p,this.touchZoom=m,this.touchRotate=y,this.keyboard=v}},{key:"toggleEvents",value:function(e,t){var n=this;this.eventManager&&e.forEach((function(e){n._events[e]!==t&&(n._events[e]=t,t?n.eventManager.on(e,n.handleEvent):n.eventManager.off(e,n.handleEvent))}))}},{key:"_onPanStart",value:function(e){var t=this.getCenter(e);this._panRotate=this.isFunctionKeyPressed(e)||e.rightButton;var n=this._panRotate?this.mapState.rotateStart({pos:t}):this.mapState.panStart({pos:t});return this.updateViewport(n,_i,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return!!this.isDragging()&&(this._panRotate?this._onPanRotate(e):this._onPanMove(e))}},{key:"_onPanEnd",value:function(e){return!!this.isDragging()&&(this._panRotate?this._onPanRotateEnd(e):this._onPanMoveEnd(e))}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var t=this.getCenter(e),n=this.mapState.pan({pos:t});return this.updateViewport(n,_i,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(e){if(this.dragPan){var t=this.dragPan.inertia,n=void 0===t?bi:t;if(n&&e.velocity){var i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.mapState.pan({pos:r}).panEnd();return this.updateViewport(o,yi(yi({},vi),{},{transitionDuration:n,transitionEasing:xi}),{isDragging:!1,isPanning:!0}),!0}}var s=this.mapState.panEnd();return this.updateViewport(s,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var t=this.getCenter(e),n=this.mapState.rotate({pos:t});return this.updateViewport(n,_i,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(e){if(this.dragRotate){var t=this.dragRotate.inertia,n=void 0===t?bi:t;if(n&&e.velocity){var i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.mapState.rotate({pos:r}).rotateEnd();return this.updateViewport(o,yi(yi({},vi),{},{transitionDuration:n,transitionEasing:xi}),{isDragging:!1,isRotating:!0}),!0}}var s=this.mapState.panEnd();return this.updateViewport(s,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;var t=this.scrollZoom,n=t.speed,i=void 0===n?.01:n,r=t.smooth,o=void 0!==r&&r;e.preventDefault();var s=this.getCenter(e),a=e.delta,l=2/(1+Math.exp(-Math.abs(a*i)));a<0&&0!==l&&(l=1/l);var c=this.mapState.zoom({pos:s,scale:l});return c.getViewportProps().zoom!==this.mapStateProps.zoom&&(this.updateViewport(c,yi(yi({},vi),{},{transitionInterpolator:new kn({around:s}),transitionDuration:o?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(e){var t=this.getCenter(e),n=this.mapState.zoomStart({pos:t}).rotateStart({pos:t});return this._startPinchRotation=e.rotation,this._lastPinchEvent=e,this.updateViewport(n,_i,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.isDragging())return!1;if(!this.touchZoom&&!this.touchRotate)return!1;var t=this.mapState;if(this.touchZoom){var n=e.scale,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){var r=e.rotation;t=t.rotate({deltaAngleX:this._startPinchRotation-r})}return this.updateViewport(t,_i,{isDragging:!0,isPanning:Boolean(this.touchZoom),isZooming:Boolean(this.touchZoom),isRotating:Boolean(this.touchRotate)}),this._lastPinchEvent=e,!0}},{key:"_onPinchEnd",value:function(e){if(!this.isDragging())return!1;if(this.touchZoom){var t=this.touchZoom.inertia,n=void 0===t?bi:t,i=this._lastPinchEvent;if(n&&i&&e.scale!==i.scale){var r=this.getCenter(e),o=this.mapState.rotateEnd(),s=Math.log2(e.scale),a=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,s+a*n/2);return o=o.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(o,yi(yi({},vi),{},{transitionInterpolator:new kn({around:r}),transitionDuration:n,transitionEasing:xi}),{isDragging:!1,isPanning:Boolean(this.touchZoom),isZooming:Boolean(this.touchZoom),isRotating:!1}),this.blockEvents(n),!0}}var c=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(c,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(e){var t=this.getCenter(e),n=this.mapState.rotateStart({pos:t});return this.updateViewport(n,_i,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(e){if(!this.isDragging())return!1;if(!this.touchRotate)return!1;var t=this.getCenter(e);t[0]-=e.deltaX;var n=this.mapState.rotate({pos:t});return this.updateViewport(n,_i,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(e){if(!this.isDragging())return!1;if(this.touchRotate){var t=this.touchRotate.inertia,n=void 0===t?bi:t;if(n&&e.velocityY){var i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],o=this.mapState.rotate({pos:r});return this.updateViewport(o,yi(yi({},vi),{},{transitionDuration:n,transitionEasing:xi}),{isDragging:!1,isRotating:!0}),this.blockEvents(n),!1}}var s=this.mapState.rotateEnd();return this.updateViewport(s,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var t=this.getCenter(e),n=this.isFunctionKeyPressed(e),i=this.mapState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,Object.assign({},vi,{transitionInterpolator:new kn({around:t})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var t,n=this.isFunctionKeyPressed(e),i=this.keyboard,r=i.zoomSpeed,o=void 0===r?2:r,s=i.moveSpeed,a=void 0===s?100:s,l=i.rotateSpeedX,c=void 0===l?15:l,u=i.rotateSpeedY,h=void 0===u?10:u,d=this.mapStateProps;switch(e.srcEvent.keyCode){case 189:t=n?this.getMapState({zoom:d.zoom-Math.log2(o)-1}):this.getMapState({zoom:d.zoom-Math.log2(o)});break;case 187:t=n?this.getMapState({zoom:d.zoom+Math.log2(o)+1}):this.getMapState({zoom:d.zoom+Math.log2(o)});break;case 37:t=n?this.getMapState({bearing:d.bearing-c}):this.mapState.pan({pos:[a,0],startPos:[0,0]});break;case 39:t=n?this.getMapState({bearing:d.bearing+c}):this.mapState.pan({pos:[-a,0],startPos:[0,0]});break;case 38:t=n?this.getMapState({pitch:d.pitch+h}):this.mapState.pan({pos:[0,a],startPos:[0,0]});break;case 40:t=n?this.getMapState({pitch:d.pitch-h}):this.mapState.pan({pos:[0,-a],startPos:[0,0]});break;default:return!1}return this.updateViewport(t,vi)}}]),e}();function Mi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ii(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mi(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Li=Object.assign({},nn.propTypes,{maxZoom:b.exports.number,minZoom:b.exports.number,maxPitch:b.exports.number,minPitch:b.exports.number,onViewStateChange:b.exports.func,onViewportChange:b.exports.func,onInteractionStateChange:b.exports.func,transitionDuration:b.exports.oneOfType([b.exports.number,b.exports.string]),transitionInterpolator:b.exports.object,transitionInterruption:b.exports.number,transitionEasing:b.exports.func,onTransitionStart:b.exports.func,onTransitionInterrupt:b.exports.func,onTransitionEnd:b.exports.func,scrollZoom:b.exports.oneOfType([b.exports.bool,b.exports.object]),dragPan:b.exports.oneOfType([b.exports.bool,b.exports.object]),dragRotate:b.exports.oneOfType([b.exports.bool,b.exports.object]),doubleClickZoom:b.exports.bool,touchZoom:b.exports.oneOfType([b.exports.bool,b.exports.object]),touchRotate:b.exports.oneOfType([b.exports.bool,b.exports.object]),keyboard:b.exports.oneOfType([b.exports.bool,b.exports.object]),onHover:b.exports.func,onClick:b.exports.func,onDblClick:b.exports.func,onContextMenu:b.exports.func,onMouseDown:b.exports.func,onMouseMove:b.exports.func,onMouseUp:b.exports.func,onTouchStart:b.exports.func,onTouchMove:b.exports.func,onTouchEnd:b.exports.func,onMouseEnter:b.exports.func,onMouseLeave:b.exports.func,onMouseOut:b.exports.func,onWheel:b.exports.func,touchAction:b.exports.string,eventRecognizerOptions:b.exports.object,clickRadius:b.exports.number,interactiveLayerIds:b.exports.array,getCursor:b.exports.func,controller:b.exports.instanceOf(Pi)}),Ri=Object.assign({},nn.defaultProps,Ot,zn.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:function(e){var t=e.isDragging,n=e.isHovering;return t?"grabbing":n?"pointer":"grab"}});function zi(e){if(e.lngLat||!e.offsetCenter)return e;var t=e.offsetCenter,n=t.x,i=t.y;if(!Number.isFinite(n)||!Number.isFinite(i))return e;var r=[n,i];e.point=r;var o=this.viewport,s=o.unproject(r,{targetZ:o.meterOffset[2]});return e.lngLat=[s[0],s[1]],e}function Di(e){var t=this.map;if(!t||!e)return null;var n={},i=this.props.clickRadius;this.props.interactiveLayerIds&&(n.layers=this.props.interactiveLayerIds);try{return t.queryRenderedFeatures(i?[[e[0]-i,e[1]+i],[e[0]+i,e[1]-i]]:e,n)}catch(e){return null}}function Oi(e,t){var n=this.props[e];n&&n(zi.call(this,t))}function Bi(e){Oi.call(this,"touch"===e.pointerType?"onTouchStart":"onMouseDown",e)}function Fi(e){Oi.call(this,"touch"===e.pointerType?"onTouchEnd":"onMouseUp",e)}function Ni(e){if(Oi.call(this,"touch"===e.pointerType?"onTouchMove":"onMouseMove",e),!this.state.isDragging){var t,n=this.props,i=n.onHover,r=n.interactiveLayerIds;e=zi.call(this,e),(r||i)&&(t=Di.call(this,e.point));var o=Boolean(r&&t&&t.length>0),s=o&&!this.state.isHovering,a=!o&&this.state.isHovering;(i||s)&&(e.features=t,i&&i(e)),s&&Oi.call(this,"onMouseEnter",e),a&&Oi.call(this,"onMouseLeave",e),(s||a)&&this.setState({isHovering:o})}}function Ui(e){var t=this.props,n=t.onClick,i=t.onNativeClick,r=t.onDblClick,o=t.doubleClickZoom,s=[],a=r||o;switch(e.type){case"anyclick":s.push(i),a||s.push(n);break;case"click":a&&s.push(n)}(s=s.filter(Boolean)).length&&((e=zi.call(this,e)).features=Di.call(this,e.point),s.forEach((function(t){return t(e)})))}var ji=t.exports.forwardRef((function(e,n){var i=t.exports.useContext(Wt),r=t.exports.useMemo((function(){return e.controller||new Pi}),[]),o=t.exports.useMemo((function(){return new mi(null,{touchAction:e.touchAction,recognizerOptions:e.eventRecognizerOptions})}),[]),s=t.exports.useRef(null),a=t.exports.useRef(null),l=t.exports.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}).current;l.props=e,l.map=a.current&&a.current.getMap(),l.setState=function(t){l.state=Ii(Ii({},l.state),t),s.current.style.cursor=e.getCursor(l.state)};var c,u,h=!0,d=function(e,t,n){if(h)c=[e,t,n];else{var i=l.props,r=i.onViewStateChange,o=i.onViewportChange;Object.defineProperty(e,"position",{get:function(){return[0,0,Zt(l.map,e)]}}),r&&r({viewState:e,interactionState:t,oldViewState:n}),o&&o(e,t,n)}};t.exports.useImperativeHandle(n,(function(){return function(e){return{getMap:e.current&&e.current.getMap,queryRenderedFeatures:e.current&&e.current.queryRenderedFeatures}}(a)}),[]);var f=t.exports.useMemo((function(){return Ii(Ii({},i),{},{eventManager:o,container:i.container||s.current})}),[i,s.current]);f.onViewportChange=d,f.viewport=i.viewport||Yt(l),l.viewport=f.viewport;var p=function(e){var t=e.isDragging,n=void 0!==t&&t;if(n!==l.state.isDragging&&l.setState({isDragging:n}),h)u=e;else{var i=l.props.onInteractionStateChange;i&&i(e)}},A=function(){l.width&&l.height&&r.setOptions(Ii(Ii(Ii({},l.props),l.props.viewState),{},{isInteractive:Boolean(l.props.onViewStateChange||l.props.onViewportChange),onViewportChange:d,onStateChange:p,eventManager:o,width:l.width,height:l.height}))};t.exports.useEffect((function(){return o.setElement(s.current),o.on({pointerdown:Bi.bind(l),pointermove:Ni.bind(l),pointerup:Fi.bind(l),pointerleave:Oi.bind(l,"onMouseOut"),click:Ui.bind(l),anyclick:Ui.bind(l),dblclick:Oi.bind(l,"onDblClick"),wheel:Oi.bind(l,"onWheel"),contextmenu:Oi.bind(l,"onContextMenu")}),function(){o.destroy()}}),[]),qt((function(){c&&d.apply(void 0,_(c)),u&&p(u)})),A();var g=e.width,y=e.height,v=e.style,b=e.getCursor,x=t.exports.useMemo((function(){return Ii(Ii({position:"relative"},v),{},{width:g,height:y,cursor:b(l.state)})}),[v,g,y,b,l.state]);return c&&l._child||(l._child=t.exports.createElement($t,{value:f},t.exports.createElement("div",{key:"event-canvas",ref:s,style:x},t.exports.createElement(nn,m({},e,{width:"100%",height:"100%",style:null,onResize:function(e){var t=e.width,n=e.height;l.width=t,l.height=n,A(),l.props.onResize({width:t,height:n})},ref:a}))))),h=!1,l._child}));ji.supported=nn.supported,ji.propTypes=Li,ji.defaultProps=Ri,b.exports.string.isRequired,b.exports.string;b.exports.oneOf(["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade","sky"]).isRequired,b.exports.string,b.exports.string,b.exports.string;var Vi={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},Gi={captureScroll:b.exports.bool,captureDrag:b.exports.bool,captureClick:b.exports.bool,captureDoubleClick:b.exports.bool,capturePointerMove:b.exports.bool};function Wi(e){var t=e.containerRef.current,n=e.context.eventManager;if(t&&n){var i={wheel:function(t){var n=e.props;n.captureScroll&&t.stopPropagation(),n.onScroll&&n.onScroll(t,e)},panstart:function(t){var n=e.props;n.captureDrag&&t.stopPropagation(),n.onDragStart&&n.onDragStart(t,e)},anyclick:function(t){var n=e.props;n.captureClick&&t.stopPropagation(),n.onNativeClick&&n.onNativeClick(t,e)},click:function(t){var n=e.props;n.captureClick&&t.stopPropagation(),n.onClick&&n.onClick(t,e)},dblclick:function(t){var n=e.props;n.captureDoubleClick&&t.stopPropagation(),n.onDoubleClick&&n.onDoubleClick(t,e)},pointermove:function(t){var n=e.props;n.capturePointerMove&&t.stopPropagation(),n.onPointerMove&&n.onPointerMove(t,e)}};return n.watch(i,t),function(){n.off(i)}}}function $i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=dn(e);if(t){var r=dn(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return hn(this,n)}}function qi(e){var n=e.instance,i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.exports.useContext(Wt),i=t.exports.useRef(null),r=t.exports.useRef({props:e,state:{},context:n,containerRef:i}).current;return r.props=e,r.context=n,t.exports.useEffect((function(){return Wi(r)}),[n.eventManager]),r}(e),r=i.context,o=i.containerRef;return n._context=r,n._containerRef=o,n._render()}var Zi=function(e){cn(i,e);var n=$i(i);function i(){var e;ft(this,i);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return v(an(e=n.call.apply(n,[this].concat(o))),"_context",{}),v(an(e),"_containerRef",t.exports.createRef()),v(an(e),"_onScroll",(function(e){})),v(an(e),"_onDragStart",(function(e){})),v(an(e),"_onDblClick",(function(e){})),v(an(e),"_onClick",(function(e){})),v(an(e),"_onPointerMove",(function(e){})),e}return At(i,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return t.exports.createElement(qi,m({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),i}(t.exports.PureComponent);v(Zi,"propTypes",Gi),v(Zi,"defaultProps",Vi);var Hi=Object.assign({},Gi,{draggable:b.exports.bool,onDrag:b.exports.func,onDragEnd:b.exports.func,onDragStart:b.exports.func,offsetLeft:b.exports.number,offsetTop:b.exports.number}),Qi=Object.assign({},Vi,{draggable:!1,offsetLeft:0,offsetTop:0});Object.assign({},Hi,{className:b.exports.string,longitude:b.exports.number.isRequired,latitude:b.exports.number.isRequired}),Object.assign({},Qi,{className:""});function Xi(e,t){if(!e)throw new Error(t||"loader assertion failed.")}Object.assign({},Gi,{className:b.exports.string,longitude:b.exports.number.isRequired,latitude:b.exports.number.isRequired,altitude:b.exports.number,offsetLeft:b.exports.number,offsetTop:b.exports.number,tipSize:b.exports.number,closeButton:b.exports.bool,closeOnClick:b.exports.bool,anchor:b.exports.oneOf(Object.keys({top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}})),dynamicPosition:b.exports.bool,sortByDepth:b.exports.bool,onClose:b.exports.func}),Object.assign({},Vi,{className:"",offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}}),Object.assign({},Gi,{toggleLabel:b.exports.string,className:b.exports.string,style:b.exports.object,compact:b.exports.bool,customAttribution:b.exports.oneOfType([b.exports.string,b.exports.arrayOf(b.exports.string)])}),Object.assign({},Vi,{className:"",toggleLabel:"Toggle Attribution"}),Object.assign({},Gi,{className:b.exports.string,style:b.exports.object,container:b.exports.object,label:b.exports.string}),Object.assign({},Vi,{className:"",container:null,label:"Toggle fullscreen"}),Object.assign({},Gi,{className:b.exports.string,style:b.exports.object,label:b.exports.string,disabledLabel:b.exports.string,auto:b.exports.bool,positionOptions:b.exports.object,fitBoundsOptions:b.exports.object,trackUserLocation:b.exports.bool,showUserLocation:b.exports.bool,showAccuracyCircle:b.exports.bool,onViewStateChange:b.exports.func,onViewportChange:b.exports.func,onGeolocate:b.exports.func}),Object.assign({},Vi,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showAccuracyCircle:!0,onGeolocate:function(){}}),Object.assign({},Gi,{className:b.exports.string,style:b.exports.object,onViewStateChange:b.exports.func,onViewportChange:b.exports.func,showCompass:b.exports.bool,showZoom:b.exports.bool,zoomInLabel:b.exports.string,zoomOutLabel:b.exports.string,compassLabel:b.exports.string}),Object.assign({},Vi,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),Object.assign({},Gi,{className:b.exports.string,style:b.exports.object,maxWidth:b.exports.number,unit:b.exports.oneOf(["imperial","metric","nautical"])}),Object.assign({},Vi,{className:"",maxWidth:100,unit:"metric"}),Object.assign({},Gi,{redraw:b.exports.func.isRequired}),Object.assign({},Gi,{redraw:b.exports.func.isRequired,style:b.exports.object}),Object.assign({},Gi,{redraw:b.exports.func.isRequired,style:b.exports.object}),Ct&&Ct.setRTLTextPlugin;const Yi={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Ki=Yi.global||Yi.self||Yi.window||{},Ji="object"!=typeof process||"[object process]"!==String(process)||process.browser,er="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);er&&parseFloat(er[1]);function tr(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}"object"!=typeof process||"[object process]"!==String(process)||process.browser;const nr="undefined"!=typeof window&&void 0!==window.orientation,ir="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);ir&&parseFloat(ir[1]);class rr{constructor(e,t){v(this,"name",void 0),v(this,"workerThread",void 0),v(this,"isRunning",void 0),v(this,"result",void 0),v(this,"_resolve",void 0),v(this,"_reject",void 0),this.name=e,this.workerThread=t,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){tr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){tr(this.isRunning),this.isRunning=!1,this._reject(e)}}const or=new Map;function sr(e){tr(e.source&&!e.url||!e.source&&e.url);let t=or.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return ar((t=e,`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var t}(e.url),or.set(e.url,t)),e.source&&(t=ar(e.source),or.set(e.source,t))),tr(t),t}function ar(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function lr(e,t=!0,n){const i=n||new Set;if(e){if(cr(e))i.add(e);else if(cr(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const n in e)lr(e[n],t,i)}else;return void 0===n?Array.from(i):[]}function cr(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const ur=()=>{};class hr{static isSupported(){return"undefined"!=typeof Worker}constructor(e){v(this,"name",void 0),v(this,"source",void 0),v(this,"url",void 0),v(this,"terminated",!1),v(this,"worker",void 0),v(this,"onMessage",void 0),v(this,"onError",void 0),v(this,"_loadableURL","");const{name:t,source:n,url:i}=e;tr(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=ur,this.onError=e=>console.log(e),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=ur,this.onError=ur,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||lr(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=sr({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}}class dr{constructor(e){v(this,"name","unnamed"),v(this,"source",void 0),v(this,"url",void 0),v(this,"maxConcurrency",1),v(this,"maxMobileConcurrency",1),v(this,"onDebug",(()=>{})),v(this,"reuseWorkers",!0),v(this,"props",{}),v(this,"jobQueue",[]),v(this,"idleQueue",[]),v(this,"count",0),v(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=((e,t,n)=>e.done(n)),n=((e,t)=>e.error(t))){const i=new Promise((i=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new rr(t.name,e);e.onMessage=e=>t.onMessage(n,e.type,e.payload),e.onError=e=>t.onError(n,e),t.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new hr({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return nr?this.maxMobileConcurrency:this.maxConcurrency}}const fr={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class pr{static isSupported(){return hr.isSupported()}static getWorkerFarm(e={}){return pr._workerFarm=pr._workerFarm||new pr({}),pr._workerFarm.setProps(e),pr._workerFarm}constructor(e){v(this,"props",void 0),v(this,"workerPools",new Map),this.props={...fr},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let r=this.workerPools.get(t);return r||(r=new dr({name:t,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}v(pr,"_workerFarm",void 0);async function Ar(e,t,n,i,r){const o=e.id,s=function(e,t={}){const n=t[e.id]||{},i=`${e.id}-worker.js`;let r=n.workerUrl;if("test"===t._workerType&&(r=`modules/${e.module}/dist/${i}`),!r){let t=e.version;"latest"===t&&(t="latest");const n=t?`@${t}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${i}`}return tr(r),r}(e,n),a=pr.getWorkerFarm(n).getWorkerPool({name:o,url:s});n=JSON.parse(JSON.stringify(n));const l=await a.startJob("process-on-worker",mr.bind(null,r));l.postMessage("process",{input:t,options:n});const c=await l.result;return await c.result}async function mr(e,t,n,i){switch(n){case"done":t.done(i);break;case"error":t.error(i.error);break;case"process":const{id:r,input:o,options:s}=i;try{const n=await e(o,s);t.postMessage("done",{id:r,result:n})}catch(e){const n=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:n})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function gr(e){var t;if((t=e)&&"object"==typeof t&&t.isBuffer&&(e=e),e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}async function yr(e){const t=[];for await(const n of e)t.push(n);return function(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),n=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(n);let r=0;for(const e of t)i.set(e,r),r+=e.byteLength;return i.buffer}(...t)}function _r(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class vr{constructor(e,t){this.name=e,this.type=t,this.sampleSize=1,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=_r(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(_r()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class br{constructor({id:e,stats:t}){this.id=e,this.stats={},this._initializeStats(t),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}_initializeStats(e=[]){e.forEach((e=>this._getOrCreate(e)))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:n}=e;return this.stats[t]||(this.stats[t]=e instanceof vr?e:new vr(t,n)),this.stats[t]}}const xr={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class wr{constructor(e={}){v(this,"props",void 0),v(this,"stats",void 0),v(this,"activeRequestCount",0),v(this,"requestQueue",[]),v(this,"requestMap",new Map),v(this,"deferredUpdate",null),this.props={...xr,...e},this.stats=new br({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e,t=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise((e=>(n.resolve=e,n)));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const r=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){const e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort(((e,t)=>e.priority-t.priority))}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}const Er={};const Sr=e=>"function"==typeof e,Tr=e=>null!==e&&"object"==typeof e,kr=e=>Tr(e)&&e.constructor==={}.constructor,Cr=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Pr=e=>"undefined"!=typeof Blob&&e instanceof Blob,Mr=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Tr(e)&&Sr(e.tee)&&Sr(e.cancel)&&Sr(e.getReader))(e)||(e=>Tr(e)&&Sr(e.read)&&Sr(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),Ir=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Lr=/^([-\w.]+\/[-\w.+]+)/;function Rr(e){const t=Lr.exec(e);return t?t[1]:e}function zr(e){const t=Ir.exec(e);return t?t[1]:""}const Dr=/\?.*/;function Or(e){if(Cr(e)){const t=Br(e.url||"");return{url:t,type:Rr(e.headers.get("content-type")||"")||zr(t)}}return Pr(e)?{url:Br(e.name||""),type:e.type||""}:"string"==typeof e?{url:Br(e),type:zr(e)}:{url:"",type:""}}function Br(e){return e.replace(Dr,"")}async function Fr(e){if(Cr(e))return e;const t={},n=function(e){return Cr(e)?e.headers["content-length"]||-1:Pr(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const{url:i,type:r}=Or(e);r&&(t["content-type"]=r);const o=await async function(e){const t=5;if("string"==typeof e)return`data:,${e.slice(0,t)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const n=new FileReader;n.onload=t=>{var n;return e(null==t||null===(n=t.target)||void 0===n?void 0:n.result)},n.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){return`data:base64,${function(e){let t="";const n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return btoa(t)}(e.slice(0,t))}`}return null}(e);o&&(t["x-first-bytes"]=o),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:i}),s}async function Nr(e,t){if("string"==typeof e){e=function(e){for(const t in Er)if(e.startsWith(t)){const n=Er[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);let n=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(n=t.fetch),await fetch(e,n)}return await Fr(e)}function Ur(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}function jr(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||Ur()}const Vr={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},Gr=Vr.window||Vr.self||Vr.global,Wr=Vr.process||{},$r="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",qr=jr();class Zr{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}(n),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Hr(e,t,n,i=600){const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(n=Math.min(n,i/e.width));const o=e.width*n,s=e.height*n,a=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(r,");"),"background-size:".concat(o,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}const Qr={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function Xr(e){return"string"==typeof e?Qr[e.toUpperCase()]||Qr.WHITE:e}function Yr(e,t){if(!e)throw new Error(t||"Assertion failed")}function Kr(){let e;if(qr&&Gr.performance)e=Gr.performance.now();else if(Wr.hrtime){const t=Wr.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const Jr={debug:qr&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},eo={enabled:!0,level:0};function to(){}const no={},io={once:!0};function ro(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}class oo{constructor({id:e}={id:""}){this.id=e,this.VERSION=$r,this._startTs=Kr(),this._deltaTs=Kr(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new Zr("__probe-".concat(this.id,"__"),eo),this.userData={},this.timeStamp("".concat(this.id," started")),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n);for(const n of i)"function"==typeof e[n]&&(t.find((e=>n===e))||(e[n]=e[n].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Kr()-this._startTs).toPrecision(10))}getDelta(){return Number((Kr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}assert(e,t){Yr(e,t)}warn(e){return this._getLogFunction(0,e,Jr.warn,arguments,io)}error(e){return this._getLogFunction(0,e,Jr.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Jr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Jr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Jr.debug||Jr.info,arguments,io)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||to,n&&[n],{tag:ro(t)}):to}image({logLevel:e,priority:t,image:n,message:i="",scale:r=1}){return this._shouldLog(e||t)?qr?function({image:e,message:t="",scale:n=1}){if("string"==typeof e){const i=new Image;return i.onload=()=>{const e=Hr(i,t,n);console.log(...e)},i.src=e,to}const i=e.nodeName||"";if("img"===i.toLowerCase())return console.log(...Hr(e,t,n)),to;if("canvas"===i.toLowerCase()){const i=new Image;return i.onload=()=>console.log(...Hr(i,t,n)),i.src=e.toDataURL(),to}return to}({image:n,message:i,scale:r}):function({image:e,message:t="",scale:n=1}){let i=null;try{i=module.require("asciify-image")}catch(e){}if(i)return()=>i(e,{fit:"box",width:"".concat(Math.round(80*n),"%")}).then((e=>console.log(e)));return to}({image:n,message:i,scale:r}):to}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||to)}group(e,t,n={collapsed:!1}){n=ao({logLevel:e,message:t,opts:n});const{collapsed:i}=n;return n.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||to)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=so(e)}_getLogFunction(e,t,n,i=[],r){if(this._shouldLog(e)){r=ao({logLevel:e,message:t,args:i,opts:r}),Yr(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Kr();const o=r.tag||r.message;if(r.once){if(no[o])return to;no[o]=Kr()}return t=function(e,t,n){if("string"==typeof t){const s=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(n.total)):"";t=n.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),i=t,r=n.color,o=n.background,qr||"string"!=typeof i||(r&&(r=Xr(r),i="[".concat(r,"m").concat(i,"[39m")),o&&(r=Xr(o),i="[".concat(o+10,"m").concat(i,"[49m"))),t=i}var i,r,o;return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return to}}function so(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Yr(Number.isFinite(t)&&t>=0),t}function ao(e){const{logLevel:t,message:n}=e;e.logLevel=so(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(e.args=i,typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return Yr("string"===r||"object"===r),Object.assign(e,e.opts)}oo.VERSION=$r;const lo=new oo({id:"loaders.gl"});class co{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const uo={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){v(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},ho={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function fo(){Ki.loaders=Ki.loaders||{};const{loaders:e}=Ki;return e._state=e._state||{},e._state}const po=()=>{const e=fo();return e.globalOptions=e.globalOptions||{...uo},e.globalOptions};function Ao(e,t,n,i){return n=n||[],function(e,t){go(e,null,uo,ho,t);for(const n of t){const i=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};go(i,n.id,r,o,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const i={...e.options||{}};(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(i,n),null===i.log&&(i.log=new co);return _o(i,po()),_o(i,t),i}(t,e,i)}function mo(e,t){const n=po(),i=e||n;return"function"==typeof i.fetch?i.fetch:Tr(i.fetch)?e=>Nr(e,i):null!=t&&t.fetch?null==t?void 0:t.fetch:Nr}function go(e,t,n,i,r){const o=t||"Top level",s=t?`${t}.`:"";for(const a in e){const l=!t&&Tr(e[a]),c="baseUri"===a&&!t,u="workerUrl"===a&&t;if(!(a in n)&&!c&&!u)if(a in i)lo.warn(`${o} loader option '${s}${a}' no longer supported, use '${i[a]}'`)();else if(!l){const e=yo(a,r);lo.warn(`${o} loader option '${s}${a}' not recognized. ${e}`)()}}}function yo(e,t){const n=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return`Did you mean '${r.id}.${t}'?`;const o=t.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||`Did you mean '${r.id}.${t}'?`)}return i}function _o(e,t){for(const n in t)if(n in t){const i=t[n];kr(i)&&kr(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function vo(e){var t;if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions)}function bo(e){var t,n;let i;return Xi(e,"null loader"),Xi(vo(e),"invalid loader"),Array.isArray(e)&&(i=e[1],e=e[0],e={...e,options:{...e.options,...i}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(n=e)&&void 0!==n&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const xo=()=>{const e=fo();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};const wo=/\.([^.]+)$/;function Eo(e,t=[],n,i){if(!So(e))return null;if(t&&!Array.isArray(t))return bo(t);let r=[];t&&(r=r.concat(t)),null!=n&&n.ignoreRegisteredLoaders||r.push(...xo()),function(e){for(const t of e)bo(t)}(r);const o=function(e,t,n,i){const{url:r,type:o}=Or(e),s=r||(null==i?void 0:i.url);let a=null;null!=n&&n.mimeType&&(a=ko(t,null==n?void 0:n.mimeType));return a=a||function(e,t){const n=t&&wo.exec(t),i=n&&n[1];return i?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,i):null}(t,s),a=a||ko(t,o),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(Co(t,n))return n}else if(ArrayBuffer.isView(t)){if(Po(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(Po(t,0,n))return n}return null}(t,e),a=a||ko(t,null==n?void 0:n.fallbackMimeType),a}(e,r,n,i);if(!(o||null!=n&&n.nothrow))throw new Error(To(e));return o}function So(e){return!(e instanceof Response&&204===e.status)}function To(e){const{url:t,type:n}=Or(e);let i="No valid loader found";return e&&(i+=` data: "${function(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Mo(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return Mo(e,0,t)}return""}(e)}", contentType: "${n}"`),t&&(i+=` url: ${t}`),i}function ko(e,t){for(const n of e){if(n.mimeTypes&&n.mimeTypes.includes(t))return n;if(t===`application/x.${n.id}`)return n}return null}function Co(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function Po(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((i=>function(e,t,n,i){if(i instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==r[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e,n);case"string":return i===Mo(e,t,i.length);default:return!1}}(e,t,n,i)))}function Mo(e,t,n){if(e.byteLength<t+n)return"";const i=new DataView(e);let r="";for(let e=0;e<n;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}const Io=262144;function Lo(e,t){return Ji?async function*(e,t){const n=e.getReader();let i;try{for(;;){const e=i||n.read();null!=t&&t._streamReadAhead&&(i=n.read());const{done:r,value:o}=await e;if(r)return;yield gr(o)}}catch(e){n.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield gr(t)}(e)}function Ro(e,t){if("string"==typeof e)return function*(e,t){const n=(null==t?void 0:t.chunkSize)||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,n),o=e.slice(i,i+t);i+=t,yield r.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=Io}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,n),r=new ArrayBuffer(t),o=new Uint8Array(e,i,t);new Uint8Array(r).set(o),i+=t,yield r}}(e,t);if(Pr(e))return async function*(e,t){const n=(null==t?void 0:t.chunkSize)||1048576;let i=0;for(;i<e.size;){const t=i+n,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(Mr(e))return Lo(e,t);if(Cr(e)){return Lo(e.body,t)}throw new Error("makeIterator")}const zo="Cannot convert supplied data type";async function Do(e,t,n){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t,n){if(t.text&&"string"==typeof e)return e;var i;if((i=e)&&"object"==typeof i&&i.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(zo)}(e,t);if(Pr(e)&&(e=await Fr(e)),Cr(e)){const n=e;return await async function(e){if(!e.ok){const t=await async function(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{const n=e.headers.get("Content-Type");let i=e.statusText;n.includes("application/json")&&(i+=` ${await e.text()}`),t+=i,t=t.length>60?`${t.slice(60)}...`:t}catch(e){}return t}(e);throw new Error(t)}}(n),t.binary?await n.arrayBuffer():await n.text()}if(Mr(e)&&(e=Ro(e,n)),(r=e)&&"function"==typeof r[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return yr(e);var r;throw new Error(zo)}async function Oo(e,t,n,i){tr(!i||"object"==typeof i),!t||Array.isArray(t)||vo(t)||(i=void 0,n=t,t=void 0),e=await e,n=n||{};const{url:r}=Or(e),o=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:null}(t,i),s=await async function(e,t=[],n,i){if(!So(e))return null;let r=Eo(e,t,{...n,nothrow:!0},i);if(r)return r;if(Pr(e)&&(r=Eo(e=await e.slice(0,10).arrayBuffer(),t,n,i)),!(r||null!=n&&n.nothrow))throw new Error(To(e));return r}(e,o,n);return s?(i=function(e,t,n=null){if(n)return n;const i={fetch:mo(t,e),...e};return Array.isArray(i.loaders)||(i.loaders=null),i}({url:r,parse:Oo,loaders:o},n=Ao(n,s,o,r),i),await async function(e,t,n,i){if(function(e,t="3.0.12"){tr(e,"no worker provided");const n=e.version}(e),t=await Do(t,e,n),e.parseTextSync&&"string"==typeof t)return n.dataType="text",e.parseTextSync(t,n,i,e);if(function(e,t){return!!pr.isSupported()&&e.worker&&(null==t?void 0:t.worker)}(e,n))return await Ar(e,t,n,0,Oo);if(e.parseText&&"string"==typeof t)return await e.parseText(t,n,i,e);if(e.parse)return await e.parse(t,n,i,e);throw tr(!e.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(s,e,n,i)):null}async function Bo(e,t,n,i){Array.isArray(t)||vo(t)||(n=t,t=void 0);const r=mo(n);let o=e;return"string"==typeof e&&(o=await r(e)),Pr(e)&&(o=await r(e)),await Oo(o,t,n)}function Fo(e,t){if(!e)throw new Error(t)}const No={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Uo=No.global||No.self||No.window,jo="object"!=typeof process||"[object process]"!==String(process)||process.browser,Vo="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Vo&&parseFloat(Vo[1]);const{_parseImageNode:Go}=Uo,Wo="undefined"!=typeof Image,$o="undefined"!=typeof ImageBitmap,qo=Boolean(Go),Zo=!!jo||qo;function Ho(e){const t=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!t)throw new Error("Not an image");return t}const Qo=/^data:image\/svg\+xml/,Xo=/\.svg((\?|#).*)?$/;function Yo(e){return e&&(Qo.test(e)||Xo.test(e))}function Ko(e,t){if(Yo(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Jo(e,t,n){const i=function(e,t){if(Yo(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return Ko(e,t)}(e,n),r=self.URL||self.webkitURL,o="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise(((t,i)=>{try{n.onload=()=>t(n),n.onerror=t=>i(new Error(`Could not load image ${e}: ${t}`))}catch(e){i(e)}}))}(o||i,t)}finally{o&&r.revokeObjectURL(o)}}const es={};let ts=!0;async function ns(e,t,n){let i;if(Yo(n)){i=await Jo(e,t,n)}else i=Ko(e,n);const r=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||es)return!1;return!0}(t)&&ts||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),ts=!1}return await createImageBitmap(e)}(i,r)}const is=!1,rs=!0;function os(e){const t=ss(e);return function(e){const t=ss(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,is)))return null;return{mimeType:"image/png",width:t.getUint32(16,is),height:t.getUint32(20,is)}}(t)||function(e){const t=ss(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,is)&&255===t.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,is);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(r+5,is),width:t.getUint16(r+7,is)};if(!n.has(e))return null;r+=2,r+=t.getUint16(r,is)}return null}(t)||function(e){const t=ss(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,is)))return null;return{mimeType:"image/gif",width:t.getUint16(6,rs),height:t.getUint16(8,rs)}}(t)||function(e){const t=ss(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,is)&&t.getUint32(2,rs)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,rs),height:t.getUint32(22,rs)}}(t)}function ss(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const as={id:"image",module:"images",name:"Images",version:"3.0.12",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:r}=n||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if($o)return"imagebitmap";if(Wo)return"image";if(Zo)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return $o||Wo||Zo;case"imagebitmap":return $o;case"image":return Wo;case"data":return Zo;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(i)){case"imagebitmap":o=await ns(e,t,r);break;case"image":o=await Jo(e,t,r);break;case"data":o=await function(e,t){const{mimeType:n}=os(e)||{},{_parseImageNode:i}=Uo;return Fo(i),i(e,n,t)}(e,t);break;default:Fo(!1)}return"data"===i&&(o=function(e){switch(Ho(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(o)),o},tests:[e=>Boolean(os(new DataView(e)))],options:{image:{type:"auto",decode:!0}}};var ls={},cs={exports:{}};!function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0}(cs);var us={exports:{}};!function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(us);var hs={},ds=cs.exports;Object.defineProperty(hs,"__esModule",{value:!0}),hs.console=hs.process=hs.document=hs.global=hs.window=hs.self=void 0;var fs=ds(us.exports),ps={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":(0,fs.default)(process))&&process},As=ps.self||ps.window||ps.global;hs.self=As;var ms=ps.window||ps.self||ps.global;hs.window=ms;var gs=ps.global||ps.self||ps.window;hs.global=gs;var ys=ps.document||{};hs.document=ys;var _s=ps.process||{};hs.process=_s;var vs=console;hs.console=vs;var bs={},xs={},ws=cs.exports;Object.defineProperty(xs,"__esModule",{value:!0}),xs.default=function(e){if("undefined"!=typeof window&&"object"===(0,Es.default)(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===(0,Es.default)(process.versions)&&Boolean(process.versions.electron))return!0;var t="object"===("undefined"==typeof navigator?"undefined":(0,Es.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=e||t;if(n&&n.indexOf("Electron")>=0)return!0;return!1};var Es=ws(us.exports);var Ss=cs.exports;Object.defineProperty(bs,"__esModule",{value:!0}),bs.default=Cs,bs.isBrowserMainThread=function(){return Cs()&&"undefined"!=typeof document};var Ts=Ss(us.exports),ks=Ss(xs);function Cs(){return!("object"===("undefined"==typeof process?"undefined":(0,Ts.default)(process))&&"[object process]"===String(process)&&!process.browser)||(0,ks.default)()}var Ps={},Ms=cs.exports;Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.isMobile=function(){return void 0!==Is.window.orientation},Ps.default=function(e){if(!e&&!(0,Ls.default)())return"Node";if((0,Rs.default)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},n=e||t.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";var i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");if(i||r)return"IE";if(Is.window.chrome)return"Chrome";if(Is.window.safari)return"Safari";if(Is.window.mozInnerScreenX)return"Firefox";return"Unknown"};var Is=hs,Ls=Ms(bs),Rs=Ms(xs);!function(e){var t=cs.exports,n=us.exports;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return i.self}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return i.window}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return i.global}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return i.document}}),Object.defineProperty(e,"process",{enumerable:!0,get:function(){return i.process}}),Object.defineProperty(e,"console",{enumerable:!0,get:function(){return i.console}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"isBrowserMainThread",{enumerable:!0,get:function(){return r.isBrowserMainThread}}),Object.defineProperty(e,"getBrowser",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"isMobile",{enumerable:!0,get:function(){return o.isMobile}}),Object.defineProperty(e,"isElectron",{enumerable:!0,get:function(){return s.default}});var i=hs,r=l(bs),o=l(Ps),s=t(xs);function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var i=a(t);if(i&&i.has(e))return i.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(r,s,l):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}}(ls);var zs=ls,Ds=new oo({id:"deck"});const Os={attributeUpdateMessages:[]};let Bs={};function Fs(e){Ds.level>0&&Bs[e]&&Bs[e].call(...arguments)}Bs=(e=>({"layer.changeFlag":(t,n,i)=>{e.log(3,"".concat(t.id," ").concat(n,": "),i[n])()},"layer.initialize":t=>{e.log(1,"Initializing ".concat(t))()},"layer.update":(t,n)=>{if(n){const n=t.getChangeFlags();e.log(2,"Updating ".concat(t," because: ").concat(Object.keys(n).filter((e=>n[e])).join(", ")))()}else e.log(4,"".concat(t," does not need update"))()},"layer.matched":(t,n)=>{n&&e.log(4,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{e.log(1,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,n,i)=>{n?e.log(2,"Composite layer rendered new subLayers ".concat(t),i)():e.log(4,"Composite layer reused subLayers ".concat(t),i)()},"layerManager.setLayers":(t,n,i)=>{n&&e.log(2,"Updating ".concat(i.length," deck layers"))()},"layerManager.activateViewport":(t,n)=>{e.log(3,"Viewport changed",n)()},"attributeManager.invalidate":(t,n,i)=>{e.log(1,i?"invalidated attributes ".concat(i," (").concat(n,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":e=>{Os.attributeUpdateMessages.length=0,Os.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,n)=>{const i=Math.round(Date.now()-Os.attributeManagerUpdateStart);e.groupCollapsed(2,"Updated attributes for ".concat(n," instances in ").concat(t.id," in ").concat(i,"ms"))();for(const t of Os.attributeUpdateMessages)e.log(3,t)();e.groupEnd(2)()},"attribute.updateStart":e=>{Os.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const n="".concat(e.id," allocated ").concat(t);Os.attributeUpdateMessages.push(n)},"attribute.updateEnd":(e,t)=>{const n=Math.round(Date.now()-Os.attributeUpdateStart),i="".concat(e.id," updated ").concat(t," in ").concat(n,"ms");Os.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(t,n,i)=>{const{pass:r,redrawReason:o,stats:s}=i;for(const i of n){const{totalCount:n,visibleCount:a,compositeCount:l,pickableCount:c}=i,u=n-l-a;e.log(2,"RENDER #".concat(t.renderCount,"   ").concat(a," (of ").concat(n," layers) to ").concat(r," because ").concat(o,"   (").concat(u," hidden, ").concat(l," composite ").concat(c," pickable)"))(),s&&s.get("Redraw Layers").add(a)}}}))(Ds);var Ns={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse};const Us="8.5.10",js=zs.global.deck&&zs.global.deck.VERSION;if(js&&js!==Us)throw new Error("deck.gl - multiple versions detected: ".concat(js," vs ").concat(Us));js||(Ds.log(1,"deck.gl ".concat(Us))(),zs.global.deck=Object.assign(zs.global.deck||{},{VERSION:Us,version:Us,log:Ds,_registerLoggers:function(e){Bs=e}}),function(e){const t=xo();e=Array.isArray(e)?e:[e];for(const n of e){const e=bo(n);t.find((t=>e===t))||t.unshift(e)}}([Ns,[as,{imagebitmap:{premultiplyAlpha:"none"}}]]));var Vs=zs.global.deck;const Gs=new oo({id:"luma.gl"});function Ws(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function $s(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version)))}function qs(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function Zs(e){return Ws($s(e),"Invalid WebGLRenderingContext"),e}function Hs(e){return Ws(qs(e),"Requires WebGL2"),e}const Qs={};function Xs(e,t){var n;Qs[e]=!0,void 0!==t&&(n=t,zs.global.console&&zs.global.console.error&&zs.global.console.error(n))}const Ys=function e(t){const n=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let t=0;t<this.attribs.length;t++){const i=new e.VertexAttrib(n);this.attribs[t]=i}this.maxAttrib=0};(Ys.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Ks=function(e){const t=this;this.gl=e,function(e){const t=e.getError;e.getError=function(){let n;do{n=t.apply(e),0!==n&&(Qs[n]=!0)}while(0!==n);for(n in Qs)if(Qs[n])return delete Qs[n],parseInt(n,10);return 0}}(e);const n=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:n.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){const i=t.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,e);const r=i.attribs[e];return r.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){const i=t.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,e);const r=i.attribs[e];return r.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(e,i){switch(e){case 34962:t.currentArrayBuffer=i;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=i}return n.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(e,i){const r=t.currentVertexArrayObject,o=r.attribs[e];switch(i){case 34975:return o.buffer;case 34338:return o.enabled;case 34339:return o.size;case 34340:return o.stride;case 34341:return o.type;case 34922:return o.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,i,r,o,s,a){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,e);const c=l.attribs[e];return c.buffer=t.currentArrayBuffer,c.size=i,c.type=r,c.normalized=o,c.stride=s,c.offset=a,c.recache(),n.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",(()=>{var e;e="OESVertexArrayObject emulation library context restored",zs.global.console&&zs.global.console.log&&zs.global.console.log(e),t.reset_()}),!0),this.reset_()};Ks.prototype.VERTEX_ARRAY_BINDING_OES=34229,Ks.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(34921),this.defaultVertexArrayObject=new Ys(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},Ks.prototype.createVertexArrayOES=function(){const e=new Ys(this);return this.vertexArrayObjects.push(e),e},Ks.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},Ks.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Ys&&e.hasBeenBound&&e.ext===this)},Ks.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive)return void Xs(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");const n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const r=this.currentVertexArrayObject;if(i===r)return;i&&r.elementArrayBuffer===i.elementArrayBuffer||n.bindBuffer.call(t,34963,r.elementArrayBuffer);let o=this.currentArrayBuffer;const s=Math.max(i?i.maxAttrib:0,r.maxAttrib);for(let e=0;e<=s;e++){const s=r.attribs[e],a=i?i.attribs[e]:null;if(i&&s.enabled===a.enabled||(s.enabled?n.enableVertexAttribArray.call(t,e):n.disableVertexAttribArray.call(t,e)),s.enabled){let r=!1;i&&s.buffer===a.buffer||(o!==s.buffer&&(n.bindBuffer.call(t,34962,s.buffer),o=s.buffer),r=!0),(r||s.cached!==a.cached)&&n.vertexAttribPointer.call(t,e,s.size,s.type,s.normalized,s.stride,s.offset)}}this.currentArrayBuffer!==o&&n.bindBuffer.call(t,34962,this.currentArrayBuffer)};const Js="OES_element_index",ea="WEBGL_draw_buffers",ta="WEBGL_debug_renderer_info",na=e=>qs(e)?void 0:0,ia={3074:e=>qs(e)?void 0:36064,35723:e=>qs(e)?void 0:4352,35977:na,32937:na,36795:(e,t)=>{const n=qs(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?t(n.GPU_DISJOINT_EXT):0},37445:(e,t)=>{const n=e.getExtension(ta);return t(n&&n.UNMASKED_VENDOR_WEBGL||7936)},37446:(e,t)=>{const n=e.getExtension(ta);return t(n&&n.UNMASKED_RENDERER_WEBGL||7937)},34047:(e,t)=>{const n=e.luma.extensions.EXT_texture_filter_anisotropic;return n?t(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:na,35071:na,37447:na,36063:(e,t)=>{if(!qs(e)){const n=e.getExtension(ea);return n?t(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:na,35374:na,35377:na,34852:e=>{if(!qs(e)){const t=e.getExtension(ea);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:e=>e.getExtension(Js)?2147483647:65535,33001:e=>e.getExtension(Js)?16777216:65535,33e3:e=>16777216,37157:na,35373:na,35657:na,36183:na,37137:na,34045:na,35978:na,35979:na,35968:na,35376:na,35375:na,35659:na,37154:na,35371:na,35658:na,35076:na,35077:na,35380:na};const ra="ANGLE_instanced_arrays";const oa={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Ws(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[ra]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){Ws(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Ws(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Ws(!1)},deleteQuery:()=>{Ws(!1)},beginQuery:()=>{Ws(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},sa={readBuffer:(e,t,n)=>{qs(e)&&t(n)},getVertexAttrib:(e,t,n,i)=>{const{webgl2:r,ext:o}=function(e,t){return{webgl2:qs(e),ext:e.getExtension(t)}}(e,ra);let s;switch(i){case 35069:s=!!r&&void 0;break;case 35070:s=r||o?void 0:0}return void 0!==s?s:t(n,i)},getProgramParameter:(e,t,n,i)=>{if(!qs(e))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return t(n,i)},getInternalformatParameter:(e,t,n,i,r)=>qs(e)||32937!==r?e.getInternalformatParameter(n,i,r):new Int32Array([0]),getTexParameter(e,t,n,i){if(34046===i){const{extensions:t}=e.luma,n=t.EXT_texture_filter_anisotropic;i=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046}return t(n,i)},getParameter:function(e,t,n){const i=ia[n],r="function"==typeof i?i(e,t,n):i;return void 0!==r?r:t(n)},hint:(e,t,n,i)=>t(n,i)};function aa(e,{extension:t,target:n,target2:i}){const r=oa[t];Ws(r);const{meta:o={}}=r,{suffix:s=""}=o,a=e.getExtension(t);for(const t of Object.keys(r)){const o=`${t}${s}`;let l=null;"meta"===t||"function"==typeof e[t]||(a&&"function"==typeof a[o]?l=(...e)=>a[o](...e):"function"==typeof r[t]&&(l=r[t].bind(n))),l&&(n[t]=l,i[t]=l)}}("undefined"!=typeof global?global:window).polyfillContext=function(e){e.luma=e.luma||{};const{luma:t}=e;return t.polyfilled||(!function(e){if("function"==typeof e.createVertexArray)return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};const n=e.getExtension;e.getExtension=function(t){return n.call(this,t)||("OES_vertex_array_object"!==t?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Ks(this)),this.__OESVertexArrayObject))}}(e),function(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const n of t)e.luma[n]=e.getExtension(n)}(e),function(e,t){for(const n of Object.getOwnPropertyNames(t))"overrides"!==n&&aa(e,{extension:n,target:e.luma,target2:e})}(e,oa),function(e,{target:t,target2:n}){Object.keys(sa).forEach((i=>{if("function"==typeof sa[i]){const r=e[i]?e[i].bind(e):()=>{},o=sa[i].bind(null,e,r);t[i]=o,n[i]=o}}))}(e,{target:t,target2:e}),t.polyfilled=!0),e};const la={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ca=(e,t,n)=>t?e.enable(n):e.disable(n),ua=(e,t,n)=>e.hint(n,t),ha=(e,t,n)=>e.pixelStorei(n,t);function da(e){return Array.isArray(e)||ArrayBuffer.isView(e)}const fa={3042:ca,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:ca,2885:(e,t)=>e.cullFace(t),2929:ca,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:ca,35723:ua,36006:(e,t)=>{const n=qs(e)?36009:36160;return e.bindFramebuffer(n,t)},2886:(e,t)=>e.frontFace(t),33170:ua,2849:(e,t)=>e.lineWidth(t),32823:ca,32824:"polygonOffset",10752:"polygonOffset",35977:ca,32938:"sampleCoverage",32939:"sampleCoverage",3089:ca,3088:(e,t)=>e.scissor(...t),2960:ca,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),3333:ha,3317:ha,37440:ha,37441:ha,37443:ha,3330:ha,3332:ha,3331:ha,36010:(e,t)=>e.bindFramebuffer(36008,t),3314:ha,32878:ha,3316:ha,3315:ha,32877:ha,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=da(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=da(t)&&2===t.length?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=da(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=da(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilFuncSeparate(1028,n,i,r),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=da(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilOpSeparate(1028,n,i,r),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};function pa(e,t,n){return void 0!==t[e]?t[e]:n[e]}const Aa={blendEquation:(e,t,n)=>e.blendEquationSeparate(pa(32777,t,n),pa(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(pa(32969,t,n),pa(32968,t,n),pa(32971,t,n),pa(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(pa(32824,t,n),pa(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(pa(32938,t,n),pa(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,pa(2962,t,n),pa(2967,t,n),pa(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,pa(34816,t,n),pa(36003,t,n),pa(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,pa(2964,t,n),pa(2965,t,n),pa(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,pa(34817,t,n),pa(34818,t,n),pa(34819,t,n))},ma={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},blendColor:(e,t,n,i,r)=>e({32773:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,i,r)=>e({32969:t,32968:n,32971:i,32970:r}),clearColor:(e,t,n,i,r)=>e({3106:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,i,r)=>e({3107:[t,n,i,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,i,r)=>e({3088:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,i)=>e({2962:t,2967:n,2963:i,34816:t,36003:n,36004:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:i,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,i)=>e({2964:t,2965:n,2966:i,34817:t,34818:n,34819:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:i,[1028===t?2966:34819]:r}),viewport:(e,t,n,i,r)=>e({2978:[t,n,i,r]})},ga=(e,t)=>e.isEnabled(t),ya={3042:ga,2884:ga,2929:ga,3024:ga,32823:ga,32926:ga,32928:ga,3089:ga,2960:ga,35977:ga};function _a(e){for(const t in e)return!1;return!0}function va(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}function ba(e,t){const n=e[t].bind(e);e[t]=function(...t){const i=t[0];return i in e.state.cache||(e.state.cache[i]=n(...t)),e.state.enable?e.state.cache[i]:n(...t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function xa(e,t,n){const i=e[t].bind(e);e[t]=function(...t){const{valueChanged:r,oldValue:o}=n(e.state._updateCache,...t);return r&&i(...t),o},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}class wa{constructor(e,{copyState:t=!1,log:n=(()=>{})}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?function(e,t){if("number"==typeof(t=t||la)){const n=t,i=ya[n];return i?i(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),i={};for(const t of n){const n=ya[t];i[t]=n?n(e,Number(t)):e.getParameter(Number(t))}return i}(e):Object.assign({},la),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Ws(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Ta(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const r in e){Ws(void 0!==r);const o=e[r],s=this.cache[r];va(o,s)||(n=!0,t=s,i&&!(r in i)&&(i[r]=s),this.cache[r]=o)}return{valueChanged:n,oldValue:t}}}function Ea(e,t={}){const{enable:n=!0,copyState:i}=t;if(Ws(void 0!==i),!e.state){const t="undefined"!=typeof global?global:window,{polyfillContext:n}=t;n&&n(e),e.state=new wa(e,{copyState:i}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){e.state.program!==n&&(t(n),e.state.program=n)}}(e);for(const t in ma){xa(e,t,ma[t])}ba(e,"getParameter"),ba(e,"isEnabled")}return e.state.enable=n,e}function Sa(e){Ws(e.state),e.state.pop()}function Ta(e,t){if(Ws($s(e),"setParameters requires a WebGL context"),_a(t))return;const n={};for(const i in t){const r=Number(i),o=fa[i];o&&("string"==typeof o?n[o]=!0:o(e,t[i],r))}const i=e.state&&e.state.cache;if(i)for(const r in n){(0,Aa[r])(e,t,i)}}function ka(e,t,n){if(_a(t))return n(e);const{nocatch:i=!0}=t;let r;if(function(e){e.state||Ea(e,{copyState:!1}),e.state.push()}(e),Ta(e,t),i)r=n(e),Sa(e);else try{r=n(e)}finally{Sa(e)}return r}function Ca(e){const{luma:t}=e;if(e.canvas&&t){const{clientWidth:n}=t.canvasSizeInfo;return n?e.drawingBufferWidth/n:1}return 1}function Pa(e,t,n=!0){return function(e,t,n,i,r){const o=Ma(e[0],t,n);let s=Ia(e[1],t,i,r),a=Ma(e[0]+1,t,n);const l=a===n-1?a:a-1;let c;a=Ia(e[1]+1,t,i,r),r?(a=0===a?a:a+1,c=s,s=a):c=a===i-1?a:a-1;return{x:o,y:s,width:Math.max(l-o+1,1),height:Math.max(c-s+1,1)}}(t,Ca(e),e.drawingBufferWidth,e.drawingBufferHeight,n)}function Ma(e,t,n){return Math.min(Math.round(e*t),n-1)}function Ia(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const La=zs.isBrowser(),Ra=La&&"undefined"!=typeof document,za={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Da(e={}){Ws(La,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils"),e=Object.assign({},za,e);const{width:t,height:n}=e;function i(t){if(e.throwOnError)throw new Error(t);return console.error(t),null}let r;e.onError=i;const{canvas:o}=e,s=function({canvas:e,width:t=800,height:n=600,onError:i}){let r;if("string"==typeof e){Ra&&"complete"===document.readyState||i(`createGLContext called on canvas '${e}' before page was loaded`),r=document.getElementById(e)}else e?r=e:(r=document.createElement("canvas"),r.id="lumagl-canvas",r.style.width=Number.isFinite(t)?`${t}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",document.body.insertBefore(r,document.body.firstChild));return r}({canvas:o,width:t,height:n,onError:i});return r=function(e,t){const{onError:n}=t;let i=null;const r=e=>i=e.statusMessage||i;e.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:o=!0,webgl2:s=!0}=t;let a=null;s&&(a=a||e.getContext("webgl2",t),a=a||e.getContext("experimental-webgl2",t));o&&(a=a||e.getContext("webgl",t),a=a||e.getContext("experimental-webgl",t));if(e.removeEventListener("webglcontextcreationerror",r,!1),!a)return n(`Failed to create ${s&&!o?"WebGL2":"WebGL"} context: ${i||"Unknown error"}`);t.onContextLost&&e.addEventListener("webglcontextlost",t.onContextLost,!1);t.onContextRestored&&e.addEventListener("webglcontextrestored",t.onContextRestored,!1);return a}(s,e),r?(r=Oa(r,e),function(e){const t=qs(e)?"WebGL2":"WebGL1",n=function(e){const t=e.getParameter(7936),n=e.getParameter(7937),i=e.getExtension("WEBGL_debug_renderer_info"),r=i&&e.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),o=i&&e.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||t,renderer:o||n,vendorMasked:t,rendererMasked:n,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}(e),i=n?`(${n.vendor},${n.renderer})`:"",r=e.debug?" debug":"";Gs.info(1,`${t}${r} context ${i}`)()}(r),r):null}function Oa(e,t={}){if(!e||e._instrumented)return e;e._version=e._version||function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return 2;return 1}(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},za,t);const{manageState:n,debug:i}=t;return n&&Ea(e,{copyState:!1,log:(...e)=>Gs.log(1,...e)()}),La&&i&&(zs.global.makeDebugContext?(e=zs.global.makeDebugContext(e,t),Gs.level=Math.max(Gs.level,1)):Gs.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function Ba(e,t={}){if(e.canvas){return void function(e,t,n){let i="width"in n?n.width:e.canvas.clientWidth,r="height"in n?n.height:e.canvas.clientHeight;i&&r||(Gs.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=e.canvas.width||1,r=e.canvas.height||1);e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const o=e.luma.canvasSizeInfo;if(o.clientWidth!==i||o.clientHeight!==r||o.devicePixelRatio!==t){let n=t;const o=Math.floor(i*n),s=Math.floor(r*n);e.canvas.width=o,e.canvas.height=s,e.drawingBufferWidth===o&&e.drawingBufferHeight===s||(Gs.warn("Device pixel ratio clamped")(),n=Math.min(e.drawingBufferWidth/i,e.drawingBufferHeight/r),e.canvas.width=Math.floor(i*n),e.canvas.height=Math.floor(r*n)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:t})}}(e,function(e){const t="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}(t.useDevicePixels),t)}const n=e.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in t&&"height"in t&&n.resize(t.width,t.height)}const Fa="8.5.7";const Na=new class{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new br({id:e})),this.stats.get(e)}};if(zs.global.luma&&zs.global.luma.VERSION!==Fa)throw new Error(`luma.gl - multiple VERSIONs detected: ${zs.global.luma.VERSION} vs 8.5.7`);function Ua(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}function ja(e,t){if("string"!=typeof t)return t;const n=Number(t);if(!isNaN(n))return n;const i=e[t=t.replace(/^.*\./,"")];return Ua(void 0!==i,`Accessing undefined constant GL.${t}`),i}function Va(e,t){t=Number(t);for(const n in e)if(e[n]===t)return`GL.${n}`;return String(t)}zs.global.luma||(zs.isBrowser()&&Gs.log(1,"luma.gl 8.5.7 - set luma.log.level=1 (or higher) to trace rendering")(),zs.global.luma=zs.global.luma||{VERSION:Fa,version:Fa,log:Gs,stats:Na,globals:{modules:{},nodeIO:{}}}),zs.global.luma;const Ga={};function Wa(e="id"){Ga[e]=Ga[e]||1;return`${e}-${Ga[e]++}`}function $a(e){return Ua("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function qa(e){let t=!0;for(const n in e){t=!1;break}return t}function Za(e,t,n,i){const r=`See luma.gl ${n} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,o=Object.getPrototypeOf(e);i.forEach((e=>{o.methodName||(o[e]=()=>{throw Gs.removed(`Calling removed method ${t}.${e}: `,r)(),new Error(e)})}))}const Ha="Resource subclass must define virtual methods";class Qa{constructor(e,t={}){Zs(e);const{id:n,userData:i={}}=t;this.gl=e,this.gl2=e,this.id=n||Wa(this.constructor.name),this.userData=i,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach((e=>e.delete())),this}bind(e=this.handle){if("function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t={}){Ua(e=ja(this.gl,e));const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=qs(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const t=n.webgl1,i="webgl2"in n?n.webgl2:n.webgl1;return e?i:t}}return this._getParameter(e,t)}getParameters(e={}){const{parameters:t,keys:n}=e,i=this.constructor.PARAMETERS||{},r=qs(this.gl),o={},s=t||Object.keys(i);for(const t of s){const s=i[t];if(s&&(!("webgl2"in s)||r)&&(!("extension"in s)||this.gl.getExtension(s.extension))){const i=n?Va(this.gl,t):t;o[i]=this.getParameter(t,e),n&&"GLenum"===s.type&&(o[i]=Va(this.gl,o[i]))}}return o}setParameter(e,t){Ua(e=ja(this.gl,e));const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=qs(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(t=ja(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,n){return Za(this,e,t,n)}initialize(e){}_createHandle(){throw new Error(Ha)}_deleteHandle(){throw new Error(Ha)}_bindHandle(e){throw new Error(Ha)}_getOptsFromHandle(){throw new Error(Ha)}_getParameter(e,t){throw new Error(Ha)}_setParameter(e,t){throw new Error(Ha)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this.constructor.name,t=Na.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this.constructor.name;Na.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,t=this.constructor.name){const n=Na.get("Memory Usage");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const t=Na.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}function Xa(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}function Ya(e,{clamped:t=!0}={}){switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Ka({data:e,width:t,height:n}){const i=Math.round(t/2),r=Math.round(n/2),o=new Uint8Array(i*r*4);for(let n=0;n<r;n++)for(let r=0;r<i;r++)for(let s=0;s<4;s++)o[4*(n*i+r)+s]=e[4*(2*n*t+2*r)+s];return{data:o,width:i,height:r}}function Ja(e,t,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:o={}}=n;for(const n in i)if(n in t){const t=i[n]?`${e}.${i[n]}`:"N/A";Gs.removed(`${e}.${n}`,t)()}for(const n in r)if(n in t){const t=r[n];Gs.deprecated(`${e}.${n}`,`${e}.${t}`)()}let s=null;for(const n in o)if(n in t){const i=o[n];Gs.deprecated(`${e}.${n}`,`${e}.${i}`)(),s=s||Object.assign({},t),s[i]=t[n],delete s[n]}return s||t}const el={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},tl={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class nl{static getBytesPerElement(e){return Ya(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){Ua(e.size);return Ya(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new nl(...[el,...e])}constructor(...e){e.forEach((e=>this._assign(e))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return nl.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return nl.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=Ja("Accessor",e,tl)).type&&(this.type=e.type,5124!==e.type&&5125!==e.type||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const il={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},rl={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:il},ol={removedProps:il};class sl extends Qa{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/nl.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/nl.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Ja("Buffer",e,rl),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=Ja("Buffer",e,ol))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new nl(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:n=0,srcOffset:i=0}=e,r=e.byteLength||e.length;Ua(t);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),0!==i||void 0!==r?(Hs(this.gl),this.gl.bufferSubData(this.target,n,t,i,r)):this.gl.bufferSubData(o,n,t),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(t),this}copyData({sourceBuffer:e,readOffset:t=0,writeOffset:n=0,size:i}){const{gl:r}=this;return Hs(r),r.bindBuffer(36662,e.handle),r.bindBuffer(36663,this.handle),r.copyBufferSubData(36662,36663,t,n,i),r.bindBuffer(36662,null),r.bindBuffer(36663,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:t=0,dstOffset:n=0,length:i=0}={}){Hs(this.gl);const r=Ya(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(t),s=n;let a,l;e?(l=e.length,a=l-s):(a=Math.min(o,i||o),l=s+a);const c=Math.min(o,a);return Ua((i=i||c)<=c),e=e||new r(l),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,n,i),this.gl.bindBuffer(36662,null),e}bind({target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:n=0,size:i}={}){return 35345===e||35982===e?void 0!==i?this.gl.bindBufferRange(e,t,this.handle,n,i):(Ua(0===n),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:t=this.accessor&&this.accessor.index}={}){return 35345===e||35982===e?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,t=0,n=e.byteLength+t){Ua(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.usage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,10),this.bytesUsed=n,this._trackAllocatedMemory(n);const r=Xa(e);return Ua(r),this.setAccessor(new nl(this.accessor,{type:r})),this}_setByteLength(e,t=this.usage){Ua(e>=0),this._trackDeallocatedMemory();let n=e;0===e&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=e/Ya(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}_inferType(e){this.accessor.type||this.setAccessor(new nl(this.accessor,{type:Xa(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return Gs.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Gs.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Gs.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Gs.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new nl(this.accessor,e),this}}const al={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},ll={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},cl={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};const ul=[9729,9728],hl=zs.global.WebGLBuffer||function(){};class dl extends Qa{static isSupported(e,t={}){const{format:n,linearFiltering:i}=t;let r=!0;return n&&(r=r&&function(e,t){const n=al[t];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;const i=qs(e)&&n.gl2||n.gl1;return"string"==typeof i?e.getExtension(i):i}(e,n),r=r&&(!i||function(e,t){const n=al[t];switch(n&&n.types[0]){case 5126:return e.getExtension("OES_texture_float_linear");case 5131:return e.getExtension("OES_texture_half_float_linear");default:return!0}}(e,n))),r}constructor(e,t){const{id:n=Wa("texture"),handle:i,target:r}=t;super(e,{id:n,handle:i}),this.target=r,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let t=e.data;if(t instanceof Promise)return t.then((t=>this.initialize(Object.assign({},e,{pixels:t,data:t})))),this;const n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(n&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",(()=>this.initialize(e))),this;const{pixels:i=null,format:r=6408,border:o=0,recreate:s=!1,parameters:a={},pixelStore:l={},textureUnit:c}=e;t||(t=i);let{width:u,height:h,dataFormat:d,type:f,compressed:p=!1,mipmaps:A=!0}=e;const{depth:m=0}=e;return({width:u,height:h,compressed:p,dataFormat:d,type:f}=this._deduceParameters({format:r,type:f,dataFormat:d,compressed:p,data:t,width:u,height:h})),this.width=u,this.height=h,this.depth=m,this.format=r,this.type=f,this.dataFormat=d,this.border=o,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),A&&this._isNPOT()&&(Gs.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),A=!1,this._updateForNPOT(a)),this.mipmaps=A,this.setImageData({data:t,width:u,height:h,depth:m,format:r,type:f,dataFormat:d,border:o,mipmaps:A,parameters:l,compressed:p}),A&&this.generateMipmap(),this.setParameters(a),s&&(this.data=t),n&&(this._video={video:t,parameters:a,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:n}=this._video;if(n===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize({height:e,width:t,mipmaps:n=!1}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(e={}){return this._isNPOT()?(Gs.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),ka(this.gl,e,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:n=null,level:i=0,format:r=this.format,border:o=this.border,offset:s=0,parameters:a={}}=e;let{data:l=null,type:c=this.type,width:u=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:f=!1}=e;l||(l=n),({type:c,dataFormat:d,compressed:f,width:u,height:h}=this._deduceParameters({format:r,type:c,dataFormat:d,compressed:f,data:l,width:u,height:h}));const{gl:p}=this;p.bindTexture(this.target,this.handle);let A,m=null;if(({data:l,dataType:m}=this._getDataType({data:l,compressed:f})),ka(this.gl,a,(()=>{switch(m){case"null":p.texImage2D(t,i,r,u,h,o,d,c,l);break;case"typed-array":p.texImage2D(t,i,r,u,h,o,d,c,l,s);break;case"buffer":A=Hs(p),A.bindBuffer(35052,l.handle||l),A.texImage2D(t,i,r,u,h,o,d,c,s),A.bindBuffer(35052,null);break;case"browser-object":qs(p)?p.texImage2D(t,i,r,u,h,o,d,c,l):p.texImage2D(t,i,r,d,c,l);break;case"compressed":for(const[e,n]of l.entries())p.compressedTexImage2D(t,e,n.format,n.width,n.height,o,n.data);break;default:Ua(!1,"Unknown image data type")}})),l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const e=ll[this.dataFormat]||4,t=cl[this.type]||1;this._trackAllocatedMemory(this.width*this.height*e*t,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:n=null,x:i=0,y:r=0,width:o=this.width,height:s=this.height,level:a=0,format:l=this.format,type:c=this.type,dataFormat:u=this.dataFormat,compressed:h=!1,offset:d=0,border:f=this.border,parameters:p={}}){if(({type:c,dataFormat:u,compressed:h,width:o,height:s}=this._deduceParameters({format:l,type:c,dataFormat:u,compressed:h,data:n,width:o,height:s})),Ua(0===this.depth,"texSubImage not supported for 3D textures"),n||(n=t),n&&n.data){const e=n;n=e.data,o=e.shape[0],s=e.shape[1]}n instanceof sl&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),ka(this.gl,p,(()=>{if(h)this.gl.compressedTexSubImage2D(e,a,i,r,o,s,l,n);else if(null===n)this.gl.texSubImage2D(e,a,i,r,o,s,u,c,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(e,a,i,r,o,s,u,c,n,d);else if(n instanceof hl){const t=Hs(this.gl);t.bindBuffer(35052,n),t.texSubImage2D(e,a,i,r,o,s,u,c,d),t.bindBuffer(35052,null)}else if(qs(this.gl)){Hs(this.gl).texSubImage2D(e,a,i,r,o,s,u,c,n)}else this.gl.texSubImage2D(e,a,i,r,u,c,n)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return Gs.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof sl?{data:e.handle,dataType:"buffer"}:e instanceof hl?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:n}=e;let{width:i,height:r,dataFormat:o,type:s,compressed:a}=e;const l=al[t];return o=o||l&&l.dataFormat,s=s||l&&l.types[0],a=a||l&&l.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:o,type:s,compressed:a,width:i,height:r,format:t,data:n}}_deduceImageSize(e,t,n){let i;return i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},Ua(i,"Could not deduced texture size"),Ua(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),Ua(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Ua(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!qs(this.gl)&&(!(!this.width||!this.height)&&(!$a(this.width)||!$a(this.height)))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:-1===ul.indexOf(t)&&(t=9729);break;case 10242:case 10243:33071!==t&&(t=33071)}return t}}class fl extends dl{static isSupported(e,t){return dl.isSupported(e,t)}constructor(e,t={}){var n,i;Zs(e),(t instanceof Promise||"string"==typeof t)&&(t={data:t}),"string"==typeof t.data&&(t=Object.assign({},t,{data:(n=t.data,Ua("string"==typeof n),n=""+n,new Promise(((e,t)=>{try{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error(`Could not load image ${n}.`)),r.crossOrigin=i&&i.crossOrigin||"anonymous",r.src=n}catch(e){t(e)}})))})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const pl=[34069,34070,34071,34072,34073,34074];class Al extends dl{constructor(e,t={}){Zs(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(e={}){const{mipmaps:t=!0,parameters:n={}}=e;return this.opts=e,this.setCubeMapImageData(e).then((()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(n)})),this}subImage({face:e,data:t,x:n=0,y:i=0,mipmapLevel:r=0}){return this._subImage({target:e,data:t,x:n,y:i,mipmapLevel:r})}async setCubeMapImageData({width:e,height:t,pixels:n,data:i,border:r=0,format:o=6408,type:s=5121}){const{gl:a}=this,l=n||i,c=await Promise.all(pl.map((e=>{const t=l[e];return Promise.all(Array.isArray(t)?t:[t])})));this.bind(),pl.forEach(((n,i)=>{c[i].length>1&&!1!==this.opts.mipmaps&&Gs.warn(`${this.id} has mipmap and multiple LODs.`)(),c[i].forEach(((i,l)=>{e&&t?a.texImage2D(n,l,o,e,t,r,o,s,i):a.texImage2D(n,l,o,o,s,i)}))})),this.unbind()}setImageDataForFace(e){const{face:t,width:n,height:i,pixels:r,data:o,border:s=0,format:a=6408,type:l=5121}=e,{gl:c}=this,u=r||o;return this.bind(),u instanceof Promise?u.then((n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n})))):this.width||this.height?c.texImage2D(t,0,a,n,i,s,a,l,u):c.texImage2D(t,0,a,a,l,u),this}}Al.FACES=pl;class ml extends dl{static isSupported(e){return qs(e)}constructor(e,t={}){Hs(e),super(e,t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1})),this.initialize(t),Object.seal(this)}setImageData({level:e=0,dataFormat:t=6408,width:n,height:i,depth:r=1,border:o=0,format:s,type:a=5121,offset:l=0,data:c,parameters:u={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),ka(this.gl,u,(()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,e,t,n,i,r,o,s,a,c),c instanceof sl&&(this.gl.bindBuffer(35052,c.handle),this.gl.texImage3D(this.target,e,t,n,i,r,o,s,a,l))})),c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const e=ll[this.dataFormat]||4,t=cl[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*e*t,"Texture")}return this.loaded=!0,this}}const gl="EXT_color_buffer_float";var yl={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:gl,bpp:2},33327:{gl2:gl,bpp:4},34842:{gl2:gl,bpp:8},33326:{gl2:gl,bpp:4},33328:{gl2:gl,bpp:8},34836:{gl2:gl,bpp:16},35898:{gl2:gl,bpp:4}};class _l extends Qa{static isSupported(e,{format:t}={format:null}){return!t||function(e,t,n){const i=n[t];if(!i)return!1;const r=qs(e)&&i.gl2||i.gl1;return"string"==typeof r?e.getExtension(r):r}(e,t,yl)}static getSamplesForFormat(e,{format:t}){return e.getInternalformatParameter(36161,t,32937)}constructor(e,t={}){super(e,t),this.initialize(t),Object.seal(this)}initialize({format:e,width:t=1,height:n=1,samples:i=0}){return Ua(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==i&&qs(this.gl)?this.gl.renderbufferStorageMultisample(36161,i,e,t,n):this.gl.renderbufferStorage(36161,e,t,n),this.format=e,this.width=t,this.height=n,this.samples=i,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*yl[this.format].bpp),this}resize({width:e,height:t}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){this.gl.bindRenderbuffer(36161,this.handle);return this.gl.getRenderbufferParameter(36161,e)}}const vl="clear: bad arguments";function bl(e,{framebuffer:t=null,color:n=null,depth:i=null,stencil:r=null}={}){const o={};t&&(o.framebuffer=t);let s=0;n&&(s|=16384,!0!==n&&(o.clearColor=n)),i&&(s|=256,!0!==i&&(o.clearDepth=i)),r&&(s|=1024,!0!==i&&(o.clearStencil=i)),Ua(0!==s,vl),ka(e,o,(()=>{e.clear(s)}))}function xl(e,t={}){const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=t;let{sourceAttachment:o=36064,target:s=null,sourceWidth:a,sourceHeight:l,sourceType:c}=t;const{framebuffer:u,deleteFramebuffer:h}=El(e);Ua(u);const{gl:d,handle:f,attachments:p}=u;a=a||u.width,l=l||u.height,36064===o&&null===f&&(o=1028),Ua(p[o]),c=c||p[o].type,s=function(e,t,n,i,r){if(e)return e;const o=Ya(t=t||5121,{clamped:!1}),s=function(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Ua(!1),0}}(n);return new o(i*r*s)}(s,c,r,a,l),c=c||Xa(s);const A=d.bindFramebuffer(36160,f);return d.readPixels(n,i,a,l,r,c,s),d.bindFramebuffer(36160,A||null),h&&u.delete(),s}function wl(e,{sourceAttachment:t=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}={}){let i=xl(e,{sourceAttachment:t}),{width:r,height:o}=e;for(;o>n;)({data:i,width:r,height:o}=Ka({data:i,width:r,height:o}));!function({data:e,width:t,height:n,bytesPerPixel:i=4,temp:r}){const o=t*i;r=r||new Uint8Array(o);for(let t=0;t<n/2;++t){const i=t*o,s=(n-t-1)*o;r.set(e.subarray(i,i+o)),e.copyWithin(i,s,s+o),e.set(r,s)}}({data:i,width:r,height:o});const s=document.createElement("canvas");s.width=r,s.height=o;const a=s.getContext("2d"),l=a.createImageData(r,o);return l.data.set(i),a.putImageData(l,0,0),s.toDataURL()}function El(e){return e instanceof Il?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:Rl(e),deleteFramebuffer:!0}}const Sl="TIMER_QUERY",Tl="ELEMENT_INDEX_UINT32";var kl={["WEBGL2"]:[!1,!0],["VERTEX_ARRAY_OBJECT"]:["OES_vertex_array_object",!0],[Sl]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],["INSTANCED_RENDERING"]:["ANGLE_instanced_arrays",!0],["MULTIPLE_RENDER_TARGETS"]:["WEBGL_draw_buffers",!0],[Tl]:["OES_element_index_uint",!0],["BLEND_EQUATION_MINMAX"]:["EXT_blend_minmax",!0],["FLOAT_BLEND"]:["EXT_float_blend"],["COLOR_ENCODING_SRGB"]:["EXT_sRGB",!0],["TEXTURE_DEPTH"]:["WEBGL_depth_texture",!0],["TEXTURE_FLOAT"]:["OES_texture_float",!0],["TEXTURE_HALF_FLOAT"]:["OES_texture_half_float",!0],["TEXTURE_FILTER_LINEAR_FLOAT"]:["OES_texture_float_linear"],["TEXTURE_FILTER_LINEAR_HALF_FLOAT"]:["OES_texture_half_float_linear"],["TEXTURE_FILTER_ANISOTROPIC"]:["EXT_texture_filter_anisotropic"],["COLOR_ATTACHMENT_RGBA32F"]:[function(e){const t=new fl(e,{format:6408,type:5126,dataFormat:6408}),n=new Il(e,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),i=n.getStatus();return t.delete(),n.delete(),36053===i},"EXT_color_buffer_float"],["COLOR_ATTACHMENT_FLOAT"]:[!1,"EXT_color_buffer_float"],["COLOR_ATTACHMENT_HALF_FLOAT"]:["EXT_color_buffer_half_float"],["GLSL_FRAG_DATA"]:["WEBGL_draw_buffers",!0],["GLSL_FRAG_DEPTH"]:["EXT_frag_depth",!0],["GLSL_DERIVATIVES"]:["OES_standard_derivatives",!0],["GLSL_TEXTURE_LOD"]:["EXT_shader_texture_lod",!0]};function Cl(e,t){return(t=Array.isArray(t)?t:[t]).every((t=>Pl(e,t)))}function Pl(e,t){return e.luma=e.luma||{},e.luma.caps=e.luma.caps||{},void 0===e.luma.caps[t]&&(e.luma.caps[t]=function(e,t){const n=kl[t];let i;Ua(n,t);const r=qs(e)&&n[1]||n[0];if("function"==typeof r)i=r(e);else if(Array.isArray(r)){i=!0;for(const t of r)i=i&&Boolean(e.getExtension(t))}else"string"==typeof r?i=Boolean(e.getExtension(r)):"boolean"==typeof r?i=r:Ua(!1);return i}(e,t)),e.luma.caps[t]||Gs.log(2,`Feature: ${t} not supported`)(),e.luma.caps[t]}const Ml="Multiple render targets not supported";class Il extends Qa{static isSupported(e,t={}){const{colorBufferFloat:n,colorBufferHalfFloat:i}=t;let r=!0;return n&&(r=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(r=r&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),r}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Il(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Hs(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Hs(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e,t={}){super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize({width:e=1,height:t=1,attachments:n=null,color:i=!0,depth:r=!0,stencil:o=!1,check:s=!0,readBuffer:a,drawBuffers:l}){if(Ua(e>=0&&t>=0,"Width and height need to be integers"),this.width=e,this.height=t,n)for(const i in n){const r=n[i];(Array.isArray(r)?r[0]:r).resize({width:e,height:t})}else n=this._createDefaultAttachments(i,r,o,e,t);this.update({clearAttachments:!0,attachments:n,readBuffer:a,drawBuffers:l}),n&&s&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update({attachments:e={},readBuffer:t,drawBuffers:n,clearAttachments:i=!1,resizeAttachments:r=!0}){this.attach(e,{clearAttachments:i,resizeAttachments:r});const{gl:o}=this,s=o.bindFramebuffer(36160,this.handle);return t&&this._setReadBuffer(t),n&&this._setDrawBuffers(n),o.bindFramebuffer(36160,s||null),this}resize(e={}){let{width:t,height:n}=e;if(null===this.handle)return Ua(void 0===t&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===t&&(t=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),t!==this.width&&n!==this.height&&Gs.log(2,`Resizing framebuffer ${this.id} to ${t}x${n}`)();for(const e in this.attachments)this.attachments[e].resize({width:t,height:n});return this.width=t,this.height=n,this}attach(e,{clearAttachments:t=!1,resizeAttachments:n=!0}={}){const i={};t&&Object.keys(this.attachments).forEach((e=>{i[e]=null})),Object.assign(i,e);const r=this.gl.bindFramebuffer(36160,this.handle);for(const e in i){Ua(void 0!==e,"Misspelled framebuffer binding point?");const t=Number(e),r=i[t];let o=r;if(o)if(o instanceof _l)this._attachRenderbuffer({attachment:t,renderbuffer:o});else if(Array.isArray(r)){const[e,n=0,i=0]=r;o=e,this._attachTexture({attachment:t,texture:e,layer:n,level:i})}else this._attachTexture({attachment:t,texture:o,layer:0,level:0});else this._unattach(t);n&&o&&o.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,r||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter((e=>!this.attachments[e])).forEach((e=>{delete this.attachments[e]}))}checkStatus(){const e=this.getStatus();if(36053!==e)throw new Error(function(e){return(Il.STATUS||{})[e]||`Framebuffer error ${e}`}(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),n=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),n}clear(e={}){const{color:t,depth:n,stencil:i,drawBuffers:r=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(t||n||i)&&bl(this.gl,{color:t,depth:n,stencil:i}),r.forEach(((e,t)=>{!function(e,{framebuffer:t=null,buffer:n=6144,drawBuffer:i=0,value:r=[0,0,0,0]}={}){Hs(e),ka(e,{framebuffer:t},(()=>{switch(n){case 6144:switch(r.constructor){case Int32Array:e.clearBufferiv(n,i,r);break;case Uint32Array:e.clearBufferuiv(n,i,r);break;case Float32Array:default:e.clearBufferfv(n,i,r)}break;case 6145:e.clearBufferfv(6145,0,[r]);break;case 6146:e.clearBufferiv(6146,0,[r]);break;case 34041:const[t,o]=r;e.clearBufferfi(34041,0,t,o);break;default:Ua(!1,vl)}}))}(this.gl,{drawBuffer:t,value:e})})),this.gl.bindFramebuffer(36160,o||null),this}readPixels(e={}){return Gs.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return Gs.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return Gs.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return Gs.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return Gs.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return Gs.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:t=0,y:n=0,width:i,height:r}){const o=Hs(this.gl),s=o.bindFramebuffer(36008,this.handle);return 0===t&&0===n&&void 0===i&&void 0===r?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,t,n,i,r),o.bindFramebuffer(36008,s),this}getAttachmentParameter(e,t,n){let i=this._getAttachmentParameterFallback(t);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),n&&i>1e3&&(i=Va(this.gl,i)),i}getAttachmentParameters(e=36064,t,n=this.constructor.ATTACHMENT_PARAMETERS||[]){const i={};for(const r of n){i[t?Va(this.gl,r):r]=this.getAttachmentParameter(e,r,t)}return i}getParameters(e=!0){const t=Object.keys(this.attachments),n={};for(const i of t){const t=Number(i);n[e?Va(this.gl,t):t]=this.getAttachmentParameters(t,e)}return n}show(){return"undefined"!=typeof window&&window.open(wl(this),"luma-debug-texture"),this}log(e=0,t=""){if(e>Gs.level||"undefined"==typeof window)return this;t=t||`Framebuffer ${this.id}`;const n=wl(this,{targetMaxHeight:100});return Gs.image({logLevel:e,message:t,image:n},t)(),this}bind({target:e=36160}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=36160}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,n,i,r){let o=null;return e&&(o=o||{},o[36064]=new fl(this.gl,{id:`${this.id}-color0`,pixels:null,format:6408,type:5121,width:i,height:r,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(o[36064])),t&&n?(o=o||{},o[33306]=new _l(this.gl,{id:`${this.id}-depth-stencil`,format:35056,width:i,height:111}),this.ownResources.push(o[33306])):t?(o=o||{},o[36096]=new _l(this.gl,{id:`${this.id}-depth`,format:33189,width:i,height:r}),this.ownResources.push(o[36096])):n&&Ua(!1),o}_unattach(e){const t=this.attachments[e];t&&(t instanceof _l?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=36064,renderbuffer:t}){const{gl:n}=this;n.framebufferRenderbuffer(36160,e,36161,t.handle),this.attachments[e]=t}_attachTexture({attachment:e=36064,texture:t,layer:n,level:i}){const{gl:r}=this;switch(r.bindTexture(t.target,t.handle),t.target){case 35866:case 32879:Hs(r).framebufferTextureLayer(36160,e,t.target,i,n);break;case 34067:const o=function(e){return e<34069?e+34069:e}(n);r.framebufferTexture2D(36160,e,o,t.handle,i);break;case 3553:r.framebufferTexture2D(36160,e,3553,t.handle,i);break;default:Ua(!1,"Illegal texture type")}r.bindTexture(t.target,null),this.attachments[e]=t}_setReadBuffer(e){const t=qs(n=this.gl)?n:null;var n;t?t.readBuffer(e):Ua(36064===e||1029===e,Ml),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,n=Hs(t);if(n)n.drawBuffers(e);else{const n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):Ua(1===e.length&&(36064===e[0]||1029===e[0]),Ml)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=function(e){e.luma=e.luma||{},e.luma.caps=e.luma.caps||{};for(const t in kl)void 0===e.luma.caps[t]&&(e.luma.caps[t]=Pl(e,t));return e.luma.caps}(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return t.WEBGL2||t.EXT_sRGB?null:9729;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function Ll(e,t){Ua(e instanceof fl||e instanceof Al||e instanceof ml);const n=e.constructor,{gl:i,width:r,height:o,format:s,type:a,dataFormat:l,border:c,mipmaps:u}=e;return new n(i,Object.assign({width:r,height:o,format:s,type:a,dataFormat:l,border:c,mipmaps:u},t))}function Rl(e,t){const{gl:n,width:i,height:r,id:o}=e;return new Il(n,Object.assign({},t,{id:`framebuffer-for-${o}`,width:i,height:r,attachments:{36064:e}}))}function zl(e,t="unnamed"){const n=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:t}Il.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];function Dl(e,t,n,i){const r=e.split(/\r?\n/),o={},s={},a=i||zl(t)||"(unnamed)",l=`${function(e){switch(e){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(n)} shader ${a}`;for(let t=0;t<r.length;t++){const n=r[t];if(n.length<=1)continue;const i=n.split(":"),a=i[0],c=parseInt(i[2],10);if(isNaN(c))throw new Error(`GLSL compilation error in ${l}: ${e}`);"WARNING"!==a?o[c]=n:s[c]=n}const c=function(e,t=1,n=": "){const i=e.split(/\r?\n/),r=String(i.length+t-1).length;return i.map(((e,i)=>{const o=String(i+t),s=o.length;return Bl(o,r-s)+n+e}))}(t);return{shaderName:l,errors:Ol(o,c),warnings:Ol(s,c)}}function Ol(e,t){let n="";for(let i=0;i<t.length;i++){const r=t[i];if((e[i+3]||e[i+2]||e[i+1])&&(n+=`${r}\n`,e[i+1])){const t=e[i+1],r=t.split(":",3),o=r[0],s=parseInt(r[1],10)||0;n+=Bl(`^^^ ${o}: ${t.substring(r.join(":").length+1).trim()}\n\n`,s)}}return n}function Bl(e,t){let n="";for(let e=0;e<t;++e)n+=" ";return`${n}${e}`}function Fl(e){let t=100;const n=e.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}return t}class Nl extends Qa{static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Ua(!1),"unknown"}}constructor(e,t){Zs(e),Ua("string"==typeof t.source,"Shader: GLSL source code must be a JavaScript string");super(e,{id:zl(t.source,null)||t.id||Wa(`unnamed ${Nl.getTypeName(t.shaderType)}`)}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize({source:e}){const t=zl(e,null);t&&(this.id=Wa(t)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${Nl.getTypeName(this.shaderType)}:${this.id}`}getName(){return zl(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(e=this.source){e.startsWith("#version ")||(e=`#version 100\n${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);if(!this.getParameter(35713)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:t,errors:n,warnings:i}=Dl(e,this.source,this.shaderType,this.id);throw Gs.error(`GLSL compilation errors in ${t}\n${n}`)(),Gs.warn(`GLSL compilation warnings in ${t}\n${i}`)(),new Error(`GLSL compilation errors in ${t}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Ul extends Nl{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class jl extends Nl{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Vl={5126:nc.bind(null,"uniform1fv",Hl,1,ic),35664:nc.bind(null,"uniform2fv",Hl,2,ic),35665:nc.bind(null,"uniform3fv",Hl,3,ic),35666:nc.bind(null,"uniform4fv",Hl,4,ic),5124:nc.bind(null,"uniform1iv",Ql,1,ic),35667:nc.bind(null,"uniform2iv",Ql,2,ic),35668:nc.bind(null,"uniform3iv",Ql,3,ic),35669:nc.bind(null,"uniform4iv",Ql,4,ic),35670:nc.bind(null,"uniform1iv",Ql,1,ic),35671:nc.bind(null,"uniform2iv",Ql,2,ic),35672:nc.bind(null,"uniform3iv",Ql,3,ic),35673:nc.bind(null,"uniform4iv",Ql,4,ic),35674:nc.bind(null,"uniformMatrix2fv",Hl,4,rc),35675:nc.bind(null,"uniformMatrix3fv",Hl,9,rc),35676:nc.bind(null,"uniformMatrix4fv",Hl,16,rc),35678:tc,35680:tc,5125:nc.bind(null,"uniform1uiv",Xl,1,ic),36294:nc.bind(null,"uniform2uiv",Xl,2,ic),36295:nc.bind(null,"uniform3uiv",Xl,3,ic),36296:nc.bind(null,"uniform4uiv",Xl,4,ic),35685:nc.bind(null,"uniformMatrix2x3fv",Hl,6,rc),35686:nc.bind(null,"uniformMatrix2x4fv",Hl,8,rc),35687:nc.bind(null,"uniformMatrix3x2fv",Hl,6,rc),35688:nc.bind(null,"uniformMatrix3x4fv",Hl,12,rc),35689:nc.bind(null,"uniformMatrix4x2fv",Hl,8,rc),35690:nc.bind(null,"uniformMatrix4x3fv",Hl,12,rc),35678:tc,35680:tc,35679:tc,35682:tc,36289:tc,36292:tc,36293:tc,36298:tc,36299:tc,36300:tc,36303:tc,36306:tc,36307:tc,36308:tc,36311:tc},Gl={},Wl={},$l={},ql=[0];function Zl(e,t,n,i){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(ql[0]=e,e=ql);const r=e.length;if(r%t&&Gs.warn(`Uniform size should be multiples of ${t}`,e)(),e instanceof n)return e;let o=i[r];o||(o=new n(r),i[r]=o);for(let t=0;t<r;t++)o[t]=e[t];return o}function Hl(e,t){return Zl(e,t,Float32Array,Gl)}function Ql(e,t){return Zl(e,t,Int32Array,Wl)}function Xl(e,t){return Zl(e,t,Uint32Array,$l)}function Yl(e,t,n){const i=Vl[n.type];if(!i)throw new Error(`Unknown GLSL uniform type ${n.type}`);return i().bind(null,e,t)}function Kl(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function Jl(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;const t=Math.min(e.length,16);for(let n=0;n<t;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof dl||(e instanceof _l||e instanceof Il&&Boolean(e.texture))))}function ec(e,t,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(e[t]){const i=e[t];for(let e=0,t=n.length;e<t;++e)i[e]=n[e]}else e[t]=n.slice();else e[t]=n}function tc(){let e=null;return(t,n,i)=>{const r=e!==i;return r&&(t.uniform1i(n,i),e=i),r}}function nc(e,t,n,i){let r=null,o=null;return(s,a,l)=>{const c=t(l,n),u=c.length;let h=!1;if(null===r)r=new Float32Array(u),o=u,h=!0;else{Ua(o===u,"Uniform length cannot change.");for(let e=0;e<u;++e)if(c[e]!==r[e]){h=!0;break}}return h&&(i(s,e,a,c),r.set(c)),h}}function ic(e,t,n,i){e[t](n,i)}function rc(e,t,n,i){e[t](n,!1,i)}const oc=5126,sc=5124,ac=5125,lc={[oc]:[oc,1,"float"],35664:[oc,2,"vec2"],35665:[oc,3,"vec3"],35666:[oc,4,"vec4"],[sc]:[sc,1,"int"],35667:[sc,2,"ivec2"],35668:[sc,3,"ivec3"],35669:[sc,4,"ivec4"],[ac]:[ac,1,"uint"],36294:[ac,2,"uvec2"],36295:[ac,3,"uvec3"],36296:[ac,4,"uvec4"],35670:[oc,1,"bool"],35671:[oc,2,"bvec2"],35672:[oc,3,"bvec3"],35673:[oc,4,"bvec4"],35674:[oc,8,"mat2"],35685:[oc,8,"mat2x3"],35686:[oc,8,"mat2x4"],35675:[oc,12,"mat3"],35687:[oc,12,"mat3x2"],35688:[oc,12,"mat3x4"],35676:[oc,16,"mat4"],35689:[oc,16,"mat4x2"],35690:[oc,16,"mat4x3"]};function cc(e){const t=lc[e];if(!t)return null;const[n,i]=t;return{type:n,components:i}}function uc(e,t){switch(e){case 5120:case 5121:case 5122:case 5123:e=oc}for(const n in lc){const[i,r,o]=lc[n];if(i===e&&r===t)return{glType:n,name:o}}return null}class hc{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,n=t.getProgramParameter(e.handle,35721);for(let i=0;i<n;i++){const{name:n,type:r,size:o}=t.getActiveAttrib(e.handle,i),s=t.getAttribLocation(e.handle,n);s>=0&&this._addAttribute(s,n,r,o)}this.attributeInfos.sort(((e,t)=>e.location-t.location))}_readVaryingsFromProgram(e){const{gl:t}=e;if(!qs(t))return;const n=t.getProgramParameter(e.handle,35971);for(let i=0;i<n;i++){const{name:n,type:r,size:o}=t.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,n,r,o)}this.varyingInfos.sort(((e,t)=>e.location-t.location))}_addAttribute(e,t,n,i){const{type:r,components:o}=cc(n),s={type:r,size:i*o};this._inferProperties(e,t,s);const a={location:e,name:t,accessor:new nl(s)};this.attributeInfos.push(a),this.attributeInfosByLocation[e]=a,this.attributeInfosByName[a.name]=a}_inferProperties(e,t,n){/instance/i.test(t)&&(n.divisor=1)}_addVarying(e,t,n,i){const{type:r,components:o}=cc(n),s={location:e,name:t,accessor:new nl({type:r,size:i*o})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}const dc=35981,fc=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class pc extends Qa{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Program","v6.0",fc),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(e={}){const{hash:t,vs:n,fs:i,varyings:r,bufferMode:o=dc}=e;return this.hash=t||"",this.vs="string"==typeof n?new Ul(this.gl,{id:`${e.id}-vs`,source:n}):n,this.fs="string"==typeof i?new jl(this.gl,{id:`${e.id}-fs`,source:i}):i,Ua(this.vs instanceof Ul),Ua(this.fs instanceof jl),this.uniforms={},this._textureUniforms={},r&&r.length>0&&(Hs(this.gl),this.varyings=r,this.gl2.transformFeedbackVaryings(this.handle,r,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new hc(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:t=4,vertexCount:n,offset:i=0,start:r,end:o,isIndexed:s=!1,indexType:a=5123,instanceCount:l=0,isInstanced:c=l>0,vertexArray:u=null,transformFeedback:h,framebuffer:d,parameters:f={},uniforms:p,samplers:A}){if((p||A)&&(Gs.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(p||{})),Gs.priority>=e){const i=d?d.id:"default",r=`mode=${Va(this.gl,t)} verts=${n} instances=${l} indexType=${Va(this.gl,a)} isInstanced=${c} isIndexed=${s} Framebuffer=${i}`;Gs.log(e,r)()}return Ua(u),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===n||c&&0===l)&&(u.bindForDraw(n,l,(()=>{if(void 0!==d&&(f=Object.assign({},f,{framebuffer:d})),h){const e=function(e){switch(e){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return Ua(!1),0}}(t);h.begin(e)}this._bindTextures(),ka(this.gl,f,(()=>{s&&c?this.gl2.drawElementsInstanced(t,n,a,i,l):s&&qs(this.gl)&&!isNaN(r)&&!isNaN(o)?this.gl2.drawRangeElements(t,r,o,n,a,i):s?this.gl.drawElements(t,n,a,i):c?this.gl2.drawArraysInstanced(t,i,n,l):this.gl.drawArrays(t,i,n)})),h&&h.end()})),!0)}setUniforms(e={}){Gs.priority>=2&&function(e,t,n){for(const i in e){const r=e[i];if((!n||Boolean(n[i]))&&!Jl(r))throw t=t?`${t} `:"",console.error(`${t} Bad uniform ${i}`,r),new Error(`${t} Bad uniform ${i}`)}}(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const n=e[t],i=this._uniformSetters[t];if(i){let e=n,r=!1;if(e instanceof Il&&(e=e.texture),e instanceof dl)if(r=this.uniforms[t]!==n,r){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);const n=e,{textureIndex:r}=i;n.bind(r),e=r,this._textureUniforms[t]=n}else e=i.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(i(e)||r)&&ec(this.uniforms,t,n)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const n=this._textureUniforms[t];n.update(),e=e&&n.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),n={};for(const e of t){switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:n.vs=new Ul({handle:e});break;case 35632:n.fs=new jl({handle:e})}}return n}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const e=this._getName();this.id=Wa(e)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?`${e}-program`:"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Gs.time(4,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),Gs.timeEnd(4,`linkProgram for ${this._getName()}`)(),e.debug||Gs.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`);e.validateProgram(this.handle);if(!e.getProgramParameter(this.handle,35715))throw new Error(`Error validating: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const n=this.gl.getActiveUniform(this.handle,t),{name:i}=Kl(n.name);let r=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=Yl(e,r,n),n.size>1)for(let t=0;t<n.size;t++)r=e.getUniformLocation(this.handle,`${i}[${t}]`),this._uniformSetters[`${i}[${t}]`]=Yl(e,r,n)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}class Ac extends Qa{static isSupported(e,t=[]){const n=qs(e),i=Cl(e,Sl);let r=n||i;for(const e of t)switch(e){case"queries":r=r&&n;break;case"timers":r=r&&i;break;default:Ua(!1)}return r}constructor(e,t={}){super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(35007)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?36202:35887)}beginTransformFeedbackQuery(){return this.begin(35976)}begin(e){return this._queryPending||(this.target=e,this.gl2.beginQuery(this.target,this.handle)),this}end(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(36795)}getResult(){return this.gl2.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise(((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)})),this._pollingPromise}_createHandle(){return Ac.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class mc extends Qa{static isSupported(e){return qs(e)}constructor(e,t={}){Hs(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,qa(this.buffers)||this.bind((()=>this._unbindBuffers())),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind((()=>{for(const t in e)this.setBuffer(t,e[t])})),this}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteSize:r,byteOffset:o}=this._getBufferParams(t);return n<0?(this.unused[e]=i,Gs.warn((()=>`${this.id} unused varying buffer ${e}`))(),this):(this.buffers[n]=t,this.bindOnUse||this._bindBuffer(n,i,o,r),this)}begin(e=0){return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,n,i;return e instanceof sl==!1?(i=e.buffer,n=e.byteSize,t=e.byteOffset):i=e,void 0===t&&void 0===n||(t=t||0,n=n||i.byteLength-t),{buffer:i,byteOffset:t,byteSize:n}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:n,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,i,n)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t,n=0,i){const r=t&&t.handle;return r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let gc=null;function yc(e,t){var n;return new e((n=e.BYTES_PER_ELEMENT*t,(!gc||gc.byteLength<n)&&(gc=new ArrayBuffer(n)),gc),0,t)}class _c extends Qa{static isSupported(e,t={}){return!t.constantAttributeZero||(qs(e)||"Chrome"===function(e){if(!e&&!jr())return"Node";if(Ur(e))return"Electron";const t="undefined"!=typeof navigator?navigator:{},n=e||t.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r?"IE":Gr.chrome?"Chrome":Gr.safari?"Safari":Gr.mozInnerScreenX?"Firefox":"Unknown"}())}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new _c(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return _c.MAX_ATTRIBUTES=_c.MAX_ATTRIBUTES||e.getParameter(34921),_c.MAX_ATTRIBUTES}static setConstant(e,t,n){switch(n.constructor){case Float32Array:_c._setConstantFloatArray(e,t,n);break;case Int32Array:_c._setConstantIntArray(e,t,n);break;case Uint32Array:_c._setConstantUintArray(e,t,n);break;default:Ua(!1)}}constructor(e,t={}){const n=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:n})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return _c.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,t={}){return Ua(!e||34963===e.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind((()=>{this.gl.bindBuffer(34963,e?e.handle:null)})),this}setBuffer(e,t,n){if(34963===t.target)return this.setElementBuffer(t,n);const{size:i,type:r,stride:o,offset:s,normalized:a,integer:l,divisor:c}=n,{gl:u,gl2:h}=this;return e=Number(e),this.bind((()=>{u.bindBuffer(34962,t.handle),l?(Ua(qs(u)),h.vertexAttribIPointer(e,i,r,o,s)):u.vertexAttribPointer(e,i,r,a,o,s),u.enableVertexAttribArray(e),h.vertexAttribDivisor(e,c||0)})),this}enable(e,t=!0){return!t&&0===e&&!_c.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind((()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)))),this}getConstantBuffer(e,t){const n=this._normalizeConstantArrayValue(t),i=n.byteLength*e,r=n.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new sl(this.gl,i),o=o||this.buffer.reallocate(i),o=o||!this._compareConstantArrayValues(n,this.bufferValue),o){const e=yc(t.constructor,r);!function({target:e,source:t,start:n=0,count:i=1}){const r=t.length,o=i*r;let s=0;for(let i=n;s<r;s++)e[i++]=t[s];for(;s<o;)s<o-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+o-s),s=o)}({target:e,source:n,start:0,count:r}),this.buffer.subData(e),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}static _setConstantFloatArray(e,t,n){switch(n.length){case 1:e.vertexAttrib1fv(t,n);break;case 2:e.vertexAttrib2fv(t,n);break;case 3:e.vertexAttrib3fv(t,n);break;case 4:e.vertexAttrib4fv(t,n);break;default:Ua(!1)}}static _setConstantIntArray(e,t,n){switch(Ua(qs(e)),n.length){case 1:e.vertexAttribI1iv(t,n);break;case 2:e.vertexAttribI2iv(t,n);break;case 3:e.vertexAttribI3iv(t,n);break;case 4:e.vertexAttribI4iv(t,n);break;default:Ua(!1)}}static _setConstantUintArray(e,t,n){switch(Ua(qs(e)),n.length){case 1:e.vertexAttribI1uiv(t,n);break;case 2:e.vertexAttribI2uiv(t,n);break;case 3:e.vertexAttribI3uiv(t,n);break;case 4:e.vertexAttribI4uiv(t,n);break;default:Ua(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,{location:t}){return Ua(Number.isFinite(t)),this.bind((()=>34373===e?this.gl.getVertexAttribOffset(t,e):this.gl.getVertexAttrib(t,e)))}}const vc=/^(.+)__LOCATION_([0-9]+)$/,bc=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class xc{constructor(e,t={}){const n=t.id||t.program&&t.program.id;this.id=n,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new _c(e),Za(this,"VertexArray","v6.0",bc),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind((()=>{for(const t in e){const n=e[t];this._setAttribute(t,n)}this.gl.bindBuffer(34962,null)})),this}setElementBuffer(e=null,t={}){return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t,n={}){if(34963===t.target)return this.setElementBuffer(t,n);const{location:i,accessor:r}=this._resolveLocationAndAccessor(e,t,t.accessor,n);return i>=0&&(this.values[i]=t,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,t,r)),this}setConstant(e,t,n={}){const{location:i,accessor:r}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},n));return i>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[i]=t,this.accessors[i]=r,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new sl(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof sl&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))})),this}bindBuffers(){return this.vertexArrayObject.bind((()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof sl&&this.setBuffer(e,t)}})),this}bindForDraw(e,t,n){let i;return this.vertexArrayObject.bind((()=>{this._setConstantAttributes(e,t),i=n()})),i}_resolveLocationAndAccessor(e,t,n,i){const r={location:-1,accessor:null},{location:o,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=t,Gs.once(3,(()=>`unused value ${e} in ${this.id}`))(),r;const a=this._getAttributeInfo(s||o);if(!a)return r;const l=this.accessors[o]||{},c=nl.resolve(a.accessor,l,n,i),{size:u,type:h}=c;return Ua(Number.isFinite(u)&&Number.isFinite(h)),{location:o,accessor:c}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const n=vc.exec(e),i=n?n[1]:e,r=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+r,name:i}:{location:-1}}_setAttribute(e,t){if(t instanceof sl)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof sl){const n=t[0],i=t[1];this.setBuffer(e,n,i)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const n=t;this.setConstant(e,n)}else{if(!(t.buffer instanceof sl))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");{const n=t;this.setBuffer(e,n.buffer,n)}}}_setConstantAttributes(e,t){const n=Math.max(0|e,0|t);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,n);for(let e=1;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)i=this.values[e],ArrayBuffer.isView(i)&&this._setConstantAttribute(e,i)}_setConstantAttributeZero(e,t){if(_c.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,e);const n=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(e,t){_c.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const n=this.values[t],i=this.accessors[t];if(!n)return;const{divisor:r}=i,o=r>0;if(e.isInstanced=e.isInstanced||o,n instanceof sl){const t=n;if(o){const n=t.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,n)}else{const n=t.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,n)}}}setElements(e=null,t={}){return Gs.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function wc(e,t={}){const{isInteger:n=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return function(e,t){const{maxElts:n=16,size:i=1}=t;let r="[";for(let o=0;o<e.length&&o<n;++o)o>0&&(r+=","+(o%i==0?" ":"")),r+=wc(e[o],t);return`${r}${e.length>n?"...":"]"}`}(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return n?"0":"0.";if(n)return e.toFixed(0);if(Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const i=e.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function Ec({header:e="Uniforms",program:t,uniforms:n,undefinedOnly:i=!1}){Ua(t);const r=".*Matrix",o=t._uniformSetters,s={},a=Object.keys(o).sort();let l=0;for(const t of a)t.match(".*_.*")||t.match(r)||Sc({table:s,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&l++;for(const t of a)t.match(r)&&Sc({table:s,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&l++;for(const t of a)s[t]||Sc({table:s,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&l++;let c=0;const u={};if(!i)for(const t in n){const i=n[t];s[t]||(c++,u[t]={Type:`NOT USED: ${i}`,[e]:wc(i)})}return{table:s,count:l,unusedTable:u,unusedCount:c}}function Sc({table:e,header:t,uniforms:n,uniformName:i,undefinedOnly:r}){const o=n[i],s=function(e){return null!=e}(o);return(!r||!s)&&(e[i]={[t]:s?wc(o):"N/A","Uniform Type":s?o:"NOT PROVIDED"},!0)}function Tc(e,t,n,i){const{gl:r}=e;if(!t)return{[i]:"null","Format ":"N/A"};let o,s,a,l="NOT PROVIDED",c=1,u=0,h=0;if(n&&(l=n.type,c=n.size,l=String(l).replace("Array",""),o=-1!==l.indexOf("nt")),t instanceof sl){const e=t,{data:d,changed:f}=e.getDebugData();let p;if(s=f?"*":"",a=d,h=e.byteLength,u=h/d.BYTES_PER_ELEMENT/c,n){p=`${n.divisor>0?"I ":"P "} ${u} (x${c}=${h} bytes ${Va(r,l)})`}else o=!0,p=`${h} bytes`;return{[i]:`${s}${wc(a,{size:c,isInteger:o})}`,"Format ":p}}return a=t,c=t.length,l=String(t.constructor.name).replace("Array",""),o=-1!==l.indexOf("nt"),{[i]:`${wc(a,{size:c,isInteger:o})} (constant)`,"Format ":`${c}x${l} (constant)`}}function kc(e,t){const{type:n,size:i}=t,r=uc(n,i);return r?`${e} (${r.name})`:e}function Cc(e){const{type:t,size:n}=e.accessor,i=uc(t,n);return i?`${i.name} ${e.name}`:e.name}const Pc=zs.isBrowser()&&"undefined"!=typeof document;let Mc=0;class Ic{constructor(e={}){const{onCreateContext:t=(e=>Da(e)),onAddHTML:n=null,onInitialize:i=(()=>{}),onRender:r=(()=>{}),onFinalize:o=(()=>{}),onError:s,gl:a=null,glOptions:l={},debug:c=!1,createFramebuffer:u=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:d=!0,stats:f=Na.get("animation-loop-"+Mc++)}=e;let{useDevicePixels:p=!0}=e;"useDevicePixelRatio"in e&&(Gs.deprecated("useDevicePixelRatio","useDevicePixels")(),p=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:n,onInitialize:i,onRender:r,onFinalize:o,onError:s,gl:a,glOptions:l,debug:c,createFramebuffer:u},this.gl=a,this.needsRedraw=null,this.timeline=null,this.stats=f,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:d,useDevicePixels:p}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Ua("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then((()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Ac.isSupported(this.gl,["timers"])?new Ac(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps)))).then((e=>{this._running&&(this._addCallbackData(e||{}),!1!==e&&this._startLoop())}));return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,t=1){const n=document.getElementById(e);return n?Number(n.value):t}setViewParameters(){return Gs.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Pc?new Promise(((e,t)=>{Pc&&"complete"===document.readyState?e(document):window.addEventListener("load",(()=>{e(document)}))})):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):(t=e,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t));var t}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):(t=e,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60));var t}_renderFrame(...e){this.display?this.display._renderFrame(...e):this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){"object"==typeof e&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Oa(this.props.gl,e):this.onCreateContext(e),!$s(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Ta(this.gl,la),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let n=1;const{canvas:i}=this.gl;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&Ba(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Il(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Lc="vs",Rc="fs";function zc(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const Dc={number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},array:{validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Oc(e){let t=Bc(e);return"object"===t?e?"type"in e?Object.assign({},e,Dc[e.type]):"value"in e?(t=Bc(e.value),Object.assign({type:t},e,Dc[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},Dc[t])}function Bc(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}class Fc{constructor({name:e,vs:t,fs:n,dependencies:i=[],uniforms:r,getUniforms:o,deprecations:s=[],defines:a={},inject:l={},vertexShader:c,fragmentShader:u}){zc("string"==typeof e),this.name=e,this.vs=t||c,this.fs=n||u,this.getModuleUniforms=o,this.dependencies=i,this.deprecations=this._parseDeprecationDefinitions(s),this.defines=a,this.injections=function(e){const t={vs:{},fs:{}};for(const n in e){let i=e[n];const r=n.slice(0,2);"string"==typeof i&&(i={order:0,injection:i}),t[r][n]=i}return t}(l),r&&(this.uniforms=function(e){const t={};for(const n in e){const i=Oc(e[n]);t[n]=i}return t}(r))}getModuleSource(e){let t;switch(e){case"vs":t=this.vs||"";break;case"fs":t=this.fs||"";break;default:zc(!1)}return`#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}\n${t}// END MODULE_${this.name}\n\n`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach((n=>{n.regex.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(e){return e.forEach((e=>{if("function"===e.type)e.regex=new RegExp(`\\b${e.old}\\(`);else e.regex=new RegExp(`${e.type} ${e.old};`)})),e}_defaultGetUniforms(e={}){const t={},n=this.uniforms;for(const i in n){const r=n[i];i in e&&!r.private?(r.validate&&zc(r.validate(e[i],r),`${this.name}: invalid ${i}`),t[i]=e[i]):t[i]=r.value}return t}}function Nc(e){return function(e){const t={},n={};return Uc({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]))}(jc(e))}function Uc({modules:e,level:t,moduleMap:n,moduleDepth:i}){if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const r of e)n[r.name]=r,(void 0===i[r.name]||i[r.name]<t)&&(i[r.name]=t);for(const r of e)r.dependencies&&Uc({modules:r.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function jc(e,t){return e.map((e=>(e instanceof Fc||(zc("string"!=typeof e,`Shader module use by name is deprecated. Import shader module '${e}' and use it directly.`),zc(e.name,"shader module has no name"),(e=new Fc(e)).dependencies=jc(e.dependencies)),e)))}const Vc={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Gc={};Object.keys(Vc).forEach((e=>{Gc[e]=e}));const Wc={};function $c(e,t,n={}){const i=Vc[t];if(zc(i,t),!function(e={}){const t="undefined"!=typeof window&&window.navigator||{},n=e.userAgent||t.userAgent||"",i=-1!==n.indexOf("MSIE "),r=-1!==n.indexOf("Trident/");return i||r}(n))return!0;if(t in Wc)return Wc[t];const r=`#extension GL_${i[0]} : ${n.behavior||"enable"}\nvoid main(void) {}`,o=e.createShader(35633);e.shaderSource(o,r),e.compileShader(o);const s=e.getShaderParameter(o,35713);return e.deleteShader(o),Wc[t]=s,s}function qc(e,t){const n=Vc[t];zc(n,t);const i=function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}(e)&&n[1]||n[0],r="string"==typeof i?Boolean(e.getExtension(i)):i;return zc(!1===r||!0===r),r}function Zc(e,t){return(t=Array.isArray(t)?t:[t]).every((t=>qc(e,t)))}const Hc={[Lc]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[Rc]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Qc="__LUMA_INJECT_DECLARATIONS__",Xc=/void\s+main\s*\([^)]*\)\s*\{\n?/,Yc=/}\n?[^{}]*$/,Kc=[];function Jc(e,t,n,i=!1){const r=t===Lc;for(const t in n){const i=n[t];i.sort(((e,t)=>e.order-t.order)),Kc.length=i.length;for(let e=0,t=i.length;e<t;++e)Kc[e]=i[e].injection;const o=`${Kc.join("\n")}\n`;switch(t){case"vs:#decl":r&&(e=e.replace(Qc,o));break;case"vs:#main-start":r&&(e=e.replace(Xc,(e=>e+o)));break;case"vs:#main-end":r&&(e=e.replace(Yc,(e=>o+e)));break;case"fs:#decl":r||(e=e.replace(Qc,o));break;case"fs:#main-start":r||(e=e.replace(Xc,(e=>e+o)));break;case"fs:#main-end":r||(e=e.replace(Yc,(e=>o+e)));break;default:e=e.replace(t,(e=>e+o))}}return e=e.replace(Qc,""),i&&(e=e.replace(/\}\s*$/,(e=>e+Hc[t]))),e}function eu(e){const t={};return zc(Array.isArray(e)&&e.length>1),e.forEach((e=>{for(const n in e)t[n]=t[n]?`${t[n]}\n${e[n]}`:e[n]})),t}function tu(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}const nu=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],iu=[...nu,[tu("attribute"),"in $1"],[tu("varying"),"out $1"]],ru=[...nu,[tu("varying"),"in $1"]],ou=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],su=[...ou,[tu("in"),"attribute $1"],[tu("out"),"varying $1"]],au=[...ou,[tu("in"),"varying $1"]],lu="gl_FragColor",cu=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,uu=/void\s+main\s*\([^)]*\)\s*\{\n?/;function hu(e,t,n){switch(t){case 300:return n?du(e,iu):function(e){const t=(e=du(e,ru)).match(cu);if(t){const n=t[1];e=e.replace(new RegExp("\\bgl_FragColor\\b","g"),n)}else{const t="fragmentColor";e=e.replace(uu,(e=>`out vec4 ${t};\n${e}`)).replace(new RegExp("\\bgl_FragColor\\b","g"),t)}return e}(e);case 100:return n?du(e,su):function(e){const t=(e=du(e,au)).match(cu);if(t){const n=t[1];e=e.replace(cu,"").replace(new RegExp(`\\b${n}\\b`,"g"),lu)}return e}(e);default:throw new Error(`unknown GLSL version ${t}`)}}function du(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}const fu={[Lc]:"vertex",[Rc]:"fragment"};function pu(e,{id:t,source:n,type:i,modules:r,defines:o={},hookFunctions:s=[],inject:a={},transpileToGLSL100:l=!1,prologue:c=!0,log:u}){zc("string"==typeof n,"shader source must be a string");const h=i===Lc,d=n.split("\n");let f=100,p="",A=n;0===d[0].indexOf("#version ")?(f=300,p=d[0],A=d.slice(1).join("\n")):p=`#version ${f}`;const m={};r.forEach((e=>{Object.assign(m,e.getDefines())})),Object.assign(m,o);let g=c?`${p}\n${function({id:e,source:t,type:n}){return e&&"string"==typeof e&&-1===t.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${e}_${fu[n]}\n\n`:""}({id:t,source:n,type:i})}\n${function({type:e}){return`\n#define SHADER_TYPE_${fu[e].toUpperCase()}\n`}({type:i})}\n${function(e){const t=function(e){const t=e.getExtension("WEBGL_debug_renderer_info"),n=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||7936),i=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||7937),r=function(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/Apple/i)||t.match(/Apple/i)?"APPLE":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN"}(n,i);return{gpuVendor:r,vendor:n,renderer:i,version:e.getParameter(7938),shadingLanguageVersion:e.getParameter(35724)}}(e);switch(t.gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n"}}(e)}\n${function(e,t,n){let i="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return Zc(e,Gc.GLSL_FRAG_DEPTH)&&(i+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),Zc(e,Gc.GLSL_DERIVATIVES)&&$c(e,Gc.GLSL_DERIVATIVES)&&(i+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),Zc(e,Gc.GLSL_FRAG_DATA)&&$c(e,Gc.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),Zc(e,Gc.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),i}(e)}\n${function(e={}){let t=0,n="";for(const i in e){0===t&&(n+="\n// APPLICATION DEFINES\n"),t++;const r=e[i];(r||Number.isFinite(r))&&(n+=`#define ${i.toUpperCase()} ${e[i]}\n`)}0===t&&(n+="\n");return n}(m)}\n${h?"":"precision highp float;\n\n"}\n`:`${p}\n`;const y=function(e){const t={vs:{},fs:{}};return e.forEach((e=>{let n;"string"!=typeof e?(n=e,e=n.hook):n={},e=e.trim();const[i,r]=e.split(":"),o=e.replace(/\(.+/,"");t[i][o]=Object.assign(n,{signature:r})})),t}(s),_={},v={},b={};for(const e in a){const t="string"==typeof a[e]?{injection:a[e],order:0}:a[e],n=e.match(/^(v|f)s:(#)?([\w-]+)$/);if(n){const i=n[2],r=n[3];i?"decl"===r?v[e]=[t]:b[e]=[t]:_[e]=[t]}else b[e]=[t]}for(const e of r){u&&e.checkDeprecations(A,u);g+=e.getModuleSource(i,f);const t=e.injections[i];for(const e in t){const n=e.match(/^(v|f)s:#([\w-]+)$/);if(n){const i="decl"===n[2]?v:b;i[e]=i[e]||[],i[e].push(t[e])}else _[e]=_[e]||[],_[e].push(t[e])}}return g+="\n\n__LUMA_INJECT_DECLARATIONS__\n\n",g=Jc(g,i,v),g+=function(e,t){let n="";for(const i in e){const r=e[i];if(n+=`void ${r.signature} {\n`,r.header&&(n+=`  ${r.header}`),t[i]){const e=t[i];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+=`  ${t.injection}\n`}r.footer&&(n+=`  ${r.footer}`),n+="}\n"}return n}(y[i],_),g+=A,g=Jc(g,i,b),g=hu(g,l?100:f,h),g}function Au(e){return function(t){const n={};for(const i of e){const e=i.getUniforms(t,n);Object.assign(n,e)}return n}}const mu="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",gu=`#version 300 es\n${mu}`;function yu(e,t){t=Array.isArray(t)?t:[t];const n=e.replace(/^\s+/,"").split(/\s+/),[i,r,o]=n;if(!t.includes(i)||!r||!o)return null;return{qualifier:i,type:r,name:o.split(";")[0]}}function _u(e={}){const{version:t=100,input:n,inputType:i,output:r}=e;if(!n)return 300===t?gu:t>300?`#version ${t}\n${mu}`:"void main() {gl_FragColor = vec4(0);}";const o=function(e,t){switch(t){case"float":return`vec4(${e}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${e}, 0.0, 1.0)`;case"vec3":return`vec4(${e}, 1.0)`;case"vec4":return e;default:return zc(!1),null}}(n,i);return t>=300?`#version ${t} ${300===t?"es":""}\nin ${i} ${n};\nout vec4 ${r};\nvoid main() {\n  ${r} = ${o};\n}`:`varying ${i} ${n};\nvoid main() {\n  gl_FragColor = ${o};\n}`}const vu={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null};function bu(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}const xu={};function wu(e,{precision:t=xu.precision||4}={}){return e=function(e){return Math.round(e/xu.EPSILON)*xu.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function Eu(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Su(e,t,n){if(Eu(e)){n=n||((i=e).clone?i.clone():new Array(i.length));for(let i=0;i<n.length&&i<e.length;++i)n[i]=t(e[i],i,n);return n}var i;return t(e)}function Tu(e,t,n){return Su(e,(e=>Math.max(t,Math.min(n,e))))}function ku(e,t,n){return Eu(e)?e.map(((e,i)=>ku(e,t[i],n))):n*t+(1-n)*e}function Cu(e,t,n){const i=xu.EPSILON;n&&(xu.EPSILON=n);try{if(e===t)return!0;if(Eu(e)&&Eu(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Cu(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):!(!Number.isFinite(e)||!Number.isFinite(t))&&Math.abs(e-t)<=xu.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{xu.EPSILON=i}}xu.EPSILON=1e-12,xu.debug=!1,xu.precision=4,xu.printTypes=!1,xu.printDegrees=!1,xu.printRowMajor=!0;class Pu extends(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array)){get ELEMENTS(){return bu(!1),0}clone(){return(new this.constructor).copy(this)}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}to(e){return e===this?this:Eu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(xu)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+wu(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Cu(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){void 0===n&&(n=t,t=e,e=this);for(let i=0;i<this.ELEMENTS;++i){const r=e[i];this[i]=r+n*(t[i]-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if(Array.isArray(e))return this.multiply(e);for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.scale(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}multiplyByScalar(e){return this.scale(e)}get elements(){return this}check(){if(xu.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}}function Mu(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${e}`);return e}function Iu(e,t,n=""){if(xu.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}const Lu={};function Ru(e,t){Lu[e]||(Lu[e]=!0,console.warn(`${e} has been removed in version ${t}, see upgrade guide for more information`))}class zu extends Pu{get ELEMENTS(){return bu(!1),0}copy(e){return bu(!1),this}get x(){return this[0]}set x(e){this[0]=Mu(e)}get y(){return this[1]}set y(e){this[1]=Mu(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return Mu(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return Mu(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return bu(e>=0&&e<this.ELEMENTS,"index is out of range"),Mu(this[e])}setComponent(e,t){return bu(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}function Du(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o||1;return e[0]=(n[0]*i+n[4]*r+n[8]*o)/s,e[1]=(n[1]*i+n[5]*r+n[9]*o)/s,e[2]=(n[2]*i+n[6]*r+n[10]*o)/s,e}const Ou=[0,0,0],Bu={};class Fu extends zu{static get ZERO(){return Bu.ZERO=Bu.ZERO||Object.freeze(new Fu(0,0,0,0))}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&Eu(e)?this.copy(e):(xu.debug&&(Mu(e),Mu(t),Mu(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return xu.debug&&(Mu(e.x),Mu(e.y),Mu(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Mu(e)}angle(e){return n=e,i=(t=this)[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2],c=Math.sqrt(i*i+r*r+o*o)*Math.sqrt(s*s+a*a+l*l),u=c&&le(t,n)/c,Math.acos(Math.min(Math.max(u,-1),1));var t,n,i,r,o,s,a,l,c,u}cross(e){return ce(this,this,e),this.check()}rotateX({radians:e,origin:t=Ou}){return function(e,t,n,i){var r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Ou}){return function(e,t,n,i){var r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Ou}){return function(e,t,n,i){var r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return ue(this,this,e),this.check()}transformAsVector(e){return Du(this,this,e),this.check()}transformByMatrix3(e){return he(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,n){var i=n[0],r=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2],u=r*c-o*l,h=o*a-i*c,d=i*l-r*a,f=r*d-o*h,p=o*u-i*d,A=i*h-r*u,m=2*s;u*=m,h*=m,d*=m,f*=2,p*=2,A*=2,e[0]=a+u+f,e[1]=l+h+p,e[2]=c+d+A}(this,this,e),this.check()}}class Nu extends Pu{get ELEMENTS(){return bu(!1),0}get RANK(){return bu(!1),0}toString(){let e="[";if(xu.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=Mu(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[n+e];return t}setColumn(e,t){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)this[n+e]=t[e];return this}}function Uu(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1],p=n[2],A=n[3],m=n[4],g=n[5],y=n[6],_=n[7],v=n[8];return e[0]=d*i+f*s+p*c,e[1]=d*r+f*a+p*u,e[2]=d*o+f*l+p*h,e[3]=A*i+m*s+g*c,e[4]=A*r+m*a+g*u,e[5]=A*o+m*l+g*h,e[6]=y*i+_*s+v*c,e[7]=y*r+_*a+v*u,e[8]=y*o+_*l+v*h,e}function ju(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}const Vu=Object.freeze([1,0,0,0,1,0,0,0,1]),Gu=Object.freeze([0,0,0,0,0,0,0,0,0]),Wu=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),$u={};class qu extends Nu{static get IDENTITY(){return $u.IDENTITY=$u.IDENTITY||Object.freeze(new qu(Vu)),$u.IDENTITY}static get ZERO(){return $u.ZERO=$u.ZERO||Object.freeze(new qu(Gu)),$u.ZERO}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Wu}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}set(e,t,n,i,r,o,s,a,l){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this.check()}setRowMajor(e,t,n,i,r,o,s,a,l){return this[0]=e,this[1]=i,this[2]=s,this[3]=t,this[4]=r,this[5]=a,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return t=(e=this)[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],t*(c*o-s*l)+n*(-c*r+s*a)+i*(l*r-o*a);var e,t,n,i,r,o,s,a,l,c}identity(){return this.copy(Vu)}fromQuaternion(e){return function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,f=r*a,p=r*l,A=o*s,m=o*a,g=o*l;e[0]=1-h-p,e[3]=u-g,e[6]=d+m,e[1]=u+g,e[4]=1-c-p,e[7]=f-A,e[2]=d-m,e[5]=f+A,e[8]=1-c-h}(this,e),this.check()}transpose(){return function(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){return function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,f=c*o-s*l,p=n*h+i*d+r*f;p&&(p=1/p,e[0]=h*p,e[1]=(-u*i+r*c)*p,e[2]=(a*i-r*s)*p,e[3]=d*p,e[4]=(u*n-r*l)*p,e[5]=(-a*n+r*o)*p,e[6]=f*p,e[7]=(-c*n+i*l)*p,e[8]=(s*n-i*o)*p)}(this,this),this.check()}multiplyLeft(e){return Uu(this,e,this),this.check()}multiplyRight(e){return Uu(this,this,e),this.check()}rotate(e){return function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),f=Math.cos(n);e[0]=f*i+d*s,e[1]=f*r+d*a,e[2]=f*o+d*l,e[3]=f*s-d*i,e[4]=f*a-d*r,e[5]=f*l-d*o,e[6]=c,e[7]=u,e[8]=h}(this,this,e),this.check()}scale(e){return Array.isArray(e)?ju(this,this,e):ju(this,this,[e,e,e]),this.check()}translate(e){return function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],f=n[1];e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*i+f*s+c,e[7]=d*r+f*a+u,e[8]=d*o+f*l+h}(this,this,e),this.check()}transform(e,t){switch(e.length){case 2:t=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e}(t||[-0,-0],e,this);break;case 3:t=he(t||[-0,-0,-0],e,this);break;case 4:t=function(e,t,n){const i=t[0],r=t[1],o=t[2];return e[0]=n[0]*i+n[3]*r+n[6]*o,e[1]=n[1]*i+n[4]*r+n[7]*o,e[2]=n[2]*i+n[5]*r+n[8]*o,e[3]=t[3],e}(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Iu(t,e.length),t}transformVector(e,t){return Ru("Matrix3.transformVector"),this.transform(e,t)}transformVector2(e,t){return Ru("Matrix3.transformVector"),this.transform(e,t)}transformVector3(e,t){return Ru("Matrix3.transformVector"),this.transform(e,t)}}const Zu=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Hu=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Qu=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Xu={};class Yu extends Nu{static get IDENTITY(){return Xu.IDENTITY=Xu.IDENTITY||Object.freeze(new Yu(Zu)),Xu.IDENTITY}static get ZERO(){return Xu.ZERO=Xu.ZERO||Object.freeze(new Yu(Hu)),Xu.ZERO}get INDICES(){return Qu}get ELEMENTS(){return 16}get RANK(){return 4}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=A,this.check()}setRowMajor(e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=c,this[7]=f,this[8]=n,this[9]=s,this[10]=u,this[11]=p,this[12]=i,this[13]=a,this[14]=h,this[15]=A,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Zu)}fromQuaternion(e){return function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,f=r*a,p=r*l,A=o*s,m=o*a,g=o*l;e[0]=1-h-p,e[1]=u+g,e[2]=d-m,e[3]=0,e[4]=u-g,e[5]=1-c-p,e[6]=f+A,e[7]=0,e[8]=d+m,e[9]=f-A,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum({left:e,right:t,bottom:n,top:i,near:r,far:o}){return o===1/0?Yu._computeInfinitePerspectiveOffCenter(this,e,t,n,i,r):function(e,t,n,i,r,o,s){var a=1/(n-t),l=1/(r-i),c=1/(o-s);e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0}(this,e,t,n,i,r,o),this.check()}static _computeInfinitePerspectiveOffCenter(e,t,n,i,r,o){const s=2*o/(n-t),a=2*o/(r-i),l=(n+t)/(n-t),c=(r+i)/(r-i),u=-2*o;return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=u,e[15]=0,e}lookAt(e,t,n){return 1===arguments.length&&({eye:e,center:t,up:n}=e),function(e,t,n,i){var r,o,s,a,l,c,u,h,d,f,p=t[0],A=t[1],m=t[2],g=i[0],y=i[1],_=i[2],v=n[0],b=n[1],x=n[2];Math.abs(p-v)<j&&Math.abs(A-b)<j&&Math.abs(m-x)<j?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(u=p-v,h=A-b,d=m-x,r=y*(d*=f=1/Math.hypot(u,h,d))-_*(h*=f),o=_*(u*=f)-g*d,s=g*h-y*u,(f=Math.hypot(r,o,s))?(r*=f=1/f,o*=f,s*=f):(r=0,o=0,s=0),a=h*s-d*o,l=d*r-u*s,c=u*o-h*r,(f=Math.hypot(a,l,c))?(a*=f=1/f,l*=f,c*=f):(a=0,l=0,c=0),e[0]=r,e[1]=a,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*p+o*A+s*m),e[13]=-(a*p+l*A+c*m),e[14]=-(u*p+h*A+d*m),e[15]=1)}(this,e,t=t||[0,0,0],n=n||[0,1,0]),this.check()}ortho({left:e,right:t,bottom:n,top:i,near:r=.1,far:o=500}){return function(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1}(this,e,t,n,i,r,o),this.check()}orthographic({fovy:e=45*Math.PI/180,aspect:t=1,focalDistance:n=1,near:i=.1,far:r=500}){if(e>2*Math.PI)throw Error("radians");const o=e/2,s=n*Math.tan(o),a=s*t;return(new Yu).ortho({left:-a,right:a,bottom:-s,top:s,near:i,far:r})}perspective({fovy:e,fov:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}={}){if((e=e||t)>2*Math.PI)throw Error("radians");return ee(this,e,n,i,r),this.check()}determinant(){return t=(e=this)[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],A=e[14],m=e[15],(t*s-n*o)*(h*m-d*A)-(t*a-i*o)*(u*m-d*p)+(t*l-r*o)*(u*A-h*p)+(n*a-i*s)*(c*m-d*f)-(n*l-r*s)*(c*A-h*f)+(i*l-r*a)*(c*p-u*f);var e,t,n,i,r,o,s,a,l,c,u,h,d,f,p,A,m}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=null){const n=this.getScale(t||[-0,-0,-0]),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=null){const n=this.getScale(t||[-0,-0,-0]),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*o,e}transpose(){return function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return H(this,this),this.check()}multiplyLeft(e){return Q(this,e,this),this.check()}multiplyRight(e){return Q(this,this,e),this.check()}rotateX(e){return K(this,this,e),this.check()}rotateY(e){return function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r}(this,this,e),this.check()}rotateZ(e){return J(this,this,e),this.check()}rotateXYZ([e,t,n]){return this.rotateX(e).rotateY(t).rotateZ(n)}rotateAxis(e,t){return function(e,t,n,i){var r,o,s,a,l,c,u,h,d,f,p,A,m,g,y,_,v,b,x,w,E,S,T,k,C=i[0],P=i[1],M=i[2],I=Math.hypot(C,P,M);I<j||(C*=I=1/I,P*=I,M*=I,r=Math.sin(n),s=1-(o=Math.cos(n)),a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],A=t[8],m=t[9],g=t[10],y=t[11],_=C*C*s+o,v=P*C*s+M*r,b=M*C*s-P*r,x=C*P*s-M*r,w=P*P*s+o,E=M*P*s+C*r,S=C*M*s+P*r,T=P*M*s-C*r,k=M*M*s+o,e[0]=a*_+h*v+A*b,e[1]=l*_+d*v+m*b,e[2]=c*_+f*v+g*b,e[3]=u*_+p*v+y*b,e[4]=a*x+h*w+A*E,e[5]=l*x+d*w+m*E,e[6]=c*x+f*w+g*E,e[7]=u*x+p*w+y*E,e[8]=a*S+h*T+A*k,e[9]=l*S+d*T+m*k,e[10]=c*S+f*T+g*k,e[11]=u*S+p*T+y*k,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return Array.isArray(e)?Y(this,this,e):Y(this,this,[e,e,e]),this.check()}translate(e){return X(this,this,e),this.check()}transform(e,t){return 4===e.length?(Iu(t=W(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;switch(n){case 2:t=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}(t||[-0,-0],e,this);break;case 3:t=ue(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Iu(t,e.length),t}transformAsVector(e,t){switch(e.length){case 2:t=function(e,t,n){const i=t[0],r=t[1],o=n[3]*i+n[7]*r||1;return e[0]=(n[0]*i+n[4]*r)/o,e[1]=(n[1]*i+n[5]*r)/o,e}(t||[-0,-0],e,this);break;case 3:t=Du(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Iu(t,e.length),t}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}transformPoint(e,t){return Ru("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,t)}transformVector(e,t){return Ru("Matrix4.transformVector","3.0"),this.transformAsPoint(e,t)}transformDirection(e,t){return Ru("Matrix4.transformDirection","3.0"),this.transformAsVector(e,t)}}function Ku(){var e=new V(4);return V!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ju(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function eh(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+s*a+r*c-o*l,e[1]=r*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-r*a,e[3]=s*u-i*a-r*l-o*c,e}function th(e,t,n,i){var r,o,s,a,l,c=t[0],u=t[1],h=t[2],d=t[3],f=n[0],p=n[1],A=n[2],m=n[3];return(o=c*f+u*p+h*A+d*m)<0&&(o=-o,f=-f,p=-p,A=-A,m=-m),1-o>j?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(a=1-i,l=i),e[0]=a*c+l*f,e[1]=a*u+l*p,e[2]=a*h+l*A,e[3]=a*d+l*m,e}function nh(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*s+s]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*o+s]-t[3*s+o])*n,e[o]=(t[3*o+r]+t[3*r+o])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e}var ih,rh,oh,sh=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},ah=G,lh=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},ch=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e[3]=a+i*(n[3]-a),e},uh=function(e){var t=e[0],n=e[1],i=e[2],r=e[3];return Math.hypot(t,n,i,r)},hh=function(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r},dh=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=o*s,e},fh=(ih=se(),rh=ae(1,0,0),oh=ae(0,1,0),function(e,t,n){var i=le(t,n);return i<-.999999?(ce(ih,rh,t),pe(ih)<1e-6&&ce(ih,oh,t),function(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o}(ih,ih),Ju(e,ih,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(ce(ih,t,n),e[0]=ih[0],e[1]=ih[1],e[2]=ih[2],e[3]=1+i,dh(e,e))});Ku(),Ku(),function(){var e=new V(9);V!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1}();const ph=[0,0,0,1];class Ah extends Pu{constructor(e=0,t=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&1===arguments.length?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromMatrix3(e){return nh(this,e),this.check()}identity(){return function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1}(this),this.check()}fromAxisRotation(e,t){return Ju(this,e,t),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Mu(e)}get y(){return this[1]}set y(e){this[1]=Mu(e)}get z(){return this[2]}set z(e){this[2]=Mu(e)}get w(){return this[3]}set w(e){this[3]=Mu(e)}len(){return uh(this)}lengthSquared(){return hh(this)}dot(e,t){if(void 0!==t)throw new Error("Quaternion.dot only takes one argument");return lh(this,e)}rotationTo(e,t){return fh(this,e,t),this.check()}add(e,t){if(void 0!==t)throw new Error("Quaternion.add only takes one argument");return sh(this,this,e),this.check()}calculateW(){return function(e,t){var n=t[0],i=t[1],r=t[2];e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r))}(this,this),this.check()}conjugate(){return function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3]}(this,this),this.check()}invert(){return function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=o*a}(this,this),this.check()}lerp(e,t,n){return ch(this,e,t,n),this.check()}multiplyRight(e,t){return bu(!t),eh(this,this,e),this.check()}multiplyLeft(e,t){return bu(!t),eh(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-i*a}(this,this,e),this.check()}rotateY(e){return function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l-o*a,e[1]=r*l+s*a,e[2]=o*l+i*a,e[3]=s*l-r*a}(this,this,e),this.check()}rotateZ(e){return function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a}(this,this,e),this.check()}scale(e){return ah(this,this,e),this.check()}slerp(e,t,n){switch(arguments.length){case 1:({start:e=ph,target:t,ratio:n}=arguments[0]);break;case 2:[t,n]=arguments,e=this}return th(this,e,t,n),this.check()}transformVector4(e,t=e){return function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*o-l*r,h=c*r+l*i-s*o,d=c*o+s*r-a*i,f=-s*i-a*r-l*o;e[0]=u*c+f*-s+h*-l-d*-a,e[1]=h*c+f*-a+d*-s-u*-l,e[2]=d*c+f*-l+u*-a-h*-s,e[3]=t[3]}(t,e,this),Iu(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e,t){return this.multiplyLeft(e,t)}multiply(e,t){return this.multiplyRight(e,t)}}var mh=1e-15,gh=1e-20,yh=(Math.PI,Math.PI,Math.PI,Math.PI,"#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n");const _h={lightSources:{}};function vh({color:e=[0,0,0],intensity:t=1}={}){return e.map((e=>e*t/255))}const bh={name:"lights",vs:yh,fs:yh,getUniforms:function e(t=_h){if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},function({ambientLight:e,pointLights:t=[],directionalLights:n=[]}){const i={};return i["lighting_uAmbientLight.color"]=e?vh(e):[0,0,0],t.forEach(((e,t)=>{i[`lighting_uPointLight[${t}].color`]=vh(e),i[`lighting_uPointLight[${t}].position`]=e.position,i[`lighting_uPointLight[${t}].attenuation`]=e.attenuation||[1,0,0]})),i.lighting_uPointLightCount=t.length,n.forEach(((e,t)=>{i[`lighting_uDirectionalLight[${t}].color`]=vh(e),i[`lighting_uDirectionalLight[${t}].direction`]=e.direction})),i.lighting_uDirectionalLightCount=n.length,i}({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const n={pointLights:[],directionalLights:[]};for(const e of t.lights||[])switch(e.type){case"ambient":n.ambientLight=e;break;case"directional":n.directionalLights.push(e);break;case"point":n.pointLights.push(e)}return e({lightSources:n})}return{}},defines:{MAX_LIGHTS:3}},xh={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};const wh={name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(e=xh){const t={};if(void 0!==e.pickingSelectedColor)if(e.pickingSelectedColor){const n=e.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=n}else t.picking_uSelectedColorValid=0;if(e.pickingHighlightColor){const n=Array.from(e.pickingHighlightColor,(e=>e/255));Number.isFinite(n[3])||(n[3]=1),t.picking_uHighlightColor=n}return void 0!==e.pickingActive&&(t.picking_uActive=Boolean(e.pickingActive),t.picking_uAttribute=Boolean(e.pickingAttribute)),t}};var Eh="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";const Sh={};function Th(e=Sh){if(!("material"in e))return{};const{material:t}=e;return t?function(e){const{ambient:t=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map((e=>e/255))}}(t):{lighting_uEnabled:!1}}const kh={name:"gouraud-lighting",dependencies:[bh],vs:Eh,defines:{LIGHTING_VERTEX:1},getUniforms:Th},Ch={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null};class Ph{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Ph(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find((t=>t.name===e.name))||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t)),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:t="",fs:n="",defines:i={},inject:r={},varyings:o=[],bufferMode:s=35981,transpileToGLSL100:a=!1}=e,l=this._getModuleList(e.modules),c=this._getHash(t),u=this._getHash(n),h=l.map((e=>this._getHash(e.name))).sort(),d=o.map((e=>this._getHash(e))),f=Object.keys(i).sort(),p=Object.keys(r).sort(),A=[],m=[];for(const e of f)A.push(this._getHash(e)),A.push(this._getHash(i[e]));for(const e of p)m.push(this._getHash(e)),m.push(this._getHash(r[e]));const g=`${c}/${u}D${A.join("/")}M${h.join("/")}I${m.join("/")}V${d.join("/")}H${this.stateHash}B${s}${a?"T":""}`;if(!this._programCache[g]){const e=function(e,t){const{vs:n,fs:i}=t,r=Nc(t.modules||[]);return{gl:e,vs:pu(e,Object.assign({},t,{source:n,type:Lc,modules:r})),fs:pu(e,Object.assign({},t,{source:i,type:Rc,modules:r})),getUniforms:Au(r)}}(this.gl,{vs:t,fs:n,modules:l,inject:r,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:a});this._programCache[g]=new pc(this.gl,{hash:g,vs:e.vs,fs:e.fs,varyings:o,bufferMode:s}),this._getUniforms[g]=e.getUniforms||(e=>{}),this._useCounts[g]=0}return this._useCounts[g]++,this._programCache[g]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let e=0,r=this._defaultModules.length;e<r;++e){const r=this._defaultModules[e],o=r.name;t[i++]=r,n[o]=!0}for(let r=0,o=e.length;r<o;++r){const o=e[r],s=o.name;n[s]||(t[i++]=o,n[s]=!0)}return t.length=i,t}}const Mh={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Ih(e,t){const{attributeMap:n=Mh}=t||{};return n&&n[e]||e}function Lh(e,t){let n;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2}Ua(Number.isFinite(t.size),`attribute ${e} needs size`)}const Rh=()=>{},zh={};class Dh{constructor(e,t={}){const{id:n=Wa("model")}=t;Ua($s(e)),this.id=n,this.gl=e,this.id=t.id||Wa("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||Ph.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:n,fs:i,modules:r,defines:o,inject:s,varyings:a,bufferMode:l,transpileToGLSL100:c}=e;this.programProps={program:t,vs:n,fs:i,modules:r,defines:o,inject:s,varyings:a,bufferMode:l,transpileToGLSL100:c},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=void 0!==e.drawMode?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Ua(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:n,fs:i,modules:r,defines:o,inject:s,varyings:a,bufferMode:l,transpileToGLSL100:c}=e;this.programProps={program:t,vs:n,fs:i,modules:r,defines:o,inject:s,varyings:a,bufferMode:l,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Ua(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Ua(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(e,t,n){const i={};let r=t.indices;for(const o in t.attributes){const s=t.attributes[o],a=Ih(o,n);if("indices"===o)r=s;else if(s.constant)i[a]=s.value;else{const t=s.value,n={...s};delete n.value,i[a]=[new sl(e,t),n],Lh(o,n)}}if(r){const t=r.value||r;Ua(t instanceof Uint16Array||t instanceof Uint32Array,'attribute array for "indices" must be of integer type');const n={size:1,isIndexed:void 0===r.isIndexed||r.isIndexed};i.indices=[new sl(e,{data:t,target:34963}),n]}return i}(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(qa(e))return this;const t={};for(const n in e){const i=e[n];t[n]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(t),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return bl(this.program.gl,e),this}draw(e={}){this._checkProgram();const{moduleSettings:t=null,framebuffer:n,uniforms:i={},attributes:r={},transformFeedback:o=this.transformFeedback,parameters:s={},vertexArray:a=this.vertexArray}=e;let l;this.setAttributes(r),this.updateModuleSettings(t),this.setUniforms(i),Gs.priority>=2&&(l=this._logDrawCallStart(2));const c=this.vertexArray.getDrawParams(),{isIndexed:u=c.isIndexed,indexType:h=c.indexType,indexOffset:d=c.indexOffset,vertexArrayInstanced:f=c.isInstanced}=this.props;f&&!this.isInstanced&&Gs.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:p,instanceCount:A}=this,{onBeforeRender:m=Rh,onAfterRender:g=Rh}=this.props;m(),this.program.setUniforms(this.uniforms);const y=this.program.draw(Object.assign(zh,e,{logPriority:l,uniforms:null,framebuffer:n,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:a,transformFeedback:o,isIndexed:u,indexType:h,isInstanced:p,instanceCount:A,offset:u?d:0}));return g(),Gs.priority>=2&&this._logDrawCallEnd(l,a,n),y}transform(e={}){const{discard:t=!0,feedbackBuffers:n,unbindModels:i=[]}=e;let{parameters:r}=e;n&&this._setFeedbackBuffers(n),t&&(r=Object.assign({},r,{35977:t})),i.forEach((e=>e.vertexArray.unbindBuffers()));try{this.draw(Object.assign({},e,{parameters:r}))}finally{i.forEach((e=>e.vertexArray.bindBuffers()))}return this}render(e={}){return Gs.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:e}=this.programProps;if(e)this._managedProgram=!1;else{const{vs:t,fs:n,modules:i,inject:r,defines:o,varyings:s,bufferMode:a,transpileToGLSL100:l}=this.programProps;e=this.programManager.get({vs:t,fs:n,modules:i,inject:r,defines:o,varyings:s,bufferMode:a,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Ua(e instanceof pc,"Model needs a program"),this._programDirty=!1,e!==this.program&&(this.program=e,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new xc(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof sl&&t.delete()}}_setAnimationProps(e){this.animated&&Ua(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(e={}){if(qa(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new mc(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:1e4;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),Gs.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:Gs.level<=2})(),e}_logDrawCallEnd(e,t,n,i){if(void 0===e)return;const r=function({vertexArray:e,header:t="Attributes"}){if(!e.configuration)return{};const n={};e.elements&&(n.ELEMENT_ARRAY_BUFFER=Tc(e,e.elements,null,t));const i=e.values;for(const r in i){const o=e._getAttributeInfo(r);if(o){let s=`${r}: ${o.name}`;const a=e.accessors[o.location];a&&(s=`${r}: ${kc(o.name,a)}`),n[s]=Tc(e,i[r],a,t)}}return n}({vertexArray:t,header:`${this.id} attributes`,attributes:this._attributes}),{table:o,unusedTable:s,unusedCount:a}=Ec({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:l,count:c}=Ec({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});c>0&&Gs.log("MISSING UNIFORMS",Object.keys(l))(),a>0&&Gs.log("UNUSED UNIFORMS",Object.keys(s))();const u=function(e){const t={},n=`Accessors for ${e.id}`;for(const i of e.attributeInfos)i&&(t[`in ${Cc(i)}`]={[n]:JSON.stringify(i.accessor)});for(const i of e.varyingInfos)i&&(t[`out ${Cc(i)}`]={[n]:JSON.stringify(i.accessor)});return t}(this.vertexArray.configuration);Gs.table(e,r)(),Gs.table(e,o)(),Gs.table(e+1,u)(),i&&i.log({logLevel:2,message:`Rendered to ${i.id}`}),Gs.groupEnd(2,`>>> DRAWING MODEL ${this.id}`)()}}class Oh{constructor(e,t={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(e={}){const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(e={}){const t=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:i}=t;return{attributes:Object.assign({},n,e.attributes),transformFeedback:i}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],n=e?t[e]:null;return n?n instanceof sl?n:n.buffer:null}getData(e={}){const{varyingName:t}=e,n=this.getBuffer(t);return n?n.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Ua(qs(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const e in this.feedbackMap){const i=this.feedbackMap[e];e in t&&(n[i]=e)}Object.assign(n,e.feedbackBuffers);for(const e in n){const i=n[e];if("string"==typeof i){const r=t[i],{byteLength:o,usage:s,accessor:a}=r;n[e]=this._createNewBuffer(e,{byteLength:o,usage:s,accessor:a})}}return n}_setupBuffers(e={}){const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const n=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:n})}_setupTransformFeedback(e,{model:t}){const{program:n}=t;e.transformFeedback=new mc(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:t}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:e,feedbackBuffers:t})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),n=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const r=this.feedbackMap[i];t[i]=e.feedbackBuffers[r],n[r]=e.sourceBuffers[i],Ua(n[r]instanceof sl)}return{sourceBuffers:t,feedbackBuffers:n}}_createNewBuffer(e,t){const n=new sl(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}function Bh({vs:e,sourceTextureMap:t,targetTextureVarying:n,targetTexture:i}){let r=Object.keys(t).length,o=null;const s={};let a=e,l={};if(r>0||n){const e=a.split("\n"),c=e.slice();if(e.forEach(((e,i,a)=>{if(r>0){const n=function(e,t){const n={},i=function(e){return yu(e,["attribute","in"])}(e);if(!i)return null;const{type:r,name:o}=i;if(o&&t[o]){const t=`// ${e} => Replaced by Transform with a sampler`,{samplerName:i,sizeName:s,uniformDeclerations:a}=function(e){const t=`transform_uSampler_${e}`,n=`transform_uSize_${e}`;return{samplerName:t,sizeName:n,uniformDeclerations:`  uniform sampler2D ${t};\n  uniform vec2 ${n};`}}(o),l=function(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return zc(!1),null}}(r),c=`  ${r} ${o} = transform_getInput(${i}, ${s}).${l};\n`;n[i]=o;return{updatedLine:t,inject:{"vs:#decl":a,"vs:#main-start":c},samplerTextureMap:n}}return null}(e,t);if(n){const{updatedLine:e,inject:t}=n;c[i]=e,l=eu([l,t]),Object.assign(s,n.samplerTextureMap),r--}}n&&!o&&(o=function(e,t){const n=yu(e,["varying","out"]);if(!n)return null;return n.name===t?n.type:null}(e,n))})),n){Ua(i);const e=`transform_uSize_${n}`;l=eu([l,{"vs:#decl":`uniform vec2 ${e};\n`,"vs:#main-start":`     vec2 transform_position = transform_getPos(${e});\n     gl_Position = vec4(transform_position, 0, 1.);\n`}])}a=c.join("\n")}return{vs:a,targetTextureType:o,inject:l,samplerTextureMap:s}}const Fh={10241:9728,10240:9728,10242:33071,10243:33071};class Nh{constructor(e,t={}){this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(e={}){const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(e={}){const{sourceBuffers:t,sourceTextures:n,framebuffer:i,targetTexture:r}=this.bindings[this.currentIndex],o=Object.assign({},t,e.attributes),s=Object.assign({},e.uniforms),a=Object.assign({},e.parameters);let l=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const e in this.samplerTextureMap){const t=this.samplerTextureMap[e];s[e]=n[t]}this._setSourceTextureParameters();const e=function({sourceTextureMap:e,targetTextureVarying:t,targetTexture:n}){const i={};let r,o;t&&(({width:r,height:o}=n),i[`transform_uSize_${t}`]=[r,o]);for(const t in e)({width:r,height:o}=e[t]),i[`transform_uSize_${t}`]=[r,o];return i}({sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r});Object.assign(s,e)}return this.hasTargetTexture&&(l=!1,a.viewport=[0,0,i.width,i.height]),{attributes:o,framebuffer:i,uniforms:s,discard:l,parameters:a}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:t}=this.bindings[this.currentIndex],n=xl(t);if(!e)return n;const i=n.constructor,r=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return zc(!1),null}}(this.targetTextureType),o=new i(n.length*r/4);let s=0;for(let e=0;e<n.length;e+=4)for(let t=0;t<r;t++)o[s++]=n[e+t];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:t,_swapTexture:n}=e;this._swapTexture=n,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:n}=e;if(n instanceof fl)return n;const i=t[n];return i?(this._targetRefTexName=n,this._createNewTexture(i)):null}_setupTextures(e={}){const{sourceBuffers:t,_sourceTextures:n={},_targetTexture:i}=e,r=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:n,targetTexture:r}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if("number"!=typeof e||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach(((e,t,n)=>{n[t]=t})),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new sl(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:e,targetTexture:t}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:e,targetTexture:t})}}_updateBinding(e,t){const{sourceBuffers:n,sourceTextures:i,targetTexture:r}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,n),r){e.targetTexture=r;const{width:t,height:n}=r,{framebuffer:i}=e;i?(i.update({attachments:{36064:r},resizeAttachments:!1}),i.resize({width:t,height:n})):e.framebuffer=new Il(this.gl,{id:"transform-framebuffer",width:t,height:n,attachments:{36064:r}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const e in t)t[e].setParameters(Fh)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;return{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}}_createNewTexture(e){const t=Ll(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:t,targetTexture:n}=this.bindings[this.currentIndex],{vs:i,uniforms:r,targetTextureType:o,inject:s,samplerTextureMap:a}=Bh({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),l=eu([e.inject||{},s]);this.targetTextureType=o,this.samplerTextureMap=a;return{vs:i,fs:e._fs||_u({version:Fl(i),input:this.targetTextureVarying,inputType:o,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[Ch].concat(e.modules||[]):e.modules,uniforms:r,inject:l}}}class Uh{static isSupported(e){return qs(e)}constructor(e,t={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:n}=this;e&&e.delete(),t&&t.delete(),n&&n.delete()}run(e={}){const{clearRenderTarget:t=!0}=e,n=this._updateDrawOptions(e);t&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t)e=e||n.swap();Ua(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t){const t=n.getData(e);if(t)return t}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t)n.update(e)}_initialize(e={}){const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Dh(t,Object.assign({},e,{fs:e.fs||_u({version:Fl(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of n)t=e.updateModelProps(t);return t}_buildResourceTransforms(e,t){(function(e){if(!qa(e.feedbackBuffers)||!qa(e.feedbackMap)||e.varyings&&e.varyings.length>0)return!0;return!1})(t)&&(this.bufferTransform=new Oh(e,t)),function(e){if(!qa(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)return!0;return!1}(t)&&(this.textureTransform=new Nh(e,t)),Ua(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of n)t=Object.assign(t,e.getDrawOptions(t));return t}}const jh={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Vh{static get DRAW_MODE(){return jh}constructor(e={}){const{id:t=Wa("geometry"),drawMode:n=jh.TRIANGLES,attributes:i={},indices:r=null,vertexCount:o=null}=e;this.id=t,this.drawMode=0|n,this.attributes={},this.userData={},this._setAttributes(i,r),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const t in e){let n=e[t];n=ArrayBuffer.isView(n)?{value:n}:n,Ua(ArrayBuffer.isView(n.value),`${this._print(t)}: must be typed array or object with value as typed array`),"POSITION"!==t&&"positions"!==t||n.size||(n.size=3),"indices"===t?(Ua(!this.indices),this.indices=n):this.attributes[t]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const t in e){const i=e[t],{value:r,size:o,constant:s}=i;!s&&r&&o>=1&&(n=Math.min(n,r.length/o))}return Ua(Number.isFinite(n)),n}}let Gh=1,Wh=1;class $h{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,o=Gh++,s={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(s,this.time),this.channels.set(o,s),o}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const e of t)this._setChannelTime(e,this.time);const n=this.animations.values();for(const e of n){const{animation:t,channel:n}=e;t.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=Wh++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}var qh={name:"geometry",vs:"\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry;\n",fs:"\n#define SMOOTH_EDGE_RADIUS 0.5\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n"};const Zh={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Zh,"IDENTITY",{get:()=>Ds.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0});const Hh={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Qh={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Xh=Object.keys(Zh).map((e=>"const int COORDINATE_SYSTEM_".concat(e," = ").concat(Zh[e],";"))).join(""),Yh=Object.keys(Hh).map((e=>"const int PROJECTION_MODE_".concat(e," = ").concat(Hh[e],";"))).join("");var Kh="".concat(Xh,"\n").concat(Yh,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\n");function Jh(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function ed(e){let t,n={};return i=>{for(const r in i)if(!Jh(i[r],n[r])){t=e(i),n=i;break}return t}}const td=[0,0,0,0],nd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],id=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],rd=[0,0,0],od=[0,0,0],sd=ed((function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,n){const{viewMatrixUncentered:i,projectionMatrix:r}=e;let{viewMatrix:o,viewProjectionMatrix:s}=e,a=td,l=td,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=ad(e,t,n);d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=W([],l,s),o=i||o,s=Q([],r,o),s=Q([],s,nd));return{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,n,i),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=e.projectionMatrix.transform([0,0,-e.focalDistance,1])[3]||1,f={project_uCoordinateSystem:n,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:s.slice(0,3),project_uCenter:r,project_uViewportSize:h,project_uDevicePixelRatio:t,project_uFocalDistance:d,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:rd,project_uScale:e.scale,project_uViewProjectionMatrix:o,project_uCameraPosition:a};if(c){const t=e.getDistanceScales(c);switch(n){case Zh.METER_OFFSETS:f.project_uCommonUnitsPerWorldUnit=t.unitsPerMeter,f.project_uCommonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case Zh.LNGLAT:case Zh.LNGLAT_OFFSETS:f.project_uCommonUnitsPerWorldUnit=t.unitsPerDegree,f.project_uCommonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case Zh.CARTESIAN:f.project_uCommonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.project_uCommonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f}));function ad(e,t,n=od){let i,r=n,o=!0;switch(i=t===Zh.LNGLAT_OFFSETS||t===Zh.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Hh.WEB_MERCATOR:t!==Zh.LNGLAT&&t!==Zh.CARTESIAN||(o=!1);break;case Hh.WEB_MERCATOR_AUTO_OFFSET:t===Zh.LNGLAT?r=i:t===Zh.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Hh.IDENTITY:r=e.position.map(Math.fround);break;case Hh.GLOBE:o=!1,i=null;break;default:o=!1}return r[2]=r[2]||0,{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:o}}const ld={};var cd={name:"project",dependencies:[vu],vs:Kh,getUniforms:function(e=ld){return e.viewport?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=Zh.DEFAULT,coordinateOrigin:r,autoWrapLongitude:o=!1}={}){i===Zh.DEFAULT&&(i=e.isGeospatial?Zh.LNGLAT:Zh.CARTESIAN);const s=sd({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r});return s.project_uWrapLongitude=o,s.project_uModelMatrix=n||id,s}(e):{}}};var ud={name:"project32",dependencies:[cd],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    mat3 rotation = project_get_orientation_matrix(projectedPosition);\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"};const hd=ed((function({viewport:e,center:t}){return new Yu(e.viewProjectionMatrix).invert().transform(t)})),dd=ed((function({viewport:e,shadowMatrices:t}){const n=[],i=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,o=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map((e=>function(e,t){const[n,i,r]=e,o=Re([n,i,r],t);if(Number.isFinite(r))return o;return[o[0],o[1],0]}(e,i)));for(const i of t){const t=i.clone().translate(new Fu(e.center).negate()),r=o.map((e=>t.transform(e))),s=(new Yu).ortho({left:Math.min(...r.map((e=>e[0]))),right:Math.max(...r.map((e=>e[0]))),bottom:Math.min(...r.map((e=>e[1]))),top:Math.max(...r.map((e=>e[1]))),near:Math.min(...r.map((e=>-e[2]))),far:Math.max(...r.map((e=>-e[2])))});n.push(s.multiplyRight(i))}return n})),fd=[0,0,0,1],pd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];var Ad={name:"shadow",dependencies:[cd],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(e={},t={})=>{if(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0){const{shadowEnabled:n=!0}=e;return n&&e.shadowMatrices&&e.shadowMatrices.length>0?function(e={},t={}){const n={shadow_uDrawShadowMap:Boolean(e.drawToShadowMap),shadow_uUseShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,shadow_uColor:e.shadowColor||fd,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},i=hd({viewport:e.viewport,center:t.project_uCenter}),r=[],o=dd({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let n=0;n<e.shadowMatrices.length;n++){const s=o[n],a=s.clone().translate(new Fu(e.viewport.center).negate());t.project_uCoordinateSystem===Zh.LNGLAT&&t.project_uProjectionMode===Hh.WEB_MERCATOR?(o[n]=a,r[n]=i):(o[n]=s.clone().multiplyRight(pd),r[n]=a.transform(i))}for(let t=0;t<o.length;t++)n["shadow_uViewProjectionMatrices[".concat(t,"]")]=o[t],n["shadow_uProjectCenters[".concat(t,"]")]=r[t],e.shadowMaps&&e.shadowMaps.length>0?n["shadow_uShadowMap".concat(t)]=e.shadowMaps[t]:n["shadow_uShadowMap".concat(t)]=e.dummyShadowMap;return n}(e,t):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}},md={inject:{"vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  // for picking depth values\n  picking_setPickingAttribute(geometry.position.z);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}},...wh};const gd=[qh,cd],yd=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function _d(e){const t=Ph.getDefaultProgramManager(e);for(const e of gd)t.addDefaultModule(e);for(const e of yd)t.addShaderHook(e);return t}const vd=[255,255,255],bd=1;let xd=0;class wd{constructor(e={}){const{color:t=vd}=e,{intensity:n=bd}=e;this.id=e.id||"ambient-".concat(xd++),this.color=t,this.intensity=n,this.type="ambient"}}const Ed=[255,255,255],Sd=1,Td=[0,0,-1];let kd=0;class Cd{constructor(e={}){const{color:t=Ed}=e,{intensity:n=Sd}=e,{direction:i=Td}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-".concat(kd++),this.color=t,this.intensity=n,this.type="directional",this.direction=new Fu(i).normalize().toArray(),this.shadow=r}getProjectedLight(){return this}}class Pd{constructor(e={}){const{id:t="effect"}=e;this.id=t,this.props={...e}}preRender(){}getModuleParameters(){}cleanup(){}}class Md extends class{constructor(e,t={}){const{id:n="pass"}=t;this.id=n,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(){}cleanup(){}}{render(e){return Ta(this.gl,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{viewports:t,views:n,onViewportActive:i,clearCanvas:r=!0}=e;e.pass=e.pass||"unknown";const o=this.gl;r&&function(e){const t=e.drawingBufferWidth,n=e.drawingBufferHeight;Ta(e,{viewport:[0,0,t,n]}),e.clear(16640)}(o);const s=[];for(const r of t){const t=r.viewport||r,a=n&&n[t.id];i(t);const l=this._getDrawLayerParams(t,e);e.view=a;const c=t.subViewports||[t];for(const t of c){e.viewport=t;const n=this._drawLayersInViewport(o,e,l);s.push(n)}}return s}_getDrawLayerParams(e,{layers:t,pass:n,layerFilter:i,effects:r,moduleParameters:o}){const s=[],a=Id(),l={viewport:e,isPicking:n.startsWith("picking"),renderPass:n};for(let e=0;e<t.length;e++){const c=t[e],u=this._shouldDrawLayer(c,l,i),h={shouldDrawLayer:u,layerRenderIndex:a(c,u)};u&&(h.moduleParameters=this._getModuleParameters(c,r,n,o),h.layerParameters=this.getLayerParameters(c,e)),s[e]=h}return s}_drawLayersInViewport(e,{layers:t,pass:n,viewport:i,view:r},o){const s=function(e,{viewport:t}){const n=e.canvas?e.canvas.clientHeight||e.canvas.height:100,i=t,r=Ca(e);return[i.x*r,(n-i.y-i.height)*r,i.width*r,i.height*r]}(e,{viewport:i});if(r&&r.props.clear){const t=!0===r.props.clear?{color:!0,depth:!0}:r.props.clear;ka(e,{scissorTest:!0,scissor:s},(()=>bl(e,t)))}const a={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};Ta(e,{viewport:s});for(let e=0;e<t.length;e++){const r=t[e],{shouldDrawLayer:s,layerRenderIndex:l,moduleParameters:c,layerParameters:u}=o[e];if(s&&r.props.pickable&&a.pickableCount++,r.isComposite)a.compositeCount++;else if(s){a.visibleCount++,c.viewport=i;try{r.drawLayer({moduleParameters:c,uniforms:{layerIndex:l},parameters:u})}catch(e){r.raiseError(e,"drawing ".concat(r," to ").concat(n))}}}return a}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t){return e.props.parameters}_shouldDrawLayer(e,t,n){if(!(this.shouldDrawLayer(e)&&e.props.visible))return!1;if(t.layer=e,n&&!n(t))return!1;let i=e.parent;for(;i;){if(!i.filterSubLayer(t))return!1;t.layer=i,i=i.parent}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,n,i){const r=Object.assign(Object.create(e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Ca(this.gl)});if(t)for(const n of t)Object.assign(r,n.getModuleParameters(e));return Object.assign(r,this.getModuleParameters(e,t),i)}}function Id(e=0,t={}){const n={},i=(r,o)=>{const s=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in t)&&i(r.parent,!1),l in n){const e=n[l]=n[l]||Id(t[l],t);c=e(r,o),n[a]=e}else Number.isFinite(s)?(c=s+(t[l]||0),n[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return i}class Ld extends Md{constructor(e,t){super(e,t),this.shadowMap=new fl(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new _l(e,{format:33189,width:1,height:1}),this.fbo=new Il(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;ka(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(()=>{const n=e.viewports[0],i=Ca(this.gl),r=n.width*i,o=n.height*i;r===t.width&&o===t.height||t.resize({width:r,height:o}),super.render({...e,target:t,pass:"shadow"})}))}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const Rd={color:[255,255,255],intensity:1},zd=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Dd=[0,0,0,200/255];class Od extends Pd{constructor(e){super(e),this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowColor=Dd,this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.shadow=!1,this.programManager=null;for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((e=>e.shadow))}preRender(e,{layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:o}){if(this.shadow){this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(e),this.programManager||(this.programManager=Ph.getDefaultProgramManager(e),Ad&&this.programManager.addDefaultModule(Ad)),this.dummyShadowMap||(this.dummyShadowMap=new fl(e,{width:1,height:1}));for(let e=0;e<this.shadowPasses.length;e++){this.shadowPasses[e].render({layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:o,moduleParameters:{shadowLightId:e,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((t=>t.getProjectedLight({layer:e}))),pointLights:this.pointLights.map((t=>t.getProjectedLight({layer:e})))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Ad),this.programManager=null)}_createLightMatrix(){const e=[];for(const t of this.directionalLights){const n=(new Yu).lookAt({eye:new Fu(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new Ld(e);this.shadowPasses[t]=n,this.shadowMaps[t]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new wd(Rd),this.directionalLights.push(new Cd(zd[0]),new Cd(zd[1])))}}var Bd=new class{constructor(e){this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(e)}setProps(e){Object.assign(this.props,e)}allocate(e,t,{size:n=1,type:i,padding:r=0,copy:o=!1,initialize:s=!1,maxCount:a}){const l=i||e&&e.constructor||Float32Array,c=t*n+r;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u;a&&(u=a*n+r);const h=this._allocate(l,c,s,u);return e&&o?h.set(e):s||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,n,i){let r=Math.max(Math.ceil(t*this.props.overAlloc),1);r>i&&(r=i);const o=this._pool,s=e.BYTES_PER_ELEMENT*r,a=o.findIndex((e=>e.byteLength>=s));if(a>=0){const t=new e(o.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,r=t.findIndex((e=>e.byteLength>=i));r<0?t.push(n):(r>0||t.length<this.props.poolSize)&&t.splice(r,0,n),t.length>this.props.poolSize&&t.shift()}};const Fd=new Fu;function Nd(e,t,n,i){Fd.set(e,t,n);const r=Fd.len();return{distance:i/r,normal:new Fu(-e/r,-t/r,-n/r)}}let Ud;function jd(e,{size:t=1,startIndex:n=0,endIndex:i}){Number.isFinite(i)||(i=e.length);const r=(i-n)/t;Ud=Bd.allocate(Ud,r,{type:Float32Array,size:2*t});let o=n,s=0;for(;o<i;){for(let n=0;n<t;n++){const i=e[o++];Ud[s+n]=i,Ud[s+n+t]=(a=i)-Math.fround(a)}s+=2*t}var a;return Ud.subarray(0,r*t*2)}const Vd=Math.PI/180,Gd=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Wd=[0,0,0],$d={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class qd{constructor(e={}){const{id:t=null,x:n=0,y:i=0,width:r=1,height:o=1}=e;this.id=t||this.constructor.displayName||"viewport",this.x=n,this.y=i,this.width=r||1,this.height=o||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Hh.WEB_MERCATOR:Hh.WEB_MERCATOR_AUTO_OFFSET:Hh.IDENTITY}equals(e){return e instanceof qd&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Cu(e.projectionMatrix,this.projectionMatrix)&&Cu(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=Le(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,o=t?r:this.height-r;return 2===e.length?[i,o]:[i,o,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,o]=e,s=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=Re([i,s,o],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){return this.isGeospatial?Ee(e):e}unprojectFlat(e){return this.isGeospatial?Se(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1]),Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])]}getDistanceScales(e=null){return e?Te({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,function(e){const t={};return t.left=Nd(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),t.right=Nd(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),t.bottom=Nd(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),t.top=Nd(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),t.near=Nd(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),t.far=Nd(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14]),t}(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(e,t){return null}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_createProjectionMatrix({orthographic:e,fovyRadians:t,aspect:n,focalDistance:i,near:r,far:o}){return e?(new Yu).orthographic({fovy:t,aspect:n,focalDistance:i,near:r,far:o}):(new Yu).perspective({fovy:t,aspect:n,near:r,far:o})}_initViewMatrix(e){const{viewMatrix:t=Gd,longitude:n=null,latitude:i=null,zoom:r=null,position:o=null,modelMatrix:s=null,focalDistance:a=1,distanceScales:l=null}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this.zoom=r,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?function({latitude:e}){Ae(Number.isFinite(e));const t=Math.cos(e*ye);return we(be*t)-9}({latitude:i})+Math.log2(a):0);const c=Math.pow(2,this.zoom);this.scale=c,this.distanceScales=this.isGeospatial?Te({latitude:i,longitude:n}):l||$d,this.focalDistance=a,this.distanceScales.metersPerUnit=new Fu(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new Fu(this.distanceScales.unitsPerMeter),this.position=Wd,this.meterOffset=Wd,o&&(this.position=o,this.modelMatrix=s,this.meterOffset=s?s.transformVector(o):o),this.isGeospatial?(this.longitude=n,this.latitude=i,this.center=this._getCenterInWorld({longitude:n,latitude:i})):this.center=o?this.projectPosition(o):[0,0,0],this.viewMatrixUncentered=t,this.viewMatrix=(new Yu).multiplyRight(this.viewMatrixUncentered).translate(new Fu(this.center||Wd).negate())}_getCenterInWorld({longitude:e,latitude:t}){const{meterOffset:n,distanceScales:i}=this,r=new Fu(this.projectPosition([e,t,0]));if(n){const e=new Fu(n).scale(i.unitsPerMeter);r.add(e)}return r}_initProjectionMatrix(e){const{projectionMatrix:t=null,orthographic:n=!1,fovyRadians:i,fovy:r=75,near:o=.1,far:s=1e3,focalDistance:a=1}=e;this.projectionMatrix=t||this._createProjectionMatrix({orthographic:n,fovyRadians:i||r*Vd,aspect:this.width/this.height,focalDistance:a,near:o,far:s})}_initPixelMatrices(){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var t;Q(e,e,this.projectionMatrix),Q(e,e,this.viewMatrix),this.viewProjectionMatrix=e,this.viewMatrixInverse=H([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(t=this.viewMatrixInverse)[12],t[13],t[14]];const n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Y(n,n,[this.width/2,-this.height/2,1]),X(n,n,[1,-1,0]),Q(i,n,this.viewProjectionMatrix),this.pixelProjectionMatrix=i,this.viewportMatrix=n,this.pixelUnprojectionMatrix=H([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ds.warn("Pixel project matrix not invertible")()}}qd.displayName="Viewport";class Zd extends qd{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=11,pitch:r=0,bearing:o=0,nearZMultiplier:s=.1,farZMultiplier:a=1.01,orthographic:l=!1,repeat:c=!1,worldOffset:u=0}=e;let{width:h,height:d,altitude:f=1.5}=e;const p=Math.pow(2,i);h=h||1,d=d||1,f=Math.max(.75,f);const{fov:A,aspect:m,focalDistance:g,near:y,far:_}=Pe({width:h,height:d,pitch:r,altitude:f,nearZMultiplier:s,farZMultiplier:a});let v=Ce({height:d,pitch:r,bearing:o,scale:p,altitude:f});if(u){v=(new Yu).translate([512*u,0,0]).multiplyLeft(v)}super({...e,width:h,height:d,viewMatrix:v,longitude:n,latitude:t,zoom:i,orthographic:l,fovyRadians:A,aspect:m,focalDistance:g,near:y,far:_}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=o,this.altitude=f,this.orthographic=l,this._subViewports=c?[]:null,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let e=t;e<=n;e++){const t=e?new Zd({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}addMetersToLngLat(e,t){return ke(e,t)}panByPosition(e,t){const n=Re(t,this.pixelUnprojectionMatrix),i=ne([],this.projectFlat(e),ie([],n)),r=ne([],this.center,i),[o,s]=this.unprojectFlat(r);return{longitude:o,latitude:s}}getBounds(e={}){const t=Oe(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:o,zoom:s}=ze({width:n,height:i,bounds:e,...t});return new Zd({width:n,height:i,longitude:r,latitude:o,zoom:s})}}function Hd(e,t,n=!1){const i=t.projectPosition(e);if(n&&t instanceof Zd){const[n,r,o=0]=e,s=t.getDistanceScales([n,r]);i[2]=o*s.unitsPerMeter[2]}return i}function Qd(e,{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:o}){let[s,a,l=0]=e;switch(n&&([s,a,l]=W([],[s,a,l,1],n)),i){case Zh.LNGLAT:return Hd([s,a,l],t,o);case Zh.LNGLAT_OFFSETS:return Hd([s+r[0],a+r[1],l+(r[2]||0)],t,o);case Zh.METER_OFFSETS:return Hd(ke(r,[s,a,l]),t,o);default:return t.isGeospatial?[s+r[0],a+r[1],l+r[2]]:t.projectPosition([s,a,l])}}function Xd(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=function(e){const t={...e};let{coordinateSystem:n}=e;const{viewport:i,coordinateOrigin:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return n===Zh.DEFAULT&&(n=i.isGeospatial?Zh.LNGLAT:Zh.CARTESIAN),void 0===o&&(t.fromCoordinateSystem=n),void 0===s&&(t.fromCoordinateOrigin=r),t.coordinateSystem=n,t}(t),{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:u}=ad(n,i,r),h=Qd(e,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:u});if(u){const e=n.projectPosition(l||c);de(h,h,e)}return h}Zd.displayName="WebMercatorViewport";const Yd="Awaiting state",Kd="Matched. State transferred from previous layer",Jd="Initialized",ef="Discarded. Awaiting garbage collection",tf="No longer matched. Awaiting garbage collection",nf="Finalized! Awaiting garbage collection",rf={COMPONENT:Symbol.for("component"),ASYNC_DEFAULTS:Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL:Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED:Symbol.for("asyncPropResolved")};function of(e,t=(()=>!0)){return Array.isArray(e)?sf(e,t,[]):t(e)?[e]:[]}function sf(e,t,n){let i=-1;for(;++i<e.length;){const r=e[i];Array.isArray(r)?sf(r,t,n):t(r)&&n.push(r)}return n}function af({target:e,source:t,start:n=0,count:i=1}){const r=t.length,o=i*r;let s=0;for(let i=n;s<r;s++)e[i++]=t[s];for(;s<o;)s<o-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+o-s),s=o);return e}class lf{constructor(e,t,n){this.id=e,this.context=n,this._loadCount=0,this._subscribers=new Set,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;"string"==typeof e&&(i=Bo(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=null,this._content=e)})).catch((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)}))):(this.isLoaded=!0,this._error=null,this._content=e);for(const e of this._subscribers)e.onChange(this.getData())}}class cf{constructor({gl:e,protocol:t}){this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[e];r?r.setData(t,n):(r=new lf(e,t,this._context),this._resources[e]=r),r.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e];n.resource&&n.resource.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:o}=this;e.startsWith(o)&&(r[e=e.replace(o,"")]||this.add({resourceId:e,data:null,persistent:!1}));const s=r[e];if(this._track(n,i,s,t),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const r=this._consumers,o=r[e]=r[e]||{},s=o[t]||{};s.resource&&(s.resource.unsubscribe(s),s.resource=null,this.prune()),n&&(o[t]=s,s.onChange=i,s.resource=n,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}const uf=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}});class hf{constructor(e,{deck:t,stats:n,viewport:i,timeline:r}={}){this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new cf({gl:e,protocol:"deck://"}),this.context={...uf,layerManager:this,gl:e,deck:t,programManager:e&&_d(e),stats:n||new br({id:"deck.gl"}),viewport:i||new qd({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:r||new $h,resourceManager:this.resourceManager},this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e=null}={}){return e?this.layers.filter((t=>e.find((e=>0===t.id.indexOf(e))))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Fs("layerManager.setLayers",this,t,e),this.lastRenderedLayers=e,e=of(e,Boolean);for(const t of e)t.context=this.context;return this._updateLayers(this.layers,e),this}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this.lastRenderedLayers,e)),this._nextLayers=null}activateViewport(e){return Fs("layerManager.activateViewport",this,e),e&&(this.context.viewport=e),this}_handleError(e,t,n){n.raiseError(t,"".concat(e," of ").concat(n))}_updateLayers(e,t){const n={};for(const t of e)n[t.id]?Ds.warn("Multiple old layers with same id ".concat(t.id))():n[t.id]=t;const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let r=!1;for(const e of i)if(e.hasUniformTransition()){r=!0;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const e=t[i.id];null===e&&Ds.warn("Multiple new layers with same id ".concat(i.id))(),t[i.id]=null;let r=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),r=i.isComposite&&i.getSubLayers()}catch(e){this._handleError("matching",e,i)}r&&this._updateSublayersRecursively(r,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Jd}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Kd,t!==e&&(e.lifecycle=ef)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=tf;try{e._finalize(),e.lifecycle=nf}catch(t){this._handleError("finalization",t,e)}}}function df(e,t){if(e===t)return!0;if(!e||!t)return!1;for(const n in e){const i=e[n],r=t[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&df(i,r)))return!1}return!0}class ff{constructor(e={}){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers)this.controllers[e]&&this.controllers[e].finalize();this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter((t=>t.containsPixel(e))):this._viewports}getViews(){const e={};return this.views.forEach((t=>{e[t.id]=t})),e}getView(e){return"string"==typeof e?this.views.find((t=>t.id===e)):e}getViewState(e){const t=this.getView(e),n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(i)){const n=e.slice();return n[0]-=o.x,n[1]-=o.y,o.unproject(n,t)}}return null}setProps(e){"views"in e&&this._setViews(e.views),"viewState"in e&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=of(e,Boolean);this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!df(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else Ds.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){t.viewId=e,this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(t)}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>e._getViewport(t,{width:t.width,height:t.height}),...t})}_updateController(e,t,n,i){let r=e.controller;return r?(r={...t,...e.props,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height},i?i.setProps(r):i=this._createController(e,r),i):null}_rebuildViewports(){const{width:e,height:t,views:n}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let o=n.length;o--;){const s=n[o],a=this.getViewState(s),l=s.makeViewport({width:e,height:t,viewState:a});let c=i[s.id];s.controller&&!c&&(r=!0),!r&&s.controller||!c||(c.finalize(),c=null),this.controllers[s.id]=this._updateController(s,a,l,c),this._viewports.unshift(l)}for(const e in i)i[e]&&!this.controllers[e]&&i[e].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)}))}_diffViews(e,t){return e.length!==t.length||e.some(((n,i)=>!e[i].equals(t[i])))}}const pf=/([0-9]+\.?[0-9]*)(%|px)/;function Af(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=e.match(pf);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(e))}}function mf(e,t){return e.relative?Math.round(e.position*t):e.position}function gf(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class yf{constructor(e={}){const{id:t=null,x:n=0,y:i=0,width:r="100%",height:o="100%",projectionMatrix:s=null,fovy:a=50,near:l=.1,far:c=1e3,modelMatrix:u=null,viewportInstance:h=null,type:d=qd}=e;gf(!h||h instanceof qd),this.viewportInstance=h,this.id=t||this.constructor.displayName||"view",this.type=d,this.props={...e,id:this.id,projectionMatrix:s,fovy:a,near:l,far:c,modelMatrix:u},this._parseDimensions({x:n,y:i,width:r,height:o}),this.equals=this.equals.bind(this),Object.seal(this)}equals(e){if(this===e)return!0;if(this.viewportInstance)return e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance);return df(this.props,e.props)}makeViewport({width:e,height:t,viewState:n}){if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});return this._getViewport(n,i)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){return{x:mf(this._x,e),y:mf(this._y,t),width:mf(this._width,e),height:mf(this._height,t)}}_getControllerProps(e){let t=this.props.controller;return t?!0===t?e:("function"==typeof t&&(t={type:t}),{...e,...t}):null}_getViewport(e,t){const{type:n}=this;return new n({...e,...this.props,...t})}_parseDimensions({x:e,y:t,width:n,height:i}){this._x=Af(e),this._y=Af(t),this._width=Af(n),this._height=Af(i)}}function _f(){}const vf={onStart:_f,onUpdate:_f,onInterrupt:_f,onEnd:_f};class bf{constructor(e){this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings={...vf,...e},this._inProgress=!0,this.settings.onStart(this)}end(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}cancel(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const xf=()=>{},wf=1,Ef=2,Sf=3,Tf={transitionEasing:e=>e,transitionInterruption:wf,onTransitionStart:xf,onTransitionInterrupt:xf,onTransitionEnd:xf};class kf{constructor(e,t={}){this.ControllerState=e,this.props={...Tf,...t},this.propsInTransition=null,this.transition=new bf(t.timeline),this.onViewStateChange=t.onViewStateChange||xf,this.onStateChange=t.onStateChange||xf,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(e={...Tf,...e},this.props=e,this._shouldIgnoreViewportChange(n,e))return t;if(this._isTransitionEnabled(e)){const{interruption:i,endProps:r}=this.transition.settings,o={...n,...i===Ef?r:this.propsInTransition||n};this._triggerTransition(o,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Sf||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=new this.ControllerState(e),i=new this.ControllerState(t).shortestPathFrom(n),{transitionInterpolator:r}=t,o=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===o)return;const s=t.transitionInterpolator.initializeProps(e,i);this.propsInTransition={},this.duration=o,this.transition.start({duration:o,easing:t.transitionEasing,interpolator:t.transitionInterpolator,interruption:t.transitionInterruption,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e(t)}}_onTransitionUpdate(e){const{time:t,settings:{interpolator:n,startProps:i,endProps:r,duration:o,easing:s}}=e,a=s(t/o),l=n.interpolateProps(i,r,a);this.propsInTransition=new this.ControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}class Cf{constructor(e={}){Array.isArray(e)&&(e={compare:e,extract:e,required:e});const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare||Object.keys(t))if(!(n in e)||!(n in t)||!Cu(e[n],t[n]))return!1;return!0}initializeProps(e,t){let n;if(this._propsToExtract){const i={},r={};for(const n of this._propsToExtract)i[n]=e[n],r[n]=t[n];n={start:i,end:r}}else n={start:e,end:t};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}interpolateProps(e,t,n){return t}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach((t=>{const n=e[t];gf(Number.isFinite(n)||Array.isArray(n),"".concat(t," is required for transition"))}))}}const Pf=["longitude","latitude","zoom","bearing","pitch"],Mf=["longitude","latitude","zoom"];class If extends Cf{constructor(e={}){super((Array.isArray(e)?e:e.transitionProps)||{compare:Pf,extract:Pf,required:Mf}),this.opts=e}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const o=i(e),s=i(t),a=o.unproject(r);n.start.around=r,Object.assign(n.end,{around:s.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const r of this._propsToExtract)i[r]=ku(e[r]||0,t[r]||0,n);if(t.aroundPosition){const r=this.opts.makeViewport({...t,...i});Object.assign(i,r.panByPosition(t.aroundPosition,ku(e.around,t.around,n)))}return i}}const Lf={transitionDuration:0},Rf={transitionDuration:300,transitionEasing:e=>e,transitionInterruption:wf},zf=e=>1-(1-e)*(1-e),Df=["wheel"],Of=["panstart","panmove","panend"],Bf=["pinchstart","pinchmove","pinchend"],Ff=["tripanstart","tripanmove","tripanend"],Nf=["doubletap"],Uf=["keydown"];const jf=0,Vf=0,Gf=1.5,Wf=0,$f=20,qf=0,Zf=60;class Hf extends class{constructor(e){this._viewportProps=this._applyConstraints(e)}getViewportProps(){return this._viewportProps}getState(){return this._state}shortestPathFrom(e){return this._viewportProps}_applyConstraints(e){return e}}{constructor({makeViewport:e,width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s=Vf,pitch:a=jf,altitude:l=Gf,maxZoom:c=$f,minZoom:u=Wf,maxPitch:h=Zf,minPitch:d=qf,startPanLngLat:f,startZoomLngLat:p,startRotatePos:A,startBearing:m,startPitch:g,startZoom:y,normalize:_}={}){gf(Number.isFinite(r)),gf(Number.isFinite(i)),gf(Number.isFinite(o)),super({width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s,pitch:a,altitude:l,maxZoom:c,minZoom:u,maxPitch:h,minPitch:d,normalize:_}),this._state={startPanLngLat:f,startZoomLngLat:p,startRotatePos:A,startBearing:m,startPitch:g,startZoom:y},this.makeViewport=e}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this._state.startPanLngLat||this._unproject(t);if(!n)return this;const i=this.makeViewport(this._viewportProps).panByPosition(n,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:o}=this._state;if(!i||!Number.isFinite(r)||!Number.isFinite(o))return this;let s;return s=e?this._calculateNewPitchAndBearing({...this._getRotationParams(e,i),startBearing:r,startPitch:o}):{bearing:r+t,pitch:o+n},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:r}=this._state;Number.isFinite(i)||(i=this._viewportProps.zoom,r=this._unproject(t)||this._unproject(e));const o=this._calculateNewZoom({scale:n,startZoom:i}),s=this.makeViewport({...this._viewportProps,zoom:o});return this._getUpdatedState({zoom:o,...s.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this._viewportProps.bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this._viewportProps.bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this._viewportProps.pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this._viewportProps.pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this._viewportProps},{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}_zoomFromCenter(e){const{width:t,height:n}=this._viewportProps;return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this._viewportProps;return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this._viewportProps,...this._state,...e})}_applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Tu(i,n,t);const{maxPitch:r,minPitch:o,pitch:s}=e;e.pitch=Tu(s,o,r);const{normalize:a=!0}=e;return a&&Object.assign(e,Ne(e)),e}_unproject(e){const t=this.makeViewport(this._viewportProps);return e&&t.unproject(e)}_calculateNewZoom({scale:e,startZoom:t}){const{maxZoom:n,minZoom:i}=this._viewportProps;return Tu(t+Math.log2(e),i,n)}_calculateNewPitchAndBearing({deltaScaleX:e,deltaScaleY:t,startBearing:n,startPitch:i}){t=Tu(t,-1,1);const{minPitch:r,maxPitch:o}=this._viewportProps;let s=i;return t>0?s=i+t*(o-i):t<0&&(s=i-t*(r-i)),{pitch:s,bearing:n+180*e}}_getRotationParams(e,t){const n=e[0]-t[0],i=e[1]-t[1],r=e[1],o=t[1],{width:s,height:a}=this._viewportProps,l=n/s;let c=0;return i>0?Math.abs(a-o)>5&&(c=i/(o-a)*1.2):i<0&&o>5&&(c=1-r/o),c=Math.min(1,Math.max(-1,c)),{deltaScaleX:l,deltaScaleY:c}}}class Qf extends class{constructor(e,t={}){this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new kf(e,{...t,onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)});const n=this.linearTransitionProps;this._transition=n&&{...Rf,transitionInterpolator:new If({transitionProps:n})},this._events=null,this._interactionState={isDragging:!1},this._customEvents=[],this.onViewStateChange=null,this.onStateChange=null,this.handleEvent=this.handleEvent.bind(this),this.setProps(t)}get linearTransitionProps(){return null}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.setProps(this.controllerStateProps)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){const{ControllerState:t}=this;this.controllerState=new t({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state});const n=this._eventStartBlocked;switch(e.type){case"panstart":return!n&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!n&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!n&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}getCenter(e){const{x:t,y:n}=this.controllerStateProps,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.controllerStateProps;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging}blockEvents(e){const t=setTimeout((()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)}),e);this._eventStartBlocked=t}setProps(e){"onViewStateChange"in e&&(this.onViewStateChange=e.onViewStateChange),"onStateChange"in e&&(this.onStateChange=e.onStateChange),"makeViewport"in e&&(this.makeViewport=e.makeViewport),"dragMode"in e&&(this.dragMode=e.dragMode),this.controllerStateProps=e,"eventManager"in e&&this.eventManager!==e.eventManager&&(this.eventManager=e.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;!0===t&&(t=300),this.inertia=t;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:s=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(Df,c&&n),this.toggleEvents(Of,c&&(i||r)),this.toggleEvents(Bf,c&&(s||a)),this.toggleEvents(Ff,c&&a),this.toggleEvents(Nf,c&&o),this.toggleEvents(Uf,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=s,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach((e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))}))}updateViewport(e,t={},n={}){const i={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this._state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e})}}_onTransition(e){this.onViewStateChange&&(e.interactionState=this._interactionState,this.onViewStateChange(e))}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange&&this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,Lf,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Lf,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:zf},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Lf,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:zf},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.preventDefault();const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const{speed:n=.01,smooth:i=!1}=this.scrollZoom,{delta:r}=e;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==o&&(o=1/o);const s=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Lf,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Lf,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:zf},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return this._startPinchRotation=e.rotation,this._lastPinchEvent=e,this.updateViewport(n,Lf,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:this._startPinchRotation-n})}return this.updateViewport(t,Lf,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t,_lastPinchEvent:n}=this;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const o=Math.log2(e.scale),s=(o-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,o+s*t/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:zf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,this._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:o}=this.keyboard,{controllerState:s}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?s.zoomOut(n).zoomOut(n):s.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?s.zoomIn(n).zoomIn(n):s.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=s.rotateLeft(r),l.isRotating=!0):(a=s.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":t?(a=s.rotateRight(r),l.isRotating=!0):(a=s.moveRight(i),l.isPanning=!0);break;case"ArrowUp":t?(a=s.rotateUp(o),l.isRotating=!0):(a=s.moveUp(i),l.isPanning=!0);break;case"ArrowDown":t?(a=s.rotateDown(o),l.isRotating=!0):(a=s.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{_transition:t}=this;return t?e?{...t,transitionInterpolator:new If({...e,transitionProps:this.linearTransitionProps,makeViewport:this.controllerState.makeViewport})}:t:Lf}}{constructor(e){e.dragMode=e.dragMode||"pan",super(Hf,e)}setProps(e){const t=this.controllerStateProps;super.setProps(e);(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...this.controllerStateProps,...this._state}))}get linearTransitionProps(){return["longitude","latitude","zoom","bearing","pitch"]}}class Xf extends yf{constructor(e){super({...e,type:Zd})}get controller(){return this._getControllerProps({type:Qf})}}Xf.displayName="MapView";const Yf=new Od;class Kf{constructor(){this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length===this.effects.length&&df(e.effects,this.effects)||(this.setEffects(e.effects),this._needsRedraw="effects changed"))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._createInternalEffects()}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}_createInternalEffects(){this._internalEffects=this.effects.slice(),this.effects.some((e=>e instanceof Od))||this._internalEffects.push(Yf)}}class Jf extends Md{}const ep={blendFunc:[1,0,32771,0],blendEquation:32774};class tp extends Md{render(e){e.pickingFBO?(this.useAlpha=!0,this._drawPickingBuffer(e)):(this.useAlpha=!1,super.render(e))}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,pickingFBO:o,deviceRect:{x:s,y:a,width:l,height:c},pass:u="picking",redrawReason:h,pickZ:d}){const f=this.gl;return this.pickZ=d,ka(f,{scissorTest:!0,scissor:[s,a,l,c],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...ep,blend:!d},(()=>{super.render({target:o,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,pass:u,redrawReason:h})}))}shouldDrawLayer(e){return e.props.pickable}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t){const n=this.pickZ?{blend:!1}:{...ep,blend:!0,blendColor:[0,0,0,this.useAlpha?(t+1)/255:1]};return{...e.props.parameters,...n}}}class np{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Jf(e),this.pickLayersPass=new tp(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=this.layerFilter,e.effects=e.effects||[],e.target=e.target||Il.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const n=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,i=t.render({...e,target:n});this._postRender(e.effects,e),this.renderCount++,Fs("deckRenderer.renderLayers",this,i,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){let n=null;for(const i of e)i.preRender(this.gl,t),i.postRender&&(n=i);n&&this._resizeRenderBuffers(),this.lastPostProcessEffect=n}_resizeRenderBuffers(){const{renderBuffers:e}=this;0===e.length&&e.push(new Il(this.gl),new Il(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:n}=this,i={inputBuffer:n[0],swapBuffer:n[1],target:null};for(const r of e)if(r.postRender){if(r===this.lastPostProcessEffect){i.target=t.target,r.postRender(this.gl,i);break}const e=r.postRender(this.gl,i);i.inputBuffer=e,i.swapBuffer=e===n[0]?n[1]:n[0]}}}const ip={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function rp({pickedColors:e,layers:t,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:o}){if(e){const{x:s,y:a,width:l,height:c}=o;let u=r*r,h=-1,d=0;for(let t=0;t<c;t++){const r=t+a-i,o=r*r;if(o>u)d+=4*l;else for(let t=0;t<l;t++){if(e[d+3]-1>=0){const e=t+s-n,i=e*e+o;i<=u&&(u=i,h=d)}d+=4}}if(h>=0){const n=e[h+3]-1,i=e.slice(h,h+4),r=t[n];if(r){const e=r.decodePickingColor(i),t=Math.floor(h/4/l);return{pickedColor:i,pickedLayer:r,pickedObjectIndex:e,pickedX:s+(h/4-t*l),pickedY:a+t}}Ds.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return ip}function op({pickInfo:e,mode:t,viewports:n,layerFilter:i,pixelRatio:r,x:o,y:s,z:a}){const l=e&&e.pickedLayer,c=function(e,t,n){for(let i=e.length-1;i>=0;i--){const r=e[i];if(r.containsPixel(t)&&(!n||n(r)))return r}return e[0]}(n,{x:o,y:s},i&&l&&(e=>i({layer:l,viewport:e,isPicking:!0,renderPass:"picking:".concat(t)}))),u=c&&c.unproject([o-c.x,s-c.y],{targetZ:a});return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:u,devicePixel:e&&[e.pickedX,e.pickedY],pixelRatio:r}}function sp(e){const{pickInfo:t,lastPickedInfo:n,mode:i,layers:r}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:a}=t,l=s?[s]:[];if("hover"===i){const e=n.index,t=n.layerId,i=s&&s.props.id;if(i!==t||a!==e){if(i!==t){const e=r.find((e=>e.props.id===t));e&&l.unshift(e)}n.layerId=i,n.index=a,n.info=null}}const c=op(e),u=new Map;return u.set(null,c),l.forEach((e=>{let t={...c};e===s&&(t.color=o,t.index=a,t.picked=!0),t=ap({layer:e,info:t,mode:i}),e===s&&"hover"===i&&(n.info=t),u.set(t.layer.id,t),"hover"===i&&t.layer.updateAutoHighlight(t)})),u}function ap({layer:e,info:t,mode:n}){for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}class lp{constructor(e){this.gl=e,this.pickingFBO=null,this.pickLayersPass=new tp(e),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,s=r&&r.viewport&&r.viewport.id,a=o?n.find((e=>e.id===o)):null,l=s&&i.find((e=>e.id===s))||i[0],c=l&&l.unproject([e-l.x,t-l.y]),u={x:e,y:t,viewport:l,coordinate:c,layer:a};return a?{...r,...u}:Object.assign(u,{color:null,object:null,index:-1})}_resizeBuffer(){const{gl:e}=this;return this.pickingFBO||(this.pickingFBO=new Il(e),Il.isSupported(e,{colorBufferFloat:!0})&&(this.depthFBO=new Il(e),this.depthFBO.attach({36064:new fl(e,{format:qs(e)?34836:6408,type:5126})}))),this.pickingFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.pickingFBO}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter((e=>e.isPickable()&&!e.isComposite));return t.length>255?(Ds.warn("Too many pickable layers, only picking the first 255")(),t.slice(0,255)):t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:r,radius:o=0,depth:s=1,mode:a="query",unproject3D:l,onViewportActive:c}){if(!(e=this._getPickable(e)))return{result:[],emptyInfo:op({viewports:n,x:i,y:r})};this._resizeBuffer();const u=Ca(this.gl),h=Pa(this.gl,[i,r],!0),d=[h.x+Math.floor(h.width/2),h.y+Math.floor(h.height/2)],f=Math.round(o*u),{width:p,height:A}=this.pickingFBO,m=this._getPickingRect({deviceX:d[0],deviceY:d[1],deviceRadius:f,deviceWidth:p,deviceHeight:A});let g;const y=[],_={};for(let o=0;o<s;o++){const h=rp({pickedColors:m&&this._drawAndSample({layers:e,views:t,viewports:n,onViewportActive:c,deviceRect:m,pass:"picking:".concat(a),redrawReason:a}),layers:e,deviceX:d[0],deviceY:d[1],deviceRadius:f,deviceRect:m});let p;if(h.pickedLayer&&l&&this.depthFBO){p=this._drawAndSample({layers:[h.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:h.pickedX,y:h.pickedY,width:1,height:1},pass:"picking:".concat(a),redrawReason:"pick-z",pickZ:!0})[0]*n[0].distanceScales.metersPerUnit[2]+n[0].position[2]}if(h.pickedColor&&o+1<s){const t=h.pickedColor[3]-1;_[t]=!0,e[t].disablePickingIndex(h.pickedObjectIndex)}g=sp({pickInfo:h,lastPickedInfo:this.lastPickedInfo,mode:a,layers:e,layerFilter:this.layerFilter,viewports:n,x:i,y:r,z:p,pixelRatio:u});for(const e of g.values())e.layer&&y.push(e);if(!h.pickedColor)break}for(const t in _)e[t].restorePickingColors();return{result:y,emptyInfo:g&&g.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:r,width:o=1,height:s=1,mode:a="query",maxObjects:l=null,onViewportActive:c}){if(!(e=this._getPickable(e)))return[];this._resizeBuffer();const u=Ca(this.gl),h=Pa(this.gl,[i,r],!0),d=h.x,f=h.y+h.height,p=Pa(this.gl,[i+o,r+s],!0),A=p.x+p.width,m=p.y,g={x:d,y:m,width:A-d,height:f-m},y=function({pickedColors:e,layers:t}){const n=new Map;if(e)for(let i=0;i<e.length;i+=4){const r=e[i+3]-1;if(r>=0){const o=e.slice(i,i+4),s=o.join(",");if(!n.has(s)){const e=t[r];e?n.set(s,{pickedColor:o,pickedLayer:e,pickedObjectIndex:e.decodePickingColor(o)}):Ds.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}({pickedColors:this._drawAndSample({layers:e,views:t,viewports:n,onViewportActive:c,deviceRect:g,pass:"picking:".concat(a),redrawReason:a}),layers:e}),_=new Map,v=Number.isFinite(l);for(let e=0;e<y.length&&!(v&&_.size>=l);e++){const t=y[e];let n={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:r,width:o,height:s,pixelRatio:u};n=ap({layer:t.pickedLayer,info:n,mode:a}),_.has(n.object)||_.set(n.object,n)}return Array.from(_.values())}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,pass:o,redrawReason:s,pickZ:a}){if(e.length<1)return null;const l=a?this.depthFBO:this.pickingFBO;this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:l,deviceRect:r,pass:o,redrawReason:s,pickZ:a});const{x:c,y:u,width:h,height:d}=r,f=new(a?Float32Array:Uint8Array)(h*d*4);return xl(l,{sourceX:c,sourceY:u,sourceWidth:h,sourceHeight:d,target:f}),f}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const o=Math.max(0,e-n),s=Math.max(0,t-n),a=Math.min(i,e+n+1)-o,l=Math.min(r,t+n+1)-s;return a<=0||l<=0?null:{x:o,y:s,width:a,height:l}}}const cp={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"};class up{constructor(e){const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,cp),t.appendChild(this.el)),this.isVisible=!1}setTooltip(e,t,n){const i=this.el;if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");"text"in e&&(i.innerText=e.text),"html"in e&&(i.innerHTML=e.html),"className"in e&&(i.className=e.className),Object.assign(i.style,e.style)}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(t,"px, ").concat(n,"px)")}remove(){this.el&&this.el.remove()}}function hp(){}const dp={id:"",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:hp,onResize:hp,onViewStateChange:hp,onInteractionStateChange:hp,onBeforeRender:hp,onAfterRender:hp,onLoad:hp,onError:(e,t)=>Ds.error(e)(),_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",debug:!1,drawPickingColors:!1};class fp{constructor(e){e={...dp,...e},this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),e.viewState&&e.initialViewState&&Ds.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===zs.getBrowser()&&Ds.warn("IE 11 support will be deprecated in v8.0")(),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new br({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Bd.setProps(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ds.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ds.removed("onLayerClick","onClick")(),e.initialViewState&&!df(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||n||i||r||o,t}redraw(e){if(!this.layerManager)return;const t=e||this.needsRedraw({clearRedrawFlags:!0});t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}getViews(){return this.viewManager.views}getViewports(e){return this.viewManager.getViewports(e)}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_pick(e,t,n){const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,...n});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;if("string"==typeof t&&(t=document.getElementById(t),gf(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay";(e.parent||document.body).appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:n}=e;(t||0===t)&&(t=Number.isFinite(t)?"".concat(t,"px"):t,this.canvas.style.width=t),(n||0===n)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.position="absolute",this.canvas.style.height=n)}_updateCanvasSize(){if(this._checkForCanvasSizeChange()){const{width:e,height:t}=this;this.viewManager.setProps({width:e,height:t}),this.props.onResize({width:this.width,height:this.height})}}_checkForCanvasSizeChange(){const{canvas:e}=this;if(!e)return!1;const t=e.clientWidth||e.width,n=e.clientHeight||e.height;return(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,!0)}_createAnimationLoop(e){const{width:t,height:n,gl:i,glOptions:r,debug:o,onError:s,onBeforeRender:a,onAfterRender:l,useDevicePixels:c,autoResizeDrawingBuffer:u}=e;return new Ic({width:t,height:n,useDevicePixels:c,autoResizeDrawingBuffer:u,autoResizeViewport:!1,gl:i,onCreateContext:e=>Da({...r,...e,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:e=>this._setGLContext(e.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:a,onAfterRender:l,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new Xf({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_onPointerMove(e){const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e,t.mode="hover"}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.interactiveState.isHovering=t.length>0;let i=n,r=!1;for(const n of t)i=n,r=n.layer.onHover(n,e.event);if(!r&&this.props.onHover&&this.props.onHover(i,e.event),this.props.getTooltip){const e=this.props.getTooltip(i);this.tooltip.setTooltip(e,i.x,i.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.interactiveState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Oa(e,{enable:!0,copyState:!0})),this.tooltip=new up(this.canvas),Ta(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new $h;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new mi(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const e in Qh)this.eventManager.on(e,this._onEvent);this.viewManager=new ff({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new hf(e,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new Kf,this.deckRenderer=new np(e),this.deckPicker=new lp(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:n}=this.layerManager.context;Ta(n,this.props.parameters),this.props.onBeforeRender({gl:n}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:n})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),Ds.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.interactiveState.isDragging=e.isDragging,this.props.onInteractionStateChange(e)}_onEvent(e){const t=Qh[e.type],n=e.offsetCenter;if(!t||!n)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:o}=r,s=o&&(o[t.handler]||o.props[t.handler]),a=this.props[t.handler];let l=!1;s&&(l=s.call(o,r,e)),!l&&a&&a(r,e)}_onPointerDown(e){const t=e.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:t.x,y:t.y,radius:this.props.pickingRadius})}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Na.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}fp.getPropTypes=function(e){return{id:e.string,width:e.oneOfType([e.number,e.string]),height:e.oneOfType([e.number,e.string]),layers:e.oneOfType([e.object,e.array]),layerFilter:e.func,views:e.oneOfType([e.object,e.array]),viewState:e.object,effects:e.arrayOf(e.instanceOf(Pd)),controller:e.oneOfType([e.func,e.bool,e.object]),gl:e.object,glOptions:e.object,parameters:e.object,pickingRadius:e.number,useDevicePixels:e.oneOfType([e.bool,e.number]),touchAction:e.string,eventRecognizerOptions:e.object,onWebGLInitialized:e.func,onResize:e.func,onViewStateChange:e.func,onInteractionStateChange:e.func,onBeforeRender:e.func,onAfterRender:e.func,onLoad:e.func,onError:e.func,debug:e.bool,drawPickingColors:e.bool,_framebuffer:e.object,_animate:e.bool,_pickable:e.bool,_typedArrayManagerProps:e.object}},fp.defaultProps=dp,fp.VERSION=Vs.VERSION;class pp{constructor(e,t){this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:n}=this.source,{size:i}=t;let r=n;if(n&&n.length!==i){r=new Float32Array(i);const e=t.elementOffset||0;for(let t=0;t<i;++t)r[t]=n[e+t]}return r}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function Ap(e){return e.stride||e.size*e.bytesPerElement}function mp(e,t){t.offset&&Ds.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Ap(e),i=("vertexOffset"in t?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:n}}const gp=[],yp=[];function _p(e,t=0,n=1/0){let i=gp;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(yp.length=e.length,i=yp):i=gp,(t>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,n),r.index=t-1),{iterable:i,objectInfo:r}}function vp(e){return e&&e[Symbol.asyncIterator]}function bp(e,{size:t,stride:n,offset:i,startIndices:r,nested:o}){const s=e.BYTES_PER_ELEMENT,a=n?n/s:t,l=i?i/s:0,c=Math.floor((e.length-l)/a);return(n,{index:i,target:s})=>{if(!r){const n=i*a+l;for(let i=0;i<t;i++)s[i]=e[n+i];return s}const u=r[i],h=r[i+1]||c;let d;if(o){d=new Array(h-u);for(let n=u;n<h;n++){const i=n*a+l;s=new Array(t);for(let n=0;n<t;n++)s[n]=e[i+n];d[n-u]=s}}else if(a===t)d=e.subarray(u*t+l,h*t+l);else{d=new e.constructor((h-u)*t);let n=0;for(let i=u;i<h;i++){const r=i*a+l;for(let i=0;i<t;i++)d[n++]=e[r+i]}}return d}}const xp=[],wp=[[0,1/0]];function Ep({source:e,target:t,start:n=0,end:i,size:r,getData:o}){i=i||t.length;const s=e.length,a=i-n;if(s>a)return void t.set(e.subarray(0,a),n);if(t.set(e,n),!o)return;let l=s;for(;l<a;){const i=o(l,e);for(let e=0;e<r;e++)t[n+l]=i[e]||0,l++}}const Sp={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Tp(e,t){return e?(Number.isFinite(e)&&(e={duration:e}),e.type=e.type||"interpolation",{...Sp[e.type],...t,...e}):null}function kp(e,t){return t.getBuffer()?[t.getBuffer(),{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function Cp(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(e,'"'))}}function Pp(e){e.push(e.shift())}function Mp(e,t){const{doublePrecision:n,settings:i,value:r,size:o}=e,s=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:t*o)*s}function Ip({buffer:e,numInstances:t,attribute:n,fromLength:i,fromStartIndices:r,getData:o=(e=>e)}){const s=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*s,l=n.byteOffset,c=n.startIndices,u=r&&c,h=Mp(n,t),d=n.state.constant;if(!u&&i>=h)return;const f=d?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!d){const e=o;o=(t,i)=>n._normalizeConstant(e(t,i))}const p=d?(e,t)=>o(f,t):(e,t)=>o(f.subarray(e,e+a),t),A=e.getData({length:i}),m=new Float32Array(h);!function({source:e,target:t,size:n,getData:i,sourceStartIndices:r,targetStartIndices:o}){if(!Array.isArray(o))return Ep({source:e,target:t,size:n,getData:i}),t;let s=0,a=0;const l=i&&((e,t)=>i(e+a,t)),c=Math.min(r.length,o.length);for(let i=1;i<c;i++){const c=r[i]*n,u=o[i]*n;Ep({source:e.subarray(s,c),target:t,start:a,end:u,size:n,getData:l}),s=c,a=u}a<t.length&&Ep({source:[],target:t,start:a,size:n,getData:l})}({source:A,target:m,sourceStartIndices:r,targetStartIndices:c,size:a,getData:p}),e.byteLength<m.byteLength+l&&e.reallocate(m.byteLength+l),e.subData({data:m,offset:l})}class Lp extends class{constructor(e,t){this.gl=e,this.id=t.id,this.size=t.size;const n=t.logicalType||t.type,i=5130===n;let{defaultValue:r}=t;r=Number.isFinite(r)?[r]:r||new Array(this.size).fill(0),t.defaultValue=r;let o=n;i?o=5126:!o&&t.isIndexed?o=e&&function(e,t){return Cl(e,t)}(e,Tl)?5125:5123:o||(o=5126),t.logicalType=n,t.type=o;let s=function(e){switch(e){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(n||o||5126);this.shaderAttributes={},this.doublePrecision=i,i&&!1===t.fp64&&(s=Float32Array),t.bytesPerElement=s.BYTES_PER_ELEMENT,this.defaultType=s,this.value=null,this.settings=t,this.state={externalBuffer:null,bufferAccessor:t,allocatedValue:null,constant:!1},this._buffer=null,this.setData(t)}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new sl(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ap(e):0}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Bd.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const n={},i=this.value instanceof Float64Array,r=function(e,t){const n=mp(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(this.getAccessor(),t||{});return n[e]=new pp(this,r.high),n["".concat(e,"64Low")]=i?new pp(this,r.low):new Float32Array(this.size),n}if(t){const n=mp(this.getAccessor(),t);return{[e]:new pp(this,n)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}setData(e){const{state:t}=this;ArrayBuffer.isView(e)?e={value:e}:e instanceof sl&&(e={buffer:e});const n={...this.settings,...e};if(t.bufferAccessor=n,e.constant){let n=e.value;n=this._normalizeValue(n,[],0),this.settings.normalized&&(n=this._normalizeConstant(n));if(!(!t.constant||!this._areValuesEqual(n,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=n}else if(e.buffer){const i=e.buffer;t.externalBuffer=i,t.constant=!1,this.value=e.value;const r=e.value instanceof Float64Array;n.type=e.type||i.accessor.type,n.bytesPerElement=i.accessor.BYTES_PER_ELEMENT*(r?2:1),n.stride=Ap(n)}else if(e.value){this._checkExternalBuffer(e);let i=e.value;t.externalBuffer=null,t.constant=!1,this.value=i,n.bytesPerElement=i.BYTES_PER_ELEMENT,n.stride=Ap(n);const{buffer:r,byteOffset:o}=this;this.doublePrecision&&i instanceof Float64Array&&(i=jd(i,n));const s=i.byteLength+o+2*n.stride;r.byteLength<s&&r.reallocate(s),r.setAccessor(null),r.subData({data:i,offset:o}),n.type=e.type||r.accessor.type}return!0}updateSubBuffer(e={}){const{value:t}=this,{startOffset:n=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?jd(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),offset:n*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate({numInstances:e,copy:t=!1}){const{state:n}=this,i=n.allocatedValue,r=Bd.allocate(i,e+1,{size:this.size,type:this.defaultType,copy:t});this.value=r;const{buffer:o,byteOffset:s}=this;return o.byteLength<r.byteLength+s&&(o.reallocate(r.byteLength+s),t&&i&&o.subData({data:i instanceof Float64Array?jd(i,this):i,offset:s})),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!e.constant&&t){const n=this.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));t instanceof n||!this.settings.normalized||"normalized"in e||Ds.warn("Attribute ".concat(this.id," is normalized"))()}}_normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map((e=>(e+128)/255*2-1));case 5122:return new Float32Array(e).map((e=>(e+32768)/65535*2-1));case 5121:return new Float32Array(e).map((e=>e/255));case 5123:return new Float32Array(e).map((e=>e/65535));default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e)return t[n]=i[0],t;switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=r;for(;--o>=0;)t[n+o]=Number.isFinite(e[o])?e[o]:i[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}}{constructor(e,t={}){super(e,t);const{transition:n=!1,noAlloc:i=!1,update:r=null,accessor:o=null,transform:s=null,startIndices:a=null}=t;Object.assign(this.settings,{transition:n,noAlloc:i,update:r||o&&this._autoUpdater,accessor:o,transform:s}),Object.assign(this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:wp,startIndices:a}),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition;return Tp(Array.isArray(t)?e[t.find((t=>e[t]))]:e[t],n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===wp)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],i=e.length;let r=0;for(let o=0;o<i;o++){const i=e[o];i[1]<t[0]?(n.push(i),r=o+1):i[0]>t[1]?n.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=wp}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=xp}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}update(e){this.setData(e)}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&(!!n.update&&(super.allocate({numInstances:e,copy:t.updateRanges!==wp}),!0))}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:s}}=this;let a=!0;if(o){for(const[s,a]of r)o.call(i,this,{data:t,startRow:s,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of r){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}else;this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){if(void 0===e||"function"==typeof e)return!1;return this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;n.binaryValue=e,this.setNeedsRedraw(),ArrayBuffer.isView(e)&&(e={value:e});if(i.transform||t!==this.startIndices){gf(ArrayBuffer.isView(e.value),"invalid ".concat(i.accessor));const r=e.size&&e.size!==this.size;return n.binaryAccessor=bp(e.value,{size:e.size||this.size,stride:e.stride,offset:e.offset,startIndices:t,nested:r}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?t[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const n in e)Object.assign(t,super.getShaderAttributes(n,e[n]));return t}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:r,numInstances:o}){if(e.constant)return;const{settings:s,state:a,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=s,f=a.binaryAccessor||("function"==typeof h?h:r[h]);gf("function"==typeof f,'accessor "'.concat(h,'" is not a function'));let p=e.getVertexOffset(n);const{iterable:A,objectInfo:m}=_p(t,n,i);for(const t of A){m.index++;let n=f(t,m);if(d&&(n=d.call(this,n)),u){const t=(m.index<u.length-1?u[m.index+1]:o)-u[m.index];if(n&&Array.isArray(n[0])){let t=p;for(const i of n)e._normalizeValue(i,l,t),t+=c}else n&&n.length>c?l.set(n,p):(e._normalizeValue(n,m.target,0),af({target:l,source:m.target,start:p,count:t}));p+=t*c}else e._normalizeValue(n,l,p),p+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error("Illegal attribute generated for ".concat(this.id))}}}const Rp="\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n";const zp={interpolation:class{constructor({gl:e,attribute:t,timeline:n}){this.gl=e,this.type="interpolation",this.transition=new bf(n),this.attribute=t,this.attributeInTransition=new Lp(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=function(e,t){const n=Cp(t.size);return new Uh(e,{vs:Rp,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}(e,t);const i={byteLength:0,usage:35050};this.buffers=[new sl(e,i),new sl(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0)return void this.transition.cancel();const{gl:n,buffers:i,attribute:r}=this;Pp(i);const o={numInstances:t,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const e of i)Ip({buffer:e,...o});this.currentStartIndices=r.startIndices,this.currentLength=Mp(r,t),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aFrom:i[0],aTo:kp(0,r)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{time:e,settings:{duration:t,easing:n}}=this.transition,i=n(e/t);this.transform.run({uniforms:{time:i}})}return e}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}},spring:class{constructor({gl:e,attribute:t,timeline:n}){this.gl=e,this.type="spring",this.transition=new bf(n),this.attribute=t,this.attributeInTransition=new Lp(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=function(e){return new fl(e,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(e),this.framebuffer=function(e,t){return new Il(e,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}(e,this.texture),this.transform=function(e,t,n){const i=Cp(t.size);return new Uh(e,{framebuffer:n,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}(e,t,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new sl(e,i),new sl(e,i),new sl(e,i)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:n,buffers:i,attribute:r}=this,o={numInstances:t,attribute:r,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const e of i)Ip({buffer:e,...o});this.currentStartIndices=r.startIndices,this.currentLength=Mp(r,t),this.attributeInTransition.update({buffer:i[1],value:r.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/r.size),sourceBuffers:{aTo:kp(0,r)}})}update(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this;if(!i.update())return!1;t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:n,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:i.settings.stiffness,damping:i.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Pp(e),this.attributeInTransition.update({buffer:e[1],value:this.attribute.value});return xl(n)[0]>0||i.end(),!0}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}};class Dp{constructor(e,{id:t,timeline:n}){this.id=t,this.gl=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Uh.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const n in e){const i=e[n],r=i.getTransitionSetting(t);r&&this._updateAttribute(n,i,r)}for(const n in this.transitions){const i=e[n];i&&i.getTransitionSetting(t)||this._removeTransition(n)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(!this.isSupported||0===this.numInstances)return!1;for(const e in this.transitions){this.transitions[e].update()&&(this.needsRedraw=!0)}const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let r=!i||i.type!==n.type;if(r){if(!this.isSupported)return void Ds.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();i&&this._removeTransition(e);const o=zp[n.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,gl:this.gl}):(Ds.error("unsupported transition type '".concat(n.type,"'"))(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Op="attributeManager.invalidate";class Bp{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Dp(e,{id:"".concat(t,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(e=!0){return this.needsRedraw=!0,this}add(e,t){this._add(e,t)}addInstanced(e,t){this._add(e,t,{instanced:1})}remove(e){for(let t=0;t<e.length;t++){const n=e[t];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}invalidate(e,t){const n=this._invalidateTrigger(e,t);Fs(Op,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Fs(Op,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:r={},buffers:o={},context:s={}}={}){let a=!1;Fs("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const i in this.attributes){const l=this.attributes[i],c=l.settings.accessor;l.startIndices=n,r[i]&&Ds.removed("props.".concat(i),"data.attributes.".concat(i))(),l.setExternalBuffer(o[i])||l.setBinaryValue(o[c],e.startIndices)||!o[c]&&l.setConstantValue(r[c])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:r,context:s})),this.needsRedraw|=l.needsRedraw()}a&&Fs("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in t){const o=t[r];o.needsRedraw(e)&&!n.hasAttribute(r)&&(i[r]=o)}return i}getShaderAttributes(e,t={}){e||(e=this.getAttributes());const n={};for(const i in e)t[i]||Object.assign(n,e[i].getShaderAttributes());return n}getAccessors(){return this.updateTriggers}_add(e,t,n={}){t&&Ds.warn("AttributeManager.add({updaters}) - updater map no longer supported")();for(const t in e){const i=e[t];this.attributes[t]=this._createAttribute(t,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,n){const i={...t,id:e,isIndexed:t.isIndexed||t.elements||!1,constant:t.constant||!1,size:(t.elements?1:t.size)||1,value:t.value||null,divisor:t.instanced||n.instanced?1:t.divisor||0};return new Lp(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach((n=>{e[n]||(e[n]=[]),e[n].push(t)}))}this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,r=i[e];return r&&r.forEach((e=>{const i=n[e];i&&i.setNeedsUpdate(i.id,t)})),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(Fs("attribute.updateStart",t),t.constant)return void t.setConstantValue(t.value);t.allocate(n)&&Fs("attribute.allocate",t,n);t.updateBuffer(e)&&(this.needsRedraw=!0,Fs("attribute.updateEnd",t,n))}}const Fp=1e-5;function Np(e,t,n,i,r){const o=t-e;return(n-t)*r+-o*i+o+t}function Up(e,t){if(Array.isArray(e)){let n=0;for(let i=0;i<e.length;i++){const r=e[i]-t[i];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const jp={interpolation:class extends bf{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:r}}=this,o=r(e/i);this._value=ku(t,n,o)}},spring:class extends bf{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:o=e}=this;let s=function(e,t,n,i,r){if(Array.isArray(n)){const o=[];for(let s=0;s<n.length;s++)o[s]=Np(e[s],t[s],n[s],i,r);return o}return Np(e,t,n,i,r)}(r,o,t,n,i);const a=Up(s,t),l=Up(s,o);a<Fp&&l<Fp&&(s=t,this.end()),this._prevValue=o,this._currValue=s}}};class Vp{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:i=n.settings.fromValue}=n;t=i,this.remove(e)}if(!(i=Tp(i)))return;const o=jp[i.type];if(!o)return void Ds.error("unsupported transition type '".concat(i.type,"'"))();const s=new o(this.timeline);s.start({...i,fromValue:t,toValue:n}),r.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}const{COMPONENT:Gp}=rf;function Wp(e,t){const n=qp({newProps:e,oldProps:t,propTypes:Xp(e),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=null;const{dataComparator:i,_dataDiff:r}=e;i?i(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied");n&&r&&(n=r(e.data,t.data)||n);return n}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return"oldProps is null, initial diff";if("all"in e.updateTriggers){if(Qp(e,t,"all"))return{all:!0}}const n={};let i=!1;for(const r in e.updateTriggers)if("all"!==r){Qp(e,t,r)&&(n[r]=!0,i=n)}return i}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:Hp(e,t),transitionsChanged:$p(e,t)}}function $p(e,t){if(!e.transitions)return null;const n={},i=Xp(e);for(const r in e.transitions){const o=i[r],s=o&&o.type;("number"===s||"color"===s||"array"===s)&&Zp(e[r],t[r],o)&&(n[r]=!0)}return n}function qp({newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:r="props"}={}){if(t===e)return null;if("object"!=typeof e||null===e)return"".concat(r," changed shallowly");if("object"!=typeof t||null===t)return"".concat(r," changed shallowly");for(const o of Object.keys(e))if(!(o in n)){if(!(o in t))return"".concat(r,".").concat(o," added");const n=Zp(e[o],t[o],i[o]);if(n)return"".concat(r,".").concat(o," ").concat(n)}for(const o of Object.keys(t))if(!(o in n)){if(!(o in e))return"".concat(r,".").concat(o," dropped");if(!Object.hasOwnProperty.call(e,o)){const n=Zp(e[o],t[o],i[o]);if(n)return"".concat(r,".").concat(o," ").concat(n)}}return null}function Zp(e,t,n){let i=n&&n.equal;return i&&!i(e,t,n)?"changed deeply":i||(i=e&&t&&e.equals,!i||i.call(e,t))?i||t===e?null:"changed shallowly":"changed deeply"}function Hp(e,t){if(null===t)return"oldProps is null, initial diff";const n=t.extensions,{extensions:i}=e;if(i===n)return!1;if(i.length!==n.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(n[e]))return!0;return!1}function Qp(e,t,n){let i=e.updateTriggers[n];i=null==i?{}:i;let r=t.updateTriggers[n];r=null==r?{}:r;return qp({oldProps:r,newProps:i,triggerName:n})}function Xp(e){const t=e[Gp],n=t&&t.constructor;return n?n._propTypes:{}}function Yp(e){if(null===(t=e)||"object"!=typeof t)throw new Error("count(): argument not an object");var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}function Kp(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some((e=>"project64"===e.name)))){const e=n.modules.findIndex((e=>"project32"===e.name));e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const i={...e.inject};for(const e in t.inject)i[e]=(i[e]||"")+t.inject[e];n.inject=i}else n.inject=t.inject;return n}const Jp={10241:9987,10240:9729,10242:33071,10243:33071},eA={};const tA={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||oA(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>nA(e,t)},accessor:{validate(e,t){const n=sA(e);return"function"===n||n===sA(t.value)},equal:(e,t,n)=>"function"==typeof t||nA(e,t)},array:{validate:(e,t)=>t.optional&&!e||oA(e),equal:(e,t,n)=>n.compare?nA(e,t):e===t},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare||e===t},data:{transform:(e,t,n)=>{const{dataTransform:i}=n?n.props:{};return i&&e?i(e):e}},image:{transform:(e,t,n)=>function(e,t){const n=e.context&&e.context.gl;if(!n||!t)return null;if(t instanceof fl)return t;t.constructor&&"Object"!==t.constructor.name&&(t={data:t});let i=null;t.compressed&&(i={10241:t.data.length>1?9985:9729});const r=new fl(n,{...t,parameters:{...Jp,...i,...e.props.textureParameters}});return eA[r.id]=!0,r}(n,e),release:e=>{var t;(t=e)&&t instanceof fl&&eA[t.id]&&(t.delete(),delete eA[t.id])}}};function nA(e,t){if(e===t)return!0;if(!oA(e)||!oA(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}function iA(e,t){switch(sA(t)){case"object":return rA(e,t);case"array":return rA(e,{type:"array",value:t,compare:!1});case"boolean":return rA(e,{type:"boolean",value:t});case"number":return rA(e,{type:"number",value:t});case"function":return rA(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function rA(e,t){return"type"in t?{name:e,...tA[t.type],...t}:"value"in t?{name:e,type:sA(t.value),...t}:{name:e,type:"object",value:t}}function oA(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function sA(e){return oA(e)?"array":null===e?"null":typeof e}const{COMPONENT:aA,ASYNC_ORIGINAL:lA,ASYNC_RESOLVED:cA,ASYNC_DEFAULTS:uA}=rf;function hA(){const e=this,t=dA(e.constructor),n=Object.create(t);n[aA]=e,n[lA]={},n[cA]={};for(let e=0;e<arguments.length;++e){const t=arguments[e];for(const e in t)n[e]=t[e]}return Object.freeze(n),n}function dA(e){const t=AA(e,"_mergedDefaultProps");return t||(function(e){if(!e.prototype)return;const t=Object.getPrototypeOf(e),n=dA(t),i=function(e){const t={},n={},i={};for(const[r,o]of Object.entries(e))if(o&&o.deprecatedFor)i[r]=Array.isArray(o.deprecatedFor)?o.deprecatedFor:[o.deprecatedFor];else{const e=iA(r,o);t[r]=e,n[r]=e.value}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(AA(e,"defaultProps")||{}),r=function(e,t,n){const i=Object.create(null);Object.assign(i,t,e);const r=function(e){const t=AA(e,"layerName")||AA(e,"componentName");t||Ds.once(0,"".concat(e.name,".componentName not specified"))();return t||e.name}(n);return delete e.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}(i.defaultProps,n,e),o={...t._propTypes,...i.propTypes};!function(e,t){const n={},i={};for(const e in t){const r=t[e],{name:o,value:s}=r;r.async&&(n[o]=s,i[o]=fA(o))}e[uA]=n,e[lA]={},Object.defineProperties(e,i)}(r,o);const s={...t._deprecatedProps,...i.deprecatedProps};(function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const i="".concat(this.id,": ").concat(n);for(const i of t[n])pA(this,i)||(this[i]=e);Ds.deprecated(i,t[n].join("/"))()}})})(r,s),e._mergedDefaultProps=r,e._propTypes=o,e._deprecatedProps=s}(e),e._mergedDefaultProps)}function fA(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||vp(t)?this[lA][e]=t:this[cA][e]=t},get(){if(this[cA]){if(e in this[cA]){return this[cA][e]||this[uA][e]}if(e in this[lA]){const t=this[aA]&&this[aA].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[uA][e]}}return this[uA][e]}}}function pA(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function AA(e,t){return pA(e,t)&&e[t]}const{ASYNC_ORIGINAL:mA,ASYNC_RESOLVED:gA,ASYNC_DEFAULTS:yA}=rf,_A=Object.freeze({});class vA{constructor(e=null){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=_A,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}freezeAsyncOldProps(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){const t=e[gA]||{},n=e[mA]||e,i=e[yA]||{};for(const e in t){const n=t[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,n),t[e]=this.getAsyncProp(e)}for(const e in n){const t=n[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,t)}}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t){var n;const i=null===(n=this.layer)||void 0===n?void 0:n.props.fetch,r=t;i&&(t=i(r,{propName:e,layer:this.layer}))}t instanceof Promise?this._watchPromise(e,t):vp(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t)}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this.freezeAsyncOldProps();const n=this.asyncProps[e];t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&void 0!==t&&(this.freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];n.pendingLoadCount++;const i=n.pendingLoadCount;t.then((t=>{var r;t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,i);const o=null===(r=this.layer)||void 0===r?void 0:r.props.onDataLoad;"data"===e&&o&&o(t,{propName:e,layer:this.layer})})).catch((t=>{var n;null===(n=this.layer)||void 0===n||n.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}))}async _resolveAsyncIterable(e,t){var n;"data"!==e&&this._setPropValue(e,t);const i=this.asyncProps[e];i.pendingLoadCount++;const r=i.pendingLoadCount;let o=[],s=0;for await(const n of t){const{dataTransform:t}=this.component?this.component.props:{};o=t?t(n,o):o.concat(n),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(e,o,r)}const a=null===(n=this.layer)||void 0===n?void 0:n.props.onDataLoad;a&&a(o,{propName:e,layer:this.layer})}_postProcessValue(e,t){const n=e.type;return n&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}const{ASYNC_ORIGINAL:bA,ASYNC_RESOLVED:xA,ASYNC_DEFAULTS:wA}=rf;let EA=0;class SA{constructor(){this.props=hA.apply(this,arguments),this.id=this.props.id,this.count=EA++,this.lifecycle=Yd,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}clone(e){const{props:t}=this,n={};for(const e in t[wA])e in t[xA]?n[e]=t[xA][e]:e in t[bA]&&(n[e]=t[bA][e]);return new this.constructor({...t,...n,...e})}get stats(){return this.internalState.stats}_initState(){this.internalState=new vA({})}}SA.componentName="Component",SA.defaultProps={};class TA extends vA{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.model=null,this.needsRedraw=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}}const kA=2**24-1,CA=Object.freeze([]),PA=ed((({oldViewport:e,viewport:t})=>e.equals(t)));let MA=new Uint8ClampedArray(0);const IA={data:{type:"data",value:CA,async:!0},dataComparator:null,_dataDiff:{type:"function",value:e=>e&&e.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:i,loadOptions:r,signal:o})=>{const{resourceManager:s}=n.context;var a;(r=r||n.getLoadOptions(),i=i||n.props.loaders,o)&&(r={...r,fetch:{...null===(a=r)||void 0===a?void 0:a.fetch,signal:o}});let l=s.contains(e);return l||r||(s.add({resourceId:e,data:Bo(e,i),persistent:!1}),l=!0),l?s.subscribe({resourceId:e,onChange:e=>n.internalState.reloadAsyncProp(t,e),consumerId:n.id,requestId:t}):Bo(e,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Zh.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e],compare:!1},highlightedObjectIndex:-1,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class LA extends SA{toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}raiseError(e,t){var n,i,r,o;(t&&(e.message="".concat(t,": ").concat(e.message)),null===(n=(i=this.props).onError)||void 0===n?void 0:n.call(i,e))||(null===(r=this.context)||void 0===r||null===(o=r.onError)||void 0===o||o.call(r,e,this))}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(e=!0){this.internalState&&(this.internalState.needsRedraw=e)}setNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}hasUniformTransition(){return this.internalState.uniformTransitions.active}get isLoaded(){return this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}project(e){const{viewport:t}=this.context,n=Qd(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,o]=Le(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,o]}unproject(e){const{viewport:t}=this.context;return t.unproject(e)}projectPosition(e){return Xd(e,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Zh.DEFAULT||e===Zh.LNGLAT||e===Zh.CARTESIAN}onHover(e,t){return!!this.props.onHover&&this.props.onHover(e,t)}onClick(e,t){return!!this.props.onClick&&this.props.onClick(e,t)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){gf(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}initializeState(){throw new Error("Layer ".concat(this," has not defined initializeState"))}getShaders(e){for(const t of this.props.extensions)e=Kp(e,t.getShaders.call(this,t));return e}shouldUpdateState({oldProps:e,props:t,context:n,changeFlags:i}){return i.propsOrDataChanged}updateState({oldProps:e,props:t,context:n,changeFlags:i}){const r=this.getAttributeManager();if(i.dataChanged&&r){const{dataChanged:e}=i;if(Array.isArray(e))for(const t of e)r.invalidateAll(t);else r.invalidateAll()}const o=e.highlightedObjectIndex>=0||e.pickable,s=t.highlightedObjectIndex>=0||t.pickable;if(o!==s&&r){const{pickingColors:e,instancePickingColors:t}=r.attributes,n=e||t;n&&(s&&n.constant&&(n.constant=!1,r.invalidate(n.id)),n.value||s||(n.constant=!0,n.value=[0,0,0]))}}finalizeState(){for(const e of this.getModels())e.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t}){const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}activateViewport(e){const t=this.internalState.viewport;this.internalState.viewport=e,t&&PA({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all",t=""){const n=this.getAttributeManager();n&&("all"===e?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(e){const t=this.getAttributeManager();if(!t)return;const n=this.getNumInstances(e),i=this.getStartIndices(e);t.update({data:e.data,numInstances:n,startIndices:i,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this,ignoreUnknownAttributes:!0});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(MA.length/3);if(this.internalState.usesPickingColorCache=!0,n<t){t>kA&&Ds.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),MA=Bd.allocate(MA,t,{size:3,copy:!0,maxCount:Math.max(t,kA)});const e=Math.floor(MA.length/3),i=[];for(let t=n;t<e;t++)this.encodePickingColor(t,i),MA[3*t+0]=i[0],MA[3*t+1]=i[1],MA[3*t+2]=i[2]}e.value=MA.subarray(0,3*t)}_setModelAttributes(e,t){const n=this.getAttributeManager(),i=e.userData.excludeAttributes||{},r=n.getShaderAttributes(t,i);e.setAttributes(r)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n,r=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(o-r),offset:r})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;this.internalState.usesPickingColorCache&&n.value.buffer!==MA.buffer&&(n.value=MA.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0})}getNumInstances(e){return void 0!==(e=e||this.props).numInstances?e.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Yp(e.data)}getStartIndices(e){return void 0!==(e=e||this.props).startIndices?e.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}_initialize(){Fs("layer.initialize",this),this._initState(),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}_update(){const e=this.needsUpdate();Fs("layer.update",this,e),e&&this._updateState()}_updateState(){const e=this.props,t=this.context.viewport,n=this._updateUniformTransition();this.internalState.propsInTransition=n,this.context.viewport=this.internalState.viewport||t,this.props=n;try{const n=this._getUpdateParams(),i=this.getModels();if(this.context.gl)this.updateState(n);else try{this.updateState(n)}catch(e){}for(const e of this.props.extensions)e.updateState.call(this,n,e);const r=this.getModels()[0]!==i[0];this._updateModules(n,r),this.isComposite?this._renderLayers(n):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=t,this.props=e,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}_finalize(){Fs("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}drawLayer({moduleParameters:e=null,uniforms:t={},parameters:n={}}){this._updateAttributeTransition();const i=this.props;this.props=this.internalState.propsInTransition||i;const{opacity:r}=this.props;t.opacity=Math.pow(r,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:r}=this.props,o=r&&r(t)||[0,0];Ta(this.context.gl,{polygonOffset:o}),ka(this.context.gl,n,(()=>{const i={moduleParameters:e,uniforms:t,parameters:n,context:this.context};for(const e of this.props.extensions)e.draw.call(this,i,e);this.draw(i)}))}finally{this.props=i}}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(e){const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let i=!1;"dataChanged"===n&&Array.isArray(t[n])&&(t[n]=Array.isArray(e[n])?t[n].concat(e[n]):e[n],i=!0),t[n]||(t[n]=e[n],i=!0),i&&Fs("layer.changeFlag",this,n,e)}const n=t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged;t.propsOrDataChanged=n,t.somethingChanged=n||e.viewportChanged||e.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}diffProps(e,t){const n=Wp(e,t);if(n.updateTriggersChanged)for(const e in n.updateTriggersChanged)n.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions[i]);return this.setChangeFlags(n)}validateProps(){!function(e){const t=Xp(e);for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(e[n]))}}(this.props)}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}updateAutoHighlight(e){this.props.autoHighlight&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.pickingHighlightColor=n(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_updateModules({props:e,oldProps:t},n){const{autoHighlight:i,highlightedObjectIndex:r,highlightColor:o}=e;if(n||t.autoHighlight!==i||t.highlightedObjectIndex!==r||t.highlightColor!==o){const e={};i||(e.pickingSelectedColor=null),Array.isArray(o)&&(e.pickingHighlightColor=o),Number.isInteger(r)&&(e.pickingSelectedColor=r>=0?this.encodePickingColor(r):null),this.setModuleParameters(e)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const n=this.getAttributeManager(),i=n&&n.getNeedsRedraw(e);return t=t||i,t}_getAttributeManager(){return new Bp(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}_initState(){gf(!this.internalState&&!this.state),gf(isFinite(this.props.coordinateSystem));const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new TA({attributeManager:e,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ds.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new Vp(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(e){Fs("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.internalState.layer=this,this.state=t,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}LA.layerName="Layer",LA.defaultProps=IA;class RA extends LA{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"==typeof e){const t={data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:A,_subLayerProps:m}=this.props,g={opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:f,extensions:p,fetch:A},y=m&&m[e.id],_=y&&y.updateTriggers,v=e.id||"sublayer";if(y){const t=this.constructor._propTypes,n=e.type?e.type._propTypes:{};for(const e in y){const i=n[e]||t[e];i&&"accessor"===i.type&&(y[e]=this.getSubLayerAccessor(y[e]))}}Object.assign(g,e,y),g.id="".concat(this.props.id,"-").concat(v),g.updateTriggers={all:this.props.updateTriggers.all,...e.updateTriggers,..._};for(const e of p){const t=e.getSubLayerProps.call(this,e);t&&Object.assign(g,t,{updateTriggers:Object.assign(g.updateTriggers,t.updateTriggers)})}return g}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;const t=!e||this.needsUpdate();t&&(e=this.renderLayers(),e=of(e,Boolean),this.internalState.subLayers=e),Fs("compositeLayer.renderLayers",this,t,e);for(const t of e)t.parent=this}}RA.layerName="CompositeLayer";const zA=[255,255,255],DA=1,OA=[0,0,1],BA=[0,0,1];let FA=0;class NA{constructor(e={}){const{color:t=zA}=e,{intensity:n=DA}=e,{position:i=BA}=e;this.id=e.id||"point-".concat(FA++),this.color=t,this.intensity=n,this.type="point",this.position=i,this.attenuation=function(e){if("attenuation"in e)return e.attenuation;if("intensity"in e)return[0,0,e.intensity];return OA}(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:t}=this,n=e.context.viewport,{coordinateSystem:i,coordinateOrigin:r}=e.props,o=Xd(this.position,{viewport:n,coordinateSystem:i,coordinateOrigin:r,fromCoordinateSystem:n.isGeospatial?Zh.LNGLAT:Zh.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return t.color=this.color,t.intensity=this.intensity,t.position=o,t}}const UA=["bearing","pitch"],jA={speed:1.2,curve:1.414};class VA extends Cf{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),this.props={...jA,...e}}interpolateProps(e,t,n){const i=Ve(e,t,n,this.props);for(const r of UA)i[r]=ku(e[r]||0,t[r]||0,n);return i}getDuration(e,t){let{transitionDuration:n}=t;return"auto"===n&&(n=Ge(e,t,this.props)),n}}class GA{constructor(e={}){const{attributes:t={}}=e;this.typedArrayManager=Bd,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e),Object.seal(this)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:o,dataChanged:s,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===o?2:3),this.buffers=n,this.normalize=a,r&&(gf(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.positions=r)),this.geometryBuffer=n.positions,Array.isArray(s))for(const e of s)this._rebuildGeometry(e);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}normalizeGeometry(e){return e}updateGeometryAttributes(e,t,n){throw new Error("Not implemented")}getGeometrySize(e){throw new Error("Not implemented")}getGeometryFromBuffer(e){const t=e.value||e;return gf(ArrayBuffer.isView(t)),bp(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices})}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:o}=this;for(const s in r)if(s in i)o.release(n[s]),n[s]=null;else{const i=r[s];i.copy=t,n[s]=o.allocate(n[s],e,i)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:r}=this,{iterable:o,objectInfo:s}=_p(i,t,n);for(const t of o){s.index++;e(r(t,s),s.index)}}_rebuildGeometry(e){if(!this.data||!this.getGeometry)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:o}=this,{startRow:s=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],n=[0]),this.normalize||!o)this._forEachGeometry(((e,t)=>{e=this.normalizeGeometry(e),l[t]=e,n[t+1]=n[t]+this.getGeometrySize(e)}),s,a),i=n[n.length-1];else if(o.buffer instanceof sl){const e=o.stride||4*this.positionSize;n=r.startIndices,i=n[r.length]||o.buffer.byteLength/e}else{const e=o.value||o,t=o.stride/e.BYTES_PER_ELEMENT||this.positionSize;n=r.startIndices,i=n[r.length]||e.length/t}this._allocate(i,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const c={};this._forEachGeometry(((e,r)=>{e=l[r]||e,c.vertexStart=n[r],c.indexStart=t[r];const o=r<n.length-1?n[r+1]:i;c.geometrySize=o-n[r],c.geometryIndex=r,this.updateGeometryAttributes(e,c)}),s,a),this.vertexCount=t[t.length-1]}}const WA=new Uint16Array([0,2,1,0,3,2]),$A=new Float32Array([0,1,0,0,1,0,1,1]);function qA(e,t){if(!t)return function(e){const t=new Float64Array(12);for(let n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return{vertexCount:6,positions:t,indices:WA,texCoords:$A}}(e);const n=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),i=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),r=Math.ceil(n/t)+1,o=Math.ceil(i/t)+1,s=(r-1)*(o-1)*6,a=new Uint32Array(s),l=new Float32Array(r*o*2),c=new Float64Array(r*o*3);let u=0,h=0;for(let t=0;t<r;t++){const n=t/(r-1);for(let i=0;i<o;i++){const r=i/(o-1),s=ZA(e,n,r);c[3*u+0]=s[0],c[3*u+1]=s[1],c[3*u+2]=s[2]||0,l[2*u+0]=n,l[2*u+1]=1-r,t>0&&i>0&&(a[h++]=u-o,a[h++]=u-o-1,a[h++]=u-1,a[h++]=u-o,a[h++]=u-1,a[h++]=u),u++}}return{vertexCount:s,positions:c,indices:a,texCoords:l}}function ZA(e,t,n){return ku(ku(e[0],e[1],n),ku(e[3],e[2],n),t)}var HA="\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor, vec4(color, 1.0), alpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n".concat("\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n","\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture2D(bitmapTexture, uv);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n\n  if (picking_uActive) {\n    // Since instance information is not used, we can use picking color for pixel index\n    gl_FragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n");const QA={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Zh.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class XA extends LA{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\nvarying vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:HA,modules:[ud,md]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:n}){if(n.extensionsChanged){var i;const{gl:e}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}const r=this.getAttributeManager();if(e.bounds!==t.bounds){const e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(const n in t)e&&e[n]!==t[n]&&r.invalidate(n);this.setState({mesh:t,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo({info:e}){const{image:t}=this.props;if(!e.color||!t)return e.bitmap=null,e;const{width:n,height:i}=t;e.index=0;const r=function(e){const[t,n,i]=e;return[(t+(15&i)/16)/256,(n+(240&i)/256)/256]}(e.color),o=[Math.floor(r[0]*n),Math.floor(r[1]*i)];return e.bitmap={size:{width:n,height:i},uv:r,pixel:o},e}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return Number.isFinite(e[0])&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),qA(t,this.context.viewport.resolution)}_getModel(e){return e?new Dh(e,{...this.getShaders(),id:this.props.id,geometry:new Vh({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:t,moduleParameters:n}=e,{model:i,coordinateConversion:r,bounds:o,disablePicking:s}=this.state,{image:a,desaturate:l,transparentColor:c,tintColor:u}=this.props;n.pickingActive&&s||a&&i&&i.setUniforms(t).setUniforms({bitmapTexture:a,desaturate:l,transparentColor:c.map((e=>e/255)),tintColor:u.slice(0,3).map((e=>e/255)),coordinateConversion:r,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:n}=Zh;let{_imageCoordinateSystem:i}=this.props;if(i!==n){const{bounds:n}=this.props;if(!Number.isFinite(n[0]))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const r=this.context.viewport.resolution?e:t;if(i=i===e?e:t,i===e&&r===t)return{coordinateConversion:-1,bounds:n};if(i===t&&r===e){const e=Ee([n[0],n[1]]),t=Ee([n[2],n[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}XA.layerName="BitmapLayer",XA.defaultProps=QA;const YA=()=>{},KA={10241:9987,10240:9729,10242:33071,10243:33071};function JA(e,t,n,i){return n===t.width&&i===t.height?t:(e.canvas.height=i,e.canvas.width=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,n,i),e.canvas)}function em(e){return e&&(e.id||e.url)}function tm(e,t,n,i){const r=t.width,o=t.height,s=Ll(t,{width:n,height:i});return function(e,t,n={}){const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:o=0,targetInternalFormat:s=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:h}=n;const{framebuffer:d,deleteFramebuffer:f}=El(e);Ua(d);const{gl:p,handle:A}=d,m=void 0!==a||void 0!==l||void 0!==c;a=a||0,l=l||0,c=c||0;const g=p.bindFramebuffer(36160,A);Ua(t);let y=null;if(t instanceof dl&&(y=t,u=Number.isFinite(u)?u:y.width,h=Number.isFinite(h)?h:y.height,y.bind(0),t=y.target),m)switch(t){case 3553:case 34067:p.copyTexSubImage2D(t,o,a,l,i,r,u,h);break;case 35866:case 32879:Hs(p).copyTexSubImage3D(t,o,a,l,c,i,r,u,h)}else p.copyTexImage2D(t,o,s,i,r,u,h,0);y&&y.unbind(),p.bindFramebuffer(36160,g||null),f&&d.delete()}(t,s,{targetY:0,width:r,height:o}),t.delete(),s}function nm(e,t,n){for(let i=0;i<t.length;i++){const{icon:r,xOffset:o}=t[i];e[em(r)]={...r,x:o,y:n}}}class im{constructor(e,{onUpdate:t=YA,onError:n=YA}){this.gl=e,this.onUpdate=t,this.onError=n,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null}finalize(){var e;null===(e=this._texture)||void 0===e||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?em(e):e;return this._mapping[t]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,data:r,getIcon:o}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),o&&(this._getIcon=o),i&&(this._mapping=i),n&&this._updateIconAtlas(n),this._autoPacking&&(r||o)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(r))}get isLoaded(){return 0===this._pendingCount}_updateIconAtlas(e){var t;null===(t=this._texture)||void 0===t||t.delete(),this._texture=null,this._externalTexture=e,this.onUpdate()}_updateAutoPacking(e){const t=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};const i={},{iterable:r,objectInfo:o}=_p(e);for(const e of r){o.index++;const r=t(e,o),s=em(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");i[s]||n[s]&&r.url===n[s].url||(i[s]={...r,source:e,sourceIndex:o.index})}return i}(e,this._getIcon,this._mapping)||{});if(t.length>0){const{mapping:e,xOffset:n,yOffset:i,rowHeight:r,canvasHeight:o}=function({icons:e,buffer:t,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:o=0,canvasWidth:s}){let a=[];for(let l=0;l<e.length;l++){const c=e[l];if(!n[em(c)]){const{height:e,width:l}=c;i+l+t>s&&(nm(n,a,r),i=0,r=o+r+t,o=0,a=[]),a.push({icon:c,xOffset:i}),i=i+l+t,o=Math.max(o,e)}}return a.length>0&&nm(n,a,r),{mapping:n,rowHeight:o,xOffset:i,yOffset:r,canvasWidth:s,canvasHeight:(l=o+r+t,Math.pow(2,Math.ceil(Math.log2(l))))};var l}({icons:t,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=r,this._mapping=e,this._xOffset=n,this._yOffset=i,this._canvasHeight=o,this._texture||(this._texture=new fl(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:KA})),this._texture.height!==this._canvasHeight&&(this._texture=tm(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(t)}}_loadIcons(e){const t=this._canvas.getContext("2d");for(const n of e)this._pendingCount++,Bo(n.url,as,this._loadOptions).then((e=>{const i=em(n),{x:r,y:o,width:s,height:a}=this._mapping[i],l=JA(t,e,s,a);this._texture.setSubImageData({data:l,x:r,y:o,width:s,height:a}),this._texture.generateMipmap(),this.onUpdate()})).catch((e=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:e})})).finally((()=>{this._pendingCount--}))}}const rm=[0,0,0,255],om={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:rm},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class sm extends LA{getShaders(){return super.getShaders({vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ud,md]})}initializeState(){this.state={iconManager:new im(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:rm},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState({oldProps:e,props:t,changeFlags:n}){super.updateState({props:t,oldProps:e,changeFlags:n});const i=this.getAttributeManager(),{iconAtlas:r,iconMapping:o,data:s,getIcon:a}=t,{iconManager:l}=this.state;l.setProps({loadOptions:t.loadOptions});let c=!1;if(r||this.internalState.isAsyncPropLoading("iconAtlas")?(e.iconAtlas!==t.iconAtlas&&l.setProps({iconAtlas:r,autoPacking:!1}),e.iconMapping!==t.iconMapping&&(l.setProps({iconMapping:o}),c=!0)):l.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&l.setProps({data:s,getIcon:a}),c&&(i.invalidate("instanceOffsets"),i.invalidate("instanceIconFrames"),i.invalidate("instanceColorModes")),n.extensionsChanged){var u;const{gl:e}=this.context;null===(u=this.state.model)||void 0===u||u.delete(),this.state.model=this._getModel(e),i.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:r,billboard:o,alphaCutoff:s}=this.props,{iconManager:a}=this.state,{viewport:l}=this.context,c=a.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeScale:t*("pixels"===r?l.metersPerPixel:1),sizeMinPixels:n,sizeMaxPixels:i,billboard:o,alphaCutoff:s}).draw()}_getModel(e){return new Dh(e,{...this.getShaders(),id:this.props.id,geometry:new Vh({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const{onIconError:t}=this.getCurrentLayer().props;t?t(e):Ds.error(e.error)()}getInstanceOffset(e){const t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}}sm.layerName="IconLayer",sm.defaultProps=om;const am=[0,0,0,255],lm={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:am},getLineColor:{type:"accessor",value:am},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class cm extends LA{getShaders(){return super.getShaders({vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool billboard;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = antialiasing ? \n    smoothedge(distToCenter, outerRadiusPixels) : \n    step(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = antialiasing ? \n      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\n      step(innerUnitRadius * outerRadiusPixels, distToCenter);\n\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ud,md]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),n.extensionsChanged){var i;const{gl:e}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{viewport:t}=this.context,{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:o,stroked:s,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:d,lineWidthMaxPixels:f}=this.props,p="pixels"===n?t.metersPerPixel:1,A="pixels"===u?t.metersPerPixel:1;this.state.model.setUniforms(e).setUniforms({stroked:s?1:0,filled:a,billboard:l,antialiasing:c,radiusScale:i*p,radiusMinPixels:r,radiusMaxPixels:o,lineWidthScale:h*A,lineWidthMinPixels:d,lineWidthMaxPixels:f}).draw()}_getModel(e){return new Dh(e,{...this.getShaders(),id:this.props.id,geometry:new Vh({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}cm.layerName="ScatterplotLayer",cm.defaultProps=lm;const um=1,hm=-1;function dm(e,t,n={}){const i=function(e,t={}){return Math.sign(function(e,t={}){const{start:n=0,end:i=e.length}=t,r=t.size||2;let o=0;for(let t=n,s=i-r;t<i;t+=r)o+=(e[t]-e[s])*(e[t+1]+e[s+1]),s=t;return o/2}(e,t))}(e,n);return i!==t&&(function(e,t){const{start:n=0,end:i=e.length,size:r=2}=t,o=(i-n)/r,s=Math.floor(o/2);for(let t=0;t<s;++t){const i=n+t*r,s=n+(o-1-t)*r;for(let t=0;t<r;++t){const n=e[i+t];e[i+t]=e[s+t],e[s+t]=n}}}(e,n),!0)}function fm(e,t){const n=t.length,i=e.length;if(i>0){let r=!0;for(let o=0;o<n;o++)if(e[i-n+o]!==t[o]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)e[i+r]=t[r];return!0}function pm(e,t){const n=t.length;for(let i=0;i<n;i++)e[i]=t[i]}function Am(e,t,n,i,r=[]){const o=i+t*n;for(let t=0;t<n;t++)r[t]=e[o+t];return r}function mm(e,t,n,i,r=[]){let o,s;if(8&n)o=(i[3]-e[1])/(t[1]-e[1]),s=3;else if(4&n)o=(i[1]-e[1])/(t[1]-e[1]),s=1;else if(2&n)o=(i[2]-e[0])/(t[0]-e[0]),s=2;else{if(!(1&n))return null;o=(i[0]-e[0])/(t[0]-e[0]),s=0}for(let n=0;n<e.length;n++)r[n]=(1&s)===n?i[s]:o*(t[n]-e[n])+e[n];return r}function gm(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function ym(e,t={}){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:a=e.length}=t,l=(a-s)/n;let c=[];const u=[c],h=Am(e,0,n,s);let d,f;const p=xm(h,r,o,[]),A=[];fm(c,h);for(let t=1;t<l;t++){for(d=Am(e,t,n,s,d),f=gm(d,p);f;){mm(h,d,f,p,A);const e=gm(A,p);e&&(mm(h,A,e,p,A),f=e),fm(c,A),pm(h,A),wm(p,r,f),i&&c.length>n&&(c=[],u.push(c),fm(c,h)),f=gm(d,p)}fm(c,d),pm(h,d)}return i?u:u[0]}function _m(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function vm(e,t,n={}){if(!e.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:o=[0,0],edgeTypes:s=!1}=n,a=[],l=[{pos:e,types:s&&new Array(e.length/i).fill(1),holes:t||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:e,types:t,holes:n}=l.shift();Em(e,i,n[0]||e.length,c),u=xm(c[0],r,o,u);const h=gm(c[1],u);if(h){let r=bm(e,t,i,0,n[0]||e.length,u,h);const o={pos:r[0].pos,types:r[0].types,holes:[]},a={pos:r[1].pos,types:r[1].types,holes:[]};l.push(o,a);for(let l=0;l<n.length;l++)r=bm(e,t,i,n[l],n[l+1]||e.length,u,h),r[0]&&(o.holes.push(o.pos.length),o.pos=_m(o.pos,r[0].pos),s&&(o.types=_m(o.types,r[0].types))),r[1]&&(a.holes.push(a.pos.length),a.pos=_m(a.pos,r[1].pos),s&&(a.types=_m(a.types,r[1].types)))}else{const i={positions:e};s&&(i.edgeTypes=t),n.length&&(i.holeIndices=n),a.push(i)}}return a}function bm(e,t,n,i,r,o,s){const a=(r-i)/n,l=[],c=[],u=[],h=[],d=[];let f,p,A;const m=Am(e,a-1,n,i);let g=Math.sign(8&s?m[1]-o[3]:m[0]-o[2]),y=t&&t[a-1],_=0,v=0;for(let r=0;r<a;r++)f=Am(e,r,n,i,f),p=Math.sign(8&s?f[1]-o[3]:f[0]-o[2]),A=t&&t[i/n+r],p&&g&&g!==p&&(mm(m,f,s,o,d),fm(l,d)&&u.push(y),fm(c,d)&&h.push(y)),p<=0?(fm(l,f)&&u.push(A),_-=p):u.length&&(u[u.length-1]=0),p>=0?(fm(c,f)&&h.push(A),v+=p):h.length&&(h[h.length-1]=0),pm(m,f),g=p,y=A;return[_?{pos:l,types:t&&u}:null,v?{pos:c,types:t&&h}:null]}function xm(e,t,n,i){const r=Math.floor((e[0]-n[0])/t)*t+n[0],o=Math.floor((e[1]-n[1])/t)*t+n[1];return i[0]=r,i[1]=o,i[2]=r+t,i[3]=o+t,i}function wm(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function Em(e,t,n,i){let r=1/0,o=-1/0,s=1/0,a=-1/0;for(let i=0;i<n;i+=t){const t=e[i],n=e[i+1];r=t<r?t:r,o=t>o?t:o,s=n<s?n:s,a=n>a?n:a}return i[0][0]=r,i[0][1]=s,i[1][0]=o,i[1][1]=a,i}function Sm(e,t,n,i){let r=-1,o=-1;for(let s=n+1;s<i;s+=t){const t=Math.abs(e[s]);t>r&&(r=t,o=s-1)}return o}function Tm(e,t,n,i,r=85.051129){const o=e[n],s=e[i-t];if(Math.abs(o-s)>180){const i=Am(e,0,t,n);i[0]+=360*Math.round((s-o)/360),fm(e,i),i[1]=Math.sign(i[1])*r,fm(e,i),i[0]=o,fm(e,i)}}function km(e,t,n,i){let r,o=e[0];for(let s=n;s<i;s+=t){r=e[s];const t=r-o;(t>180||t<-180)&&(r-=360*Math.round(t/360)),e[s]=o=r}}function Cm(e,t){let n;const i=e.length/t;for(let r=0;r<i&&(n=e[r*t],(n+180)%360==0);r++);const r=360*-Math.round(n/360);if(0!==r)for(let n=0;n<i;n++)e[n*t]+=r}class Pm extends Vh{constructor(e={}){const{id:t=Wa("column-geometry")}=e,{indices:n,attributes:i}=function(e){const{radius:t,height:n=1,nradial:i=10}=e;let{vertices:r}=e;r&&(Ds.assert(r.length>=i),r=r.flatMap((e=>[e[0],e[1]])),dm(r,hm));const o=n>0,s=i+1,a=o?3*s+1:i,l=2*Math.PI/i,c=new Uint16Array(o?3*i*2:0),u=new Float32Array(3*a),h=new Float32Array(3*a);let d=0;if(o){for(let e=0;e<s;e++){const o=e*l,s=e%i,a=Math.sin(o),c=Math.cos(o);for(let e=0;e<2;e++)u[d+0]=r?r[2*s]:c*t,u[d+1]=r?r[2*s+1]:a*t,u[d+2]=(.5-e)*n,h[d+0]=r?r[2*s]:c,h[d+1]=r?r[2*s+1]:a,d+=3}u[d+0]=u[d-3],u[d+1]=u[d-2],u[d+2]=u[d-1],d+=3}for(let e=o?0:1;e<s;e++){const o=Math.floor(e/2)*Math.sign(.5-e%2),s=o*l,a=(o+i)%i,c=Math.sin(s),f=Math.cos(s);u[d+0]=r?r[2*a]:f*t,u[d+1]=r?r[2*a+1]:c*t,u[d+2]=n/2,h[d+2]=1,d+=3}if(o){let e=0;for(let t=0;t<i;t++)c[e++]=2*t+0,c[e++]=2*t+2,c[e++]=2*t+0,c[e++]=2*t+1,c[e++]=2*t+1,c[e++]=2*t+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:h}}}}(e);super({...e,id:t,indices:n,attributes:i})}}const Mm=[0,0,0,255],Im={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:Mm},getLineColor:{type:"accessor",value:Mm},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Lm extends LA{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio -= sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ud,kh,md]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Mm},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Mm},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState({props:e,oldProps:t,changeFlags:n}){super.updateState({props:e,oldProps:t,changeFlags:n});const i=n.extensionsChanged;if(i){var r;const{gl:e}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}(i||e.diskResolution!==t.diskResolution||e.vertices!==t.vertices||(e.extruded||e.stroked)!==(t.extruded||t.stroked))&&this._updateGeometry(e)}getGeometry(e,t,n){const i=new Pm({radius:1,height:n?2:0,vertices:t,nradial:e});let r=0;if(t)for(let n=0;n<e;n++){const i=t[n];r+=Math.sqrt(i[0]*i[0]+i[1]*i[1])/e}else r=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*r}),i}_getModel(e){return new Dh(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:t,extruded:n,stroked:i}){const r=this.getGeometry(e,t,n||i);this.setState({fillVertexCount:r.attributes.POSITION.value.length/3,wireframeVertexCount:r.indices.value.length}),this.state.model.setProps({geometry:r})}draw({uniforms:e}){const{viewport:t}=this.context,{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:o,elevationScale:s,extruded:a,filled:l,stroked:c,wireframe:u,offset:h,coverage:d,radius:f,angle:p}=this.props,{model:A,fillVertexCount:m,wireframeVertexCount:g,edgeDistance:y}=this.state,_="pixels"===n?t.metersPerPixel:1;A.setUniforms(e).setUniforms({radius:f,angle:p/180*Math.PI,offset:h,extruded:a,coverage:d,elevationScale:s,edgeDistance:y,widthScale:i*_,widthMinPixels:r,widthMaxPixels:o}),a&&u&&(A.setProps({isIndexed:!0}),A.setVertexCount(g).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(A.setProps({isIndexed:!1}),A.setVertexCount(m).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!a&&c&&(A.setProps({isIndexed:!1}),A.setVertexCount(2*m/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}function Rm(e,t,n,i){let r=e;if(Array.isArray(e[0])){const n=e.length*t;r=new Array(n);for(let n=0;n<e.length;n++)for(let i=0;i<t;i++)r[n*t+i]=e[n][i]||0}return n?ym(r,{size:t,gridResolution:n}):i?function(e,t={}){const{size:n=2,startIndex:i=0,endIndex:r=e.length,normalize:o=!0}=t,s=e.slice(i,r);km(s,n,0,r-i);const a=ym(s,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const e of a)Cm(e,n);return a}(r,{size:t}):r}Lm.layerName="ColumnLayer",Lm.defaultProps=Im;class zm extends GA{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):()=>null}normalizeGeometry(e){return this.normalize?Rm(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}get(e){return this.attributes[e]}getGeometrySize(e){if(Array.isArray(e[0])){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&Array.isArray(e[0]))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const{segmentTypes:n}=this.attributes,i=this.isClosed(e),{vertexStart:r,geometrySize:o}=t;n.fill(0,r,r+o),i?(n[r]=4,n[r+o-2]=4):(n[r]+=1,n[r+o-2]+=2),n[r+o-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n)return;const{vertexStart:i,geometrySize:r}=t,o=new Array(3);for(let t=i,s=0;s<r;t++,s++)this.getPointOnPath(e,s,o),n[3*t]=o[0],n[3*t+1]=o[1],n[3*t+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const r=t*i;return n[0]=e[r],n[1]=e[r+1],n[2]=3===i&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return this.opts.loop;const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}const Dm=[0,0,0,255],Om={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:Dm},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Bm={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Fm extends LA{getShaders(){return super.getShaders({vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ud,md]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Bm,accessor:"getPath",update:this.calculatePositions,noAlloc:true,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:true},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Bm,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Bm,defaultValue:Dm},instancePickingColors:{size:3,type:5121,accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}}),this.setState({pathTesselator:new zm({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&Ds.removed("getDashArray","PathStyleExtension")()}updateState({oldProps:e,props:t,changeFlags:n}){super.updateState({props:t,oldProps:e,changeFlags:n});const i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,r=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:r.getPath,buffers:r,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||i.invalidateAll()}if(n.extensionsChanged){var r;const{gl:e}=this.context;null===(r=this.state.model)||void 0===r||r.delete(),this.state.model=this._getModel(e),i.invalidateAll()}}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,{data:i}=this.props;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const{data:t}=this.props;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else this._disablePickingIndex(e)}draw({uniforms:e}){const{viewport:t}=this.context,{jointRounded:n,capRounded:i,billboard:r,miterLimit:o,widthUnits:s,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u="pixels"===s?t.metersPerPixel:1;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthScale:a*u,miterLimit:o,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){return new Dh(e,{...this.getShaders(),id:this.props.id,geometry:new Vh({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}Fm.layerName="PathLayer",Fm.defaultProps=Om;var Nm={exports:{}};function Um(e,t,n){n=n||2;var i,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=jm(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(u&&(d=function(e,t,n,i){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=jm(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),a.push(Km(s));for(a.sort(Hm),r=0;r<a.length;r++)n=Vm(n=Qm(a[r],n),n.next);return n}(e,t,d,n)),e.length>80*n){i=o=e[0],r=s=e[1];for(var p=n;p<h;p+=n)(a=e[p])<i&&(i=a),(l=e[p+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-i,s-r))?1/c:0}return Gm(d,f,n,i,r,c),f}function jm(e,t,n,i,r){var o,s;if(r===hg(e,t,n,i)>0)for(o=t;o<n;o+=i)s=lg(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=lg(o,e[o],e[o+1],s);return s&&ng(s,s.next)&&(cg(s),s=s.next),s}function Vm(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!ng(i,i.next)&&0!==tg(i.prev,i,i.next))i=i.next;else{if(cg(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function Gm(e,t,n,i,r,o,s){if(e){!s&&o&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=Ym(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?$m(e,i,r,o):Wm(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),cg(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Gm(e=qm(Vm(e),t,n),t,n,i,r,o,2):2===s&&Zm(e,t,n,i,r,o):Gm(Vm(e),t,n,i,r,o,1);break}}}function Wm(e){var t=e.prev,n=e,i=e.next;if(tg(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(Jm(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&tg(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function $m(e,t,n,i){var r=e.prev,o=e,s=e.next;if(tg(r,o,s)>=0)return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,c=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=Ym(a,l,t,n,i),d=Ym(c,u,t,n,i),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&Jm(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&tg(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&Jm(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&tg(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&Jm(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&tg(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&Jm(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&tg(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function qm(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!ng(r,o)&&ig(r,i,i.next,o)&&sg(r,o)&&sg(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),cg(i),cg(i.next),i=e=o),i=i.next}while(i!==e);return Vm(i)}function Zm(e,t,n,i,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&eg(s,a)){var l=ag(s,a);return s=Vm(s,s.next),l=Vm(l,l.next),Gm(s,t,n,i,r,o),void Gm(l,t,n,i,r,o)}a=a.next}s=s.next}while(s!==e)}function Hm(e,t){return e.x-t.x}function Qm(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s){if(s=a,a===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===s)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&Jm(o<h?r:s,o,u,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),sg(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&Xm(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var i=ag(n,e),r=Vm(n,n.next);return Vm(i,i.next),t===n?r:t}function Xm(e,t){return tg(e.prev,e,t.prev)<0&&tg(t.next,e,e.next)<0}function Ym(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Km(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Jm(e,t,n,i,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function eg(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&ig(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(sg(e,t)&&sg(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(tg(e.prev,e,t.prev)||tg(e,t.prev,t))||ng(e,t)&&tg(e.prev,e,e.next)>0&&tg(t.prev,t,t.next)>0)}function tg(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ng(e,t){return e.x===t.x&&e.y===t.y}function ig(e,t,n,i){var r=og(tg(e,t,n)),o=og(tg(e,t,i)),s=og(tg(n,i,e)),a=og(tg(n,i,t));return r!==o&&s!==a||(!(0!==r||!rg(e,n,t))||(!(0!==o||!rg(e,i,t))||(!(0!==s||!rg(n,e,i))||!(0!==a||!rg(n,t,i)))))}function rg(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function og(e){return e>0?1:e<0?-1:0}function sg(e,t){return tg(e.prev,e,e.next)<0?tg(e,t,e.next)>=0&&tg(e,e.prev,t)>=0:tg(e,t,e.prev)<0||tg(e,e.next,t)<0}function ag(e,t){var n=new ug(e.i,e.x,e.y),i=new ug(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function lg(e,t,n,i){var r=new ug(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function cg(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ug(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hg(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}Nm.exports=Um,Nm.exports.default=Um,Um.deviation=function(e,t,n,i){var r=t&&t.length,o=r?t[0]*n:e.length,s=Math.abs(hg(e,0,o,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(hg(e,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,f=i[a+1]*n,p=i[a+2]*n;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},Um.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n};var dg=Nm.exports;const fg=um,pg=hm,Ag={isClosed:!0};function mg(e,t,n,i,r){let o=t;const s=n.length;for(let t=0;t<s;t++)for(let r=0;r<i;r++)e[o++]=n[t][r]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let t=0;t<i;t++)e[o++]=n[0][t]||0;return Ag.start=t,Ag.end=o,Ag.size=i,dm(e,r,Ag),o}function gg(e,t,n,i,r=0,o,s){const a=(o=o||n.length)-r;if(a<=0)return t;let l=t;for(let t=0;t<a;t++)e[l++]=n[r+t];if(!function(e,t,n,i){for(let r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}(n,i,r,o))for(let t=0;t<i;t++)e[l++]=n[r+t];return Ag.start=t,Ag.end=l,Ag.size=i,dm(e,s,Ag),l}function yg(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],i=[];if(e.positions){const{positions:r,holeIndices:o}=e;if(o){let e=0;for(let s=0;s<=o.length;s++)e=gg(n,e,r,t,o[s-1],o[s],0===s?fg:pg),i.push(e);return i.pop(),{positions:n,holeIndices:i}}e=r}if(Number.isFinite(e[0]))return gg(n,0,e,t,0,n.length,fg),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let r=0;for(const[o,s]of e.entries())r=mg(n,r,s,t,0===o?fg:pg),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return mg(n,0,e,t,fg),n}class _g extends GA{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;t&&(this.vertexCount=(t.value||t).length)}normalizeGeometry(e){if(this.normalize){if(e=yg(e,this.positionSize),this.opts.resolution)return vm(e.positions||e,e.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return function(e,t,n={}){const{size:i=2,normalize:r=!0,edgeTypes:o=!1}=n;t=t||[];const s=[],a=[];let l=0,c=0;for(let r=0;r<=t.length;r++){const o=t[r]||e.length,u=c,h=Sm(e,i,l,o);for(let t=h;t<o;t++)s[c++]=e[t];for(let t=l;t<h;t++)s[c++]=e[t];km(s,i,u,c),Tm(s,i,u,c,n.maxLatitude),l=o,a[r]=c}a.pop();const u=vm(s,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(r)for(const e of u)Cm(e.positions,i);return u}(e.positions||e,e.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return e}getGeometrySize(e){if(Array.isArray(e)&&!Number.isFinite(e[0])){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return(e.positions||e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):()=>null}updateGeometryAttributes(e,t){if(Array.isArray(e)&&!Number.isFinite(e[0]))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:o,typedArrayManager:s}=this;let a=r.indices;if(!a)return;let l=i;const c=function(e,t,n){let i=null;e.holeIndices&&(i=e.holeIndices.map((e=>e/t)));let r=e.positions||e;if(n){const e=r.length;r=r.slice();const i=[];for(let o=0;o<e;o+=t){i[0]=r[o],i[1]=r[o+1];const e=n(i);r[o]=e[0],r[o+1]=e[1]}}return dg(r,i,t)}(e,this.positionSize,this.opts.preproject);a=s.allocate(a,i+c.length,{copy:!0});for(let e=0;e<c.length;e++)a[l++]=c[e]+n;o[t+1]=i+c.length,r.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i)return;const o=e.positions||e;for(let e=t,s=0;s<n;e++,s++){const t=o[s*r],n=o[s*r+1],a=r>2?o[s*r+2]:0;i[3*e]=t,i[3*e+1]=n,i[3*e+2]=a}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{attributes:{vertexValid:i},positionSize:r}=this,o=e&&e.holeIndices;if(e&&e.edgeTypes?i.set(e.edgeTypes,t):i.fill(1,t,t+n),o)for(let e=0;e<o.length;e++)i[t+o[e]/r-1]=0;i[t+n-1]=0}}var vg="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n#ifdef IS_SIDE_VERTEX\n  if(vertexValid < 0.5){\n    gl_Position = vec4(0.);\n    return;\n  }\n#endif\n\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",bg="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(vg,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),xg="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(vg,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  #if RING_WINDING_ORDER_CW == 1\n    props.positions = instancePositions;\n    props.positions64Low = instancePositions64Low;\n    props.nextPositions = nextPositions;\n    props.nextPositions64Low = nextPositions64Low;\n  #else\n    props.positions = nextPositions;\n    props.positions64Low = nextPositions64Low;\n    props.nextPositions = instancePositions;\n    props.nextPositions64Low = instancePositions64Low;\n  #endif\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n\n  calculatePosition(props);\n}\n");const wg=[0,0,0,255],Eg={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:wg},getLineColor:{type:"accessor",value:wg},material:!0},Sg={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Tg extends LA{getShaders(e){return super.getShaders({vs:"top"===e?bg:xg,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[ud,kh,md]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:t}=this.context;let{coordinateSystem:n}=this.props;t.isGeospatial&&n===Zh.DEFAULT&&(n=Zh.LNGLAT),this.setState({numInstances:0,polygonTesselator:new _g({preproject:n===Zh.LNGLAT&&t.projectFlat,fp64:this.use64bitPositions(),IndexType:!e||Cl(e,Tl)?Uint32Array:Uint16Array})});const i=this.getAttributeManager(),r=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:r},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Sg,accessor:"getPolygon",update:this.calculatePositions,noAlloc:r,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:r},elevations:{size:1,transition:Sg,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Sg,accessor:"getFillColor",defaultValue:wg,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Sg,accessor:"getLineColor",defaultValue:wg,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,{data:i}=this.props;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const{data:t}=this.props;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:o,sideModel:s,polygonTesselator:a}=this.state,l={...e,extruded:Boolean(t),elevationScale:r};s&&(s.setInstanceCount(a.instanceCount-1),s.setUniforms(l),i&&(s.setDrawMode(3),s.setUniforms({isWireframe:!0}).draw()),n&&(s.setDrawMode(6),s.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(a.vertexCount),o.setUniforms(l).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:i}=e,r=this.getAttributeManager();var o;(i.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&(null===(o=this.state.models)||void 0===o||o.forEach((e=>e.delete())),this.setState(this._getModels(this.context.gl)),r.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:t,filled:n,extruded:i}=this.props;let r,o;if(n){const n=this.getShaders("top");n.defines.NON_INSTANCED_MODEL=1,r=new Dh(e,{...n,id:"".concat(t,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(o=new Dh(e,{...this.getShaders("side"),id:"".concat(t,"-side"),geometry:new Vh({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,r].filter(Boolean),topModel:r,sideModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}function kg({data:e,getIndex:t,dataRange:n,replace:i}){const{startRow:r=0,endRow:o=1/0}=n,s=e.length;let a=s,l=s;for(let n=0;n<s;n++){const i=t(e[n]);if(a>n&&i>=r&&(a=n),i>=o){l=n;break}}let c=a;const u=l-a!==i.length,h=u&&e.slice(l);for(let t=0;t<i.length;t++)e[c++]=i[t];if(u){for(let t=0;t<h.length;t++)e[c++]=h[t];e.length=c}return{startRow:a,endRow:a+i.length}}Tg.layerName="SolidPolygonLayer",Tg.defaultProps=Eg;const Cg=[0,0,0,255],Pg={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:Cg},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Mg extends RA{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&Ds.removed("getLineDashArray","PathStyleExtension")()}updateState({oldProps:e,props:t,changeFlags:n}){const i=n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon);if(i&&Array.isArray(n.dataChanged)){const e=this.state.paths.slice(),t=n.dataChanged.map((t=>kg({data:e,getIndex:e=>e.__source.index,dataRange:t,replace:this._getPaths(t)})));this.setState({paths:e,pathsDiff:t})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:n,positionFormat:i,_normalize:r}=this.props,o=[],s="XY"===i?2:3,{startRow:a,endRow:l}=e,{iterable:c,objectInfo:u}=_p(t,a,l);for(const e of c){u.index++;let t=n(e,u);r&&(t=yg(t,s));const{holeIndices:i}=t,a=t.positions||t;if(i)for(let t=0;t<=i.length;t++){const n=a.slice(i[t-1]||0,i[t]||a.length);o.push(this.getSubLayerRow({path:n},e,u.index))}else o.push(this.getSubLayerRow({path:a},e,u.index))}return o}renderLayers(){const{data:e,_dataDiff:t,stroked:n,filled:i,extruded:r,wireframe:o,_normalize:s,_windingOrder:a,elevationScale:l,transitions:c,positionFormat:u}=this.props,{lineWidthUnits:h,lineWidthScale:d,lineWidthMinPixels:f,lineWidthMaxPixels:p,lineJointRounded:A,lineMiterLimit:m,lineDashJustified:g}=this.props,{getFillColor:y,getLineColor:_,getLineWidth:v,getLineDashArray:b,getElevation:x,getPolygon:w,updateTriggers:E,material:S}=this.props,{paths:T,pathsDiff:k}=this.state,C=this.getSubLayerClass("fill",Tg),P=this.getSubLayerClass("stroke",Fm),M=this.shouldRenderSubLayer("fill",T)&&new C({_dataDiff:t,extruded:r,elevationScale:l,filled:i,wireframe:o,_normalize:s,_windingOrder:a,getElevation:x,getFillColor:y,getLineColor:r&&o?_:Cg,material:S,transitions:c},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:E.getPolygon,getElevation:E.getElevation,getFillColor:E.getFillColor,lineColors:r&&o,getLineColor:E.getLineColor}}),{data:e,positionFormat:u,getPolygon:w});return[!r&&M,!r&&n&&this.shouldRenderSubLayer("stroke",T)&&new P({_dataDiff:k&&(()=>k),widthUnits:h,widthScale:d,widthMinPixels:f,widthMaxPixels:p,jointRounded:A,miterLimit:m,dashJustified:g,_pathType:"loop",transitions:c&&{getWidth:c.getLineWidth,getColor:c.getLineColor,getPath:c.getPolygon},getColor:this.getSubLayerAccessor(_),getWidth:this.getSubLayerAccessor(v),getDashArray:this.getSubLayerAccessor(b)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:E.getLineWidth,getColor:E.getLineColor,getDashArray:E.getLineDashArray}}),{data:T,positionFormat:u,getPath:e=>e.path}),r&&M]}}Mg.layerName="PolygonLayer",Mg.defaultProps=Pg;const Ig=[];class Lg extends sm{getShaders(){return{...super.getShaders(),fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float buffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"}}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(e,{index:t,target:n})=>this.encodePickingColor(t,n)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map((e=>e/255)),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&Ds.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:r}=this.state;e.uniforms={...e.uniforms,buffer:.75,outlineBuffer:i?Math.max(n,.75*(1-i)):-1,gamma:n,sdf:Boolean(t),outlineColor:r},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).map((e=>super.getInstanceOffset(e))):Ig}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).map((e=>super.getInstanceIconFrame(e))):Ig}}Lg.layerName="MultiIconLayer",Lg.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};var Rg={exports:{}};Rg.exports=Dg,Rg.exports.default=Dg;var zg=1e20;function Dg(e,t,n,i,r,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var s=this.size=this.fontSize+2*this.buffer,a=s+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=s,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(s/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Og(e,t,n,i,r,o){for(var s=0;s<t;s++)Bg(e,s,t,n,i,r,o);for(var a=0;a<n;a++)Bg(e,a*t,1,t,i,r,o)}function Bg(e,t,n,i,r,o,s){var a,l,c,u;for(o[0]=0,s[0]=-zg,s[1]=zg,a=0;a<i;a++)r[a]=e[t+a*n];for(a=1,l=0,c=0;a<i;a++){do{u=o[l],c=(r[a]-r[u]+a*a-u*u)/(a-u)/2}while(c<=s[l]&&--l>-1);o[++l]=a,s[l]=c,s[l+1]=zg}for(a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;u=o[l],e[t+a*n]=r[u]+(a-u)*(a-u)}}Dg.prototype._draw=function(e,t){var n,i,r,o,s,a,l,c,u,h=this.ctx.measureText(e),d=h.width,f=2*this.buffer;t&&this.useMetrics?(s=Math.floor(h.actualBoundingBoxAscent),c=this.buffer+Math.ceil(h.actualBoundingBoxAscent),a=this.buffer,l=this.buffer,n=(i=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+f,r=(o=Math.min(this.size-a,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+f,this.ctx.textBaseline="alphabetic"):(n=i=this.size,r=o=this.size,s=19*this.fontSize/24,a=l=0,c=this.middle,this.ctx.textBaseline="middle"),i&&o&&(this.ctx.clearRect(l,a,i,o),this.ctx.fillText(e,this.buffer,c),u=this.ctx.getImageData(l,a,i,o));var p=new Uint8ClampedArray(n*r);return function(e,t,n,i,r,o,s){o.fill(zg,0,t*n),s.fill(0,0,t*n);for(var a=(t-i)/2,l=0;l<r;l++)for(var c=0;c<i;c++){var u=(l+a)*t+c+a,h=e.data[4*(l*i+c)+3]/255;if(1===h)o[u]=0,s[u]=zg;else if(0===h)o[u]=zg,s[u]=0;else{var d=Math.max(0,.5-h),f=Math.max(0,h-.5);o[u]=d*d,s[u]=f*f}}}(u,n,r,i,o,this.gridOuter,this.gridInner),Og(this.gridOuter,n,r,this.f,this.v,this.z),Og(this.gridInner,n,r,this.f,this.v,this.z),function(e,t,n,i,r,o,s){for(var a=0;a<t*n;a++){var l=Math.sqrt(i[a])-Math.sqrt(r[a]);e[a]=Math.round(255-255*(l/o+s))}}(p,n,r,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:p,metrics:{width:i,height:o,sdfWidth:n,sdfHeight:r,top:s,left:0,advance:d}}},Dg.prototype.draw=function(e){return this._draw(e,!1).data},Dg.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};var Fg=Rg.exports;const Ng=[];function Ug(e,t,n,i){let r=0;for(let o=t;o<n;o++){const t=e[o];let n=null;const s=i&&i[t];s&&(n=s.width),r+=n}return r}function jg(e,t,n,i,r,o){let s=t,a=0;for(let l=t;l<n;l++){const t=Ug(e,l,l+1,r);a+t>i&&(s<l&&o.push(l),s=l,a=0),a+=t}return a}function Vg(e,t,n,i,r=0,o){void 0===o&&(o=e.length);const s=[];return"break-all"===t?jg(e,r,o,n,i,s):function(e,t,n,i,r,o){let s=t,a=t,l=t,c=0;for(let u=t;u<n;u++)if(" "===e[u]?l=u+1:" "!==e[u+1]&&u+1!==n||(l=u+1),l>a){let t=Ug(e,a,l,r);c+t>i&&(s<a&&(o.push(a),s=a,c=0),t>i&&(t=jg(e,a,l,i,r,o),s=o[o.length-1])),a=l,c+=t}}(e,r,o,n,i,s),s}function Gg(e,t,n,i,r,o){let s=0,a=0;for(let o=t;o<n;o++){const t=e[o],n=i[t];n?(a||(a=n.height),r[o]=s+n.width/2,s+=n.width):(Ds.warn("Missing character: ".concat(t," (").concat(t.codePointAt(0),")"))(),r[o]=s,s+=32)}o[0]=s,o[1]=a}function Wg(e,t,n,i,r){const o=(e=Array.from(e)).length,s=new Array(o),a=new Array(o),l=new Array(o),c=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,u=[0,0],h=[];let d=0,f=0,p=0;for(let A=0;A<=o;A++){const m=e[A];if("\n"!==m&&A!==o||(p=A),p>f){const o=c?Vg(e,n,i,r,f,p):Ng;for(let n=0;n<=o.length;n++){const i=0===n?f:o[n-1],c=n<o.length?o[n]:p;Gg(e,i,c,r,s,h);for(let e=i;e<c;e++)a[e]=d+h[1]/2,l[e]=h[0];d+=h[1]*t,u[0]=Math.max(u[0],h[0])}f=p}"\n"===m&&(s[f]=0,a[f]=0,l[f]=0,f++)}return u[1]=d,{x:s,y:a,rowWidth:l,size:u}}const $g=function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),qg="Monaco, monospace",Zg="normal",Hg=new class{constructor(e=5){this.limit=e,this.clear()}clear(){this._cache={},this._order=[]}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}_deleteCache(e){delete this._cache[e]}_deleteOrder(e){const t=this._order.findIndex((t=>t===e));t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}(3),Qg=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function Xg(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function Yg(e,t,n,i){e.font="".concat(i," ").concat(n,"px ").concat(t),e.fillStyle="#000",e.textBaseline="baseline",e.textAlign="left"}class Kg{constructor(){this.props={fontFamily:qg,fontWeight:Zg,characterSet:$g,fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12},this._key=null,this._atlas=null}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return 1.2}setProps(e={}){Qg.forEach((t=>{t in e&&(this.props[t]=e[t])}));const t=this._key;this._key=this._getKey();const n=function(e,t){const n=Hg.get(e);if(!n)return t;const i=[],r=n.mapping;let o=Object.keys(r);o=new Set(o);let s=t;return s instanceof Array&&(s=new Set(s)),s.forEach((e=>{o.has(e)||i.push(e)})),i}(this._key,this.props.characterSet),i=Hg.get(this._key);if(i&&0===n.length)return void(this._key!==t&&(this._atlas=i));const r=this._generateFontAtlas(this._key,n,i);this._atlas=r,Hg.set(this._key,r)}_generateFontAtlas(e,t,n){const{fontFamily:i,fontWeight:r,fontSize:o,buffer:s,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=1024);const h=u.getContext("2d");Yg(h,i,o,r);const{mapping:d,canvasHeight:f,xOffset:p,yOffset:A}=function({characterSet:e,getFontWidth:t,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:o={},xOffset:s=0,yOffset:a=0}){let l=0,c=s,u=0;for(const s of e)if(!o[s]){const e=t(s,u++);c+e+2*i>r&&(c=0,l++),o[s]={x:c+i,y:a+l*(n+2*i)+i,width:e,height:n},c+=e+2*i}const h=n+2*i;return{mapping:o,xOffset:c,yOffset:a+l*h,canvasHeight:(d=a+(l+1)*h,Math.pow(2,Math.ceil(Math.log2(d))))};var d}({getFontWidth:e=>h.measureText(e).width,fontHeight:1.2*o,buffer:s,characterSet:t,maxCanvasWidth:1024,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==f){const e=h.getImageData(0,0,u.width,u.height);u.height=f,h.putImageData(e,0,0)}if(Yg(h,i,o,r),a){const e=new Fg(o,s,l,c,i,r),n=h.getImageData(0,0,e.size,e.size);for(const i of t)Xg(e.draw(i),n),h.putImageData(n,d[i].x-s,d[i].y+s)}else for(const e of t)h.fillText(e,d[e].x,d[e].y+.9*o);return{xOffset:p,yOffset:A,mapping:d,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:r,radius:o,cutoff:s}=this.props;return r?"".concat(e," ").concat(t," ").concat(n," ").concat(i," ").concat(o," ").concat(s):"".concat(e," ").concat(t," ").concat(n," ").concat(i)}}const Jg={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class ey extends LA{getShaders(){return super.getShaders({vs:"#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[ud,md]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:n}){if(super.updateState({props:e,oldProps:t,changeFlags:n}),n.extensionsChanged){var i;const{gl:e}=this.context;null===(i=this.state.model)||void 0===i||i.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{viewport:t}=this.context,{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:o,sizeMaxPixels:s,getLineWidth:a}=this.props;let{padding:l}=this.props;const c="pixels"===r?t.metersPerPixel:1;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:Boolean(a),padding:l,sizeScale:i*c,sizeMinPixels:o,sizeMaxPixels:s}).draw()}_getModel(e){return new Dh(e,{...this.getShaders(),id:this.props.id,geometry:new Vh({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}ey.layerName="TextBackgroundLayer",ey.defaultProps=Jg;const ty={fontSize:64,buffer:4,sdf:!1,radius:12,cutoff:.25,smoothing:.1},ny={start:1,middle:0,end:-1},iy={top:1,center:0,bottom:-1},ry=[0,0,0,255],oy=["fontSize","buffer","sdf","radius","cutoff"],sy={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ry},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:$g},fontFamily:qg,fontWeight:Zg,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ry},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:ry},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class ay extends RA{initializeState(){this.state={styleVersion:0,fontAtlasManager:new Kg}}updateState({props:e,oldProps:t,changeFlags:n}){const i=n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText),r=this.state.characterSet;i&&this._updateText();const o=r!==this.state.characterSet||this._fontChanged(t,e);o&&this._updateFontAtlas(t,e);(o||e.lineHeight!==t.lineHeight||e.wordBreak!==t.wordBreak||e.maxWidth!==t.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(e,t){const{fontSettings:n,fontFamily:i,fontWeight:r}=t,{fontAtlasManager:o,characterSet:s}=this.state;o.setProps({...ty,...n,characterSet:s,fontFamily:i,fontWeight:r})}_fontChanged(e,t){if(e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight)return!0;if(e.fontSettings===t.fontSettings)return!1;const n=e.fontSettings||{},i=t.fontSettings||{};return oy.some((e=>n[e]!==i[e]))}_updateText(){const{data:e,characterSet:t}=this.props,n=e.attributes&&e.attributes.getText;let i,{getText:r}=this.props,{startIndices:o}=e;const s="auto"===t&&new Set;if(n&&o){const{texts:t,characterCount:a}=function({value:e,length:t,stride:n,offset:i,startIndices:r,characterSet:o}){const s=e.BYTES_PER_ELEMENT,a=n?n/s:1,l=i?i/s:0,c=r[t]||Math.ceil((e.length-l)/a),u=o&&new Set,h=new Array(t);let d=e;if(a>1||l>0){d=new e.constructor(c);for(let t=0;t<c;t++)d[t]=e[t*a+l]}for(let e=0;e<t;e++){const t=r[e],n=r[e+1]||c,i=d.subarray(t,n);h[e]=String.fromCodePoint.apply(null,i),u&&i.forEach(u.add,u)}if(u)for(const e of u)o.add(String.fromCodePoint(e));return{texts:h,characterCount:c}}({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:s});i=a,r=(e,{index:n})=>t[n]}else{const{iterable:t,objectInfo:n}=_p(e);o=[0],i=0;for(const e of t){n.index++;const t=Array.from(r(e,n)||"");s&&t.forEach(s.add,s),i+=t.length,o.push(i)}}this.setState({getText:r,startIndices:o,numInstances:i,characterSet:s||t})}getBoundingRect(e,t){const n=this.state.fontAtlasManager.mapping,{getText:i}=this.state,{wordBreak:r,maxWidth:o,lineHeight:s,getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=i(e,t)||"",{size:[u,h]}=Wg(c,s,r,o,n);return[(ny["function"==typeof a?a(e,t):a]-1)*u/2,(iy["function"==typeof l?l(e,t):l]-1)*h/2,u,h]}getIconOffsets(e,t){const n=this.state.fontAtlasManager.mapping,{getText:i}=this.state,{wordBreak:r,maxWidth:o,lineHeight:s,getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=i(e,t)||"",{x:u,y:h,rowWidth:d,size:[f,p]}=Wg(c,s,r,o,n),A=ny["function"==typeof a?a(e,t):a],m=iy["function"==typeof l?l(e,t):l],g=u.length,y=new Array(2*g);let _=0;for(let e=0;e<g;e++){const t=(1-A)*(f-d[e])/2;y[_++]=(A-1)*f/2+t+u[e],y[_++]=(m-1)*p/2+h[e]}return y}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,texture:r,mapping:o},styleVersion:s}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,getBackgroundColor:p,getBorderColor:A,getBorderWidth:m,backgroundPadding:g,background:y,billboard:_,fontSettings:v,outlineWidth:b,outlineColor:x,sizeScale:w,sizeUnits:E,sizeMinPixels:S,sizeMaxPixels:T,transitions:k,updateTriggers:C}=this.props,P=this.getSubLayerClass("characters",Lg),M=this.getSubLayerClass("background",ey);return[y&&new M({getFillColor:p,getLineColor:A,getLineWidth:m,padding:g,getPosition:c,getSize:h,getAngle:d,getPixelOffset:f,billboard:_,sizeScale:w/this.state.fontAtlasManager.props.fontSize,sizeUnits:E,sizeMinPixels:S,sizeMaxPixels:T,transitions:k&&{getPosition:k.getPosition,getAngle:k.getAngle,getSize:k.getSize,getFillColor:k.getBackgroundColor,getLineColor:k.getBorderColor,getLineWidth:k.getBorderWidth,getPixelOffset:k.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:C.getPosition,getAngle:C.getAngle,getSize:C.getSize,getFillColor:C.getBackgroundColor,getLineColor:C.getBorderColor,getLineWidth:C.getBorderWidth,getPixelOffset:C.getPixelOffset,getBoundingRect:{getText:C.getText,getTextAnchor:C.getTextAnchor,getAlignmentBaseline:C.getAlignmentBaseline,styleVersion:s}}}),{data:a.attributes?{length:a.length,attributes:a.attributes.background||{}}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect.bind(this)}),new P({sdf:v.sdf,smoothing:Number.isFinite(v.smoothing)?v.smoothing:ty.smoothing,outlineWidth:b,outlineColor:x,iconAtlas:r,iconMapping:o,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:f,billboard:_,sizeScale:w*i,sizeUnits:E,sizeMinPixels:S*i,sizeMaxPixels:T*i,transitions:k&&{getPosition:k.getPosition,getAngle:k.getAngle,getColor:k.getColor,getSize:k.getSize,getPixelOffset:k.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:C.getText,getPosition:C.getPosition,getAngle:C.getAngle,getColor:C.getColor,getSize:C.getSize,getPixelOffset:C.getPixelOffset,getIconOffsets:{getText:C.getText,getTextAnchor:C.getTextAnchor,getAlignmentBaseline:C.getAlignmentBaseline,styleVersion:s}}}),{data:a,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets.bind(this),getIcon:n})]}}ay.layerName="TextLayer",ay.defaultProps=sy;const ly={circle:{type:cm,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:sm,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:ay,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},cy={type:Fm,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",getLineColor:"getColor",getLineWidth:"getWidth"}},uy={type:Tg,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function hy({type:e,props:t}){const n={};for(const i in t)n[i]=e.defaultProps[t[i]];return n}function dy(e,t){const{transitions:n,updateTriggers:i}=e.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const o in t){const s=t[o];let a=e.props[o];o.startsWith("get")&&(a=e.getSubLayerAccessor(a),r.updateTriggers[s]=i[o],n&&(r.transitions[s]=n[o])),r[s]=a}return r}function fy(e,t,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:o=e.length}=n;for(let n=r;n<o;n++){const r=e[n];Ds.assert(r&&r.geometry,"GeoJSON does not have geometry");const{geometry:o}=r;if("GeometryCollection"===o.type){Ds.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");const{geometries:e}=o;for(let o=0;o<e.length;o++){py(e[o],i,t,r,n)}}else py(o,i,t,r,n)}return i}function py(e,t,n,i,r){const{type:o,coordinates:s}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=t;if(function(e,t){let n=Ay[e];Ds.assert(n,"Unknown GeoJSON type ".concat(e));for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(o,s))switch(o){case"Point":a.push(n({geometry:e},i,r));break;case"MultiPoint":s.forEach((e=>{a.push(n({geometry:{type:"Point",coordinates:e}},i,r))}));break;case"LineString":l.push(n({geometry:e},i,r));break;case"MultiLineString":s.forEach((e=>{l.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"Polygon":c.push(n({geometry:e},i,r)),s.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"MultiPolygon":s.forEach((e=>{c.push(n({geometry:{type:"Polygon",coordinates:e}},i,r)),e.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}))}))}else Ds.warn("".concat(o," coordinates are malformed"))()}const Ay={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function my(e){return e.geometry.coordinates}function gy(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:i,lines:r,polygons:o}=e,s=function(e,t){const n={points:null,lines:null,polygons:null};for(const i in n){const r=e[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(3*r.length);const o=[];for(let e=0;e<r.length;e++)t(r[e],o),n[i][3*e+0]=o[0],n[i][3*e+1]=o[1],n[i][3*e+2]=o[2]}return n}(e,t);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{getPosition:i.positions,instancePickingColors:{size:3,value:s.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{getPath:r.positions,instancePickingColors:{size:3,value:s.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{getPolygon:o.positions,pickingColors:{size:3,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygons._normalize=!1,o.triangles&&(n.polygons.data.attributes.indices=o.triangles.value),n.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{getPath:o.positions,instancePickingColors:{size:3,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygonsOutline._pathType="open",n}const yy={...hy(ly.circle),...hy(ly.icon),...hy(ly.text),...hy(cy),...hy(uy),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class _y extends RA{initializeState(){this.state={layerProps:{},features:{}},this.props.getLineDashArray&&Ds.removed("getLineDashArray","PathStyleExtension")()}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=gy(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=function(e){if(Array.isArray(e))return e;switch(Ds.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return Ds.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),i=this.getSubLayerRow.bind(this);let r={};const o={};if(Array.isArray(t.dataChanged)){const e=this.state.features;for(const t in e)r[t]=e[t].slice(),o[t]=[];for(const s of t.dataChanged){const t=fy(n,i,s);for(const n in e)o[n].push(kg({data:r[n],getIndex:e=>e.__source.index,dataRange:s,replace:t[n]}))}}else r=fy(n,i);const s=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:r,polygonFeatures:o,polygonOutlineFeatures:s}=e;return n.points.data=i,n.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),n.points.getPosition=my,n.lines.data=r,n.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),n.lines.getPath=my,n.polygons.data=o,n.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),n.polygons.getPolygon=my,n.polygonsOutline.data=s,n.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),n.polygonsOutline.getPath=my,n}(r,o);this.setState({features:r,featuresDiff:o,layerProps:s})}_updateAutoHighlight(e){const t="".concat(this.id,"-points-"),n=e.sourceLayer.id.startsWith(t);for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,i="polygons-fill",r=this.shouldRenderSubLayer(i,n.polygons.data)&&this.getSubLayerClass(i,uy.type);if(r){const o=dy(this,uy.props),s=e&&t;return s||delete o.getLineColor,o.updateTriggers.lineColors=s,new r(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,i="polygons-stroke",r="linestrings",o=!e&&t&&this.shouldRenderSubLayer(i,n.polygonsOutline.data)&&this.getSubLayerClass(i,cy.type),s=this.shouldRenderSubLayer(r,n.lines.data)&&this.getSubLayerClass(r,cy.type);if(o||s){const e=dy(this,cy.props);return[o&&new o(e,this.getSubLayerProps({id:i,updateTriggers:e.updateTriggers}),n.polygonsOutline),s&&new s(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=t.points.data.findIndex((e=>e.__source.index===i)));const r=new Set(e.split("+")),o=[];for(const e of r){const n="points-".concat(e),r=ly[e],s=r&&this.shouldRenderSubLayer(n,t.points.data)&&this.getSubLayerClass(n,r.type);if(s){const e=dy(this,r.props);o.push(new s(e,this.getSubLayerProps({id:n,updateTriggers:e.updateTriggers,highlightedObjectIndex:i}),t.points))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return t&&"function"==typeof e?(t,n)=>{const{data:i,index:r}=n,o=function(e,t){if(!e)return null;const n="startIndices"in e?e.startIndices[t]:t,i=e.featureIds.value[n];return-1!==n?function(e,t,n){const i={properties:{...e.properties[t]}};for(const t in e.numericProps)i.properties[t]=e.numericProps[t].value[n];return i}(e,i,n):null}(i,r);return e(o,n)}:super.getSubLayerAccessor(e)}}_y.layerName="GeoJsonLayer",_y.defaultProps=yy;var vy="undefined"!=typeof window?t.exports.useLayoutEffect:t.exports.useEffect;function by(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}function xy(e){return e?"function"==typeof e?t.exports.createElement(yf,{},e):Array.isArray(e)?e.map(xy):e.type===l.Fragment?xy(e.props.children):(by(e.type,yf),e):e}const wy={position:"absolute",zIndex:-1};function Ey(e,n){return e?"function"==typeof e?e(n):Array.isArray(e)?e.map((e=>Ey(e,n))):function(e){const t=e&&e.type,n=t&&t.defaultProps;return n&&n.mapStyle}(e)?(n.style=wy,t.exports.cloneElement(e,n)):function(e){const t=e&&e.type;return t&&t.deckGLViewProps}(e)?t.exports.cloneElement(e,n):e:e}const Sy={mixBlendMode:null};function Ty(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const ky=t.exports.forwardRef(((e,n)=>{const i=t.exports.useRef({}).current,[r,o]=t.exports.useState(0);i.forceUpdate=o;const s=t.exports.useRef(null),a=t.exports.useRef(null),c=t.exports.useMemo((()=>function({children:e,layers:t,views:n}){const i=[],r=[],o={};return l.Children.forEach(xy(e),(e=>{if(e){const t=e.type;if(by(t,LA)){const n=function(e,t){const n={},i=e.defaultProps||{};for(const e in t)i[e]!==t[e]&&(n[e]=t[e]);return new e(n)}(t,e.props);r.push(n)}else i.push(e);if(t!==yf&&by(t,yf)&&e.props.id){const n=new t(e.props);o[n.id]=n}}})),Object.keys(o).length>0&&(Array.isArray(n)?n.forEach((e=>{o[e.id]=e})):n&&(o[n.id]=n),n=Object.values(o)),{layers:t=r.length>0?[...r,...t]:t,children:i,views:n}}(e)),[e.layers,e.views,e.children]);let u=!0;const h=t=>u&&e.viewState?(i.viewStateUpdateRequested=t,null):(i.viewStateUpdateRequested=null,e.onViewStateChange(t)),d=t=>{u?i.interactionStateUpdateRequested=t:(i.interactionStateUpdateRequested=null,e.onInteractionStateChange(t))},f=t.exports.useMemo((()=>{const t={...e,style:null,width:"100%",height:"100%",layers:c.layers,views:c.views,onViewStateChange:h,onInteractionStateChange:d};return i.deck&&i.deck.setProps(t),t}),[e]);t.exports.useEffect((()=>(i.deck=function(e,t){const n=new(t.Deck||fp)({...t,style:null,width:"100%",height:"100%",_customRender:t=>{e.redrawReason=t;const i=n.viewManager.getViewports();e.lastRenderedViewports!==i?e.forceUpdate((e=>e+1)):Ty(e)}});return n}(i,{...f,parent:s.current,canvas:a.current}),()=>i.deck.finalize())),[]),vy((()=>{Ty(i);const{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=i;e&&h(e),t&&d(t)})),t.exports.useImperativeHandle(n,(()=>function(e){const t={pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)};return Object.defineProperty(t,"deck",{get:()=>e.deck}),t}(i)),[]);const{viewManager:p}=i.deck||{},A=p&&p.getViewports(),{ContextProvider:m,width:g,height:y,id:_,style:v}=e,{containerStyle:b,canvasStyle:x}=t.exports.useMemo((()=>function({width:e,height:t,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(n)for(const e in n)e in Sy?r[e]=n[e]:i[e]=n[e];return{containerStyle:i,canvasStyle:r}}({width:g,height:y,style:v})),[g,y,v]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===A||i.version!==r){i.lastRenderedViewports=A,i.version=r;const e=function({children:e,deck:n,ContextProvider:i}){const{viewManager:r}=n||{};if(!r||!r.views.length)return[];const o={},s=r.views[0].id;for(const t of e){let e=s,n=t;by(t.type,yf)&&(e=t.props.id||s,n=t.props.children);const i=r.getViewport(e),a=r.getViewState(e);if(i){const{x:t,y:r,width:s,height:l}=i;n=Ey(n,{x:t,y:r,width:s,height:l,viewport:i,viewState:a}),o[e]||(o[e]={viewport:i,children:[]}),o[e].children.push(n)}}return Object.keys(o).map((e=>{const{viewport:r,children:s}=o[e],{x:a,y:l,width:c,height:u}=r,h={position:"absolute",left:a,top:l,width:c,height:u},d="view-".concat(e),f=t.exports.createElement("div",{key:d,id:d,style:h},...s);if(i){const o={viewport:r,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:t=>{t.viewId=e,n._onViewStateChange(t)}};return t.exports.createElement(i,{key:d,value:o},f)}return f}))}({children:c.children,deck:i.deck,ContextProvider:m}),n=t.exports.createElement("canvas",{key:"canvas",id:_||"deckgl-overlay",ref:a,style:x});i.control=t.exports.createElement("div",{id:"".concat(_||"deckgl","-wrapper"),ref:s,style:b},[n,e])}return u=!1,i.control}));ky.propTypes=fp.getPropTypes(F),ky.defaultProps=fp.defaultProps;var Cy=ky;class Py{constructor({x:e,y:t,z:n,onTileLoad:i,onTileError:r}){this.x=e,this.y=t,this.z=n,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._isLoaded=!1,this._isCancelled=!1,this.onTileLoad=i,this.onTileError=r}get data(){return this._isLoaded?this.content:this._loader}get isLoaded(){return this._isLoaded}get isLoading(){return Boolean(this._loader)}get isCancelled(){return this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||Ds.error("byteLength not defined in tile data")(),e}async _loadData(e,t){const{x:n,y:i,z:r,bbox:o}=this;this._abortController=new AbortController;const{signal:s}=this._abortController,a=await t.scheduleRequest(this,(e=>e.isSelected?1:-1));if(!a)return void(this._isCancelled=!0);if(this._isCancelled)return void a.done();let l,c;try{l=await e({x:n,y:i,z:r,bbox:o,signal:s})}catch(e){c=e||!0}finally{a.done(),this._isCancelled&&!l?this._isLoaded=!1:(this._isLoaded=!0,this._isCancelled=!1)}this._isLoaded&&(c?this.onTileError(c,this):(this.content=l,this.onTileLoad(this)))}loadData(e,t){e&&(this._isCancelled=!1,this._loader=this._loadData(e,t),this._loader.finally((()=>{this._loader=void 0})))}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController.abort())}}const My=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),Iy=new Fu,Ly=new Fu;class Ry{constructor(e=[0,0,0],t=[0,0,0],n=null){n=n||Iy.copy(e).add(t).scale(.5),this.center=new Fu(n),this.halfDiagonal=new Fu(t).subtract(this.center),this.minimum=new Fu(e),this.maximum=new Fu(t)}clone(){return new Ry(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,n=Ly.from(e.normal),i=t.x*Math.abs(n.x)+t.y*Math.abs(n.y)+t.z*Math.abs(n.z),r=this.center.dot(n)+e.distance;return r-i>0?My.INSIDE:r+i<0?My.OUTSIDE:My.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Iy.from(e).subtract(this.center),{halfDiagonal:n}=this;let i,r=0;return i=Math.abs(t.x)-n.x,i>0&&(r+=i*i),i=Math.abs(t.y)-n.y,i>0&&(r+=i*i),i=Math.abs(t.z)-n.z,i>0&&(r+=i*i),r}}const zy=new Fu,Dy=new Fu;class Oy{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new Fu,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=zy.from(t),this.center=(new Fu).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Oy(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,r=e.radius,o=zy.copy(i).subtract(t),s=o.magnitude();if(n>=s+r)return this.clone();if(r>=s+n)return e.clone();const a=.5*(n+s+r);return Dy.copy(o).scale((-n+a)/s).add(t),this.center.copy(Dy),this.radius=a,this}expand(e){const t=(e=zy.from(e)).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);const t=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[4],s=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.hypot(n,i,r),e[1]=Math.hypot(o,s,a),e[2]=Math.hypot(l,c,u),e}(zy,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const t=(e=zy.from(e)).subtract(this.center);return Math.max(0,t.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,i=e.normal.dot(t)+e.distance;return i<-n?My.OUTSIDE:i<n?My.INTERSECTING:My.INSIDE}}const By=new Fu,Fy=new Fu,Ny=new Fu,Uy=new Fu,jy=new Fu,Vy=new Fu,Gy=new Fu,Wy=0,$y=1,qy=2,Zy=3,Hy=4,Qy=5,Xy=6,Yy=7,Ky=8;class Jy{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=(new Fu).from(e),this.halfAxes=new qu(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new Fu(e).len(),new Fu(t).len(),new Fu(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new Fu(e).normalize(),r=new Fu(t).normalize(),o=new Fu(n).normalize();return(new Ah).fromMatrix3(new qu([...i,...r,...o]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new Ah(n),r=(new qu).fromQuaternion(i);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=(new Fu).from(e),this.halfAxes=r,this}clone(){return new Jy(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Oy){const t=this.halfAxes,n=t.getColumn(0,Ny),i=t.getColumn(1,Uy),r=t.getColumn(2,jy),o=By.copy(n).add(i).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,r=n.x,o=n.y,s=n.z,a=Math.abs(r*i[Wy]+o*i[$y]+s*i[qy])+Math.abs(r*i[Zy]+o*i[Hy]+s*i[Qy])+Math.abs(r*i[Xy]+o*i[Yy]+s*i[Ky]),l=n.dot(t)+e.distance;return l<=-a?My.OUTSIDE:l>=a?My.INSIDE:My.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Fy.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,Ny),r=n.getColumn(1,Uy),o=n.getColumn(2,jy),s=i.magnitude(),a=r.magnitude(),l=o.magnitude();i.normalize(),r.normalize(),o.normalize();let c,u=0;return c=Math.abs(t.dot(i))-s,c>0&&(u+=c*c),c=Math.abs(t.dot(r))-a,c>0&&(u+=c*c),c=Math.abs(t.dot(o))-l,c>0&&(u+=c*c),u}computePlaneDistances(e,t,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,s=this.halfAxes,a=s.getColumn(0,Ny),l=s.getColumn(1,Uy),c=s.getColumn(2,jy),u=Vy.copy(a).add(l).add(c).add(o),h=Gy.copy(u).subtract(e);let d=t.dot(h);return i=Math.min(d,i),r=Math.max(d,r),u.copy(o).add(a).add(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),u.copy(o).add(a).subtract(l).add(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),u.copy(o).add(a).subtract(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),o.copy(u).subtract(a).add(l).add(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),o.copy(u).subtract(a).add(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),o.copy(u).subtract(a).subtract(l).add(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),o.copy(u).subtract(a).subtract(l).subtract(c),h.copy(u).subtract(e),d=t.dot(h),i=Math.min(d,i),r=Math.max(d,r),n[0]=i,n[1]=r,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,Ny);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,Uy);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,jy);return i.transformAsPoint(e),this.halfAxes=new qu([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const e_=new Fu,t_=new Fu;class n_{constructor(e=[0,0,1],t=0){this.normal=new Fu,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return bu(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=e_.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),bu(Cu(this.normal.len(),1)),this.distance=i,this}clone(e){return new n_(this.normal,this.distance)}equals(e){return Cu(this.distance,e.distance)&&Cu(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=t_.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e,t=[0,0,0]){e=e_.from(e);const n=this.getPointDistance(e),i=t_.copy(this.normal).scale(n);return e.subtract(i).to(t)}}const i_=[new Fu([1,0,0]),new Fu([0,1,0]),new Fu([0,0,1])],r_=new Fu,o_=new Fu;new n_(new Fu(1,0,0),0);class s_{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(e=[]){this.planes=e,bu(this.planes.every((e=>e instanceof n_)))}fromBoundingSphere(e){this.planes.length=2*i_.length;const t=e.center,n=e.radius;let i=0;for(const e of i_){let r=this.planes[i],o=this.planes[i+1];r||(r=this.planes[i]=new n_),o||(o=this.planes[i+1]=new n_);const s=r_.copy(e).scale(-n).add(t);e.dot(s),r.fromPointNormal(s,e);const a=r_.copy(e).scale(n).add(t),l=o_.copy(e).negate();l.dot(a),o.fromPointNormal(a,l),i+=2}return this}computeVisibility(e){bu(e);let t=My.INSIDE;for(const n of this.planes){switch(e.intersectPlane(n)){case My.OUTSIDE:return My.OUTSIDE;case My.INTERSECTING:t=My.INTERSECTING}}return t}computeVisibilityWithPlaneMask(e,t){if(bu(e,"boundingVolume is required."),bu(Number.isFinite(t),"parentPlaneMask is required."),t===s_.MASK_OUTSIDE||t===s_.MASK_INSIDE)return t;let n=s_.MASK_INSIDE;const i=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&0==(t&o))continue;const s=i[r],a=e.intersectPlane(s);if(a===My.OUTSIDE)return s_.MASK_OUTSIDE;a===My.INTERSECTING&&(n|=o)}return n}}new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu,new Fu;const a_=new qu,l_=new qu,c_=new qu,u_=new qu,h_=new qu;function d_(e,t={}){const n=gh;let i=0,r=0;const o=l_,s=c_;o.identity(),s.copy(e);const a=n*function(e){let t=0;for(let n=0;n<9;++n){const i=e[n];t+=i*i}return Math.sqrt(t)}(s);for(;r<10&&A_(s)>a;)m_(s,u_),h_.copy(u_).transpose(),s.multiplyRight(u_),s.multiplyLeft(h_),o.multiplyRight(u_),++i>2&&(++r,i=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=s.toTarget(t.diagonal),t}const f_=[1,0,0],p_=[2,2,1];function A_(e){let t=0;for(let n=0;n<3;++n){const i=e[a_.getElementIndex(p_[n],f_[n])];t+=2*i*i}return Math.sqrt(t)}function m_(e,t){const n=mh;let i=0,r=1;for(let t=0;t<3;++t){const n=Math.abs(e[a_.getElementIndex(p_[t],f_[t])]);n>i&&(r=t,i=n)}const o=f_[r],s=p_[r];let a=1,l=0;if(Math.abs(e[a_.getElementIndex(s,o)])>n){const t=(e[a_.getElementIndex(s,s)]-e[a_.getElementIndex(o,o)])/2/e[a_.getElementIndex(s,o)];let n;n=t<0?-1/(-t+Math.sqrt(1+t*t)):1/(t+Math.sqrt(1+t*t)),a=1/Math.sqrt(1+n*n),l=n*a}return qu.IDENTITY.to(t),t[a_.getElementIndex(o,o)]=t[a_.getElementIndex(s,s)]=a,t[a_.getElementIndex(s,o)]=l,t[a_.getElementIndex(o,s)]=-l,t}const g_=new Fu,y_=new Fu,__=new Fu,v_=new Fu,b_=new Fu,x_=new qu,w_={diagonal:new qu,unitary:new qu};const E_=512,S_=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],T_=S_.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),k_=T_.concat([[.25,.5],[.75,.5]]);class C_{constructor(e,t,n){this.x=e,this.y=t,this.z=n}get children(){if(!this._children){const e=2*this.x,t=2*this.y,n=this.z+1;this._children=[new C_(e,t,n),new C_(e,t+1,n),new C_(e+1,t,n),new C_(e+1,t+1,n)]}return this._children}update(e){const{viewport:t,cullingVolume:n,elevationBounds:i,minZ:r,maxZ:o,bounds:s,offset:a,project:l}=e,c=this.getBoundingVolume(i,a,l);if(s&&!this.insideBounds(s))return!1;if(n.computeVisibility(c)<0)return!1;if(!this.childVisible){let{z:e}=this;if(e<o&&e>=r){const n=c.distanceTo(t.cameraPosition)*t.scale/t.height;e+=Math.floor(Math.log2(n))}if(e>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const t of this.children)t.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds([e,t,n,i]){const r=Math.pow(2,this.z),o=E_/r;return this.x*o<n&&this.y*o<i&&(this.x+1)*o>e&&(this.y+1)*o>t}getBoundingVolume(e,t,n){if(n){const t=this.z<1?k_:this.z<2?T_:S_,i=[];for(const r of t){const t=z_(this.x+r[0],this.y+r[1],this.z);t[2]=e[0],i.push(n(t)),e[0]!==e[1]&&(t[2]=e[1],i.push(n(t)))}return function(e,t=new Jy){if(!e||0===e.length)return t.halfAxes=new qu([0,0,0,0,0,0,0,0,0]),t.center=new Fu,t;const n=e.length,i=new Fu(0,0,0);for(const t of e)i.add(t);const r=1/n;i.multiplyByScalar(r);let o=0,s=0,a=0,l=0,c=0,u=0;for(const t of e){const e=g_.copy(t).subtract(i);o+=e.x*e.x,s+=e.x*e.y,a+=e.x*e.z,l+=e.y*e.y,c+=e.y*e.z,u+=e.z*e.z}o*=r,s*=r,a*=r,l*=r,c*=r,u*=r;const h=x_;h[0]=o,h[1]=s,h[2]=a,h[3]=s,h[4]=l,h[5]=c,h[6]=a,h[7]=c,h[8]=u;const{unitary:d}=d_(h,w_),f=t.halfAxes.copy(d);let p=f.getColumn(0,__),A=f.getColumn(1,v_),m=f.getColumn(2,b_),g=-Number.MAX_VALUE,y=-Number.MAX_VALUE,_=-Number.MAX_VALUE,v=Number.MAX_VALUE,b=Number.MAX_VALUE,x=Number.MAX_VALUE;for(const t of e)g_.copy(t),g=Math.max(g_.dot(p),g),y=Math.max(g_.dot(A),y),_=Math.max(g_.dot(m),_),v=Math.min(g_.dot(p),v),b=Math.min(g_.dot(A),b),x=Math.min(g_.dot(m),x);p=p.multiplyByScalar(.5*(v+g)),A=A.multiplyByScalar(.5*(b+y)),m=m.multiplyByScalar(.5*(x+_)),t.center.copy(p).add(A).add(m);const w=y_.set(g-v,y-b,_-x).multiplyByScalar(.5),E=new qu([w[0],0,0,0,w[1],0,0,0,w[2]]);return t.halfAxes.multiplyRight(E),t}(i)}const i=Math.pow(2,this.z),r=E_/i,o=this.x*r+t*E_,s=E_-(this.y+1)*r;return new Ry([o,s,e[0]],[o+r,s+r,e[1]])}}const P_=512,M_=[-1/0,-1/0,1/0,1/0],I_={type:"url",value:null,validate:(e,t)=>t.optional&&null===e||"string"==typeof e||Array.isArray(e)&&e.every((e=>"string"==typeof e)),equals:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}};function L_(e,t){const n=[t.transformPoint([e[0],e[1]]),t.transformPoint([e[2],e[1]]),t.transformPoint([e[0],e[3]]),t.transformPoint([e[2],e[3]])];return[Math.min(...n.map((e=>e[0]))),Math.min(...n.map((e=>e[1]))),Math.max(...n.map((e=>e[0]))),Math.max(...n.map((e=>e[1])))]}function R_(e,t){return Math.pow(2,e)*P_/t}function z_(e,t,n){const i=R_(n,P_),r=e/i*360-180,o=Math.PI-2*Math.PI*t/i;return[r,180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))]}function D_(e,t,n,i){const r=R_(n,i);return[e/r*P_,t/r*P_]}function O_(e,t,n,i,r=512){if(e.isGeospatial){const[e,r]=z_(t,n,i),[o,s]=z_(t+1,n+1,i);return{west:e,north:r,east:o,south:s}}const[o,s]=D_(t,n,i,r),[a,l]=D_(t+1,n+1,i,r);return{left:o,top:s,right:a,bottom:l}}function B_(e,t,n,i,r){const o=function(e,t,n){let i;if(t&&2===t.length){const[n,r]=t,o=e.getBounds({z:n}),s=e.getBounds({z:r});i=[Math.min(o[0],s[0]),Math.min(o[1],s[1]),Math.max(o[2],s[2]),Math.max(o[3],s[3])]}else i=e.getBounds();return e.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}(e,null,i),s=R_(t,n),[a,l,c,u]=function(e,t,n){if(n)return L_(e,n).map((e=>e*t/P_));return e.map((e=>e*t/P_))}(o,s,r),h=[];for(let e=Math.floor(a);e<c;e++)for(let n=Math.floor(l);n<u;n++)h.push({x:e,y:n,z:t});return h}function F_({viewport:e,maxZoom:t,minZoom:n,zRange:i,extent:r,tileSize:o=512,modelMatrix:s,modelMatrixInverse:a,zoomOffset:l=0}){let c=e.isGeospatial?Math.round(e.zoom+Math.log2(P_/o))+l:Math.ceil(e.zoom)+l;if(Number.isFinite(n)&&c<n){if(!r)return[];c=n}Number.isFinite(t)&&c>t&&(c=t);let u=r;return s&&a&&r&&!e.isGeospatial&&(u=L_(r,s)),e.isGeospatial?function(e,t,n,i){const r=e.resolution?e.projectPosition:null,o=Object.values(e.getFrustumPlanes()).map((({normal:e,distance:t})=>new n_(e.clone().negate(),t))),s=new s_(o),a=e.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,c=n&&n[1]*a||0,u=e.pitch<=60?t:0;if(i){const[e,t,n,r]=i,o=Ee([e,r]),s=Ee([n,t]);i=[o[0],E_-o[1],s[0],E_-s[1]]}const h=new C_(0,0,0),d={viewport:e,project:r,cullingVolume:s,elevationBounds:[l,c],minZ:u,maxZ:t,bounds:i,offset:0};if(h.update(d),e.subViewports&&e.subViewports.length>1){for(d.offset=-1;h.update(d)&&!(--d.offset<-3););for(d.offset=1;h.update(d)&&!(++d.offset>3););}return h.getSelected()}(e,c,i,r):B_(e,c,o,u||M_,a)}const N_="best-available";class U_{constructor(e){this.opts=e,this._getTileData=e.getTileData,this.onTileError=e.onTileError,this.onTileLoad=t=>{e.onTileLoad(t),this.opts.maxCacheByteSize&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this.onTileUnload=e.onTileUnload,this._requestScheduler=new wr({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles.every((e=>e.isLoaded))}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort()}update(e,{zRange:t,modelMatrix:n}={}){const i=new Yu(n),r=!i.equals(this._modelMatrix);if(!e.equals(this._viewport)||r){r&&(this._modelMatrixInverse=n&&i.clone().invert(),this._modelMatrix=n&&i),this._viewport=e;const o=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=o.map((e=>this._getTile(e,!0))),this._dirty&&this._rebuildTree()}const o=this.updateTileStates();return this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}getTileIndices({viewport:e,maxZoom:t,minZoom:n,zRange:i,modelMatrix:r,modelMatrixInverse:o}){const{tileSize:s,extent:a,zoomOffset:l}=this.opts;return F_({viewport:e,maxZoom:t,minZoom:n,zRange:i,tileSize:s,extent:a,modelMatrix:r,modelMatrixInverse:o,zoomOffset:l})}getTileMetadata({x:e,y:t,z:n}){const{tileSize:i}=this.opts;return{bbox:O_(this._viewport,e,t,n,i)}}getParentIndex(e){return e.x=Math.floor(e.x/2),e.y=Math.floor(e.y/2),e.z-=1,e}updateTileStates(){this._updateTileStates(this.selectedTiles);const{maxRequests:e}=this.opts,t=[];let n=0,i=!1;for(const e of this._cache.values()){const r=Boolean(1&e.state);e.isVisible!==r&&(i=!0,e.isVisible=r),e.isSelected=5===e.state,e.isLoading&&(n++,e.isSelected||t.push(e))}if(e>0)for(;n>e&&t.length>0;){t.shift().abort(),n--}return i}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children.length=0;for(const t of e.values()){const e=this._getNearestAncestor(t.x,t.y,t.z);t.parent=e,e&&e.children.push(t)}}_updateTileStates(e){const{_cache:t}=this,n=this.opts.refinementStrategy||N_;for(const e of t.values())e.state=0;for(const t of e)t.state=5;if("never"!==n){for(const t of e)V_(t,n);for(const t of e)j_(t)&&G_(t)}}_resizeCache(){const{_cache:e,opts:t}=this,n=t.maxCacheSize||(t.maxCacheByteSize?1/0:5*this.selectedTiles.length),i=t.maxCacheByteSize||1/0;if(e.size>n||this._cacheByteSize>i){for(const[r,o]of e)if(o.isVisible||(this._cacheByteSize-=t.maxCacheByteSize?o.byteLength:0,e.delete(r),this.onTileUnload(o)),e.size<=n&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(((e,t)=>e.z-t.z)),this._dirty=!1)}_getTile({x:e,y:t,z:n},i){const r="".concat(e,",").concat(t,",").concat(n);let o=this._cache.get(r);return!o&&i?(o=new Py({x:e,y:t,z:n,onTileLoad:this.onTileLoad,onTileError:this.onTileError}),Object.assign(o,this.getTileMetadata(o)),o.loadData(this._getTileData,this._requestScheduler),this._cache.set(r,o),this._dirty=!0):o&&o.isCancelled&&!o.isLoading&&o.loadData(this._getTileData,this._requestScheduler),o}_getNearestAncestor(e,t,n){const{_minZoom:i=0}=this;let r={x:e,y:t,z:n};for(;r.z>i;){r=this.getParentIndex(r);const e=this._getTile(r);if(e)return e}return null}}function j_(e){let t=e;for(;t;){if(!1&t.state)return!0;if(t.isLoaded)return!1;t=t.parent}return!0}function V_(e,t){let n,i=3;for(;n=e.parent;){if(e.isLoaded&&(i=4,t===N_))return;n.state=Math.max(n.state,i),e=n}}function G_(e){for(const t of e.children)t.state=Math.max(t.state,3),t.isLoaded||G_(t)}const W_={data:[],dataComparator:I_.equals,renderSubLayers:{type:"function",value:e=>new _y(e),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:e=>{},compare:!1},onTileUnload:{type:"function",value:e=>{},compare:!1},onTileError:{type:"function",value:e=>console.error(e),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:N_,zRange:null,maxRequests:6,zoomOffset:0};class $_ extends RA{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e;null===(e=this.state.tileset)||void 0===e||e.finalize()}get isLoaded(){const{tileset:e}=this.state;return e.selectedTiles.every((e=>e.layers&&e.layers.every((e=>e.isLoaded))))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,changeFlags:t}){let{tileset:n}=this.state;!n||t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData)?(n&&n.finalize(),n=new U_({...this._getTilesetOptions(e),getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}),this.setState({tileset:n})):(t.propsChanged||t.updateTriggersChanged)&&(n.setOptions(this._getTilesetOptions(e)),this.state.tileset.tiles.forEach((e=>{e.layers=null}))),this._updateTileset()}_getTilesetOptions(e){const{tileSize:t,maxCacheSize:n,maxCacheByteSize:i,refinementStrategy:r,extent:o,maxZoom:s,minZoom:a,maxRequests:l,zoomOffset:c}=e;return{maxCacheSize:n,maxCacheByteSize:i,maxZoom:s,minZoom:a,tileSize:t,refinementStrategy:r,extent:o,maxRequests:l,zoomOffset:c}}_updateTileset(){const{tileset:e}=this.state,{zRange:t,modelMatrix:n}=this.props,i=e.update(this.context.viewport,{zRange:t,modelMatrix:n}),{isLoaded:r}=e,o=this.state.isLoaded!==r,s=this.state.frameNumber!==i;r&&(o||s)&&this._onViewportLoad(),s&&this.setState({frameNumber:i}),this.state.isLoaded=r}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.getCurrentLayer().props.onTileLoad(e),e.isVisible&&this.setNeedsUpdate()}_onTileError(e,t){const n=this.getCurrentLayer();n.props.onTileError(e),n._updateTileset(),t.isVisible&&this.setNeedsUpdate()}_onTileUnload(e){this.getCurrentLayer().props.onTileUnload(e)}getTileData(e){const t=this.getCurrentLayer(),{data:n,getTileData:i,fetch:r}=t.props,{signal:o}=e;return e.url=function(e,t){if(!e||!e.length)return null;Array.isArray(e)&&(e=e[Math.abs(t.x+t.y)%e.length]);const{x:n,y:i,z:r}=t;return e.replace("{x}",n).replace("{y}",i).replace("{z}",r).replace("{-y}",Math.pow(2,r)-i-1)}(n,e),i?i(e):e.url?r(e.url,{propName:"data",layer:t,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getHighlightedObjectIndex(){return-1}getPickingInfo({info:e,sourceLayer:t}){return e.tile=t.props.tile,e}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map((e=>{const t=this.getHighlightedObjectIndex(e);if(e.isLoaded)if(e.layers)e.layers[0]&&e.layers[0].props.highlightedObjectIndex!==t&&(e.layers=e.layers.map((e=>e.clone({highlightedObjectIndex:t}))));else{const n=this.renderSubLayers({...this.props,id:"".concat(this.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.data,_offset:0,tile:e});e.layers=of(n,Boolean).map((n=>n.clone({tile:e,highlightedObjectIndex:t})))}else;return e.layers}))}filterSubLayer({layer:e}){return this.props.visible&&e.props.tile.isVisible}}$_.layerName="TileLayer",$_.defaultProps=W_;var q_=function(e){var t,n=void 0!==(e=e||{})?e:{},i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);var r,o="";document.currentScript&&(o=document.currentScript.src),o=0!==o.indexOf("blob:")?o.substr(0,o.lastIndexOf("/")+1):"",r=function(e,t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||0==i.status&&i.response)t(i.response);else{var r=Z(e);r?t(r.buffer):n()}},i.onerror=n,i.send(null)};var s=n.print||console.log.bind(console),a=n.printErr||console.warn.bind(console);for(t in i)i.hasOwnProperty(t)&&(n[t]=i[t]);i=null,n.arguments;var l=0,c=function(){return l};var u=!1;function h(e){var t,i=n["_"+e];return t="Cannot call unknown function "+e+", make sure it is exported",i||se("Assertion failed: "+t),i}function d(e,t,n,i,r){var o={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,i){if(!(i>0))return 0;for(var r=n,o=n+i-1,s=0;s<e.length;++s){var a=e.charCodeAt(s);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++s);if(a<=127){if(n>=o)break;t[n++]=a}else if(a<=2047){if(n+1>=o)break;t[n++]=192|a>>6,t[n++]=128|63&a}else if(a<=65535){if(n+2>=o)break;t[n++]=224|a>>12,t[n++]=128|a>>6&63,t[n++]=128|63&a}else{if(n+3>=o)break;t[n++]=240|a>>18,t[n++]=128|a>>12&63,t[n++]=128|a>>6&63,t[n++]=128|63&a}}t[n]=0})(e,A,t,n)})(e,t=K(n),n)}return t},array:function(e){var t=K(e.length);return function(e,t){p.set(e,t)}(e,t),t}};var s=h(e),a=[],l=0;if(i)for(var c=0;c<i.length;c++){var u=o[n[c]];u?(0===l&&(l=ee()),a[c]=u(i[c])):a[c]=i[c]}var d=s.apply(null,a);return d=function(e){return"string"===t?b(e):"boolean"===t?Boolean(e):e}(d),0!==l&&J(l),d}var f,p,A,m,g,y,_,v="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function b(e,t){return e?function(e,t,n){for(var i=t+n,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&v)return v.decode(e.subarray(t,r));for(var o="";t<r;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var l=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|l:(7&s)<<18|a<<12|l<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var c=s-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o}(A,e,t):""}function x(e,t){return e%t>0&&(e+=t-e%t),e}function w(e){f=e,n.HEAP8=p=new Int8Array(e),n.HEAP16=m=new Int16Array(e),n.HEAP32=g=new Int32Array(e),n.HEAPU8=A=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=y=new Float32Array(e),n.HEAPF64=_=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var E=n.TOTAL_MEMORY||33554432;function S(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?n.dynCall_v(i):n.dynCall_vi(i,t.arg):i(void 0===t.arg?null:t.arg)}else t()}}E=(f=n.buffer?n.buffer:new ArrayBuffer(E)).byteLength,w(f),g[6004]=5266928;var T=[],k=[],C=[],P=[];var M=Math.abs,I=Math.ceil,L=Math.floor,R=Math.min,z=0,D=null;n.preloadedImages={},n.preloadedAudios={};var O,B,F=null,N="data:application/octet-stream;base64,";function U(e){return String.prototype.startsWith?e.startsWith(N):0===e.indexOf(N)}F="data:application/octet-stream;base64,AAAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAABAAAAAMAAAAGAAAABQAAAAIAAAAAAAAAAgAAAAMAAAABAAAABAAAAAYAAAAAAAAABQAAAAMAAAAGAAAABAAAAAUAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAABAAAABQAAAAIAAAAAAAAAAQAAAAMAAAAGAAAABAAAAAYAAAAAAAAABQAAAAIAAAABAAAABAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAgAAAAMAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABgAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAEAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAACAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAwAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAQAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAFAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABgAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAAAAAAABgAAAAAAAAADAAAAAgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAUAAAAEAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAEAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAUAAAACAAAABAAAAAMAAAAIAAAAAQAAAAcAAAAGAAAACQAAAAAAAAADAAAAAgAAAAIAAAAGAAAACgAAAAsAAAAAAAAAAQAAAAUAAAADAAAADQAAAAEAAAAHAAAABAAAAAwAAAAAAAAABAAAAH8AAAAPAAAACAAAAAMAAAAAAAAADAAAAAUAAAACAAAAEgAAAAoAAAAIAAAAAAAAABAAAAAGAAAADgAAAAsAAAARAAAAAQAAAAkAAAACAAAABwAAABUAAAAJAAAAEwAAAAMAAAANAAAAAQAAAAgAAAAFAAAAFgAAABAAAAAEAAAAAAAAAA8AAAAJAAAAEwAAAA4AAAAUAAAAAQAAAAcAAAAGAAAACgAAAAsAAAAYAAAAFwAAAAUAAAACAAAAEgAAAAsAAAARAAAAFwAAABkAAAACAAAABgAAAAoAAAAMAAAAHAAAAA0AAAAaAAAABAAAAA8AAAADAAAADQAAABoAAAAVAAAAHQAAAAMAAAAMAAAABwAAAA4AAAB/AAAAEQAAABsAAAAJAAAAFAAAAAYAAAAPAAAAFgAAABwAAAAfAAAABAAAAAgAAAAMAAAAEAAAABIAAAAhAAAAHgAAAAgAAAAFAAAAFgAAABEAAAALAAAADgAAAAYAAAAjAAAAGQAAABsAAAASAAAAGAAAAB4AAAAgAAAABQAAAAoAAAAQAAAAEwAAACIAAAAUAAAAJAAAAAcAAAAVAAAACQAAABQAAAAOAAAAEwAAAAkAAAAoAAAAGwAAACQAAAAVAAAAJgAAABMAAAAiAAAADQAAAB0AAAAHAAAAFgAAABAAAAApAAAAIQAAAA8AAAAIAAAAHwAAABcAAAAYAAAACwAAAAoAAAAnAAAAJQAAABkAAAAYAAAAfwAAACAAAAAlAAAACgAAABcAAAASAAAAGQAAABcAAAARAAAACwAAAC0AAAAnAAAAIwAAABoAAAAqAAAAHQAAACsAAAAMAAAAHAAAAA0AAAAbAAAAKAAAACMAAAAuAAAADgAAABQAAAARAAAAHAAAAB8AAAAqAAAALAAAAAwAAAAPAAAAGgAAAB0AAAArAAAAJgAAAC8AAAANAAAAGgAAABUAAAAeAAAAIAAAADAAAAAyAAAAEAAAABIAAAAhAAAAHwAAACkAAAAsAAAANQAAAA8AAAAWAAAAHAAAACAAAAAeAAAAGAAAABIAAAA0AAAAMgAAACUAAAAhAAAAHgAAADEAAAAwAAAAFgAAABAAAAApAAAAIgAAABMAAAAmAAAAFQAAADYAAAAkAAAAMwAAACMAAAAuAAAALQAAADgAAAARAAAAGwAAABkAAAAkAAAAFAAAACIAAAATAAAANwAAACgAAAA2AAAAJQAAACcAAAA0AAAAOQAAABgAAAAXAAAAIAAAACYAAAB/AAAAIgAAADMAAAAdAAAALwAAABUAAAAnAAAAJQAAABkAAAAXAAAAOwAAADkAAAAtAAAAKAAAABsAAAAkAAAAFAAAADwAAAAuAAAANwAAACkAAAAxAAAANQAAAD0AAAAWAAAAIQAAAB8AAAAqAAAAOgAAACsAAAA+AAAAHAAAACwAAAAaAAAAKwAAAD4AAAAvAAAAQAAAABoAAAAqAAAAHQAAACwAAAA1AAAAOgAAAEEAAAAcAAAAHwAAACoAAAAtAAAAJwAAACMAAAAZAAAAPwAAADsAAAA4AAAALgAAADwAAAA4AAAARAAAABsAAAAoAAAAIwAAAC8AAAAmAAAAKwAAAB0AAABFAAAAMwAAAEAAAAAwAAAAMQAAAB4AAAAhAAAAQwAAAEIAAAAyAAAAMQAAAH8AAAA9AAAAQgAAACEAAAAwAAAAKQAAADIAAAAwAAAAIAAAAB4AAABGAAAAQwAAADQAAAAzAAAARQAAADYAAABHAAAAJgAAAC8AAAAiAAAANAAAADkAAABGAAAASgAAACAAAAAlAAAAMgAAADUAAAA9AAAAQQAAAEsAAAAfAAAAKQAAACwAAAA2AAAARwAAADcAAABJAAAAIgAAADMAAAAkAAAANwAAACgAAAA2AAAAJAAAAEgAAAA8AAAASQAAADgAAABEAAAAPwAAAE0AAAAjAAAALgAAAC0AAAA5AAAAOwAAAEoAAABOAAAAJQAAACcAAAA0AAAAOgAAAH8AAAA+AAAATAAAACwAAABBAAAAKgAAADsAAAA/AAAATgAAAE8AAAAnAAAALQAAADkAAAA8AAAASAAAAEQAAABQAAAAKAAAADcAAAAuAAAAPQAAADUAAAAxAAAAKQAAAFEAAABLAAAAQgAAAD4AAAArAAAAOgAAACoAAABSAAAAQAAAAEwAAAA/AAAAfwAAADgAAAAtAAAATwAAADsAAABNAAAAQAAAAC8AAAA+AAAAKwAAAFQAAABFAAAAUgAAAEEAAAA6AAAANQAAACwAAABWAAAATAAAAEsAAABCAAAAQwAAAFEAAABVAAAAMQAAADAAAAA9AAAAQwAAAEIAAAAyAAAAMAAAAFcAAABVAAAARgAAAEQAAAA4AAAAPAAAAC4AAABaAAAATQAAAFAAAABFAAAAMwAAAEAAAAAvAAAAWQAAAEcAAABUAAAARgAAAEMAAAA0AAAAMgAAAFMAAABXAAAASgAAAEcAAABZAAAASQAAAFsAAAAzAAAARQAAADYAAABIAAAAfwAAAEkAAAA3AAAAUAAAADwAAABYAAAASQAAAFsAAABIAAAAWAAAADYAAABHAAAANwAAAEoAAABOAAAAUwAAAFwAAAA0AAAAOQAAAEYAAABLAAAAQQAAAD0AAAA1AAAAXgAAAFYAAABRAAAATAAAAFYAAABSAAAAYAAAADoAAABBAAAAPgAAAE0AAAA/AAAARAAAADgAAABdAAAATwAAAFoAAABOAAAASgAAADsAAAA5AAAAXwAAAFwAAABPAAAATwAAAE4AAAA/AAAAOwAAAF0AAABfAAAATQAAAFAAAABEAAAASAAAADwAAABjAAAAWgAAAFgAAABRAAAAVQAAAF4AAABlAAAAPQAAAEIAAABLAAAAUgAAAGAAAABUAAAAYgAAAD4AAABMAAAAQAAAAFMAAAB/AAAASgAAAEYAAABkAAAAVwAAAFwAAABUAAAARQAAAFIAAABAAAAAYQAAAFkAAABiAAAAVQAAAFcAAABlAAAAZgAAAEIAAABDAAAAUQAAAFYAAABMAAAASwAAAEEAAABoAAAAYAAAAF4AAABXAAAAUwAAAGYAAABkAAAAQwAAAEYAAABVAAAAWAAAAEgAAABbAAAASQAAAGMAAABQAAAAaQAAAFkAAABhAAAAWwAAAGcAAABFAAAAVAAAAEcAAABaAAAATQAAAFAAAABEAAAAagAAAF0AAABjAAAAWwAAAEkAAABZAAAARwAAAGkAAABYAAAAZwAAAFwAAABTAAAATgAAAEoAAABsAAAAZAAAAF8AAABdAAAATwAAAFoAAABNAAAAbQAAAF8AAABqAAAAXgAAAFYAAABRAAAASwAAAGsAAABoAAAAZQAAAF8AAABcAAAATwAAAE4AAABtAAAAbAAAAF0AAABgAAAAaAAAAGIAAABuAAAATAAAAFYAAABSAAAAYQAAAH8AAABiAAAAVAAAAGcAAABZAAAAbwAAAGIAAABuAAAAYQAAAG8AAABSAAAAYAAAAFQAAABjAAAAUAAAAGkAAABYAAAAagAAAFoAAABxAAAAZAAAAGYAAABTAAAAVwAAAGwAAAByAAAAXAAAAGUAAABmAAAAawAAAHAAAABRAAAAVQAAAF4AAABmAAAAZQAAAFcAAABVAAAAcgAAAHAAAABkAAAAZwAAAFsAAABhAAAAWQAAAHQAAABpAAAAbwAAAGgAAABrAAAAbgAAAHMAAABWAAAAXgAAAGAAAABpAAAAWAAAAGcAAABbAAAAcQAAAGMAAAB0AAAAagAAAF0AAABjAAAAWgAAAHUAAABtAAAAcQAAAGsAAAB/AAAAZQAAAF4AAABzAAAAaAAAAHAAAABsAAAAZAAAAF8AAABcAAAAdgAAAHIAAABtAAAAbQAAAGwAAABdAAAAXwAAAHUAAAB2AAAAagAAAG4AAABiAAAAaAAAAGAAAAB3AAAAbwAAAHMAAABvAAAAYQAAAG4AAABiAAAAdAAAAGcAAAB3AAAAcAAAAGsAAABmAAAAZQAAAHgAAABzAAAAcgAAAHEAAABjAAAAdAAAAGkAAAB1AAAAagAAAHkAAAByAAAAcAAAAGQAAABmAAAAdgAAAHgAAABsAAAAcwAAAG4AAABrAAAAaAAAAHgAAAB3AAAAcAAAAHQAAABnAAAAdwAAAG8AAABxAAAAaQAAAHkAAAB1AAAAfwAAAG0AAAB2AAAAcQAAAHkAAABqAAAAdgAAAHgAAABsAAAAcgAAAHUAAAB5AAAAbQAAAHcAAABvAAAAcwAAAG4AAAB5AAAAdAAAAHgAAAB4AAAAcwAAAHIAAABwAAAAeQAAAHcAAAB2AAAAeQAAAHQAAAB4AAAAdwAAAHUAAABxAAAAdgAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAQAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAADAAAABQAAAAEAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAgAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAABQAAAAUAAAAAAAAAAAAAAP////8BAAAAAAAAAAMAAAAEAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAQAAAP//////////AQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAIAAAAAAAAAAAAAAAEAAAACAAAABgAAAAQAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAoAAAACAAAAAAAAAAAAAAABAAAAAQAAAAUAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAAAAAAAAAAAAAEAAAADAAAABwAAAAYAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAAAAAAAAAAAAQAAAAAAAAAJAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAAAAAAAAAAAAQAAAAQAAAAIAAAACgAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAAAAAAAAAAABAAAACwAAAA8AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAgAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAAAAAAAAAAABAAAADAAAABAAAAAMAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAEAAAAKAAAAEwAAAAgAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAJAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAgAAAAAAAAAAAAAAAQAAAA0AAAARAAAADQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAAAAAAAAAAAAAEAAAAOAAAAEgAAAA8AAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAAAAAABAAAA//////////8TAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABIAAAAAAAAAGAAAAAAAAAAhAAAAAAAAAB4AAAAAAAAAIAAAAAMAAAAxAAAAAQAAADAAAAADAAAAMgAAAAMAAAAIAAAAAAAAAAUAAAAFAAAACgAAAAUAAAAWAAAAAAAAABAAAAAAAAAAEgAAAAAAAAApAAAAAQAAACEAAAAAAAAAHgAAAAAAAAAEAAAAAAAAAAAAAAAFAAAAAgAAAAUAAAAPAAAAAQAAAAgAAAAAAAAABQAAAAUAAAAfAAAAAQAAABYAAAAAAAAAEAAAAAAAAAACAAAAAAAAAAYAAAAAAAAADgAAAAAAAAAKAAAAAAAAAAsAAAAAAAAAEQAAAAMAAAAYAAAAAQAAABcAAAADAAAAGQAAAAMAAAAAAAAAAAAAAAEAAAAFAAAACQAAAAUAAAAFAAAAAAAAAAIAAAAAAAAABgAAAAAAAAASAAAAAQAAAAoAAAAAAAAACwAAAAAAAAAEAAAAAQAAAAMAAAAFAAAABwAAAAUAAAAIAAAAAQAAAAAAAAAAAAAAAQAAAAUAAAAQAAAAAQAAAAUAAAAAAAAAAgAAAAAAAAAHAAAAAAAAABUAAAAAAAAAJgAAAAAAAAAJAAAAAAAAABMAAAAAAAAAIgAAAAMAAAAOAAAAAQAAABQAAAADAAAAJAAAAAMAAAADAAAAAAAAAA0AAAAFAAAAHQAAAAUAAAABAAAAAAAAAAcAAAAAAAAAFQAAAAAAAAAGAAAAAQAAAAkAAAAAAAAAEwAAAAAAAAAEAAAAAgAAAAwAAAAFAAAAGgAAAAUAAAAAAAAAAQAAAAMAAAAAAAAADQAAAAUAAAACAAAAAQAAAAEAAAAAAAAABwAAAAAAAAAaAAAAAAAAACoAAAAAAAAAOgAAAAAAAAAdAAAAAAAAACsAAAAAAAAAPgAAAAMAAAAmAAAAAQAAAC8AAAADAAAAQAAAAAMAAAAMAAAAAAAAABwAAAAFAAAALAAAAAUAAAANAAAAAAAAABoAAAAAAAAAKgAAAAAAAAAVAAAAAQAAAB0AAAAAAAAAKwAAAAAAAAAEAAAAAwAAAA8AAAAFAAAAHwAAAAUAAAADAAAAAQAAAAwAAAAAAAAAHAAAAAUAAAAHAAAAAQAAAA0AAAAAAAAAGgAAAAAAAAAfAAAAAAAAACkAAAAAAAAAMQAAAAAAAAAsAAAAAAAAADUAAAAAAAAAPQAAAAMAAAA6AAAAAQAAAEEAAAADAAAASwAAAAMAAAAPAAAAAAAAABYAAAAFAAAAIQAAAAUAAAAcAAAAAAAAAB8AAAAAAAAAKQAAAAAAAAAqAAAAAQAAACwAAAAAAAAANQAAAAAAAAAEAAAABAAAAAgAAAAFAAAAEAAAAAUAAAAMAAAAAQAAAA8AAAAAAAAAFgAAAAUAAAAaAAAAAQAAABwAAAAAAAAAHwAAAAAAAAAyAAAAAAAAADAAAAAAAAAAMQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAIQAAAAMAAAAYAAAAAwAAABIAAAADAAAAEAAAAAMAAABGAAAAAAAAAEMAAAAAAAAAQgAAAAMAAAA0AAAAAwAAADIAAAAAAAAAMAAAAAAAAAAlAAAAAwAAACAAAAAAAAAAHgAAAAMAAABTAAAAAAAAAFcAAAADAAAAVQAAAAMAAABKAAAAAwAAAEYAAAAAAAAAQwAAAAAAAAA5AAAAAQAAADQAAAADAAAAMgAAAAAAAAAZAAAAAAAAABcAAAAAAAAAGAAAAAMAAAARAAAAAAAAAAsAAAADAAAACgAAAAMAAAAOAAAAAwAAAAYAAAADAAAAAgAAAAMAAAAtAAAAAAAAACcAAAAAAAAAJQAAAAMAAAAjAAAAAwAAABkAAAAAAAAAFwAAAAAAAAAbAAAAAwAAABEAAAAAAAAACwAAAAMAAAA/AAAAAAAAADsAAAADAAAAOQAAAAMAAAA4AAAAAwAAAC0AAAAAAAAAJwAAAAAAAAAuAAAAAwAAACMAAAADAAAAGQAAAAAAAAAkAAAAAAAAABQAAAAAAAAADgAAAAMAAAAiAAAAAAAAABMAAAADAAAACQAAAAMAAAAmAAAAAwAAABUAAAADAAAABwAAAAMAAAA3AAAAAAAAACgAAAAAAAAAGwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAFAAAAAAAAAAzAAAAAwAAACIAAAAAAAAAEwAAAAMAAABIAAAAAAAAADwAAAADAAAALgAAAAMAAABJAAAAAwAAADcAAAAAAAAAKAAAAAAAAABHAAAAAwAAADYAAAADAAAAJAAAAAAAAABAAAAAAAAAAC8AAAAAAAAAJgAAAAMAAAA+AAAAAAAAACsAAAADAAAAHQAAAAMAAAA6AAAAAwAAACoAAAADAAAAGgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAMwAAAAMAAABSAAAAAwAAAEAAAAAAAAAALwAAAAAAAABMAAAAAwAAAD4AAAAAAAAAKwAAAAMAAABhAAAAAAAAAFkAAAADAAAARwAAAAMAAABiAAAAAwAAAFQAAAAAAAAARQAAAAAAAABgAAAAAwAAAFIAAAADAAAAQAAAAAAAAABLAAAAAAAAAEEAAAAAAAAAOgAAAAMAAAA9AAAAAAAAADUAAAADAAAALAAAAAMAAAAxAAAAAwAAACkAAAADAAAAHwAAAAMAAABeAAAAAAAAAFYAAAAAAAAATAAAAAMAAABRAAAAAwAAAEsAAAAAAAAAQQAAAAAAAABCAAAAAwAAAD0AAAAAAAAANQAAAAMAAABrAAAAAAAAAGgAAAADAAAAYAAAAAMAAABlAAAAAwAAAF4AAAAAAAAAVgAAAAAAAABVAAAAAwAAAFEAAAADAAAASwAAAAAAAAA5AAAAAAAAADsAAAAAAAAAPwAAAAMAAABKAAAAAAAAAE4AAAADAAAATwAAAAMAAABTAAAAAwAAAFwAAAADAAAAXwAAAAMAAAAlAAAAAAAAACcAAAADAAAALQAAAAMAAAA0AAAAAAAAADkAAAAAAAAAOwAAAAAAAABGAAAAAwAAAEoAAAAAAAAATgAAAAMAAAAYAAAAAAAAABcAAAADAAAAGQAAAAMAAAAgAAAAAwAAACUAAAAAAAAAJwAAAAMAAAAyAAAAAwAAADQAAAAAAAAAOQAAAAAAAAAuAAAAAAAAADwAAAAAAAAASAAAAAMAAAA4AAAAAAAAAEQAAAADAAAAUAAAAAMAAAA/AAAAAwAAAE0AAAADAAAAWgAAAAMAAAAbAAAAAAAAACgAAAADAAAANwAAAAMAAAAjAAAAAAAAAC4AAAAAAAAAPAAAAAAAAAAtAAAAAwAAADgAAAAAAAAARAAAAAMAAAAOAAAAAAAAABQAAAADAAAAJAAAAAMAAAARAAAAAwAAABsAAAAAAAAAKAAAAAMAAAAZAAAAAwAAACMAAAAAAAAALgAAAAAAAABHAAAAAAAAAFkAAAAAAAAAYQAAAAMAAABJAAAAAAAAAFsAAAADAAAAZwAAAAMAAABIAAAAAwAAAFgAAAADAAAAaQAAAAMAAAAzAAAAAAAAAEUAAAADAAAAVAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAWQAAAAAAAAA3AAAAAwAAAEkAAAAAAAAAWwAAAAMAAAAmAAAAAAAAAC8AAAADAAAAQAAAAAMAAAAiAAAAAwAAADMAAAAAAAAARQAAAAMAAAAkAAAAAwAAADYAAAAAAAAARwAAAAAAAABgAAAAAAAAAGgAAAAAAAAAawAAAAMAAABiAAAAAAAAAG4AAAADAAAAcwAAAAMAAABhAAAAAwAAAG8AAAADAAAAdwAAAAMAAABMAAAAAAAAAFYAAAADAAAAXgAAAAMAAABSAAAAAAAAAGAAAAAAAAAAaAAAAAAAAABUAAAAAwAAAGIAAAAAAAAAbgAAAAMAAAA6AAAAAAAAAEEAAAADAAAASwAAAAMAAAA+AAAAAwAAAEwAAAAAAAAAVgAAAAMAAABAAAAAAwAAAFIAAAAAAAAAYAAAAAAAAABVAAAAAAAAAFcAAAAAAAAAUwAAAAMAAABlAAAAAAAAAGYAAAADAAAAZAAAAAMAAABrAAAAAwAAAHAAAAADAAAAcgAAAAMAAABCAAAAAAAAAEMAAAADAAAARgAAAAMAAABRAAAAAAAAAFUAAAAAAAAAVwAAAAAAAABeAAAAAwAAAGUAAAAAAAAAZgAAAAMAAAAxAAAAAAAAADAAAAADAAAAMgAAAAMAAAA9AAAAAwAAAEIAAAAAAAAAQwAAAAMAAABLAAAAAwAAAFEAAAAAAAAAVQAAAAAAAABfAAAAAAAAAFwAAAAAAAAAUwAAAAAAAABPAAAAAAAAAE4AAAAAAAAASgAAAAMAAAA/AAAAAQAAADsAAAADAAAAOQAAAAMAAABtAAAAAAAAAGwAAAAAAAAAZAAAAAUAAABdAAAAAQAAAF8AAAAAAAAAXAAAAAAAAABNAAAAAQAAAE8AAAAAAAAATgAAAAAAAAB1AAAABAAAAHYAAAAFAAAAcgAAAAUAAABqAAAAAQAAAG0AAAAAAAAAbAAAAAAAAABaAAAAAQAAAF0AAAABAAAAXwAAAAAAAABaAAAAAAAAAE0AAAAAAAAAPwAAAAAAAABQAAAAAAAAAEQAAAAAAAAAOAAAAAMAAABIAAAAAQAAADwAAAADAAAALgAAAAMAAABqAAAAAAAAAF0AAAAAAAAATwAAAAUAAABjAAAAAQAAAFoAAAAAAAAATQAAAAAAAABYAAAAAQAAAFAAAAAAAAAARAAAAAAAAAB1AAAAAwAAAG0AAAAFAAAAXwAAAAUAAABxAAAAAQAAAGoAAAAAAAAAXQAAAAAAAABpAAAAAQAAAGMAAAABAAAAWgAAAAAAAABpAAAAAAAAAFgAAAAAAAAASAAAAAAAAABnAAAAAAAAAFsAAAAAAAAASQAAAAMAAABhAAAAAQAAAFkAAAADAAAARwAAAAMAAABxAAAAAAAAAGMAAAAAAAAAUAAAAAUAAAB0AAAAAQAAAGkAAAAAAAAAWAAAAAAAAABvAAAAAQAAAGcAAAAAAAAAWwAAAAAAAAB1AAAAAgAAAGoAAAAFAAAAWgAAAAUAAAB5AAAAAQAAAHEAAAAAAAAAYwAAAAAAAAB3AAAAAQAAAHQAAAABAAAAaQAAAAAAAAB3AAAAAAAAAG8AAAAAAAAAYQAAAAAAAABzAAAAAAAAAG4AAAAAAAAAYgAAAAMAAABrAAAAAQAAAGgAAAADAAAAYAAAAAMAAAB5AAAAAAAAAHQAAAAAAAAAZwAAAAUAAAB4AAAAAQAAAHcAAAAAAAAAbwAAAAAAAABwAAAAAQAAAHMAAAAAAAAAbgAAAAAAAAB1AAAAAQAAAHEAAAAFAAAAaQAAAAUAAAB2AAAAAQAAAHkAAAAAAAAAdAAAAAAAAAByAAAAAQAAAHgAAAABAAAAdwAAAAAAAAByAAAAAAAAAHAAAAAAAAAAawAAAAAAAABkAAAAAAAAAGYAAAAAAAAAZQAAAAMAAABTAAAAAQAAAFcAAAADAAAAVQAAAAMAAAB2AAAAAAAAAHgAAAAAAAAAcwAAAAUAAABsAAAAAQAAAHIAAAAAAAAAcAAAAAAAAABcAAAAAQAAAGQAAAAAAAAAZgAAAAAAAAB1AAAAAAAAAHkAAAAFAAAAdwAAAAUAAABtAAAAAQAAAHYAAAAAAAAAeAAAAAAAAABfAAAAAQAAAGwAAAABAAAAcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAB+ogX28rbpPxqumpJv+fM/165tC4ns9D+XaEnTqUsEQFrOtNlC4PA/3U+0XG6P9b9TdUUBxTTjP4PUp8ex1ty/B1rD/EN43z+lcDi6LLrZP/a45NWEHMY/oJ5ijLDZ+j/xw3rjxWPjP2B8A46ioQdAotff3wla2z+FMSpA1jj+v6b5Y1mtPbS/cIu8K0F457/2esiyJpDNv98k5Ts2NeA/pvljWa09tD88ClUJ60MDQPZ6yLImkM0/4ONKxa0UBcD2uOTVhBzGv5G7JRxGave/8cN648Vj47+HCwtkjAXIv6LX398JWtu/qyheaCAL9D9TdUUBxTTjv4gyTxslhwVAB1rD/EN4378EH/28teoFwH6iBfbytum/F6ztFYdK/r/Xrm0Liez0vwcS6wNGWeO/Ws602ULg8L9TCtRLiLT8P8pi5RexJsw/BlIKPVwR5T95Wyu0/QjnP5PjoT7YYcu/mBhKZ6zrwj8wRYS7NebuP3qW6geh+Ls/SLrixebL3r+pcyymN9XrPwmkNHp7xec/GWNMZVAA17+82s+x2BLiPwn2ytbJ9ek/LgEH1sMS1j8yp/2LhTfeP+SnWwtQBbu/d38gkp5X7z8ytsuHaADGPzUYObdf1+m/7IauECWhwz+cjSACjzniP76Z+wUhN9K/1+GEKzup67+/GYr/04baPw6idWOvsuc/ZedTWsRa5b/EJQOuRzi0v/OncYhHPes/h49PixY53j+i8wWfC03Nvw2idWOvsue/ZedTWsRa5T/EJQOuRzi0P/KncYhHPeu/iY9PixY53r+i8wWfC03NP9anWwtQBbs/d38gkp5X778ytsuHaADGvzUYObdf1+k/74auECWhw7+cjSACjzniv8CZ+wUhN9I/1uGEKzup6z+/GYr/04bavwmkNHp7xee/F2NMZVAA1z+82s+x2BLivwr2ytbJ9em/KwEH1sMS1r8yp/2LhTfev81i5RexJsy/BlIKPVwR5b95Wyu0/Qjnv5DjoT7YYcs/nBhKZ6zrwr8wRYS7Nebuv3OW6geh+Lu/SLrixebL3j+pcyymN9Xrv8rHIFfWehZAMBwUdlo0DECTUc17EOb2PxpVB1SWChdAzjbhb9pTDUDQhmdvECX5P9FlMKCC9+g/IIAzjELgE0DajDngMv8GQFhWDmDPjNs/y1guLh96EkAxPi8k7DIEQJCc4URlhRhA3eLKKLwkEECqpNAyTBD/P6xpjXcDiwVAFtl//cQm4z+Ibt3XKiYTQM7mCLUb3QdAoM1t8yVv7D8aLZv2Nk8UQEAJPV5nQwxAtSsfTCoE9z9TPjXLXIIWQBVanC5W9AtAYM3d7Adm9j++5mQz1FoWQBUThyaVBghAwH5muQsV7T89Q1qv82MUQJoWGOfNuBdAzrkClkmwDkDQjKq77t37Py+g0dtitsE/ZwAMTwVPEUBojepluNwBQGYbtuW+t9w/HNWIJs6MEkDTNuQUSlgEQKxktPP5TcQ/ixbLB8JjEUCwuWjXMQYCQAS/R09FkRdAowpiZjhhDkB7LmlczD/7P01iQmhhsAVAnrtTwDy84z/Z6jfQ2TgTQChOCXMnWwpAhrW3daoz8z/HYJvVPI4VQLT3ik5FcA5Angi7LOZd+z+NNVzDy5gXQBXdvVTFUA1AYNMgOeYe+T8+qHXGCwkXQKQTOKwa5AJA8gFVoEMW0T+FwzJyttIRQAEAAAD/////BwAAAP////8xAAAA/////1cBAAD/////YQkAAP////+nQQAA/////5HLAQD/////95AMAP/////B9lcAAAAAAAAAAAAAAAAAAgAAAP////8OAAAA/////2IAAAD/////rgIAAP/////CEgAA/////06DAAD/////IpcDAP/////uIRkA/////4LtrwAAAAAAAAAAAAAAAAAAAAAAAgAAAP//////////AQAAAAMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////////////////////wEAAAAAAAAAAgAAAP///////////////wMAAAD//////////////////////////////////////////////////////////wIAAAD//////////wEAAAAAAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA/////////////////////wEAAAD///////////////8CAAAA////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAA////////////////AgAAAAEAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AQAAAAIAAAD///////////////8AAAAA/////////////////////wMAAAD///////////////////////////////8CAAAA////////////////AQAAAP////////////////////8AAAAA/////////////////////wMAAAD/////////////////////////////////////////////////////AwAAAP////////////////////8AAAAAAQAAAP//////////AgAAAP//////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAP///////////////wIAAAAAAAAAAQAAAP//////////////////////////////////////////////////////////////////////////AwAAAAEAAAD//////////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAgAAAAAAAAACAAAAAQAAAAEAAAACAAAAAgAAAAAAAAAFAAAABQAAAAAAAAACAAAAAgAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAABAAAAAgAAAAIAAAACAAAAAAAAAAUAAAAGAAAAAAAAAAIAAAACAAAAAwAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAIAAAAAAAAAAgAAAAEAAAADAAAAAgAAAAIAAAAAAAAABQAAAAcAAAAAAAAAAgAAAAIAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAgAAAAAAAAACAAAAAQAAAAQAAAACAAAAAgAAAAAAAAAFAAAACAAAAAAAAAACAAAAAgAAAAMAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAACAAAAAAAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAUAAAAJAAAAAAAAAAIAAAACAAAAAwAAAAUAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAIAAAACAAAAAAAAAAMAAAAOAAAAAgAAAAAAAAACAAAAAwAAAAAAAAAAAAAAAgAAAAIAAAADAAAABgAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAgAAAAIAAAAAAAAAAwAAAAoAAAACAAAAAAAAAAIAAAADAAAAAQAAAAAAAAACAAAAAgAAAAMAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAgAAAAAAAAADAAAACwAAAAIAAAAAAAAAAgAAAAMAAAACAAAAAAAAAAIAAAACAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAACAAAAAAAAAAMAAAAMAAAAAgAAAAAAAAACAAAAAwAAAAMAAAAAAAAAAgAAAAIAAAADAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAgAAAAIAAAAAAAAAAwAAAA0AAAACAAAAAAAAAAIAAAADAAAABAAAAAAAAAACAAAAAgAAAAMAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAgAAAAAAAAADAAAABgAAAAIAAAAAAAAAAgAAAAMAAAAPAAAAAAAAAAIAAAACAAAAAwAAAAsAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAIAAAACAAAAAAAAAAMAAAAHAAAAAgAAAAAAAAACAAAAAwAAABAAAAAAAAAAAgAAAAIAAAADAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAIAAAAAAAAAAwAAAAgAAAACAAAAAAAAAAIAAAADAAAAEQAAAAAAAAACAAAAAgAAAAMAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAACAAAAAgAAAAAAAAADAAAACQAAAAIAAAAAAAAAAgAAAAMAAAASAAAAAAAAAAIAAAACAAAAAwAAAA4AAAAAAAAAAAAAAAAAAAAAAAAACQAAAAIAAAACAAAAAAAAAAMAAAAFAAAAAgAAAAAAAAACAAAAAwAAABMAAAAAAAAAAgAAAAIAAAADAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAgAAAAAAAAACAAAAAQAAABMAAAACAAAAAgAAAAAAAAAFAAAACgAAAAAAAAACAAAAAgAAAAMAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABEAAAACAAAAAAAAAAIAAAABAAAADwAAAAIAAAACAAAAAAAAAAUAAAALAAAAAAAAAAIAAAACAAAAAwAAABEAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAIAAAAAAAAAAgAAAAEAAAAQAAAAAgAAAAIAAAAAAAAABQAAAAwAAAAAAAAAAgAAAAIAAAADAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAACAAAAAQAAABEAAAACAAAAAgAAAAAAAAAFAAAADQAAAAAAAAACAAAAAgAAAAMAAAATAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAACAAAAAAAAAAIAAAABAAAAEgAAAAIAAAACAAAAAAAAAAUAAAAOAAAAAAAAAAIAAAACAAAAAwAAAAIAAAABAAAAAAAAAAEAAAACAAAAAAAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAEAAAAAAAAAAgAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAgAAAAAAAAABAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAAAAAAAAAAABQAAAAQAAAAAAAAAAQAAAAUAAAAEAAAAAAAAAAUAAAAFAAAAAAAAAAEAAAAAAAAAAAAAAMuhRbbsNlBBYqHW9OmHIkF9XBuqnS31QAK37uYhNMhAOSo3UUupm0DC+6pc6JxvQHV9eseEEEJAzURsCyqlFEB8BQ4NMJjnPyy3tBoS97o/xawXQznRjj89J2K2CZxhP6vX43RIIDQ/S8isgygEBz+LvFHQkmzaPjFFFO7wMq4+AADMLkTtjkIAAOgkJqxhQgAAU7B0MjRCAADwpBcVB0IAAACYP2HaQQAAAIn/Ja5BzczM4Eg6gUHNzMxMU7BTQTMzMzNfgCZBAAAAAEi3+UAAAAAAwGPNQDMzMzMzy6BAmpmZmZkxc0AzMzMzM/NFQDMzMzMzMxlAzczMzMzM7D+ygXSx2U6RQKimJOvQKnpA23hmONTHY0A/AGcxyudNQNb3K647mzZA+S56rrwWIUAm4kUQ+9UJQKre9hGzh/M/BLvoy9WG3T+LmqMf8VHGP2m3nYNV37A/gbFHcyeCmT+cBPWBckiDP61tZACjKW0/q2RbYVUYVj8uDypVyLNAP6jGS5cA5zBBwcqhBdCNGUEGEhQ/JVEDQT6WPnRbNO1AB/AWSJgT1kDfUWNCNLDAQNk+5C33OqlAchWL34QSk0DKvtDIrNV8QNF0G3kFzGVASSeWhBl6UED+/0mNGuk4QGjA/dm/1CJALPLPMql6DEDSHoDrwpP1P2jouzWST+A/egAAAAAAAABKAwAAAAAAAPoWAAAAAAAAyqAAAAAAAAB6ZQQAAAAAAErGHgAAAAAA+mvXAAAAAADK8+MFAAAAAHqqOykAAAAASqmhIAEAAAD6oGvkBwAAAMpm8T43AAAAes+ZuIIBAABKrDQMkwoAAPq1cFUFSgAAyvkUViUGAgAAAAAAAwAAAAYAAAACAAAABQAAAAEAAAAEAAAAAAAAAAAAAAAFAAAAAwAAAAEAAAAGAAAABAAAAAIAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAA/////wAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP////8AAAAAAAAAAAEAAAABAAAAAAAAAAAAAAD/////AAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAAAAAAABAAEAAAEBAAAAAAABAAAAAQAAAAEAAQAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAHAAAABwAAAAEAAAACAAAABAAAAAMAAAAAAAAAAAAAAAcAAAADAAAAAQAAAAIAAAAFAAAABAAAAAAAAAAAAAAAYWxnb3MuYwBfcG9seWZpbGxJbnRlcm5hbABhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0dlb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9HZW9Cb3VuZGFyeQBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGgzVG9Mb2NhbElqawBiYXNlQ2VsbCAhPSBvcmlnaW5CYXNlQ2VsbAAhKG9yaWdpbk9uUGVudCAmJiBpbmRleE9uUGVudCkAcGVudGFnb25Sb3RhdGlvbnMgPj0gMABkaXJlY3Rpb25Sb3RhdGlvbnMgPj0gMABiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvSDMAIV9pc0Jhc2VDZWxsUGVudGFnb24oYmFzZUNlbGwpAGJhc2VDZWxsUm90YXRpb25zID49IDAAd2l0aGluUGVudGFnb25Sb3RhdGlvbnMgPj0gMABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";function j(e){return e}function V(e){return e.replace(/\b__Z[\w\d_]+/g,(function(e){return e===e?e:e+" ["+e+"]"}))}function G(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function W(){return p.length}function $(e){try{var t=new ArrayBuffer(e);if(t.byteLength!=e)return;return new Int8Array(t).set(p),Q(t),w(t),1}catch(e){}}var q="function"==typeof atob?atob:function(e){var t,n,i,r,o,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=a.indexOf(e.charAt(c++))<<2|(r=a.indexOf(e.charAt(c++)))>>4,n=(15&r)<<4|(o=a.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(s=a.indexOf(e.charAt(c++))),l+=String.fromCharCode(t),64!==o&&(l+=String.fromCharCode(n)),64!==s&&(l+=String.fromCharCode(i))}while(c<e.length);return l};function Z(e){if(U(e))return function(e){try{for(var t=q(e),n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}catch(e){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(N.length))}var H=function(e,t,n){var i=new e.Int8Array(n),r=new e.Int32Array(n);new e.Uint8Array(n),new e.Float32Array(n);var o=new e.Float64Array(n),s=0|t.p,a=e.Math.floor,l=e.Math.abs,c=e.Math.sqrt,u=e.Math.pow,h=e.Math.cos,d=e.Math.sin,f=e.Math.tan,p=e.Math.acos,A=e.Math.asin,m=e.Math.atan,g=e.Math.atan2,y=e.Math.ceil,_=e.Math.imul,v=e.Math.min,b=e.Math.clz32,x=t.b,w=t.c,E=t.d,S=t.e,T=t.f,k=t.g,C=t.h,P=t.i,M=24048;function I(e,t,n,i){var r,o;0|L(e|=0,t|=0,n|=0,i|=0,0)&&(Pt(0|i,0,(o=1+(0|_(3*n|0,n+1|0))|0)<<3|0),(r=0|_t(o,4))&&(R(e,t,n,i,r,o,0),yt(r)))}function L(e,t,n,i,o){e|=0,t|=0,n|=0,o|=0;var s,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0;if(s=M,M=M+16|0,p=s,r[(a=i|=0)>>2]=e,r[a+4>>2]=t,(a=0!=(0|o))&&(r[o>>2]=0),0|ze(e,t))return M=s,0|(p=1);r[p>>2]=0;e:do{if((0|n)>=1)if(a)for(h=0,d=1,f=1,l=0,a=e;;){if(!(l|h)){if(0==(0|(a=0|z(a,t,4,p)))&0==(0|(t=0|w()))){a=2;break e}if(0|ze(a,t)){a=1;break e}}if(0==(0|(a=0|z(a,t,0|r[16+(h<<2)>>2],p)))&0==(0|(t=0|w()))){a=2;break e}if(r[(e=i+(f<<3)|0)>>2]=a,r[e+4>>2]=t,r[o+(f<<2)>>2]=d,e=(0|(l=l+1|0))==(0|d),u=6==(0|(c=h+1|0)),0|ze(a,t)){a=1;break e}if((0|(d=d+(u&e&1)|0))>(0|n)){a=0;break}h=e?u?0:c:h,f=f+1|0,l=e?0:l}else for(h=0,d=1,f=1,l=0,a=e;;){if(!(l|h)){if(0==(0|(a=0|z(a,t,4,p)))&0==(0|(t=0|w()))){a=2;break e}if(0|ze(a,t)){a=1;break e}}if(0==(0|(a=0|z(a,t,0|r[16+(h<<2)>>2],p)))&0==(0|(t=0|w()))){a=2;break e}if(r[(e=i+(f<<3)|0)>>2]=a,r[e+4>>2]=t,e=(0|(l=l+1|0))==(0|d),u=6==(0|(c=h+1|0)),0|ze(a,t)){a=1;break e}if((0|(d=d+(u&e&1)|0))>(0|n)){a=0;break}h=e?u?0:c:h,f=f+1|0,l=e?0:l}else a=0}while(0);return M=s,0|(p=a)}function R(e,t,n,i,o,s,a){n|=0,i|=0,o|=0,s|=0,a|=0;var l,c,u=0,h=0,d=0,f=0,p=0;if(c=M,M=M+16|0,l=c,0==(0|(e|=0))&0==(0|(t|=0)))M=c;else{if(u=0|wt(0|e,0|t,0|s,((0|s)<0)<<31>>31|0),w(),!(0==(0|(p=0|r[(f=h=i+(u<<3)|0)>>2]))&0==(0|(f=0|r[f+4>>2]))|(d=(0|p)==(0|e)&(0|f)==(0|t))))do{d=(0|(f=0|r[(p=h=i+((u=(u+1|0)%(0|s)|0)<<3)|0)>>2]))==(0|e)&(0|(p=0|r[p+4>>2]))==(0|t)}while(!(0==(0|f)&0==(0|p)|d));u=o+(u<<2)|0,d&&(0|r[u>>2])<=(0|a)||(r[(p=h)>>2]=e,r[p+4>>2]=t,r[u>>2]=a,(0|a)>=(0|n)||(p=a+1|0,r[l>>2]=0,R(f=0|z(e,t,2,l),0|w(),n,i,o,s,p),r[l>>2]=0,R(f=0|z(e,t,3,l),0|w(),n,i,o,s,p),r[l>>2]=0,R(f=0|z(e,t,1,l),0|w(),n,i,o,s,p),r[l>>2]=0,R(f=0|z(e,t,5,l),0|w(),n,i,o,s,p),r[l>>2]=0,R(f=0|z(e,t,4,l),0|w(),n,i,o,s,p),r[l>>2]=0,R(f=0|z(e,t,6,l),0|w(),n,i,o,s,p))),M=c}}function z(e,t,n,i){e|=0,t|=0,n|=0;var o,s,a=0,l=0,c=0,u=0,h=0,d=0,f=0;if((0|r[(i|=0)>>2])>0){a=0;do{n=0|le(n),a=a+1|0}while((0|a)<(0|r[i>>2]))}o=0|Et(0|e,0|t,45),w(),s=127&o,l=0|De(e,t),a=0|Et(0|e,0|t,52),w(),a&=15;e:do{if(a)for(;;){if(d=0|Et(0|e,0|t,0|(h=3*(15-a|0)|0)),w(),d&=7,f=0==(0|Ue(a)),a=a+-1|0,u=0|St(7,0,0|h),t&=~(0|w()),e=(h=0|St(0|r[(f?464:48)+(28*d|0)+(n<<2)>>2],0,0|h))|e&~u,t|=0|w(),!(n=0|r[(f?672:256)+(28*d|0)+(n<<2)>>2])){n=0;break e}if(!a){c=6;break}}else c=6}while(0);6==(0|c)&&(e|=d=0|St(0|(f=0|r[880+(28*s|0)+(n<<2)>>2]),0,45),t=0|w()|-1040385&t,n=0|r[4304+(28*s|0)+(n<<2)>>2],127==(127&f|0)&&(f=0|St(0|r[880+(28*s|0)+20>>2],0,45),t=0|w()|-1040385&t,n=0|r[4304+(28*s|0)+20>>2],e=0|Be(f|e,t),t=0|w(),r[i>>2]=1+(0|r[i>>2]))),c=0|Et(0|e,0|t,45),w(),c&=127;e:do{if(0|O(c)){t:do{if(1==(0|De(e,t))){if((0|s)!=(0|c)){if(0|U(c,0|r[7728+(28*s|0)>>2])){e=0|Ne(e,t),l=1,t=0|w();break}e=0|Be(e,t),l=1,t=0|w();break}switch(0|l){case 5:e=0|Ne(e,t),t=0|w(),r[i>>2]=5+(0|r[i>>2]),l=0;break t;case 3:e=0|Be(e,t),t=0|w(),r[i>>2]=1+(0|r[i>>2]),l=0;break t;default:return f=0,x(0|(d=0)),0|f}}else l=0}while(0);if((0|n)>0){a=0;do{e=0|Oe(e,t),t=0|w(),a=a+1|0}while((0|a)!=(0|n))}if((0|s)!=(0|c)){if(!(0|B(c))){if(0!=(0|l)|5!=(0|De(e,t)))break;r[i>>2]=1+(0|r[i>>2]);break}switch(127&o){case 8:case 118:break e}3!=(0|De(e,t))&&(r[i>>2]=1+(0|r[i>>2]))}}else if((0|n)>0){a=0;do{e=0|Be(e,t),t=0|w(),a=a+1|0}while((0|a)!=(0|n))}}while(0);return r[i>>2]=((0|r[i>>2])+n|0)%6|0,f=e,x(0|(d=t)),0|f}function D(e,t,n,i,s,a){t|=0,n|=0,i|=0,s|=0,a|=0;var l,c,u,h,d,f,p,A,m,g=0,y=0,_=0,v=0,b=0,x=0,E=0,S=0,T=0,k=0,C=0,P=0,I=0,L=0;if(m=M,M=M+48|0,f=m+32|0,p=m+16|0,A=m,(0|(g=0|r[(e|=0)>>2]))<=0)return M=m,0|(P=0);l=e+4|0,c=f+8|0,u=p+8|0,h=A+8|0,d=((0|t)<0)<<31>>31,C=0;e:for(;;){T=(y=0|r[l>>2])+(C<<4)|0,r[f>>2]=r[T>>2],r[f+4>>2]=r[T+4>>2],r[f+8>>2]=r[T+8>>2],r[f+12>>2]=r[T+12>>2],(0|C)==(g+-1|0)?(r[p>>2]=r[y>>2],r[p+4>>2]=r[y+4>>2],r[p+8>>2]=r[y+8>>2],r[p+12>>2]=r[y+12>>2]):(T=y+(C+1<<4)|0,r[p>>2]=r[T>>2],r[p+4>>2]=r[T+4>>2],r[p+8>>2]=r[T+8>>2],r[p+12>>2]=r[T+12>>2]),T=0|q(f,p,n);t:do{if((0|T)>0){k=+(0|T),S=0;n:for(;;){L=+(T-S|0),I=+(0|S),o[A>>3]=+o[f>>3]*L/k+ +o[p>>3]*I/k,o[h>>3]=+o[c>>3]*L/k+ +o[u>>3]*I/k,y=0|wt(0|(x=0|je(A,n)),0|(E=0|w()),0|t,0|d),w(),v=0|r[(_=g=a+(y<<3)|0)>>2],_=0|r[_+4>>2];i:do{if(0==(0|v)&0==(0|_))P=14;else for(b=0;;){if((0|b)>(0|t)){g=1;break i}if((0|v)==(0|x)&(0|_)==(0|E)){g=7;break i}if(0==(0|(v=0|r[(_=g=a+((y=(y+1|0)%(0|t)|0)<<3)|0)>>2]))&0==(0|(_=0|r[_+4>>2]))){P=14;break}b=b+1|0}}while(0);switch(14==(0|P)&&(P=0,0==(0|x)&0==(0|E)?g=7:(r[g>>2]=x,r[g+4>>2]=E,g=0|r[i>>2],r[(b=s+(g<<3)|0)>>2]=x,r[b+4>>2]=E,r[i>>2]=g+1,g=0)),7&g){case 7:case 0:break;default:break n}if((0|T)<=(0|(S=S+1|0))){P=8;break t}}if(0|g){g=-1,P=20;break e}}else P=8}while(0);if(8==(0|P)&&(P=0),(0|(C=C+1|0))>=(0|(g=0|r[e>>2]))){g=0,P=20;break}}return 20==(0|P)?(M=m,0|g):0}function O(e){return 0|r[7728+(28*(e|=0)|0)+16>>2]}function B(e){return 4==(0|(e|=0))|117==(0|e)|0}function F(e){return 0|r[11152+(216*(0|r[(e|=0)>>2])|0)+(72*(0|r[e+4>>2])|0)+(24*(0|r[e+8>>2])|0)+(r[e+12>>2]<<3)>>2]}function N(e){return 0|r[11152+(216*(0|r[(e|=0)>>2])|0)+(72*(0|r[e+4>>2])|0)+(24*(0|r[e+8>>2])|0)+(r[e+12>>2]<<3)+4>>2]}function U(e,t){return t|=0,(0|r[7728+(28*(e|=0)|0)+20>>2])==(0|t)?0|(t=1):0|(t=(0|r[7728+(28*e|0)+24>>2])==(0|t))}function j(e,t){return 0|r[880+(28*(e|=0)|0)+((t|=0)<<2)>>2]}function V(e,t){return t|=0,(0|r[880+(28*(e|=0)|0)>>2])==(0|t)?0|(t=0):(0|r[880+(28*e|0)+4>>2])==(0|t)?0|(t=1):(0|r[880+(28*e|0)+8>>2])==(0|t)?0|(t=2):(0|r[880+(28*e|0)+12>>2])==(0|t)?0|(t=3):(0|r[880+(28*e|0)+16>>2])==(0|t)?0|(t=4):(0|r[880+(28*e|0)+20>>2])==(0|t)?0|(t=5):0|((0|r[880+(28*e|0)+24>>2])==(0|t)?6:7)}function G(e){return+o[(e|=0)+16>>3]<+o[e+24>>3]|0}function W(e,t){e|=0;var n,i,r=0;return(r=+o[(t|=0)>>3])>=+o[e+8>>3]&&r<=+o[e>>3]?(n=+o[e+16>>3],r=+o[e+24>>3],t=(i=+o[t+8>>3])>=r,e=i<=n&1,n<r?t&&(e=1):t||(e=0),0|(t=0!=(0|e))):0|(t=0)}function $(e,t){e|=0,t|=0;var n,i,s,a,c,u,h=0,d=0;a=M,M=M+288|0,n=a+264|0,i=a+96|0,d=(h=s=a)+96|0;do{r[h>>2]=0,h=h+4|0}while((0|h)<(0|d));return qe(t,s),We(d=0|r[(h=s)>>2],h=0|r[h+4>>2],n),$e(d,h,i),c=+Ce(n,i+8|0),o[n>>3]=+o[e>>3],o[(h=n+8|0)>>3]=+o[e+16>>3],o[i>>3]=+o[e+8>>3],o[(d=i+8|0)>>3]=+o[e+24>>3],u=+Ce(n,i),d=~~+y(+u*u/+Tt(+ +l(+(+o[h>>3]-+o[d>>3])/(+o[n>>3]-+o[i>>3])),3)/(c*(2.59807621135*c)*.8)),M=a,0|(0==(0|d)?1:d)}function q(e,t,n){e|=0,t|=0,n|=0;var i,o,s,a,l,c=0,u=0;a=M,M=M+288|0,i=a+264|0,o=a+96|0,u=(c=s=a)+96|0;do{r[c>>2]=0,c=c+4|0}while((0|c)<(0|u));return qe(n,s),We(c=0|r[(u=s)>>2],u=0|r[u+4>>2],i),$e(c,u,o),l=+Ce(i,o+8|0),u=~~+y(+ +Ce(e,t)/(2*l)),M=a,0|(0==(0|u)?1:u)}function Z(e,t,n,i){t|=0,n|=0,i|=0,r[(e|=0)>>2]=t,r[e+4>>2]=n,r[e+8>>2]=i}function H(e,t){e|=0;var n,i,s,a,c=0,u=0,h=0,d=0,f=0,p=0,A=0;r[(a=(t|=0)+8|0)>>2]=0,i=+o[e>>3],d=+l(+i),s=+o[e+8>>3],d+=.5*(f=+l(+s)/.8660254037844386),d-=+(0|(c=~~d)),f-=+(0|(e=~~f));do{if(d<.5){if(d<.3333333333333333){if(r[t>>2]=c,f<.5*(d+1)){r[t+4>>2]=e;break}e=e+1|0,r[t+4>>2]=e;break}if(e=(1&!(f<(A=1-d)))+e|0,r[t+4>>2]=e,A<=f&f<2*d){c=c+1|0,r[t>>2]=c;break}r[t>>2]=c;break}if(!(d<.6666666666666666)){if(c=c+1|0,r[t>>2]=c,f<.5*d){r[t+4>>2]=e;break}e=e+1|0,r[t+4>>2]=e;break}if(f<1-d){if(r[t+4>>2]=e,2*d-1<f){r[t>>2]=c;break}}else e=e+1|0,r[t+4>>2]=e;c=c+1|0,r[t>>2]=c}while(0);do{if(i<0){if(1&e){c=~~(+(0|c)-(2*(+((p=0|vt(0|c,((0|c)<0)<<31>>31|0,0|(p=(e+1|0)/2|0),((0|p)<0)<<31>>31|0))>>>0)+4294967296*+(0|w()))+1)),r[t>>2]=c;break}c=~~(+(0|c)-2*(+((p=0|vt(0|c,((0|c)<0)<<31>>31|0,0|(p=(0|e)/2|0),((0|p)<0)<<31>>31|0))>>>0)+4294967296*+(0|w()))),r[t>>2]=c;break}}while(0);p=t+4|0,s<0&&(c=c-((1|e<<1)/2|0)|0,r[t>>2]=c,e=0-e|0,r[p>>2]=e),u=e-c|0,(0|c)<0?(h=0-c|0,r[p>>2]=u,r[a>>2]=h,r[t>>2]=0,e=u,c=0):h=0,(0|e)<0&&(c=c-e|0,r[t>>2]=c,h=h-e|0,r[a>>2]=h,r[p>>2]=0,e=0),n=c-h|0,u=e-h|0,(0|h)<0&&(r[t>>2]=n,r[p>>2]=u,r[a>>2]=0,e=u,c=n,h=0),(0|(u=(0|h)<(0|(u=(0|e)<(0|c)?e:c))?h:u))<=0||(r[t>>2]=c-u,r[p>>2]=e-u,r[a>>2]=h-u)}function Q(e){var t,n=0,i=0,o=0,s=0,a=0;n=0|r[(e|=0)>>2],i=0|r[(t=e+4|0)>>2],(0|n)<0&&(i=i-n|0,r[t>>2]=i,r[(a=e+8|0)>>2]=(0|r[a>>2])-n,r[e>>2]=0,n=0),(0|i)<0?(n=n-i|0,r[e>>2]=n,s=(0|r[(a=e+8|0)>>2])-i|0,r[a>>2]=s,r[t>>2]=0,i=0):(a=s=e+8|0,s=0|r[s>>2]),(0|s)<0&&(n=n-s|0,r[e>>2]=n,i=i-s|0,r[t>>2]=i,r[a>>2]=0,s=0),(0|(o=(0|s)<(0|(o=(0|i)<(0|n)?i:n))?s:o))<=0||(r[e>>2]=n-o,r[t>>2]=i-o,r[a>>2]=s-o)}function X(e,t){t|=0;var n,i;i=0|r[(e|=0)+8>>2],n=+((0|r[e+4>>2])-i|0),o[t>>3]=+((0|r[e>>2])-i|0)-.5*n,o[t+8>>3]=.8660254037844386*n}function Y(e,t,n){e|=0,t|=0,r[(n|=0)>>2]=(0|r[t>>2])+(0|r[e>>2]),r[n+4>>2]=(0|r[t+4>>2])+(0|r[e+4>>2]),r[n+8>>2]=(0|r[t+8>>2])+(0|r[e+8>>2])}function K(e,t,n){e|=0,t|=0,r[(n|=0)>>2]=(0|r[e>>2])-(0|r[t>>2]),r[n+4>>2]=(0|r[e+4>>2])-(0|r[t+4>>2]),r[n+8>>2]=(0|r[e+8>>2])-(0|r[t+8>>2])}function J(e,t){t|=0;var n,i=0;i=0|_(0|r[(e|=0)>>2],t),r[e>>2]=i,n=0|_(0|r[(i=e+4|0)>>2],t),r[i>>2]=n,t=0|_(0|r[(e=e+8|0)>>2],t),r[e>>2]=t}function ee(e){var t,n,i=0,o=0,s=0,a=0,l=0;l=(0|(n=0|r[(e|=0)>>2]))<0,e=(e=(o=(0|(a=((t=(0|(s=(0|r[e+4>>2])-(l?n:0)|0))<0)?0-s|0:0)+((0|r[e+8>>2])-(l?n:0))|0))<0)?0:a)-((s=(0|(o=(0|e)<(0|(o=(0|(i=(t?0:s)-(o?a:0)|0))<(0|(a=(l?0:n)-(t?s:0)-(o?a:0)|0))?i:a))?e:o))>0)?o:0)|0,i=i-(s?o:0)|0;e:do{switch(a-(s?o:0)|0){case 0:switch(0|i){case 0:return 0|(l=0==(0|e)?0:1==(0|e)?1:7);case 1:return 0|(l=0==(0|e)?2:1==(0|e)?3:7);default:break e}case 1:switch(0|i){case 0:return 0|(l=0==(0|e)?4:1==(0|e)?5:7);case 1:if(e)break e;return 0|(e=6);default:break e}}}while(0);return 0|(l=7)}function te(e){var t,n,i=0,o=0,s=0,a=0,l=0;o=0|r[(t=(e|=0)+8|0)>>2],s=0|mt(+((3*(i=(0|r[e>>2])-o|0)|0)-(o=(0|r[(n=e+4|0)>>2])-o|0)|0)/7),r[e>>2]=s,i=0|mt(+((o<<1)+i|0)/7),r[n>>2]=i,r[t>>2]=0,o=i-s|0,(0|s)<0?(l=0-s|0,r[n>>2]=o,r[t>>2]=l,r[e>>2]=0,i=o,s=0,o=l):o=0,(0|i)<0&&(s=s-i|0,r[e>>2]=s,o=o-i|0,r[t>>2]=o,r[n>>2]=0,i=0),l=s-o|0,a=i-o|0,(0|o)<0?(r[e>>2]=l,r[n>>2]=a,r[t>>2]=0,i=a,a=l,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|i)<(0|a)?i:a))?o:s))<=0||(r[e>>2]=a-s,r[n>>2]=i-s,r[t>>2]=o-s)}function ne(e){var t,n,i=0,o=0,s=0,a=0,l=0;o=0|r[(t=(e|=0)+8|0)>>2],s=0|mt(+(((i=(0|r[e>>2])-o|0)<<1)+(o=(0|r[(n=e+4|0)>>2])-o|0)|0)/7),r[e>>2]=s,i=0|mt(+((3*o|0)-i|0)/7),r[n>>2]=i,r[t>>2]=0,o=i-s|0,(0|s)<0?(l=0-s|0,r[n>>2]=o,r[t>>2]=l,r[e>>2]=0,i=o,s=0,o=l):o=0,(0|i)<0&&(s=s-i|0,r[e>>2]=s,o=o-i|0,r[t>>2]=o,r[n>>2]=0,i=0),l=s-o|0,a=i-o|0,(0|o)<0?(r[e>>2]=l,r[n>>2]=a,r[t>>2]=0,i=a,a=l,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|i)<(0|a)?i:a))?o:s))<=0||(r[e>>2]=a-s,r[n>>2]=i-s,r[t>>2]=o-s)}function ie(e){var t,n,i,o=0,s=0,a=0,l=0;o=0|r[(e|=0)>>2],s=0|r[(n=e+4|0)>>2],a=0|r[(i=e+8|0)>>2],l=s+(3*o|0)|0,r[e>>2]=l,s=a+(3*s|0)|0,r[n>>2]=s,o=(3*a|0)+o|0,r[i>>2]=o,a=s-l|0,(0|l)<0?(o=o-l|0,r[n>>2]=a,r[i>>2]=o,r[e>>2]=0,s=a,a=0):a=l,(0|s)<0&&(a=a-s|0,r[e>>2]=a,o=o-s|0,r[i>>2]=o,r[n>>2]=0,s=0),t=a-o|0,l=s-o|0,(0|o)<0?(r[e>>2]=t,r[n>>2]=l,r[i>>2]=0,a=t,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(r[e>>2]=a-s,r[n>>2]=l-s,r[i>>2]=o-s)}function re(e){var t,n,i,o=0,s=0,a=0,l=0;l=0|r[(e|=0)>>2],a=(3*(o=0|r[(n=e+4|0)>>2])|0)+l|0,l=(s=0|r[(i=e+8|0)>>2])+(3*l|0)|0,r[e>>2]=l,r[n>>2]=a,o=(3*s|0)+o|0,r[i>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,r[n>>2]=s,r[i>>2]=o,r[e>>2]=0,l=0):s=a,(0|s)<0&&(l=l-s|0,r[e>>2]=l,o=o-s|0,r[i>>2]=o,r[n>>2]=0,s=0),t=l-o|0,a=s-o|0,(0|o)<0?(r[e>>2]=t,r[n>>2]=a,r[i>>2]=0,l=t,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|a)<(0|l)?a:l))?o:s))<=0||(r[e>>2]=l-s,r[n>>2]=a-s,r[i>>2]=o-s)}function oe(e,t){e|=0;var n,i,o,s=0,a=0,l=0;((t|=0)+-1|0)>>>0>=6||(l=(0|r[15472+(12*t|0)>>2])+(0|r[e>>2])|0,r[e>>2]=l,o=e+4|0,a=(0|r[15472+(12*t|0)+4>>2])+(0|r[o>>2])|0,r[o>>2]=a,i=e+8|0,t=(0|r[15472+(12*t|0)+8>>2])+(0|r[i>>2])|0,r[i>>2]=t,s=a-l|0,(0|l)<0?(t=t-l|0,r[o>>2]=s,r[i>>2]=t,r[e>>2]=0,a=0):(s=a,a=l),(0|s)<0&&(a=a-s|0,r[e>>2]=a,t=t-s|0,r[i>>2]=t,r[o>>2]=0,s=0),n=a-t|0,l=s-t|0,(0|t)<0?(r[e>>2]=n,r[o>>2]=l,r[i>>2]=0,a=n,t=0):l=s,(0|(s=(0|t)<(0|(s=(0|l)<(0|a)?l:a))?t:s))<=0||(r[e>>2]=a-s,r[o>>2]=l-s,r[i>>2]=t-s))}function se(e){var t,n,i,o=0,s=0,a=0,l=0;l=0|r[(e|=0)>>2],a=(o=0|r[(n=e+4|0)>>2])+l|0,l=(s=0|r[(i=e+8|0)>>2])+l|0,r[e>>2]=l,r[n>>2]=a,o=s+o|0,r[i>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,r[n>>2]=s,r[i>>2]=o,r[e>>2]=0,a=0):(s=a,a=l),(0|s)<0&&(a=a-s|0,r[e>>2]=a,o=o-s|0,r[i>>2]=o,r[n>>2]=0,s=0),t=a-o|0,l=s-o|0,(0|o)<0?(r[e>>2]=t,r[n>>2]=l,r[i>>2]=0,a=t,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(r[e>>2]=a-s,r[n>>2]=l-s,r[i>>2]=o-s)}function ae(e){var t,n,i,o=0,s=0,a=0,l=0;o=0|r[(e|=0)>>2],a=0|r[(n=e+4|0)>>2],s=0|r[(i=e+8|0)>>2],l=a+o|0,r[e>>2]=l,a=s+a|0,r[n>>2]=a,o=s+o|0,r[i>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,r[n>>2]=s,r[i>>2]=o,r[e>>2]=0,a=0):(s=a,a=l),(0|s)<0&&(a=a-s|0,r[e>>2]=a,o=o-s|0,r[i>>2]=o,r[n>>2]=0,s=0),t=a-o|0,l=s-o|0,(0|o)<0?(r[e>>2]=t,r[n>>2]=l,r[i>>2]=0,a=t,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(r[e>>2]=a-s,r[n>>2]=l-s,r[i>>2]=o-s)}function le(e){switch(0|(e|=0)){case 1:e=5;break;case 5:e=4;break;case 4:e=6;break;case 6:e=2;break;case 2:e=3;break;case 3:e=1}return 0|e}function ce(e){switch(0|(e|=0)){case 1:e=3;break;case 3:e=2;break;case 2:e=6;break;case 6:e=4;break;case 4:e=5;break;case 5:e=1}return 0|e}function ue(e){var t,n,i,o=0,s=0,a=0,l=0;o=0|r[(e|=0)>>2],s=0|r[(n=e+4|0)>>2],a=0|r[(i=e+8|0)>>2],l=s+(o<<1)|0,r[e>>2]=l,s=a+(s<<1)|0,r[n>>2]=s,o=(a<<1)+o|0,r[i>>2]=o,a=s-l|0,(0|l)<0?(o=o-l|0,r[n>>2]=a,r[i>>2]=o,r[e>>2]=0,s=a,a=0):a=l,(0|s)<0&&(a=a-s|0,r[e>>2]=a,o=o-s|0,r[i>>2]=o,r[n>>2]=0,s=0),t=a-o|0,l=s-o|0,(0|o)<0?(r[e>>2]=t,r[n>>2]=l,r[i>>2]=0,a=t,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(r[e>>2]=a-s,r[n>>2]=l-s,r[i>>2]=o-s)}function he(e){var t,n,i,o=0,s=0,a=0,l=0;l=0|r[(e|=0)>>2],a=((o=0|r[(n=e+4|0)>>2])<<1)+l|0,l=(s=0|r[(i=e+8|0)>>2])+(l<<1)|0,r[e>>2]=l,r[n>>2]=a,o=(s<<1)+o|0,r[i>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,r[n>>2]=s,r[i>>2]=o,r[e>>2]=0,l=0):s=a,(0|s)<0&&(l=l-s|0,r[e>>2]=l,o=o-s|0,r[i>>2]=o,r[n>>2]=0,s=0),t=l-o|0,a=s-o|0,(0|o)<0?(r[e>>2]=t,r[n>>2]=a,r[i>>2]=0,l=t,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|a)<(0|l)?a:l))?o:s))<=0||(r[e>>2]=l-s,r[n>>2]=a-s,r[i>>2]=o-s)}function de(e,t){t|=0;var n,i,o,s=0,a=0,l=0;return o=(0|(i=(0|r[(e|=0)>>2])-(0|r[t>>2])|0))<0,n=(0|(a=(0|r[e+4>>2])-(0|r[t+4>>2])-(o?i:0)|0))<0,t=(t=(e=(0|(l=(o?0-i|0:0)+(0|r[e+8>>2])-(0|r[t+8>>2])+(n?0-a|0:0)|0))<0)?0:l)-((a=(0|(e=(0|t)<(0|(e=(0|(s=(n?0:a)-(e?l:0)|0))<(0|(l=(o?0:i)-(n?a:0)-(e?l:0)|0))?s:l))?t:e))>0)?e:0)|0,s=s-(a?e:0)|0,0|((0|(e=(0|(e=l-(a?e:0)|0))>-1?e:0-e|0))>(0|(t=(0|(s=(0|s)>-1?s:0-s|0))>(0|(t=(0|t)>-1?t:0-t|0))?s:t))?e:t)}function fe(e,t){t|=0;var n;n=0|r[(e|=0)+8>>2],r[t>>2]=(0|r[e>>2])-n,r[t+4>>2]=(0|r[e+4>>2])-n}function pe(e,t){t|=0;var n,i,o,s=0,a=0,l=0;a=0|r[(e|=0)>>2],r[t>>2]=a,e=0|r[e+4>>2],r[(i=t+4|0)>>2]=e,r[(o=t+8|0)>>2]=0,s=e-a|0,(0|a)<0?(e=0-a|0,r[i>>2]=s,r[o>>2]=e,r[t>>2]=0,a=0):(s=e,e=0),(0|s)<0&&(a=a-s|0,r[t>>2]=a,e=e-s|0,r[o>>2]=e,r[i>>2]=0,s=0),n=a-e|0,l=s-e|0,(0|e)<0?(r[t>>2]=n,r[i>>2]=l,r[o>>2]=0,s=l,l=n,e=0):l=a,(0|(a=(0|e)<(0|(a=(0|s)<(0|l)?s:l))?e:a))<=0||(r[t>>2]=l-a,r[i>>2]=s-a,r[o>>2]=e-a)}function Ae(e){var t,n,i,o;n=(o=0|r[(t=(e|=0)+8|0)>>2])-(0|r[e>>2])|0,r[e>>2]=n,e=(0|r[(i=e+4|0)>>2])-o|0,r[i>>2]=e,r[t>>2]=0-(e+n)}function me(e){var t,n,i=0,o=0,s=0,a=0,l=0;i=0-(o=0|r[(e|=0)>>2])|0,r[e>>2]=i,r[(t=e+8|0)>>2]=0,a=(s=0|r[(n=e+4|0)>>2])+o|0,(0|o)>0?(r[n>>2]=a,r[t>>2]=o,r[e>>2]=0,i=0,s=a):o=0,(0|s)<0?(l=i-s|0,r[e>>2]=l,o=o-s|0,r[t>>2]=o,r[n>>2]=0,a=l-o|0,i=0-o|0,(0|o)<0?(r[e>>2]=a,r[n>>2]=i,r[t>>2]=0,s=i,o=0):(s=0,a=l)):a=i,(0|(i=(0|o)<(0|(i=(0|s)<(0|a)?s:a))?o:i))<=0||(r[e>>2]=a-i,r[n>>2]=s-i,r[t>>2]=o-i)}function ge(e,t,n,i){t|=0,n|=0,i|=0;var s,a=0,l=0,c=0,u=0;if(s=M,M=M+32|0,function(e,t){t|=0;var n=0,i=0,r=0;n=+o[(e=e|0)>>3],i=+h(+n),n=+d(+n),o[t+16>>3]=n,n=+o[e+8>>3],r=i*+h(+n),o[t>>3]=r,n=i*+d(+n),o[t+8>>3]=n}(e|=0,l=s),r[n>>2]=0,a=+lt(15888,l),(c=+lt(15912,l))<a&&(r[n>>2]=1,a=c),(c=+lt(15936,l))<a&&(r[n>>2]=2,a=c),(c=+lt(15960,l))<a&&(r[n>>2]=3,a=c),(c=+lt(15984,l))<a&&(r[n>>2]=4,a=c),(c=+lt(16008,l))<a&&(r[n>>2]=5,a=c),(c=+lt(16032,l))<a&&(r[n>>2]=6,a=c),(c=+lt(16056,l))<a&&(r[n>>2]=7,a=c),(c=+lt(16080,l))<a&&(r[n>>2]=8,a=c),(c=+lt(16104,l))<a&&(r[n>>2]=9,a=c),(c=+lt(16128,l))<a&&(r[n>>2]=10,a=c),(c=+lt(16152,l))<a&&(r[n>>2]=11,a=c),(c=+lt(16176,l))<a&&(r[n>>2]=12,a=c),(c=+lt(16200,l))<a&&(r[n>>2]=13,a=c),(c=+lt(16224,l))<a&&(r[n>>2]=14,a=c),(c=+lt(16248,l))<a&&(r[n>>2]=15,a=c),(c=+lt(16272,l))<a&&(r[n>>2]=16,a=c),(c=+lt(16296,l))<a&&(r[n>>2]=17,a=c),(c=+lt(16320,l))<a&&(r[n>>2]=18,a=c),(c=+lt(16344,l))<a&&(r[n>>2]=19,a=c),(c=+p(+(1-.5*a)))<1e-16)return r[i>>2]=0,r[i+4>>2]=0,r[i+8>>2]=0,r[i+12>>2]=0,void(M=s);if(n=0|r[n>>2],a=+Te((a=+o[16368+(24*n|0)>>3])-+Te(+function(e,t){e|=0;var n=0,i=0,r=0,s=0,a=0;return s=+o[(t=t|0)>>3],i=+h(+s),r=+o[t+8>>3]-+o[e+8>>3],a=i*+d(+r),n=+o[e>>3],+ +g(+a,+(+d(+s)*+h(+n)-+h(+r)*(i*+d(+n))))}(15568+(n<<4)|0,e))),u=0|Ue(t)?+Te(a+-.3334731722518321):a,a=+f(+c)/.381966011250105,(0|t)>0){l=0;do{a*=2.6457513110645907,l=l+1|0}while((0|l)!=(0|t))}c=+h(+u)*a,o[i>>3]=c,u=+d(+u)*a,o[i+8>>3]=u,M=s}function ye(e,t,n,i,s){t|=0,n|=0,i|=0,s|=0;var a=0,u=0;if(a=+function(e){var t=0,n=0;return n=+o[(e=e|0)>>3],t=+o[e+8>>3],+ +c(+(n*n+t*t))}(e|=0),a<1e-16)return t=15568+(t<<4)|0,r[s>>2]=r[t>>2],r[s+4>>2]=r[t+4>>2],r[s+8>>2]=r[t+8>>2],void(r[s+12>>2]=r[t+12>>2]);if(u=+g(+ +o[e+8>>3],+ +o[e>>3]),(0|n)>0){e=0;do{a/=2.6457513110645907,e=e+1|0}while((0|e)!=(0|n))}i?(a/=3,n=0==(0|Ue(n)),a=+m(.381966011250105*(n?a:a/2.6457513110645907))):(a=+m(.381966011250105*a),0|Ue(n)&&(u=+Te(u+.3334731722518321))),function(e,t,n,i){e|=0,t=+t,i|=0;var s=0,a=0,c=0,u=0;if((n=+n)<1e-16)return r[i>>2]=r[e>>2],r[i+4>>2]=r[e+4>>2],r[i+8>>2]=r[e+8>>2],void(r[i+12>>2]=r[e+12>>2]);a=t<0?t+6.283185307179586:t,a=t>=6.283185307179586?a+-6.283185307179586:a;do{if(!(a<1e-16)){if(s=+l(+(a+-3.141592653589793))<1e-16,t=+o[e>>3],s){t-=n,o[i>>3]=t,s=i;break}if(c=+h(+n),n=+d(+n),t=c*+d(+t)+ +h(+a)*(n*+h(+t)),t=+A(+((t=t>1?1:t)<-1?-1:t)),o[i>>3]=t,+l(+(t+-1.5707963267948966))<1e-16)return o[i>>3]=1.5707963267948966,void(o[i+8>>3]=0);if(+l(+(t+1.5707963267948966))<1e-16)return o[i>>3]=-1.5707963267948966,void(o[i+8>>3]=0);if(u=+h(+t),a=n*+d(+a)/u,n=+o[e>>3],t=(c-+d(+t)*+d(+n))/+h(+n)/u,c=a>1?1:a,t=t>1?1:t,(t=+o[e+8>>3]+ +g(+(c<-1?-1:c),+(t<-1?-1:t)))>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);return void(o[i+8>>3]=t)}t=+o[e>>3]+n,o[i>>3]=t,s=i}while(0);if(+l(+(t+-1.5707963267948966))<1e-16)return o[s>>3]=1.5707963267948966,void(o[i+8>>3]=0);if(+l(+(t+1.5707963267948966))<1e-16)return o[s>>3]=-1.5707963267948966,void(o[i+8>>3]=0);if((t=+o[e+8>>3])>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);o[i+8>>3]=t}(15568+(t<<4)|0,+Te(+o[16368+(24*t|0)>>3]-u),a,s)}function _e(e,t,n){t|=0,n|=0;var i,o;i=M,M=M+16|0,X((e|=0)+4|0,o=i),ye(o,0|r[e>>2],t,0,n),M=i}function ve(e,t,n,i,s){e|=0,t|=0,n|=0,i|=0,s|=0;var a,l,c,u,h,d,f,p,A,m,g,y,_,v,b,x,w,S,T,k,C,P,I=0,L=0,R=0,z=0,D=0,O=0;if(P=M,M=M+272|0,z=P+240|0,T=P,k=P+224|0,C=P+208|0,g=P+176|0,y=P+160|0,_=P+192|0,v=P+144|0,b=P+128|0,x=P+112|0,w=P+96|0,S=P+80|0,r[(I=P+256|0)>>2]=t,r[z>>2]=r[e>>2],r[z+4>>2]=r[e+4>>2],r[z+8>>2]=r[e+8>>2],r[z+12>>2]=r[e+12>>2],be(z,I,T),r[s>>2]=0,(0|(z=i+n+(5==(0|i)&1)|0))<=(0|n))M=P;else{l=k+4|0,c=g+4|0,u=n+5|0,h=16848+((a=0|r[I>>2])<<2)|0,d=16928+(a<<2)|0,f=b+8|0,p=x+8|0,A=w+8|0,m=C+4|0,R=n;e:for(;;){L=T+(((0|R)%5|0)<<4)|0,r[C>>2]=r[L>>2],r[C+4>>2]=r[L+4>>2],r[C+8>>2]=r[L+8>>2],r[C+12>>2]=r[L+12>>2];do{}while(2==(0|xe(C,a,0,1)));if((0|R)>(0|n)&0!=(0|Ue(t))){if(r[g>>2]=r[C>>2],r[g+4>>2]=r[C+4>>2],r[g+8>>2]=r[C+8>>2],r[g+12>>2]=r[C+12>>2],X(l,y),i=0|r[g>>2],I=0|r[17008+(80*i|0)+(r[k>>2]<<2)>>2],r[g>>2]=r[18608+(80*i|0)+(20*I|0)>>2],(0|(L=0|r[18608+(80*i|0)+(20*I|0)+16>>2]))>0){e=0;do{se(c),e=e+1|0}while((0|e)<(0|L))}switch(L=18608+(80*i|0)+(20*I|0)+4|0,r[_>>2]=r[L>>2],r[_+4>>2]=r[L+4>>2],r[_+8>>2]=r[L+8>>2],J(_,3*(0|r[h>>2])|0),Y(c,_,c),Q(c),X(c,v),D=+(0|r[d>>2]),o[b>>3]=3*D,o[f>>3]=0,O=-1.5*D,o[x>>3]=O,o[p>>3]=2.598076211353316*D,o[w>>3]=O,o[A>>3]=-2.598076211353316*D,0|r[17008+(80*(0|r[g>>2])|0)+(r[C>>2]<<2)>>2]){case 1:e=x,i=b;break;case 3:e=w,i=x;break;case 2:e=b,i=w;break;default:e=12;break e}st(y,v,i,e,S),ye(S,0|r[g>>2],a,1,s+8+(r[s>>2]<<4)|0),r[s>>2]=1+(0|r[s>>2])}if((0|R)<(0|u)&&(X(m,g),ye(g,0|r[C>>2],a,1,s+8+(r[s>>2]<<4)|0),r[s>>2]=1+(0|r[s>>2])),r[k>>2]=r[C>>2],r[k+4>>2]=r[C+4>>2],r[k+8>>2]=r[C+8>>2],r[k+12>>2]=r[C+12>>2],(0|(R=R+1|0))>=(0|z)){e=3;break}}3!=(0|e)?12==(0|e)&&E(22474,22521,581,22531):M=P}}function be(e,t,n){e|=0,t|=0,n|=0;var i,o=0,s=0,a=0,l=0,c=0;i=M,M=M+128|0,s=i,l=20208,c=(a=o=i+64|0)+60|0;do{r[a>>2]=r[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));l=20272,c=(a=s)+60|0;do{r[a>>2]=r[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));o=(c=0==(0|Ue(0|r[t>>2])))?o:s,ue(s=e+4|0),he(s),0|Ue(0|r[t>>2])&&(re(s),r[t>>2]=1+(0|r[t>>2])),r[n>>2]=r[e>>2],Y(s,o,t=n+4|0),Q(t),r[n+16>>2]=r[e>>2],Y(s,o+12|0,t=n+20|0),Q(t),r[n+32>>2]=r[e>>2],Y(s,o+24|0,t=n+36|0),Q(t),r[n+48>>2]=r[e>>2],Y(s,o+36|0,t=n+52|0),Q(t),r[n+64>>2]=r[e>>2],Y(s,o+48|0,n=n+68|0),Q(n),M=i}function xe(e,t,n,i){n|=0,i|=0;var o,s,a,l,c,u,h=0,d=0,f=0,p=0,A=0;if(u=M,M=M+32|0,c=u+12|0,s=u,A=(e|=0)+4|0,p=0|r[16928+((t|=0)<<2)>>2],p=(l=0!=(0|i))?3*p|0:p,h=0|r[A>>2],o=0|r[(a=e+8|0)>>2],l){if((0|(h=o+h+(i=0|r[(d=e+12|0)>>2])|0))==(0|p))return M=u,0|(A=1);f=d}else h=o+h+(i=0|r[(f=e+12|0)>>2])|0;if((0|h)<=(0|p))return M=u,0|(A=0);do{if((0|i)>0){if(i=0|r[e>>2],(0|o)>0){d=18608+(80*i|0)+60|0,i=e;break}i=18608+(80*i|0)+40|0,n?(Z(c,p,0,0),K(A,c,s),ae(s),Y(s,c,A),d=i,i=e):(d=i,i=e)}else d=18608+(80*(0|r[e>>2])|0)+20|0,i=e}while(0);if(r[i>>2]=r[d>>2],(0|r[(h=d+16|0)>>2])>0){i=0;do{se(A),i=i+1|0}while((0|i)<(0|r[h>>2]))}return e=d+4|0,r[c>>2]=r[e>>2],r[c+4>>2]=r[e+4>>2],r[c+8>>2]=r[e+8>>2],t=0|r[16848+(t<<2)>>2],J(c,l?3*t|0:t),Y(A,c,A),Q(A),i=l&&((0|r[a>>2])+(0|r[A>>2])+(0|r[f>>2])|0)==(0|p)?1:2,M=u,0|(A=i)}function we(e,t){e|=0,t|=0;var n=0;do{n=0|xe(e,t,0,1)}while(2==(0|n));return 0|n}function Ee(e,t,n,i,s){e|=0,t|=0,n|=0,i|=0,s|=0;var a,l,c,u,h,d,f,p,A,m,g,y,_,v,b,x,w,S,T=0,k=0,C=0,P=0,I=0;if(S=M,M=M+240|0,v=S+208|0,b=S,x=S+192|0,w=S+176|0,A=S+160|0,m=S+144|0,g=S+128|0,y=S+112|0,_=S+96|0,r[(T=S+224|0)>>2]=t,r[v>>2]=r[e>>2],r[v+4>>2]=r[e+4>>2],r[v+8>>2]=r[e+8>>2],r[v+12>>2]=r[e+12>>2],Se(v,T,b),r[s>>2]=0,(0|(p=i+n+(6==(0|i)&1)|0))<=(0|n))M=S;else{l=n+6|0,c=16928+((a=0|r[T>>2])<<2)|0,u=m+8|0,h=g+8|0,d=y+8|0,f=x+4|0,k=0,C=n,i=-1;e:for(;;){if(e=b+((T=(0|C)%6|0)<<4)|0,r[x>>2]=r[e>>2],r[x+4>>2]=r[e+4>>2],r[x+8>>2]=r[e+8>>2],r[x+12>>2]=r[e+12>>2],e=k,k=0|xe(x,a,0,1),(0|C)>(0|n)&0!=(0|Ue(t))&&(1!=(0|e)&&(0|r[x>>2])!=(0|i))){switch(X(b+(((T+5|0)%6|0)<<4)+4|0,w),X(b+(T<<4)+4|0,A),P=+(0|r[c>>2]),o[m>>3]=3*P,o[u>>3]=0,I=-1.5*P,o[g>>3]=I,o[h>>3]=2.598076211353316*P,o[y>>3]=I,o[d>>3]=-2.598076211353316*P,T=0|r[v>>2],0|r[17008+(80*T|0)+(((0|i)==(0|T)?0|r[x>>2]:i)<<2)>>2]){case 1:e=g,i=m;break;case 3:e=y,i=g;break;case 2:e=m,i=y;break;default:e=8;break e}st(w,A,i,e,_),0|at(w,_)||0|at(A,_)||(ye(_,0|r[v>>2],a,1,s+8+(r[s>>2]<<4)|0),r[s>>2]=1+(0|r[s>>2]))}if((0|C)<(0|l)&&(X(f,w),ye(w,0|r[x>>2],a,1,s+8+(r[s>>2]<<4)|0),r[s>>2]=1+(0|r[s>>2])),(0|(C=C+1|0))>=(0|p)){e=3;break}i=0|r[x>>2]}3!=(0|e)?8==(0|e)&&E(22557,22521,746,22602):M=S}}function Se(e,t,n){e|=0,t|=0,n|=0;var i,o=0,s=0,a=0,l=0,c=0;i=M,M=M+160|0,s=i,l=20336,c=(a=o=i+80|0)+72|0;do{r[a>>2]=r[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));l=20416,c=(a=s)+72|0;do{r[a>>2]=r[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));o=(c=0==(0|Ue(0|r[t>>2])))?o:s,ue(s=e+4|0),he(s),0|Ue(0|r[t>>2])&&(re(s),r[t>>2]=1+(0|r[t>>2])),r[n>>2]=r[e>>2],Y(s,o,t=n+4|0),Q(t),r[n+16>>2]=r[e>>2],Y(s,o+12|0,t=n+20|0),Q(t),r[n+32>>2]=r[e>>2],Y(s,o+24|0,t=n+36|0),Q(t),r[n+48>>2]=r[e>>2],Y(s,o+36|0,t=n+52|0),Q(t),r[n+64>>2]=r[e>>2],Y(s,o+48|0,t=n+68|0),Q(t),r[n+80>>2]=r[e>>2],Y(s,o+60|0,n=n+84|0),Q(n),M=i}function Te(e){var t;return t=(e=+e)<0?e+6.283185307179586:e,+(e>=6.283185307179586?t+-6.283185307179586:t)}function ke(e,t){return t|=0,+l(+(+o[(e|=0)>>3]-+o[t>>3]))<17453292519943298e-27?0|(t=+l(+(+o[e+8>>3]-+o[t+8>>3]))<17453292519943298e-27):0|(t=0)}function Ce(e,t){e|=0;var n,i,r,s=0;return i=+o[(t|=0)>>3],n=+o[e>>3],s=(r=+d(.5*(i-n)))*r+(s=+d(.5*(+o[t+8>>3]-+o[e+8>>3])))*(+h(+i)*+h(+n)*s),2*+g(+ +c(+s),+ +c(+(1-s)))*6371.007180918475}function Pe(e,t,n){e|=0,n|=0;var i,r,s,a,l=0,u=0,p=0,A=0,y=0,_=0;return _=+o[(t|=0)>>3],s=+o[e>>3],y=+d(.5*(_-s)),p=+o[t+8>>3],r=+o[e+8>>3],A=+d(.5*(p-r)),i=+h(+s),a=+h(+_),A=2*+g(+ +c(+(A=y*y+A*(a*i*A))),+ +c(+(1-A))),y=+o[n>>3],_=+d(.5*(y-_)),l=+o[n+8>>3],p=+d(.5*(l-p)),u=+h(+y),p=2*+g(+ +c(+(p=_*_+p*(a*u*p))),+ +c(+(1-p))),y=+d(.5*(s-y)),l=+d(.5*(r-l)),l=2*+g(+ +c(+(l=y*y+l*(i*u*l))),+ +c(+(1-l))),4*+m(+ +c(+ +f(.5*(u=.5*(A+p+l)))*+f(.5*(u-A))*+f(.5*(u-p))*+f(.5*(u-l))))}function Me(e,t){return t=0|Et(0|(e|=0),0|(t|=0),45),w(),127&t|0}function Ie(e,t){var n=0,i=0,r=0,o=0,s=0,a=0;if(!(!0&134217728==(-16777216&(t|=0)|0)))return 0|(t=0);if(s=0|Et(0|(e|=0),0|t,45),w(),(s&=127)>>>0>121)return 0|(t=0);n=0|Et(0|e,0|t,52),w(),n&=15;do{if(0|n){for(r=1,i=0;;){if(o=0|Et(0|e,0|t,3*(15-r|0)|0),w(),0!=(0|(o&=7))&(1^i)){if(1==(0|o)&0!=(0|O(s))){a=0,i=13;break}i=1}if(7==(0|o)){a=0,i=13;break}if(!(r>>>0<n>>>0)){i=9;break}r=r+1|0}if(9==(0|i)){if(15!=(0|n))break;return 0|(a=1)}if(13==(0|i))return 0|a}}while(0);for(;;){if(a=0|Et(0|e,0|t,3*(14-n|0)|0),w(),!(7==(7&a|0)&!0)){a=0,i=13;break}if(!(n>>>0<14)){a=1,i=13;break}n=n+1|0}return 13==(0|i)?0|a:0}function Le(e,t,n){n|=0;var i=0,r=0;if(i=0|Et(0|(e|=0),0|(t|=0),52),w(),(0|(i&=15))>=(0|n)){if((0|i)!=(0|n))if(n>>>0<=15){if(e|=r=0|St(0|n,0,52),t=0|w()|-15728641&t,(0|i)>(0|n))do{r=0|St(7,0,3*(14-n|0)|0),n=n+1|0,e|=r,t=0|w()|t}while((0|n)<(0|i))}else t=0,e=0}else t=0,e=0;return x(0|t),0|e}function Re(e,t,n,i){n|=0,i|=0;var o,s=0,a=0,l=0,c=0,u=0,h=0;if(l=0|Et(0|(e|=0),0|(t|=0),52),w(),(0|n)<16&(0|(l&=15))<=(0|n)){if((0|l)==(0|n))return r[(n=i)>>2]=e,void(r[n+4>>2]=t);if(o=(0|(u=0|tt(7,n-l|0)))/7|0,c=0|Et(0|e,0|t,45),w(),0|O(127&c)){e:do{if(l)for(a=1;;){if(s=0|Et(0|e,0|t,3*(15-a|0)|0),w(),0|(s&=7))break e;if(!(a>>>0<l>>>0)){s=0;break}a=a+1|0}else s=0}while(0);a=0==(0|s)}else a=0;if(h=0|St(l+1|0,0,52),s=0|w()|-15728641&t,Re(t=(h|e)&~(t=0|St(7,0,0|(c=3*(14-l|0)|0))),l=s&~(0|w()),n,i),s=i+(o<<3)|0,!a)return Re((h=0|St(1,0,0|c))|t,0|w()|l,n,s),h=s+(o<<3)|0,Re((u=0|St(2,0,0|c))|t,0|w()|l,n,h),h=h+(o<<3)|0,Re((u=0|St(3,0,0|c))|t,0|w()|l,n,h),h=h+(o<<3)|0,Re((u=0|St(4,0,0|c))|t,0|w()|l,n,h),h=h+(o<<3)|0,Re((u=0|St(5,0,0|c))|t,0|w()|l,n,h),void Re((u=0|St(6,0,0|c))|t,0|w()|l,n,h+(o<<3)|0);a=s+(o<<3)|0,(0|u)>6&&(Pt(0|s,0,(h=(a>>>0>(u=s+8|0)>>>0?a:u)+-1+(0-s)|0)+8&-8|0),s=u+(h>>>3<<3)|0),Re((h=0|St(2,0,0|c))|t,0|w()|l,n,s),h=s+(o<<3)|0,Re((u=0|St(3,0,0|c))|t,0|w()|l,n,h),h=h+(o<<3)|0,Re((u=0|St(4,0,0|c))|t,0|w()|l,n,h),h=h+(o<<3)|0,Re((u=0|St(5,0,0|c))|t,0|w()|l,n,h),Re((u=0|St(6,0,0|c))|t,0|w()|l,n,h+(o<<3)|0)}}function ze(e,t){var n=0,i=0,r=0;if(r=0|Et(0|(e|=0),0|(t|=0),45),w(),!(0|O(127&r)))return 0|(r=0);r=0|Et(0|e,0|t,52),w(),r&=15;e:do{if(r)for(i=1;;){if(n=0|Et(0|e,0|t,3*(15-i|0)|0),w(),0|(n&=7))break e;if(!(i>>>0<r>>>0)){n=0;break}i=i+1|0}else n=0}while(0);return 0|(r=0==(0|n)&1)}function De(e,t){var n=0,i=0,r=0;if(r=0|Et(0|(e|=0),0|(t|=0),52),w(),!(r&=15))return 0|(r=0);for(i=1;;){if(n=0|Et(0|e,0|t,3*(15-i|0)|0),w(),0|(n&=7)){i=5;break}if(!(i>>>0<r>>>0)){n=0,i=5;break}i=i+1|0}return 5==(0|i)?0|n:0}function Oe(e,t){var n=0,i=0,r=0,o=0,s=0,a=0,l=0;if(l=0|Et(0|(e|=0),0|(t|=0),52),w(),!(l&=15))return l=e,x(0|(a=t)),0|l;for(a=1,n=0;;){i=0|St(7,0,0|(o=3*(15-a|0)|0)),r=0|w(),s=0|Et(0|e,0|t,0|o),w(),e=(o=0|St(0|le(7&s),0,0|o))|e&~i,t=(s=0|w())|t&~r;e:do{if(!n)if(0==(o&i|0)&0==(s&r|0))n=0;else if(i=0|Et(0|e,0|t,52),w(),i&=15){n=1;t:for(;;){switch(s=0|Et(0|e,0|t,3*(15-n|0)|0),w(),7&s){case 1:break t;case 0:break;default:n=1;break e}if(!(n>>>0<i>>>0)){n=1;break e}n=n+1|0}for(n=1;;){if(r=0|Et(0|e,0|t,0|(s=3*(15-n|0)|0)),w(),o=0|St(7,0,0|s),t&=~(0|w()),e=e&~o|(s=0|St(0|le(7&r),0,0|s)),t=0|t|w(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return x(0|t),0|e}function Be(e,t){var n=0,i=0,r=0,o=0,s=0;if(i=0|Et(0|(e|=0),0|(t|=0),52),w(),!(i&=15))return i=e,x(0|(n=t)),0|i;for(n=1;s=0|Et(0|e,0|t,0|(o=3*(15-n|0)|0)),w(),r=0|St(7,0,0|o),t&=~(0|w()),e=(o=0|St(0|le(7&s),0,0|o))|e&~r,t=0|w()|t,n>>>0<i>>>0;)n=n+1|0;return x(0|t),0|e}function Fe(e,t){var n=0,i=0,r=0,o=0,s=0,a=0,l=0;if(l=0|Et(0|(e|=0),0|(t|=0),52),w(),!(l&=15))return l=e,x(0|(a=t)),0|l;for(a=1,n=0;;){i=0|St(7,0,0|(o=3*(15-a|0)|0)),r=0|w(),s=0|Et(0|e,0|t,0|o),w(),e=(o=0|St(0|ce(7&s),0,0|o))|e&~i,t=(s=0|w())|t&~r;e:do{if(!n)if(0==(o&i|0)&0==(s&r|0))n=0;else if(i=0|Et(0|e,0|t,52),w(),i&=15){n=1;t:for(;;){switch(s=0|Et(0|e,0|t,3*(15-n|0)|0),w(),7&s){case 1:break t;case 0:break;default:n=1;break e}if(!(n>>>0<i>>>0)){n=1;break e}n=n+1|0}for(n=1;;){if(o=0|St(7,0,0|(r=3*(15-n|0)|0)),s=t&~(0|w()),t=0|Et(0|e,0|t,0|r),w(),e=e&~o|(t=0|St(0|ce(7&t),0,0|r)),t=0|s|w(),!(n>>>0<i>>>0)){n=1;break}n=n+1|0}}else n=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return x(0|t),0|e}function Ne(e,t){var n=0,i=0,r=0,o=0,s=0;if(i=0|Et(0|(e|=0),0|(t|=0),52),w(),!(i&=15))return i=e,x(0|(n=t)),0|i;for(n=1;o=0|St(7,0,0|(s=3*(15-n|0)|0)),r=t&~(0|w()),t=0|Et(0|e,0|t,0|s),w(),e=(t=0|St(0|ce(7&t),0,0|s))|e&~o,t=0|w()|r,n>>>0<i>>>0;)n=n+1|0;return x(0|t),0|e}function Ue(e){return 0|(0|(e|=0))%2}function je(e,t){e|=0;var n,i;return i=M,M=M+16|0,n=i,(t|=0)>>>0<=15&&2146435072!=(2146435072&r[e+4>>2]|0)&&2146435072!=(2146435072&r[e+8+4>>2]|0)?(!function(e,t,n){var i,r;i=M,M=M+16|0,ge(e|=0,t|=0,n|=0,r=i),H(r,n+4|0),M=i}(e,t,n),t=0|function(e,t){e|=0;var n,i=0,o=0,s=0,a=0,l=0,c=0,u=0,h=0;if(n=M,M=M+64|0,c=n+40|0,o=n+24|0,s=n+12|0,a=n,St(0|(t|=0),0,52),i=134225919|w(),!t)return(0|r[e+4>>2])>2||(0|r[e+8>>2])>2||(0|r[e+12>>2])>2?(c=0,x(0|(l=0)),M=n,0|c):(St(0|F(e),0,45),l=0|w()|i,c=-1,x(0|l),M=n,0|c);if(r[c>>2]=r[e>>2],r[c+4>>2]=r[e+4>>2],r[c+8>>2]=r[e+8>>2],r[c+12>>2]=r[e+12>>2],l=c+4|0,(0|t)>0)for(e=-1;r[o>>2]=r[l>>2],r[o+4>>2]=r[l+4>>2],r[o+8>>2]=r[l+8>>2],1&t?(te(l),r[s>>2]=r[l>>2],r[s+4>>2]=r[l+4>>2],r[s+8>>2]=r[l+8>>2],ie(s)):(ne(l),r[s>>2]=r[l>>2],r[s+4>>2]=r[l+4>>2],r[s+8>>2]=r[l+8>>2],re(s)),K(o,s,a),Q(a),u=0|St(7,0,0|(h=3*(15-t|0)|0)),i&=~(0|w()),e=(h=0|St(0|ee(a),0,0|h))|e&~u,i=0|w()|i,(0|t)>1;)t=t+-1|0;else e=-1;e:do{if((0|r[l>>2])<=2&&(0|r[c+8>>2])<=2&&(0|r[c+12>>2])<=2){if(t=0|St(0|(o=0|F(c)),0,45),t|=e,e=0|w()|-1040385&i,a=0|N(c),!(0|O(o))){if((0|a)<=0)break;for(s=0;;){if(o=0|Et(0|t,0|e,52),w(),o&=15)for(i=1;c=0|Et(0|t,0|e,0|(h=3*(15-i|0)|0)),w(),u=0|St(7,0,0|h),e&=~(0|w()),t=t&~u|(h=0|St(0|le(7&c),0,0|h)),e=0|e|w(),i>>>0<o>>>0;)i=i+1|0;if((0|(s=s+1|0))==(0|a))break e}}s=0|Et(0|t,0|e,52),w(),s&=15;t:do{if(s){i=1;n:for(;;){switch(h=0|Et(0|t,0|e,3*(15-i|0)|0),w(),7&h){case 1:break n;case 0:break;default:break t}if(!(i>>>0<s>>>0))break t;i=i+1|0}if(0|U(o,0|r[c>>2]))for(i=1;u=0|St(7,0,0|(c=3*(15-i|0)|0)),h=e&~(0|w()),e=0|Et(0|t,0|e,0|c),w(),t=t&~u|(e=0|St(0|ce(7&e),0,0|c)),e=0|h|w(),i>>>0<s>>>0;)i=i+1|0;else for(i=1;c=0|Et(0|t,0|e,0|(h=3*(15-i|0)|0)),w(),u=0|St(7,0,0|h),e&=~(0|w()),t=t&~u|(h=0|St(0|le(7&c),0,0|h)),e=0|e|w(),i>>>0<s>>>0;)i=i+1|0}}while(0);if((0|a)>0){i=0;do{t=0|Oe(t,e),e=0|w(),i=i+1|0}while((0|i)!=(0|a))}}else t=0,e=0}while(0);return h=t,x(0|(u=e)),M=n,0|h}(n,t),e=0|w()):(e=0,t=0),x(0|e),M=i,0|t}function Ve(e,t,n){var i,o=0,s=0,a=0;if(i=(n|=0)+4|0,s=0|Et(0|(e|=0),0|(t|=0),52),w(),s&=15,a=0|Et(0|e,0|t,45),w(),o=0==(0|s),0|O(127&a)){if(o)return 0|(a=1);o=1}else{if(o)return 0|(a=0);o=0==(0|r[i>>2])&&0==(0|r[n+8>>2])?0!=(0|r[n+12>>2])&1:1}for(n=1;1&n?ie(i):re(i),a=0|Et(0|e,0|t,3*(15-n|0)|0),w(),oe(i,7&a),n>>>0<s>>>0;)n=n+1|0;return 0|o}function Ge(e,t,n){n|=0;var i,o,s=0,a=0,l=0,c=0,u=0,h=0;o=M,M=M+16|0,i=o,h=0|Et(0|(e|=0),0|(t|=0),45),w(),h&=127;e:do{if(0!=(0|O(h))&&(l=0|Et(0|e,0|t,52),w(),0!=(0|(l&=15)))){s=1;t:for(;;){switch(u=0|Et(0|e,0|t,3*(15-s|0)|0),w(),7&u){case 5:break t;case 0:break;default:s=t;break e}if(!(s>>>0<l>>>0)){s=t;break e}s=s+1|0}for(a=1,s=t;c=0|St(7,0,0|(t=3*(15-a|0)|0)),u=s&~(0|w()),s=0|Et(0|e,0|s,0|t),w(),e=e&~c|(s=0|St(0|ce(7&s),0,0|t)),s=0|u|w(),a>>>0<l>>>0;)a=a+1|0}else s=t}while(0);if(u=7728+(28*h|0)|0,r[n>>2]=r[u>>2],r[n+4>>2]=r[u+4>>2],r[n+8>>2]=r[u+8>>2],r[n+12>>2]=r[u+12>>2],0|Ve(e,s,n)){if(c=n+4|0,r[i>>2]=r[c>>2],r[i+4>>2]=r[c+4>>2],r[i+8>>2]=r[c+8>>2],l=0|Et(0|e,0|s,52),w(),u=15&l,1&l?(re(c),l=u+1|0):l=u,0|O(h)){e:do{if(u)for(t=1;;){if(a=0|Et(0|e,0|s,3*(15-t|0)|0),w(),0|(a&=7)){s=a;break e}if(!(t>>>0<u>>>0)){s=0;break}t=t+1|0}else s=0}while(0);s=4==(0|s)&1}else s=0;if(0|xe(n,l,s,0)){if(0|O(h))do{}while(0!=(0|xe(n,l,0,0)));(0|l)!=(0|u)&&ne(c)}else(0|l)!=(0|u)&&(r[c>>2]=r[i>>2],r[c+4>>2]=r[i+4>>2],r[c+8>>2]=r[i+8>>2]);M=o}else M=o}function We(e,t,n){n|=0;var i,r;i=M,M=M+16|0,Ge(e|=0,t|=0,r=i),t=0|Et(0|e,0|t,52),w(),_e(r,15&t,n),M=i}function $e(e,t,n){n|=0;var i,r,o=0,s=0;r=M,M=M+16|0,Ge(e|=0,t|=0,i=r),o=0|Et(0|e,0|t,45),w(),o=0==(0|O(127&o)),s=0|Et(0|e,0|t,52),w(),s&=15;e:do{if(!o){if(0|s)for(o=1;;){if(!(0==((0|St(7,0,3*(15-o|0)|0))&e|0)&0==((0|w())&t|0)))break e;if(!(o>>>0<s>>>0))break;o=o+1|0}return ve(i,s,0,5,n),void(M=r)}}while(0);Ee(i,s,0,6,n),M=r}function qe(e,t){t|=0;var n,i=0,o=0,s=0,a=0,l=0,c=0;if(St(0|(e|=0),0,52),n=134225919|w(),(0|e)<1){o=0,i=0;do{0|O(o)&&(St(0|o,0,45),l=0|n|w(),r[(e=t+(i<<3)|0)>>2]=-1,r[e+4>>2]=l,i=i+1|0),o=o+1|0}while(122!=(0|o))}else{l=0,i=0;do{if(0|O(l)){for(St(0|l,0,45),o=1,s=-1,a=0|n|w();s&=~(c=0|St(7,0,3*(15-o|0)|0)),a&=~(0|w()),(0|o)!=(0|e);)o=o+1|0;r[(c=t+(i<<3)|0)>>2]=s,r[c+4>>2]=a,i=i+1|0}l=l+1|0}while(122!=(0|l))}}function Ze(e,t,n,i){var o,s=0,a=0,l=0,c=0,u=0;if(o=M,M=M+64|0,l=o,(0|(e|=0))==(0|(n|=0))&(0|(t|=0))==(0|(i|=0))|!1|134217728!=(2013265920&t|0)|!1|134217728!=(2013265920&i|0))return M=o,0|(l=0);if(s=0|Et(0|e,0|t,52),w(),s&=15,a=0|Et(0|n,0|i,52),w(),(0|s)!=(15&a|0))return M=o,0|(l=0);if(a=s+-1|0,s>>>0>1&&(u=0|Le(e,t,a),c=0|w(),(0|u)==(0|(a=0|Le(n,i,a)))&(0|c)==(0|w()))){if(s=0|Et(0|e,0|t,0|(a=3*(15^s)|0)),w(),s&=7,a=0|Et(0|n,0|i,0|a),w(),0==(0|s)|0==(0|(a&=7)))return M=o,0|(u=1);if((0|r[21136+(s<<2)>>2])==(0|a))return M=o,0|(u=1);if((0|r[21168+(s<<2)>>2])==(0|a))return M=o,0|(u=1)}a=(s=l)+56|0;do{r[s>>2]=0,s=s+4|0}while((0|s)<(0|a));return I(e,t,1,l),s=(0|r[(u=l)>>2])==(0|n)&&(0|r[u+4>>2])==(0|i)||(0|r[(u=l+8|0)>>2])==(0|n)&&(0|r[u+4>>2])==(0|i)||(0|r[(u=l+16|0)>>2])==(0|n)&&(0|r[u+4>>2])==(0|i)||(0|r[(u=l+24|0)>>2])==(0|n)&&(0|r[u+4>>2])==(0|i)||(0|r[(u=l+32|0)>>2])==(0|n)&&(0|r[u+4>>2])==(0|i)||(0|r[(u=l+40|0)>>2])==(0|n)&&(0|r[u+4>>2])==(0|i)?1:1&((0|r[(s=l+48|0)>>2])==(0|n)?(0|r[s+4>>2])==(0|i):0),M=o,0|(u=s)}function He(e,t,n){n|=0;var i,o,s,a,l=0;if(s=M,M=M+16|0,o=s,l=0|Et(0|(e|=0),0|(t|=0),56),w(),t=0|function(e,t,n){n|=0;var i=0,o=0;if(i=0|ze(e=e|0,t=t|0),(n+-1|0)>>>0>5)return 0|(n=-1);if(1==(0|n)&(o=0!=(0|i)))return 0|(n=-1);return i=0|function(e,t){var n=0,i=0,o=0,s=0,a=0,l=0,c=0,u=0;if(u=M,M=M+32|0,s=u,Ge(e=e|0,t=t|0,o=u+16|0),a=0|Me(e,t),c=0|De(e,t),function(e,t){e=7728+(28*(e|=0)|0)|0,r[(t|=0)>>2]=r[e>>2],r[t+4>>2]=r[e+4>>2],r[t+8>>2]=r[e+8>>2],r[t+12>>2]=r[e+12>>2]}(a,s),t=0|function(e,t){e|=0;var n=0,i=0;if((t|=0)>>>0>20)return-1;do{if((0|r[11152+(216*t|0)>>2])!=(0|e))if((0|r[11152+(216*t|0)+8>>2])!=(0|e))if((0|r[11152+(216*t|0)+16>>2])!=(0|e))if((0|r[11152+(216*t|0)+24>>2])!=(0|e))if((0|r[11152+(216*t|0)+32>>2])!=(0|e))if((0|r[11152+(216*t|0)+40>>2])!=(0|e))if((0|r[11152+(216*t|0)+48>>2])!=(0|e))if((0|r[11152+(216*t|0)+56>>2])!=(0|e))if((0|r[11152+(216*t|0)+64>>2])!=(0|e))if((0|r[11152+(216*t|0)+72>>2])!=(0|e))if((0|r[11152+(216*t|0)+80>>2])!=(0|e))if((0|r[11152+(216*t|0)+88>>2])!=(0|e))if((0|r[11152+(216*t|0)+96>>2])!=(0|e))if((0|r[11152+(216*t|0)+104>>2])!=(0|e))if((0|r[11152+(216*t|0)+112>>2])!=(0|e))if((0|r[11152+(216*t|0)+120>>2])!=(0|e))if((0|r[11152+(216*t|0)+128>>2])!=(0|e)){if((0|r[11152+(216*t|0)+136>>2])!=(0|e)){if((0|r[11152+(216*t|0)+144>>2])==(0|e)){e=0,n=2,i=0;break}if((0|r[11152+(216*t|0)+152>>2])==(0|e)){e=0,n=2,i=1;break}if((0|r[11152+(216*t|0)+160>>2])==(0|e)){e=0,n=2,i=2;break}if((0|r[11152+(216*t|0)+168>>2])==(0|e)){e=1,n=2,i=0;break}if((0|r[11152+(216*t|0)+176>>2])==(0|e)){e=1,n=2,i=1;break}if((0|r[11152+(216*t|0)+184>>2])==(0|e)){e=1,n=2,i=2;break}if((0|r[11152+(216*t|0)+192>>2])==(0|e)){e=2,n=2,i=0;break}if((0|r[11152+(216*t|0)+200>>2])==(0|e)){e=2,n=2,i=1;break}if((0|r[11152+(216*t|0)+208>>2])==(0|e)){e=2,n=2,i=2;break}return-1}e=2,n=1,i=2}else e=2,n=1,i=1;else e=2,n=1,i=0;else e=1,n=1,i=2;else e=1,n=1,i=1;else e=1,n=1,i=0;else e=0,n=1,i=2;else e=0,n=1,i=1;else e=0,n=1,i=0;else e=2,n=0,i=2;else e=2,n=0,i=1;else e=2,n=0,i=0;else e=1,n=0,i=2;else e=1,n=0,i=1;else e=1,n=0,i=0;else e=0,n=0,i=2;else e=0,n=0,i=1;else e=0,n=0,i=0}while(0);return 0|r[11152+(216*t|0)+(72*n|0)+(24*e|0)+(i<<3)+4>>2]}(a,0|r[o>>2]),!(0|O(a)))return M=u,0|(c=t);switch(0|a){case 4:e=0,n=14;break;case 14:e=1,n=14;break;case 24:e=2,n=14;break;case 38:e=3,n=14;break;case 49:e=4,n=14;break;case 58:e=5,n=14;break;case 63:e=6,n=14;break;case 72:e=7,n=14;break;case 83:e=8,n=14;break;case 97:e=9,n=14;break;case 107:e=10,n=14;break;case 117:e=11,n=14;break;default:l=0,i=0}14==(0|n)&&(l=0|r[22096+(24*e|0)+8>>2],i=0|r[22096+(24*e|0)+16>>2]);(0|(e=0|r[o>>2]))!=(0|r[s>>2])&&(a=0|B(a))|(0|(e=0|r[o>>2]))==(0|i)&&(t=(t+1|0)%6|0);if(3==(0|c)&(0|e)==(0|i))return M=u,0|(c=(t+5|0)%6|0);if(!(5==(0|c)&(0|e)==(0|l)))return M=u,0|(c=t);return M=u,0|(c=(t+1|0)%6|0)}(e,t),o?0|(n=(5-i+(0|r[22384+(n<<2)>>2])|0)%5|0):0|(n=(6-i+(0|r[22416+(n<<2)>>2])|0)%6|0)}(i=(a=!0&268435456==(2013265920&t|0))?e:0,e=a?-2130706433&t|134217728:0,7&l),-1==(0|t))return r[n>>2]=0,void(M=s);Ge(i,e,o),l=0|Et(0|i,0|e,52),w(),l&=15,0|ze(i,e)?ve(o,l,t,2,n):Ee(o,l,t,2,n),M=s}function Qe(e){e|=0;var t,n,i=0;return(t=0|_t(1,12))||E(22691,22646,49,22704),0|(i=0|r[(n=e+4|0)>>2])?(r[(i=i+8|0)>>2]=t,r[n>>2]=t,0|t):(0|r[e>>2]&&E(22721,22646,61,22744),r[(i=e)>>2]=t,r[n>>2]=t,0|t)}function Xe(e,t){e|=0,t|=0;var n,i;return(i=0|gt(24))||E(22758,22646,78,22772),r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],r[i+12>>2]=r[t+12>>2],r[i+16>>2]=0,0|(n=0|r[(t=e+4|0)>>2])?(r[n+16>>2]=i,r[t>>2]=i,0|i):(0|r[e>>2]&&E(22787,22646,82,22772),r[e>>2]=i,r[t>>2]=i,0|i)}function Ye(e){var t,n,i=0,s=0,a=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0,x=0,w=0,S=0,T=0,k=0,C=0,P=0,M=0,I=0,L=0,R=0,z=0,D=0,O=0;if(0|r[(c=(e|=0)+8|0)>>2])return 0|(O=1);if(!(a=0|r[e>>2]))return 0|(O=0);i=a,s=0;do{s=s+1|0,i=0|r[i+8>>2]}while(0!=(0|i));if(s>>>0<2)return 0|(O=0);(n=0|gt(s<<2))||E(22807,22646,317,22826),(t=0|gt(s<<5))||E(22848,22646,321,22826),r[e>>2]=0,r[(C=e+4|0)>>2]=0,r[c>>2]=0,s=0,z=0,k=0,m=0;e:for(;;){if(A=0|r[a>>2]){u=0,h=A;do{if(f=+o[h+8>>3],i=h,h=0|r[h+16>>2],d=+o[(c=(p=0==(0|h))?A:h)+8>>3],+l(+(f-d))>3.141592653589793){O=14;break}u+=(d-f)*(+o[i>>3]+ +o[c>>3])}while(!p);if(14==(0|O)){O=0,u=0,i=A;do{T=+o[i+8>>3],L=0|r[(R=i+16|0)>>2],S=+o[(L=0==(0|L)?A:L)+8>>3],u+=(+o[i>>3]+ +o[L>>3])*((S<0?S+6.283185307179586:S)-(T<0?T+6.283185307179586:T)),i=0|r[(0==(0|i)?a:R)>>2]}while(0!=(0|i))}u>0?(r[n+(z<<2)>>2]=a,z=z+1|0,c=k,i=m):O=19}else O=19;if(19==(0|O)){O=0;do{if(!s){if(m){c=C,h=m+8|0,i=a,s=e;break}if(0|r[e>>2]){O=27;break e}c=C,h=e,i=a,s=e;break}if(0|r[(i=s+8|0)>>2]){O=21;break e}if(!(s=0|_t(1,12))){O=23;break e}r[i>>2]=s,c=s+4|0,h=s,i=m}while(0);if(r[h>>2]=a,r[c>>2]=a,h=t+(k<<5)|0,p=0|r[a>>2]){for(o[(A=t+(k<<5)+8|0)>>3]=17976931348623157e292,o[(m=t+(k<<5)+24|0)>>3]=17976931348623157e292,o[h>>3]=-17976931348623157e292,o[(g=t+(k<<5)+16|0)>>3]=-17976931348623157e292,x=17976931348623157e292,w=-17976931348623157e292,c=0,y=p,f=17976931348623157e292,v=17976931348623157e292,b=-17976931348623157e292,d=-17976931348623157e292;u=+o[y>>3],T=+o[y+8>>3],y=0|r[y+16>>2],S=+o[((_=0==(0|y))?p:y)+8>>3],u<f&&(o[A>>3]=u,f=u),T<v&&(o[m>>3]=T,v=T),u>b?o[h>>3]=u:u=b,T>d&&(o[g>>3]=T,d=T),x=T>0&T<x?T:x,w=T<0&T>w?T:w,c|=+l(+(T-S))>3.141592653589793,!_;)b=u;c&&(o[g>>3]=w,o[m>>3]=x)}else r[h>>2]=0,r[h+4>>2]=0,r[h+8>>2]=0,r[h+12>>2]=0,r[h+16>>2]=0,r[h+20>>2]=0,r[h+24>>2]=0,r[h+28>>2]=0;c=k+1|0}if(a=0|r[(R=a+8|0)>>2],r[R>>2]=0,!a){O=45;break}k=c,m=i}if(21==(0|O))E(22624,22646,35,22658);else if(23==(0|O))E(22678,22646,37,22658);else if(27==(0|O))E(22721,22646,61,22744);else if(45==(0|O)){e:do{if((0|z)>0){for(R=0==(0|c),I=c<<2,L=0==(0|e),M=0,i=0;;){if(P=0|r[n+(M<<2)>>2],R)O=73;else{if(!(k=0|gt(I))){O=50;break}if(!(C=0|gt(I))){O=52;break}t:do{if(L)s=0;else{for(c=0,s=0,h=e;a=t+(c<<5)|0,0|Ke(0|r[h>>2],a,0|r[P>>2])?(r[k+(s<<2)>>2]=h,r[C+(s<<2)>>2]=a,_=s+1|0):_=s,h=0|r[h+8>>2];)c=c+1|0,s=_;if((0|_)>0)if(a=0|r[k>>2],1==(0|_))s=a;else for(g=0,y=-1,s=a,m=a;;){for(p=0|r[m>>2],a=0,h=0;A=(0|(c=0|r[r[k+(h<<2)>>2]>>2]))==(0|p)?a:a+(1&(0|Ke(c,0|r[C+(h<<2)>>2],0|r[p>>2])))|0,(0|(h=h+1|0))!=(0|_);)a=A;if(s=(c=(0|A)>(0|y))?m:s,(0|(a=g+1|0))==(0|_))break t;g=a,y=c?A:y,m=0|r[k+(a<<2)>>2]}else s=0}}while(0);if(yt(k),yt(C),s){if(a=0|r[(c=s+4|0)>>2])s=a+8|0;else if(0|r[s>>2]){O=70;break}r[s>>2]=P,r[c>>2]=P}else O=73}if(73==(0|O)){if(O=0,0|(i=0|r[P>>2]))do{C=i,i=0|r[i+16>>2],yt(C)}while(0!=(0|i));yt(P),i=2}if((0|(M=M+1|0))>=(0|z)){D=i;break e}}50==(0|O)?E(22863,22646,249,22882):52==(0|O)?E(22901,22646,252,22882):70==(0|O)&&E(22721,22646,61,22744)}else D=0}while(0);return yt(n),yt(t),0|(O=D)}return 0}function Ke(e,t,n){e|=0;var i,s=0,a=0,l=0,c=0,u=0,h=0,d=0;if(!(0|W(t|=0,n|=0)))return 0|(e=0);if(t=0|G(t),i=+o[n>>3],s=t&(s=+o[n+8>>3])<0?s+6.283185307179586:s,!(e=0|r[e>>2]))return 0|(e=0);if(t){t=0,n=e;e:for(;;){for(;c=+o[n>>3],h=+o[n+8>>3],d=0|r[(n=n+16|0)>>2],l=+o[(d=0==(0|d)?e:d)>>3],a=+o[d+8>>3],c>l?(u=c,c=h):(u=l,l=c,c=a,a=h),i<l|i>u;)if(!(n=0|r[n>>2])){n=22;break e}if(s=(c=c<0?c+6.283185307179586:c)==s|(h=a<0?a+6.283185307179586:a)==s?s+-2220446049250313e-31:s,((h+=(i-l)/(u-l)*(c-h))<0?h+6.283185307179586:h)>s&&(t^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|t}else{t=0,n=e;e:for(;;){for(;c=+o[n>>3],h=+o[n+8>>3],d=0|r[(n=n+16|0)>>2],l=+o[(d=0==(0|d)?e:d)>>3],a=+o[d+8>>3],c>l?(u=c,c=h):(u=l,l=c,c=a,a=h),i<l|i>u;)if(!(n=0|r[n>>2])){n=22;break e}if(a+(i-l)/(u-l)*(c-a)>(s=c==s|a==s?s+-2220446049250313e-31:s)&&(t^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|t}return 0}function Je(e,t,n,o,s){n|=0,o|=0,s|=0;var a,l,c,u,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0;if(u=M,M=M+32|0,v=u+16|0,c=u,h=0|Et(0|(e|=0),0|(t|=0),52),w(),h&=15,g=0|Et(0|n,0|o,52),w(),(0|h)!=(15&g|0))return M=u,0|(v=1);if(A=0|Et(0|e,0|t,45),w(),A&=127,m=0|Et(0|n,0|o,45),w(),g=(0|A)!=(0|(m&=127))){if(7==(0|(f=0|V(A,m))))return M=u,0|(v=2);7==(0|(p=0|V(m,A)))?E(22925,22949,151,22959):(y=f,d=p)}else y=0,d=0;a=0|O(A),l=0|O(m),r[v>>2]=0,r[v+4>>2]=0,r[v+8>>2]=0,r[v+12>>2]=0;do{if(y){if(f=(0|(m=0|r[4304+(28*A|0)+(y<<2)>>2]))>0,l)if(f){A=0,p=n,f=o;do{p=0|Fe(p,f),f=0|w(),1==(0|(d=0|ce(d)))&&(d=0|ce(1)),A=A+1|0}while((0|A)!=(0|m));m=d,A=p,p=f}else m=d,A=n,p=o;else if(f){A=0,p=n,f=o;do{p=0|Ne(p,f),f=0|w(),d=0|ce(d),A=A+1|0}while((0|A)!=(0|m));m=d,A=p,p=f}else m=d,A=n,p=o;if(Ve(A,p,v),g||E(22972,22949,181,22959),(f=0!=(0|a))&(d=0!=(0|l))&&E(22999,22949,182,22959),f){if(d=0|De(e,t),0|i[22032+(7*d|0)+y>>0]){h=3;break}A=p=0|r[21200+(28*d|0)+(y<<2)>>2],_=26}else if(d){if(d=0|De(A,p),0|i[22032+(7*d|0)+m>>0]){h=4;break}A=0,p=0|r[21200+(28*m|0)+(d<<2)>>2],_=26}else d=0;if(26==(0|_))if((0|p)<=-1&&E(23030,22949,212,22959),(0|A)<=-1&&E(23053,22949,213,22959),(0|p)>0){f=v+4|0,d=0;do{ae(f),d=d+1|0}while((0|d)!=(0|p));d=A}else d=A;if(r[c>>2]=0,r[c+4>>2]=0,r[c+8>>2]=0,oe(c,y),0|h)for(;0|Ue(h)?ie(c):re(c),(0|h)>1;)h=h+-1|0;if((0|d)>0){h=0;do{ae(c),h=h+1|0}while((0|h)!=(0|d))}Y(_=v+4|0,c,_),Q(_),_=50}else if(Ve(n,o,v),0!=(0|a)&0!=(0|l))if((0|m)!=(0|A)&&E(23077,22949,243,22959),d=0|De(e,t),h=0|De(n,o),0|i[22032+(7*d|0)+h>>0])h=5;else if((0|(d=0|r[21200+(28*d|0)+(h<<2)>>2]))>0){f=v+4|0,h=0;do{ae(f),h=h+1|0}while((0|h)!=(0|d));_=50}else _=50;else _=50}while(0);return 50==(0|_)&&(h=v+4|0,r[s>>2]=r[h>>2],r[s+4>>2]=r[h+4>>2],r[s+8>>2]=r[h+8>>2],h=0),M=u,0|(v=h)}function et(e,t,n,i){n|=0,i|=0;var o,s,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0;if(s=M,M=M+48|0,c=s+36|0,u=s+24|0,h=s+12|0,d=s,l=0|Et(0|(e|=0),0|(t|=0),52),w(),l&=15,p=0|Et(0|e,0|t,45),w(),o=0|O(p&=127),St(0|l,0,52),g=134225919|w(),r[(m=i)>>2]=-1,r[m+4>>2]=g,!l)return(0|r[n>>2])>1||(0|r[n+4>>2])>1||(0|r[n+8>>2])>1||127==(0|(a=0|j(p,0|ee(n))))?(M=s,0|(g=1)):(A=0|St(0|a,0,45),m=0|w(),m=-1040385&r[(p=i)+4>>2]|m,r[(g=i)>>2]=r[p>>2]|A,r[g+4>>2]=m,M=s,0|(g=0));for(r[c>>2]=r[n>>2],r[c+4>>2]=r[n+4>>2],r[c+8>>2]=r[n+8>>2];r[u>>2]=r[c>>2],r[u+4>>2]=r[c+4>>2],r[u+8>>2]=r[c+8>>2],0|Ue(l)?(te(c),r[h>>2]=r[c>>2],r[h+4>>2]=r[c+4>>2],r[h+8>>2]=r[c+8>>2],ie(h)):(ne(c),r[h>>2]=r[c>>2],r[h+4>>2]=r[c+4>>2],r[h+8>>2]=r[c+8>>2],re(h)),K(u,h,d),Q(d),y=0|r[(m=i)>>2],m=0|r[m+4>>2],n=0|St(7,0,0|(_=3*(15-l|0)|0)),m&=~(0|w()),_=0|St(0|ee(d),0,0|_),m=0|w()|m,r[(g=i)>>2]=_|y&~n,r[g+4>>2]=m,(0|l)>1;)l=l+-1|0;e:do{if((0|r[c>>2])<=1&&(0|r[c+4>>2])<=1&&(0|r[c+8>>2])<=1){d=127==(0|(u=0|j(p,l=0|ee(c))))?0:0|O(u);t:do{if(l){if(o){if(c=21408+(28*(0|De(e,t))|0)+(l<<2)|0,(0|(c=0|r[c>>2]))>0){n=0;do{l=0|le(l),n=n+1|0}while((0|n)!=(0|c))}if(1==(0|l)){a=3;break e}127==(0|(n=0|j(p,l)))&&E(23104,22949,376,23134),0|O(n)?E(23147,22949,377,23134):(A=c,f=l,a=n)}else A=0,f=l,a=u;if((0|(h=0|r[4304+(28*p|0)+(f<<2)>>2]))<=-1&&E(23178,22949,384,23134),!d){if((0|A)<=-1&&E(23030,22949,417,23134),0|A){l=0,n=0|r[(c=i)>>2],c=0|r[c+4>>2];do{n=0|Be(n,c),c=0|w(),r[(_=i)>>2]=n,r[_+4>>2]=c,l=l+1|0}while((0|l)<(0|A))}if((0|h)<=0){l=54;break}for(l=0,n=0|r[(c=i)>>2],c=0|r[c+4>>2];;)if(n=0|Be(n,c),c=0|w(),r[(_=i)>>2]=n,r[_+4>>2]=c,(0|(l=l+1|0))==(0|h)){l=54;break t}}if(7==(0|(u=0|V(a,p)))&&E(22925,22949,393,23134),n=0|r[(l=i)>>2],l=0|r[l+4>>2],(0|h)>0){c=0;do{n=0|Be(n,l),l=0|w(),r[(_=i)>>2]=n,r[_+4>>2]=l,c=c+1|0}while((0|c)!=(0|h))}if(n=0|De(n,l),_=0|B(a),(0|(n=0|r[(_?21824:21616)+(28*u|0)+(n<<2)>>2]))<=-1&&E(23030,22949,412,23134),n){l=0,c=0|r[(u=i)>>2],u=0|r[u+4>>2];do{c=0|Oe(c,u),u=0|w(),r[(_=i)>>2]=c,r[_+4>>2]=u,l=l+1|0}while((0|l)<(0|n));l=54}else l=54}else if(0!=(0|o)&0!=(0|d))if(l=21408+(28*(_=0|De(e,t))|0)+((0|De(0|r[(l=i)>>2],0|r[l+4>>2]))<<2)|0,(0|(l=0|r[l>>2]))<=-1&&E(23201,22949,433,23134),l){a=0,n=0|r[(c=i)>>2],c=0|r[c+4>>2];do{n=0|Be(n,c),c=0|w(),r[(_=i)>>2]=n,r[_+4>>2]=c,a=a+1|0}while((0|a)<(0|l));a=u,l=54}else a=u,l=55;else a=u,l=54}while(0);if(54==(0|l)&&d&&(l=55),55==(0|l)&&1==(0|De(0|r[(_=i)>>2],0|r[_+4>>2]))){a=4;break}g=0|r[(_=i)>>2],_=-1040385&r[_+4>>2],y=0|St(0|a,0,45),_=0|_|w(),r[(a=i)>>2]=g|y,r[a+4>>2]=_,a=0}else a=2}while(0);return M=s,0|(_=a)}function tt(e,t){var n=0;if(!(t|=0))return 0|(n=1);n=e|=0,e=1;do{e=0|_(0==(1&t|0)?1:n,e),t>>=1,n=0|_(n,n)}while(0!=(0|t));return 0|e}function nt(e,t,n){e|=0;var i,s,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0;if(!(0|W(t|=0,n|=0)))return 0|(p=0);if(t=0|G(t),s=+o[n>>3],a=t&(a=+o[n+8>>3])<0?a+6.283185307179586:a,(0|(p=0|r[e>>2]))<=0)return 0|(p=0);if(i=0|r[e+4>>2],t){t=0,n=-1,e=0;e:for(;;){for(f=e;u=+o[i+(f<<4)>>3],d=+o[i+(f<<4)+8>>3],c=+o[i+((e=(n+2|0)%(0|p)|0)<<4)>>3],l=+o[i+(e<<4)+8>>3],u>c?(h=u,u=d):(h=c,c=u,u=l,l=d),s<c|s>h;){if(!((0|(n=f+1|0))<(0|p))){n=22;break e}e=f,f=n,n=e}if(a=(u=u<0?u+6.283185307179586:u)==a|(d=l<0?l+6.283185307179586:l)==a?a+-2220446049250313e-31:a,((d+=(s-c)/(h-c)*(u-d))<0?d+6.283185307179586:d)>a&&(t^=1),(0|(e=f+1|0))>=(0|p)){n=22;break}n=f}if(22==(0|n))return 0|t}else{t=0,n=-1,e=0;e:for(;;){for(f=e;u=+o[i+(f<<4)>>3],d=+o[i+(f<<4)+8>>3],c=+o[i+((e=(n+2|0)%(0|p)|0)<<4)>>3],l=+o[i+(e<<4)+8>>3],u>c?(h=u,u=d):(h=c,c=u,u=l,l=d),s<c|s>h;){if(!((0|(n=f+1|0))<(0|p))){n=22;break e}e=f,f=n,n=e}if(l+(s-c)/(h-c)*(u-l)>(a=u==a|l==a?a+-2220446049250313e-31:a)&&(t^=1),(0|(e=f+1|0))>=(0|p)){n=22;break}n=f}if(22==(0|n))return 0|t}return 0}function it(e,t){t|=0;var n,i,s,a,c,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0;if(!(i=0|r[(e|=0)>>2]))return r[t>>2]=0,r[t+4>>2]=0,r[t+8>>2]=0,r[t+12>>2]=0,r[t+16>>2]=0,r[t+20>>2]=0,r[t+24>>2]=0,void(r[t+28>>2]=0);if(o[(s=t+8|0)>>3]=17976931348623157e292,o[(a=t+24|0)>>3]=17976931348623157e292,o[t>>3]=-17976931348623157e292,o[(c=t+16|0)>>3]=-17976931348623157e292,!((0|i)<=0)){for(n=0|r[e+4>>2],g=17976931348623157e292,y=-17976931348623157e292,_=0,e=-1,f=17976931348623157e292,p=17976931348623157e292,m=-17976931348623157e292,h=-17976931348623157e292,v=0;u=+o[n+(v<<4)>>3],A=+o[n+(v<<4)+8>>3],d=+o[n+(((0|(e=e+2|0))==(0|i)?0:e)<<4)+8>>3],u<f&&(o[s>>3]=u,f=u),A<p&&(o[a>>3]=A,p=A),u>m?o[t>>3]=u:u=m,A>h&&(o[c>>3]=A,h=A),g=A>0&A<g?A:g,y=A<0&A>y?A:y,_|=+l(+(A-d))>3.141592653589793,(0|(e=v+1|0))!=(0|i);)b=v,m=u,v=e,e=b;_&&(o[c>>3]=y,o[a>>3]=g)}}function rt(e,t){t|=0;var n,i=0,s=0,a=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0,x=0,w=0,E=0,S=0,T=0;if(y=0|r[(e|=0)>>2]){if(o[(_=t+8|0)>>3]=17976931348623157e292,o[(v=t+24|0)>>3]=17976931348623157e292,o[t>>3]=-17976931348623157e292,o[(b=t+16|0)>>3]=-17976931348623157e292,(0|y)>0){for(a=0|r[e+4>>2],m=17976931348623157e292,g=-17976931348623157e292,s=0,i=-1,d=17976931348623157e292,f=17976931348623157e292,A=-17976931348623157e292,u=-17976931348623157e292,x=0;c=+o[a+(x<<4)>>3],p=+o[a+(x<<4)+8>>3],h=+o[a+(((0|(S=i+2|0))==(0|y)?0:S)<<4)+8>>3],c<d&&(o[_>>3]=c,d=c),p<f&&(o[v>>3]=p,f=p),c>A?o[t>>3]=c:c=A,p>u&&(o[b>>3]=p,u=p),m=p>0&p<m?p:m,g=p<0&p>g?p:g,s|=+l(+(p-h))>3.141592653589793,(0|(i=x+1|0))!=(0|y);)S=x,A=c,x=i,i=S;s&&(o[b>>3]=g,o[v>>3]=m)}}else r[t>>2]=0,r[t+4>>2]=0,r[t+8>>2]=0,r[t+12>>2]=0,r[t+16>>2]=0,r[t+20>>2]=0,r[t+24>>2]=0,r[t+28>>2]=0;if(!((0|(i=0|r[(S=e+8|0)>>2]))<=0)){n=e+12|0,E=0;do{if(a=0|r[n>>2],s=E,v=t+((E=E+1|0)<<5)|0,b=0|r[a+(s<<3)>>2]){if(o[(x=t+(E<<5)+8|0)>>3]=17976931348623157e292,o[(e=t+(E<<5)+24|0)>>3]=17976931348623157e292,o[v>>3]=-17976931348623157e292,o[(w=t+(E<<5)+16|0)>>3]=-17976931348623157e292,(0|b)>0){for(y=0|r[a+(s<<3)+4>>2],m=17976931348623157e292,g=-17976931348623157e292,a=0,s=-1,_=0,d=17976931348623157e292,f=17976931348623157e292,p=-17976931348623157e292,u=-17976931348623157e292;c=+o[y+(_<<4)>>3],A=+o[y+(_<<4)+8>>3],h=+o[y+(((0|(s=s+2|0))==(0|b)?0:s)<<4)+8>>3],c<d&&(o[x>>3]=c,d=c),A<f&&(o[e>>3]=A,f=A),c>p?o[v>>3]=c:c=p,A>u&&(o[w>>3]=A,u=A),m=A>0&A<m?A:m,g=A<0&A>g?A:g,a|=+l(+(A-h))>3.141592653589793,(0|(s=_+1|0))!=(0|b);)T=_,_=s,p=c,s=T;a&&(o[w>>3]=g,o[e>>3]=m)}}else r[v>>2]=0,r[v+4>>2]=0,r[v+8>>2]=0,r[v+12>>2]=0,r[v+16>>2]=0,r[v+20>>2]=0,r[v+24>>2]=0,r[v+28>>2]=0,i=0|r[S>>2]}while((0|E)<(0|i))}}function ot(e,t,n){var i=0,o=0,s=0;if(!(0|nt(e|=0,t|=0,n|=0)))return 0|(o=0);if((0|r[(o=e+8|0)>>2])<=0)return 0|(o=1);for(i=e+12|0,e=0;;){if(s=e,e=e+1|0,0|nt((0|r[i>>2])+(s<<3)|0,t+(e<<5)|0,n)){e=0,i=6;break}if((0|e)>=(0|r[o>>2])){e=1,i=6;break}}return 6==(0|i)?0|e:0}function st(e,t,n,i,r){t|=0,n|=0,i|=0,r|=0;var s,a,l,c,u,h,d,f=0;c=+o[(e|=0)>>3],l=+o[t>>3]-c,a=+o[e+8>>3],s=+o[t+8>>3]-a,h=+o[n>>3],f=((f=+o[i>>3]-h)*(a-(d=+o[n+8>>3]))-(c-h)*(u=+o[i+8>>3]-d))/(l*u-s*f),o[r>>3]=c+l*f,o[r+8>>3]=a+s*f}function at(e,t){return t|=0,+o[(e|=0)>>3]!=+o[t>>3]?0|(t=0):0|(t=+o[e+8>>3]==+o[t+8>>3])}function lt(e,t){t|=0;var n,i,r;return+((r=+o[(e|=0)>>3]-+o[t>>3])*r+(i=+o[e+8>>3]-+o[t+8>>3])*i+(n=+o[e+16>>3]-+o[t+16>>3])*n)}function ct(e,t,n){e|=0,n|=0;var i=0;(0|(t|=0))>0?(i=0|_t(t,4),r[e>>2]=i,i||E(23230,23253,40,23267)):r[e>>2]=0,r[e+4>>2]=t,r[e+8>>2]=0,r[e+12>>2]=n}function ut(e){var t,n,i,s=0,a=0,c=0,h=0;t=(e|=0)+4|0,n=e+12|0,i=e+8|0;e:for(;;){for(a=0|r[t>>2],s=0;;){if((0|s)>=(0|a))break e;if(c=0|r[e>>2],h=0|r[c+(s<<2)>>2])break;s=s+1|0}s=c+(~~(+l(+ +u(10,+ +(15-(0|r[n>>2])|0))*(+o[h>>3]+ +o[h+8>>3]))%+(0|a))>>>0<<2)|0,a=0|r[s>>2];t:do{if(0|a){if(c=h+32|0,(0|a)==(0|h))r[s>>2]=r[c>>2];else{if(!(s=0|r[(a=a+32|0)>>2]))break;for(;(0|s)!=(0|h);)if(!(s=0|r[(a=s+32|0)>>2]))break t;r[a>>2]=r[c>>2]}yt(h),r[i>>2]=(0|r[i>>2])-1}}while(0)}yt(0|r[e>>2])}function ht(e){var t,n=0,i=0;for(t=0|r[(e|=0)+4>>2],i=0;;){if((0|i)>=(0|t)){n=0,i=4;break}if(n=0|r[(0|r[e>>2])+(i<<2)>>2]){i=4;break}i=i+1|0}return 4==(0|i)?0|n:0}function dt(e,t){t|=0;var n=0,i=0,s=0,a=0;if(n=~~(+l(+ +u(10,+ +(15-(0|r[(e|=0)+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|r[e+4>>2]))>>>0,n=(0|r[e>>2])+(n<<2)|0,!(i=0|r[n>>2]))return 0|(a=1);a=t+32|0;do{if((0|i)!=(0|t)){if(!(n=0|r[i+32>>2]))return 0|(a=1);for(s=n;;){if((0|s)==(0|t)){s=8;break}if(!(n=0|r[s+32>>2])){n=1,s=10;break}i=s,s=n}if(8==(0|s)){r[i+32>>2]=r[a>>2];break}if(10==(0|s))return 0|n}else r[n>>2]=r[a>>2]}while(0);return yt(t),r[(a=e+8|0)>>2]=(0|r[a>>2])-1,0|(a=0)}function ft(e,t,n){e|=0,t|=0,n|=0;var i,s=0,a=0,c=0;(i=0|gt(40))||E(23283,23253,98,23296),r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],r[i+12>>2]=r[t+12>>2],r[(a=i+16|0)>>2]=r[n>>2],r[a+4>>2]=r[n+4>>2],r[a+8>>2]=r[n+8>>2],r[a+12>>2]=r[n+12>>2],r[i+32>>2]=0,a=~~(+l(+ +u(10,+ +(15-(0|r[e+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|r[e+4>>2]))>>>0,a=(0|r[e>>2])+(a<<2)|0,s=0|r[a>>2];do{if(s){for(;!(0|ke(s,t)&&0|ke(s+16|0,n));)if(a=0|r[s+32>>2],!(0|r[(s=0==(0|a)?s:a)+32>>2])){c=10;break}if(10==(0|c)){r[s+32>>2]=i;break}return yt(i),0|(c=s)}r[a>>2]=i}while(0);return r[(c=e+8|0)>>2]=1+(0|r[c>>2]),0|(c=i)}function pt(e,t,n){t|=0,n|=0;var i=0,s=0;if(s=~~(+l(+ +u(10,+ +(15-(0|r[(e|=0)+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|r[e+4>>2]))>>>0,!(s=0|r[(0|r[e>>2])+(s<<2)>>2]))return 0|(n=0);if(!n){for(e=s;;){if(0|ke(e,t)){i=10;break}if(!(e=0|r[e+32>>2])){e=0,i=10;break}}if(10==(0|i))return 0|e}for(e=s;;){if(0|ke(e,t)&&0|ke(e+16|0,n)){i=10;break}if(!(e=0|r[e+32>>2])){e=0,i=10;break}}return 10==(0|i)?0|e:0}function At(e,t){t|=0;var n=0;if(n=~~(+l(+ +u(10,+ +(15-(0|r[(e|=0)+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|r[e+4>>2]))>>>0,!(e=0|r[(0|r[e>>2])+(n<<2)>>2]))return 0|(n=0);for(;;){if(0|ke(e,t)){t=5;break}if(!(e=0|r[e+32>>2])){e=0,t=5;break}}return 5==(0|t)?0|e:0}function mt(e){return 0|~~+function(e){return+ +Mt(+(e=+e))}(e=+e)}function gt(e){e|=0;var t,n=0,i=0,o=0,s=0,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0,x=0;t=M,M=M+16|0,p=t;do{if(e>>>0<245){if(e=(h=e>>>0<11?16:e+11&-8)>>>3,3&(i=(f=0|r[5829])>>>e)|0)return o=0|r[(i=(e=23356+((n=(1&i^1)+e|0)<<1<<2)|0)+8|0)>>2],(0|(a=0|r[(s=o+8|0)>>2]))==(0|e)?r[5829]=f&~(1<<n):(r[a+12>>2]=e,r[i>>2]=a),x=n<<3,r[o+4>>2]=3|x,r[(x=o+x+4|0)>>2]=1|r[x>>2],M=t,0|(x=s);if(h>>>0>(d=0|r[5831])>>>0){if(0|i)return n=((n=i<<e&((n=2<<e)|0-n))&0-n)-1|0,a=0|r[(e=(n=23356+((o=((i=(n>>>=c=n>>>12&16)>>>5&8)|c|(a=(n>>>=i)>>>2&4)|(e=(n>>>=a)>>>1&2)|(o=(n>>>=e)>>>1&1))+(n>>>o)|0)<<1<<2)|0)+8|0)>>2],(0|(i=0|r[(c=a+8|0)>>2]))==(0|n)?(e=f&~(1<<o),r[5829]=e):(r[i+12>>2]=n,r[e>>2]=i,e=f),l=(x=o<<3)-h|0,r[a+4>>2]=3|h,r[(s=a+h|0)+4>>2]=1|l,r[a+x>>2]=l,0|d&&(o=0|r[5834],i=23356+((n=d>>>3)<<1<<2)|0,e&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[5829]=e|n,n=i,e=i+8|0),r[e>>2]=o,r[n+12>>2]=o,r[o+8>>2]=n,r[o+12>>2]=i),r[5831]=l,r[5834]=s,M=t,0|(x=c);if(a=0|r[5830]){for(i=(a&0-a)-1|0,i=u=0|r[23620+(((o=(i>>>=s=i>>>12&16)>>>5&8)|s|(l=(i>>>=o)>>>2&4)|(c=(i>>>=l)>>>1&2)|(u=(i>>>=c)>>>1&1))+(i>>>u)<<2)>>2],c=u,u=(-8&r[u+4>>2])-h|0;(e=0|r[i+16>>2])||(e=0|r[i+20>>2]);)i=e,c=(s=(l=(-8&r[e+4>>2])-h|0)>>>0<u>>>0)?e:c,u=s?l:u;if((l=c+h|0)>>>0>c>>>0){s=0|r[c+24>>2],n=0|r[c+12>>2];do{if((0|n)==(0|c)){if(!(n=0|r[(e=c+20|0)>>2])&&!(n=0|r[(e=c+16|0)>>2])){i=0;break}for(;;)if(i=0|r[(o=n+20|0)>>2])n=i,e=o;else{if(!(i=0|r[(o=n+16|0)>>2]))break;n=i,e=o}r[e>>2]=0,i=n}else i=0|r[c+8>>2],r[i+12>>2]=n,r[n+8>>2]=i,i=n}while(0);do{if(0|s){if(n=0|r[c+28>>2],(0|c)==(0|r[(e=23620+(n<<2)|0)>>2])){if(r[e>>2]=i,!i){r[5830]=a&~(1<<n);break}}else if(r[((0|r[(x=s+16|0)>>2])==(0|c)?x:s+20|0)>>2]=i,!i)break;r[i+24>>2]=s,0|(n=0|r[c+16>>2])&&(r[i+16>>2]=n,r[n+24>>2]=i),0|(n=0|r[c+20>>2])&&(r[i+20>>2]=n,r[n+24>>2]=i)}}while(0);return u>>>0<16?(x=u+h|0,r[c+4>>2]=3|x,r[(x=c+x+4|0)>>2]=1|r[x>>2]):(r[c+4>>2]=3|h,r[l+4>>2]=1|u,r[l+u>>2]=u,0|d&&(o=0|r[5834],i=23356+((n=d>>>3)<<1<<2)|0,(n=1<<n)&f?n=0|r[(e=i+8|0)>>2]:(r[5829]=n|f,n=i,e=i+8|0),r[e>>2]=o,r[n+12>>2]=o,r[o+8>>2]=n,r[o+12>>2]=i),r[5831]=u,r[5834]=l),M=t,0|(x=c+8|0)}f=h}else f=h}else f=h}else if(e>>>0<=4294967231)if(h=-8&(e=e+11|0),o=0|r[5830]){s=0-h|0,u=(e>>>=8)?h>>>0>16777215?31:h>>>((u=14-((c=((g=e<<(f=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|f|(u=((g<<=c)+245760|0)>>>16&2))+(g<<u>>>15)|0)+7|0)&1|u<<1:0,i=0|r[23620+(u<<2)>>2];e:do{if(i)for(e=0,c=h<<(31==(0|u)?0:25-(u>>>1)|0),a=0;;){if((l=(-8&r[i+4>>2])-h|0)>>>0<s>>>0){if(!l){e=i,s=0,g=65;break e}e=i,s=l}if(a=0==(0|(g=0|r[i+20>>2]))|(0|g)==(0|(i=0|r[i+16+(c>>>31<<2)>>2]))?a:g,!i){i=a,g=61;break}c<<=1}else i=0,e=0,g=61}while(0);if(61==(0|g)){if(0==(0|i)&0==(0|e)){if(!(e=((e=2<<u)|0-e)&o)){f=h;break}f=(e&0-e)-1|0,e=0,i=0|r[23620+(((a=(f>>>=l=f>>>12&16)>>>5&8)|l|(c=(f>>>=a)>>>2&4)|(u=(f>>>=c)>>>1&2)|(i=(f>>>=u)>>>1&1))+(f>>>i)<<2)>>2]}i?g=65:(c=e,l=s)}if(65==(0|g))for(a=i;;){if(s=(i=(f=(-8&r[a+4>>2])-h|0)>>>0<s>>>0)?f:s,e=i?a:e,(i=0|r[a+16>>2])||(i=0|r[a+20>>2]),!i){c=e,l=s;break}a=i}if(0!=(0|c)&&l>>>0<((0|r[5831])-h|0)>>>0&&(d=c+h|0)>>>0>c>>>0){a=0|r[c+24>>2],n=0|r[c+12>>2];do{if((0|n)==(0|c)){if(!(n=0|r[(e=c+20|0)>>2])&&!(n=0|r[(e=c+16|0)>>2])){n=0;break}for(;;)if(i=0|r[(s=n+20|0)>>2])n=i,e=s;else{if(!(i=0|r[(s=n+16|0)>>2]))break;n=i,e=s}r[e>>2]=0}else x=0|r[c+8>>2],r[x+12>>2]=n,r[n+8>>2]=x}while(0);do{if(a){if(e=0|r[c+28>>2],(0|c)==(0|r[(i=23620+(e<<2)|0)>>2])){if(r[i>>2]=n,!n){o&=~(1<<e),r[5830]=o;break}}else if(r[((0|r[(x=a+16|0)>>2])==(0|c)?x:a+20|0)>>2]=n,!n)break;r[n+24>>2]=a,0|(e=0|r[c+16>>2])&&(r[n+16>>2]=e,r[e+24>>2]=n),(e=0|r[c+20>>2])&&(r[n+20>>2]=e,r[e+24>>2]=n)}}while(0);e:do{if(l>>>0<16)x=l+h|0,r[c+4>>2]=3|x,r[(x=c+x+4|0)>>2]=1|r[x>>2];else{if(r[c+4>>2]=3|h,r[d+4>>2]=1|l,r[d+l>>2]=l,n=l>>>3,l>>>0<256){i=23356+(n<<1<<2)|0,(e=0|r[5829])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[5829]=e|n,n=i,e=i+8|0),r[e>>2]=d,r[n+12>>2]=d,r[d+8>>2]=n,r[d+12>>2]=i;break}if(n=23620+((i=(n=l>>>8)?l>>>0>16777215?31:l>>>((i=14-((v=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(i=((x<<=v)+245760|0)>>>16&2))+(x<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[d+28>>2]=i,r[(e=d+16|0)+4>>2]=0,r[e>>2]=0,!(o&(e=1<<i))){r[5830]=o|e,r[n>>2]=d,r[d+24>>2]=n,r[d+12>>2]=d,r[d+8>>2]=d;break}n=0|r[n>>2];t:do{if((-8&r[n+4>>2]|0)!=(0|l)){for(o=l<<(31==(0|i)?0:25-(i>>>1)|0);e=0|r[(i=n+16+(o>>>31<<2)|0)>>2];){if((-8&r[e+4>>2]|0)==(0|l)){n=e;break t}o<<=1,n=e}r[i>>2]=d,r[d+24>>2]=n,r[d+12>>2]=d,r[d+8>>2]=d;break e}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=d,r[b>>2]=d,r[d+8>>2]=x,r[d+12>>2]=n,r[d+24>>2]=0}}while(0);return M=t,0|(x=c+8|0)}f=h}else f=h;else f=-1}while(0);if((i=0|r[5831])>>>0>=f>>>0)return n=i-f|0,e=0|r[5834],n>>>0>15?(x=e+f|0,r[5834]=x,r[5831]=n,r[x+4>>2]=1|n,r[e+i>>2]=n,r[e+4>>2]=3|f):(r[5831]=0,r[5834]=0,r[e+4>>2]=3|i,r[(x=e+i+4|0)>>2]=1|r[x>>2]),M=t,0|(x=e+8|0);if((l=0|r[5832])>>>0>f>>>0)return v=l-f|0,r[5832]=v,b=(x=0|r[5835])+f|0,r[5835]=b,r[b+4>>2]=1|v,r[x+4>>2]=3|f,M=t,0|(x=x+8|0);if(0|r[5947]?e=0|r[5949]:(r[5949]=4096,r[5948]=4096,r[5950]=-1,r[5951]=-1,r[5952]=0,r[5940]=0,r[5947]=-16&p^1431655768,e=4096),c=f+48|0,(h=(a=e+(u=f+47|0)|0)&(s=0-e|0))>>>0<=f>>>0)return M=t,0|(x=0);if(0|(e=0|r[5939])&&(p=(d=0|r[5937])+h|0)>>>0<=d>>>0|p>>>0>e>>>0)return M=t,0|(x=0);e:do{if(4&r[5940])n=0,g=143;else{i=0|r[5835];t:do{if(i){for(o=23764;!((p=0|r[o>>2])>>>0<=i>>>0&&(p+(0|r[o+4>>2])|0)>>>0>i>>>0);){if(!(e=0|r[o+8>>2])){g=128;break t}o=e}if((n=a-l&s)>>>0<2147483647)if((0|(e=0|It(0|n)))==((0|r[o>>2])+(0|r[o+4>>2])|0)){if(-1!=(0|e)){l=n,a=e,g=145;break e}}else o=e,g=136;else n=0}else g=128}while(0);do{if(128==(0|g))if(-1!=(0|(i=0|It(0)))&&(n=i,m=(n=(0==((m=(A=0|r[5948])+-1|0)&n|0)?0:(m+n&0-A)-n|0)+h|0)+(A=0|r[5937])|0,n>>>0>f>>>0&n>>>0<2147483647)){if(0|(p=0|r[5939])&&m>>>0<=A>>>0|m>>>0>p>>>0){n=0;break}if((0|(e=0|It(0|n)))==(0|i)){l=n,a=i,g=145;break e}o=e,g=136}else n=0}while(0);do{if(136==(0|g)){if(i=0-n|0,!(c>>>0>n>>>0&n>>>0<2147483647&-1!=(0|o))){if(-1==(0|o)){n=0;break}l=n,a=o,g=145;break e}if((e=u-n+(e=0|r[5949])&0-e)>>>0>=2147483647){l=n,a=o,g=145;break e}if(-1==(0|It(0|e))){It(0|i),n=0;break}l=e+n|0,a=o,g=145;break e}}while(0);r[5940]=4|r[5940],g=143}}while(0);if(143==(0|g)&&h>>>0<2147483647&&!(-1==(0|(v=0|It(0|h)))|1^(_=(y=(m=0|It(0))-v|0)>>>0>(f+40|0)>>>0)|v>>>0<m>>>0&-1!=(0|v)&-1!=(0|m)^1)&&(l=_?y:n,a=v,g=145),145==(0|g)){n=(0|r[5937])+l|0,r[5937]=n,n>>>0>(0|r[5938])>>>0&&(r[5938]=n),u=0|r[5835];e:do{if(u){for(n=23764;;){if((0|a)==((e=0|r[n>>2])+(i=0|r[n+4>>2])|0)){g=154;break}if(!(o=0|r[n+8>>2]))break;n=o}if(154==(0|g)&&(b=n+4|0,0==(8&r[n+12>>2]|0))&&a>>>0>u>>>0&e>>>0<=u>>>0){r[b>>2]=i+l,b=u+(v=0==(7&(v=u+8|0)|0)?0:0-v&7)|0,v=(x=(0|r[5832])+l|0)-v|0,r[5835]=b,r[5832]=v,r[b+4>>2]=1|v,r[u+x+4>>2]=40,r[5836]=r[5951];break}for(a>>>0<(0|r[5833])>>>0&&(r[5833]=a),i=a+l|0,n=23764;;){if((0|r[n>>2])==(0|i)){g=162;break}if(!(e=0|r[n+8>>2]))break;n=e}if(162==(0|g)&&0==(8&r[n+12>>2]|0)){r[n>>2]=a,r[(d=n+4|0)>>2]=(0|r[d>>2])+l,h=(d=a+(0==(7&(d=a+8|0)|0)?0:0-d&7)|0)+f|0,c=(n=i+(0==(7&(n=i+8|0)|0)?0:0-n&7)|0)-d-f|0,r[d+4>>2]=3|f;t:do{if((0|u)==(0|n))x=(0|r[5832])+c|0,r[5832]=x,r[5835]=h,r[h+4>>2]=1|x;else{if((0|r[5834])==(0|n)){x=(0|r[5831])+c|0,r[5831]=x,r[5834]=h,r[h+4>>2]=1|x,r[h+x>>2]=x;break}if(1==(3&(e=0|r[n+4>>2])|0)){l=-8&e,o=e>>>3;n:do{if(e>>>0<256){if(e=0|r[n+8>>2],(0|(i=0|r[n+12>>2]))==(0|e)){r[5829]=r[5829]&~(1<<o);break}r[e+12>>2]=i,r[i+8>>2]=e;break}a=0|r[n+24>>2],e=0|r[n+12>>2];do{if((0|e)==(0|n)){if(e=0|r[(o=(i=n+16|0)+4|0)>>2])i=o;else if(!(e=0|r[i>>2])){e=0;break}for(;;)if(o=0|r[(s=e+20|0)>>2])e=o,i=s;else{if(!(o=0|r[(s=e+16|0)>>2]))break;e=o,i=s}r[i>>2]=0}else x=0|r[n+8>>2],r[x+12>>2]=e,r[e+8>>2]=x}while(0);if(!a)break;o=23620+((i=0|r[n+28>>2])<<2)|0;do{if((0|r[o>>2])==(0|n)){if(r[o>>2]=e,0|e)break;r[5830]=r[5830]&~(1<<i);break n}if(r[((0|r[(x=a+16|0)>>2])==(0|n)?x:a+20|0)>>2]=e,!e)break n}while(0);if(r[e+24>>2]=a,0|(o=0|r[(i=n+16|0)>>2])&&(r[e+16>>2]=o,r[o+24>>2]=e),!(i=0|r[i+4>>2]))break;r[e+20>>2]=i,r[i+24>>2]=e}while(0);n=n+l|0,s=l+c|0}else s=c;if(r[(n=n+4|0)>>2]=-2&r[n>>2],r[h+4>>2]=1|s,r[h+s>>2]=s,n=s>>>3,s>>>0<256){i=23356+(n<<1<<2)|0,(e=0|r[5829])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[5829]=e|n,n=i,e=i+8|0),r[e>>2]=h,r[n+12>>2]=h,r[h+8>>2]=n,r[h+12>>2]=i;break}n=s>>>8;do{if(n){if(s>>>0>16777215){o=31;break}o=s>>>((o=14-((v=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(o=((x<<=v)+245760|0)>>>16&2))+(x<<o>>>15)|0)+7|0)&1|o<<1}else o=0}while(0);if(n=23620+(o<<2)|0,r[h+28>>2]=o,r[(e=h+16|0)+4>>2]=0,r[e>>2]=0,!((e=0|r[5830])&(i=1<<o))){r[5830]=e|i,r[n>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break}n=0|r[n>>2];n:do{if((-8&r[n+4>>2]|0)!=(0|s)){for(o=s<<(31==(0|o)?0:25-(o>>>1)|0);e=0|r[(i=n+16+(o>>>31<<2)|0)>>2];){if((-8&r[e+4>>2]|0)==(0|s)){n=e;break n}o<<=1,n=e}r[i>>2]=h,r[h+24>>2]=n,r[h+12>>2]=h,r[h+8>>2]=h;break t}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=h,r[b>>2]=h,r[h+8>>2]=x,r[h+12>>2]=n,r[h+24>>2]=0}}while(0);return M=t,0|(x=d+8|0)}for(n=23764;!((e=0|r[n>>2])>>>0<=u>>>0&&(x=e+(0|r[n+4>>2])|0)>>>0>u>>>0);)n=0|r[n+8>>2];n=(e=(e=(s=x+-47|0)+(0==(7&(e=s+8|0)|0)?0:0-e&7)|0)>>>0<(s=u+16|0)>>>0?u:e)+8|0,b=a+(v=0==(7&(v=a+8|0)|0)?0:0-v&7)|0,v=(i=l+-40|0)-v|0,r[5835]=b,r[5832]=v,r[b+4>>2]=1|v,r[a+i+4>>2]=40,r[5836]=r[5951],r[(i=e+4|0)>>2]=27,r[n>>2]=r[5941],r[n+4>>2]=r[5942],r[n+8>>2]=r[5943],r[n+12>>2]=r[5944],r[5941]=a,r[5942]=l,r[5944]=0,r[5943]=n,n=e+24|0;do{b=n,r[(n=n+4|0)>>2]=7}while((b+8|0)>>>0<x>>>0);if((0|e)!=(0|u)){if(a=e-u|0,r[i>>2]=-2&r[i>>2],r[u+4>>2]=1|a,r[e>>2]=a,n=a>>>3,a>>>0<256){i=23356+(n<<1<<2)|0,(e=0|r[5829])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[5829]=e|n,n=i,e=i+8|0),r[e>>2]=u,r[n+12>>2]=u,r[u+8>>2]=n,r[u+12>>2]=i;break}if(i=23620+((o=(n=a>>>8)?a>>>0>16777215?31:a>>>((o=14-((v=((x=n<<(b=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|b|(o=((x<<=v)+245760|0)>>>16&2))+(x<<o>>>15)|0)+7|0)&1|o<<1:0)<<2)|0,r[u+28>>2]=o,r[u+20>>2]=0,r[s>>2]=0,!((n=0|r[5830])&(e=1<<o))){r[5830]=n|e,r[i>>2]=u,r[u+24>>2]=i,r[u+12>>2]=u,r[u+8>>2]=u;break}n=0|r[i>>2];t:do{if((-8&r[n+4>>2]|0)!=(0|a)){for(o=a<<(31==(0|o)?0:25-(o>>>1)|0);e=0|r[(i=n+16+(o>>>31<<2)|0)>>2];){if((-8&r[e+4>>2]|0)==(0|a)){n=e;break t}o<<=1,n=e}r[i>>2]=u,r[u+24>>2]=n,r[u+12>>2]=u,r[u+8>>2]=u;break e}}while(0);x=0|r[(b=n+8|0)>>2],r[x+12>>2]=u,r[b>>2]=u,r[u+8>>2]=x,r[u+12>>2]=n,r[u+24>>2]=0}}else 0==(0|(x=0|r[5833]))|a>>>0<x>>>0&&(r[5833]=a),r[5941]=a,r[5942]=l,r[5944]=0,r[5838]=r[5947],r[5837]=-1,r[5842]=23356,r[5841]=23356,r[5844]=23364,r[5843]=23364,r[5846]=23372,r[5845]=23372,r[5848]=23380,r[5847]=23380,r[5850]=23388,r[5849]=23388,r[5852]=23396,r[5851]=23396,r[5854]=23404,r[5853]=23404,r[5856]=23412,r[5855]=23412,r[5858]=23420,r[5857]=23420,r[5860]=23428,r[5859]=23428,r[5862]=23436,r[5861]=23436,r[5864]=23444,r[5863]=23444,r[5866]=23452,r[5865]=23452,r[5868]=23460,r[5867]=23460,r[5870]=23468,r[5869]=23468,r[5872]=23476,r[5871]=23476,r[5874]=23484,r[5873]=23484,r[5876]=23492,r[5875]=23492,r[5878]=23500,r[5877]=23500,r[5880]=23508,r[5879]=23508,r[5882]=23516,r[5881]=23516,r[5884]=23524,r[5883]=23524,r[5886]=23532,r[5885]=23532,r[5888]=23540,r[5887]=23540,r[5890]=23548,r[5889]=23548,r[5892]=23556,r[5891]=23556,r[5894]=23564,r[5893]=23564,r[5896]=23572,r[5895]=23572,r[5898]=23580,r[5897]=23580,r[5900]=23588,r[5899]=23588,r[5902]=23596,r[5901]=23596,r[5904]=23604,r[5903]=23604,b=a+(v=0==(7&(v=a+8|0)|0)?0:0-v&7)|0,v=(x=l+-40|0)-v|0,r[5835]=b,r[5832]=v,r[b+4>>2]=1|v,r[a+x+4>>2]=40,r[5836]=r[5951]}while(0);if((n=0|r[5832])>>>0>f>>>0)return v=n-f|0,r[5832]=v,b=(x=0|r[5835])+f|0,r[5835]=b,r[b+4>>2]=1|v,r[x+4>>2]=3|f,M=t,0|(x=x+8|0)}return r[(x=23312)>>2]=12,M=t,0|(x=0)}function yt(e){var t=0,n=0,i=0,o=0,s=0,a=0,l=0,c=0;if(e|=0){n=e+-8|0,o=0|r[5833],c=n+(t=-8&(e=0|r[e+-4>>2]))|0;do{if(1&e)l=n,a=n;else{if(i=0|r[n>>2],!(3&e))return;if(s=i+t|0,(a=n+(0-i)|0)>>>0<o>>>0)return;if((0|r[5834])==(0|a)){if(3!=(3&(t=0|r[(e=c+4|0)>>2])|0)){l=a,t=s;break}return r[5831]=s,r[e>>2]=-2&t,r[a+4>>2]=1|s,void(r[a+s>>2]=s)}if(n=i>>>3,i>>>0<256){if(e=0|r[a+8>>2],(0|(t=0|r[a+12>>2]))==(0|e)){r[5829]=r[5829]&~(1<<n),l=a,t=s;break}r[e+12>>2]=t,r[t+8>>2]=e,l=a,t=s;break}o=0|r[a+24>>2],e=0|r[a+12>>2];do{if((0|e)==(0|a)){if(e=0|r[(n=(t=a+16|0)+4|0)>>2])t=n;else if(!(e=0|r[t>>2])){e=0;break}for(;;)if(n=0|r[(i=e+20|0)>>2])e=n,t=i;else{if(!(n=0|r[(i=e+16|0)>>2]))break;e=n,t=i}r[t>>2]=0}else l=0|r[a+8>>2],r[l+12>>2]=e,r[e+8>>2]=l}while(0);if(o){if(t=0|r[a+28>>2],(0|r[(n=23620+(t<<2)|0)>>2])==(0|a)){if(r[n>>2]=e,!e){r[5830]=r[5830]&~(1<<t),l=a,t=s;break}}else if(r[((0|r[(l=o+16|0)>>2])==(0|a)?l:o+20|0)>>2]=e,!e){l=a,t=s;break}r[e+24>>2]=o,0|(n=0|r[(t=a+16|0)>>2])&&(r[e+16>>2]=n,r[n+24>>2]=e),(t=0|r[t+4>>2])?(r[e+20>>2]=t,r[t+24>>2]=e,l=a,t=s):(l=a,t=s)}else l=a,t=s}}while(0);if(!(a>>>0>=c>>>0)&&1&(i=0|r[(e=c+4|0)>>2])){if(2&i)r[e>>2]=-2&i,r[l+4>>2]=1|t,r[a+t>>2]=t,o=t;else{if((0|r[5835])==(0|c)){if(c=(0|r[5832])+t|0,r[5832]=c,r[5835]=l,r[l+4>>2]=1|c,(0|l)!=(0|r[5834]))return;return r[5834]=0,void(r[5831]=0)}if((0|r[5834])==(0|c))return c=(0|r[5831])+t|0,r[5831]=c,r[5834]=a,r[l+4>>2]=1|c,void(r[a+c>>2]=c);o=(-8&i)+t|0,n=i>>>3;do{if(i>>>0<256){if(t=0|r[c+8>>2],(0|(e=0|r[c+12>>2]))==(0|t)){r[5829]=r[5829]&~(1<<n);break}r[t+12>>2]=e,r[e+8>>2]=t;break}s=0|r[c+24>>2],e=0|r[c+12>>2];do{if((0|e)==(0|c)){if(e=0|r[(n=(t=c+16|0)+4|0)>>2])t=n;else if(!(e=0|r[t>>2])){n=0;break}for(;;)if(n=0|r[(i=e+20|0)>>2])e=n,t=i;else{if(!(n=0|r[(i=e+16|0)>>2]))break;e=n,t=i}r[t>>2]=0,n=e}else n=0|r[c+8>>2],r[n+12>>2]=e,r[e+8>>2]=n,n=e}while(0);if(0|s){if(e=0|r[c+28>>2],(0|r[(t=23620+(e<<2)|0)>>2])==(0|c)){if(r[t>>2]=n,!n){r[5830]=r[5830]&~(1<<e);break}}else if(r[((0|r[(i=s+16|0)>>2])==(0|c)?i:s+20|0)>>2]=n,!n)break;r[n+24>>2]=s,0|(t=0|r[(e=c+16|0)>>2])&&(r[n+16>>2]=t,r[t+24>>2]=n),0|(e=0|r[e+4>>2])&&(r[n+20>>2]=e,r[e+24>>2]=n)}}while(0);if(r[l+4>>2]=1|o,r[a+o>>2]=o,(0|l)==(0|r[5834]))return void(r[5831]=o)}if(e=o>>>3,o>>>0<256)return n=23356+(e<<1<<2)|0,(t=0|r[5829])&(e=1<<e)?e=0|r[(t=n+8|0)>>2]:(r[5829]=t|e,e=n,t=n+8|0),r[t>>2]=l,r[e+12>>2]=l,r[l+8>>2]=e,void(r[l+12>>2]=n);e=23620+((i=(e=o>>>8)?o>>>0>16777215?31:o>>>((i=14-((s=((c=e<<(a=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|a|(i=((c<<=s)+245760|0)>>>16&2))+(c<<i>>>15)|0)+7|0)&1|i<<1:0)<<2)|0,r[l+28>>2]=i,r[l+20>>2]=0,r[l+16>>2]=0,t=0|r[5830],n=1<<i;e:do{if(t&n){e=0|r[e>>2];t:do{if((-8&r[e+4>>2]|0)!=(0|o)){for(i=o<<(31==(0|i)?0:25-(i>>>1)|0);t=0|r[(n=e+16+(i>>>31<<2)|0)>>2];){if((-8&r[t+4>>2]|0)==(0|o)){e=t;break t}i<<=1,e=t}r[n>>2]=l,r[l+24>>2]=e,r[l+12>>2]=l,r[l+8>>2]=l;break e}}while(0);c=0|r[(a=e+8|0)>>2],r[c+12>>2]=l,r[a>>2]=l,r[l+8>>2]=c,r[l+12>>2]=e,r[l+24>>2]=0}else r[5830]=t|n,r[e>>2]=l,r[l+24>>2]=e,r[l+12>>2]=l,r[l+8>>2]=l}while(0);if(c=(0|r[5837])-1|0,r[5837]=c,!(0|c)){for(e=23772;e=0|r[e>>2];)e=e+8|0;r[5837]=-1}}}}function _t(e,t){t|=0;var n=0;return(e|=0)?(n=0|_(t,e),(t|e)>>>0>65535&&(n=(0|(n>>>0)/(e>>>0))==(0|t)?n:-1)):n=0,(e=0|gt(n))&&3&r[e+-4>>2]?(Pt(0|e,0,0|n),0|e):0|e}function vt(e,t,n,i){return 0|(x(0|(i=(t|=0)-(i|=0)-((n|=0)>>>0>(e|=0)>>>0|0)>>>0)),e-n>>>0|0)}function bt(e){return 0|((e|=0)?31-(0|b(e^e-1))|0:32)}function xt(e,t,n,i,o){o|=0;var s=0,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0;if(h=e|=0,a=n|=0,l=f=i|=0,!(u=c=t|=0))return s=0!=(0|o),l?s?(r[o>>2]=0|e,r[o+4>>2]=0&t,o=0,0|(x(0|(f=0)),o)):(o=0,0|(x(0|(f=0)),o)):(s&&(r[o>>2]=(h>>>0)%(a>>>0),r[o+4>>2]=0),o=(h>>>0)/(a>>>0)>>>0,0|(x(0|(f=0)),o));s=0==(0|l);do{if(a){if(!s){if((s=(0|b(0|l))-(0|b(0|u))|0)>>>0<=31){a=d=s+1|0,e=h>>>(d>>>0)&(t=s-31>>31)|u<<(l=31-s|0),t&=u>>>(d>>>0),s=0,l=h<<l;break}return o?(r[o>>2]=0|e,r[o+4>>2]=c|0&t,o=0,0|(x(0|(f=0)),o)):(o=0,0|(x(0|(f=0)),o))}if((s=a-1|0)&a|0){a=l=33+(0|b(0|a))-(0|b(0|u))|0,e=(d=32-l|0)-1>>31&u>>>((p=l-32|0)>>>0)|(u<<d|h>>>(l>>>0))&(t=p>>31),t&=u>>>(l>>>0),s=h<<(A=64-l|0)&(c=d>>31),l=(u<<A|h>>>(p>>>0))&c|h<<d&l-33>>31;break}return 0|o&&(r[o>>2]=s&h,r[o+4>>2]=0),1==(0|a)?(A=0|e,0|(x(0|(p=c|0&t)),A)):(p=u>>>((A=0|bt(0|a))>>>0)|0,A=u<<32-A|h>>>(A>>>0)|0,0|(x(0|p),A))}if(s)return 0|o&&(r[o>>2]=(u>>>0)%(a>>>0),r[o+4>>2]=0),A=(u>>>0)/(a>>>0)>>>0,0|(x(0|(p=0)),A);if(!h)return 0|o&&(r[o>>2]=0,r[o+4>>2]=(u>>>0)%(l>>>0)),A=(u>>>0)/(l>>>0)>>>0,0|(x(0|(p=0)),A);if(!((s=l-1|0)&l))return 0|o&&(r[o>>2]=0|e,r[o+4>>2]=s&u|0&t),p=0,A=u>>>((0|bt(0|l))>>>0),0|(x(0|p),A);if((s=(0|b(0|l))-(0|b(0|u))|0)>>>0<=30){a=t=s+1|0,e=u<<(l=31-s|0)|h>>>(t>>>0),t=u>>>(t>>>0),s=0,l=h<<l;break}return o?(r[o>>2]=0|e,r[o+4>>2]=c|0&t,A=0,0|(x(0|(p=0)),A)):(A=0,0|(x(0|(p=0)),A))}while(0);if(a){u=0|function(e,t,n,i){return 0|(x((t|=0)+(i|=0)+((n=(e|=0)+(n|=0)>>>0)>>>0<e>>>0|0)>>>0|0),0|n)}(0|(d=0|n),0|(h=f|0&i),-1,-1),n=0|w(),c=l,l=0;do{i=c,c=s>>>31|c<<1,s=l|s<<1,vt(0|u,0|n,0|(i=e<<1|i>>>31|0),0|(f=e>>>31|t<<1|0)),l=1&(p=(A=0|w())>>31|((0|A)<0?-1:0)<<1),e=0|vt(0|i,0|f,p&d|0,(((0|A)<0?-1:0)>>31|((0|A)<0?-1:0)<<1)&h|0),t=0|w(),a=a-1|0}while(0!=(0|a));u=c,c=0}else u=l,c=0,l=0;return a=0,0|o&&(r[o>>2]=e,r[o+4>>2]=t),A=-2&(s<<1|0)|l,0|(x(0|(p=(0|s)>>>31|(u|a)<<1|0&(a<<1|s>>>31)|c)),A)}function wt(e,t,n,i){var o,s;return s=M,M=M+16|0,xt(e|=0,t|=0,n|=0,i|=0,o=0|s),M=s,0|(x(0|r[o+4>>2]),0|r[o>>2])}function Et(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(x(t>>>n|0),e>>>n|(t&(1<<n)-1)<<32-n):(x(0),t>>>n-32|0)}function St(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(x(t<<n|(e&(1<<n)-1<<32-n)>>>32-n|0),e<<n):(x(e<<n-32|0),0)}function Tt(e,t){return t=+t,(e=+e)!=e?+t:t!=t?+e:+v(+e,+t)}function kt(e){return(e=+e)>=0?+a(e+.5):+y(e-.5)}function Ct(e,t,n){e|=0,t|=0;var o,s,a=0;if((0|(n|=0))>=8192)return k(0|e,0|t,0|n),0|e;if(s=0|e,o=e+n|0,(3&e)==(3&t)){for(;3&e;){if(!n)return 0|s;i[e>>0]=0|i[t>>0],e=e+1|0,t=t+1|0,n=n-1|0}for(a=(n=-4&o|0)-64|0;(0|e)<=(0|a);)r[e>>2]=r[t>>2],r[e+4>>2]=r[t+4>>2],r[e+8>>2]=r[t+8>>2],r[e+12>>2]=r[t+12>>2],r[e+16>>2]=r[t+16>>2],r[e+20>>2]=r[t+20>>2],r[e+24>>2]=r[t+24>>2],r[e+28>>2]=r[t+28>>2],r[e+32>>2]=r[t+32>>2],r[e+36>>2]=r[t+36>>2],r[e+40>>2]=r[t+40>>2],r[e+44>>2]=r[t+44>>2],r[e+48>>2]=r[t+48>>2],r[e+52>>2]=r[t+52>>2],r[e+56>>2]=r[t+56>>2],r[e+60>>2]=r[t+60>>2],e=e+64|0,t=t+64|0;for(;(0|e)<(0|n);)r[e>>2]=r[t>>2],e=e+4|0,t=t+4|0}else for(n=o-4|0;(0|e)<(0|n);)i[e>>0]=0|i[t>>0],i[e+1>>0]=0|i[t+1>>0],i[e+2>>0]=0|i[t+2>>0],i[e+3>>0]=0|i[t+3>>0],e=e+4|0,t=t+4|0;for(;(0|e)<(0|o);)i[e>>0]=0|i[t>>0],e=e+1|0,t=t+1|0;return 0|s}function Pt(e,t,n){t|=0;var o,s=0,a=0,l=0;if(o=(e|=0)+(n|=0)|0,t&=255,(0|n)>=67){for(;3&e;)i[e>>0]=t,e=e+1|0;for(l=t|t<<8|t<<16|t<<24,a=(s=-4&o|0)-64|0;(0|e)<=(0|a);)r[e>>2]=l,r[e+4>>2]=l,r[e+8>>2]=l,r[e+12>>2]=l,r[e+16>>2]=l,r[e+20>>2]=l,r[e+24>>2]=l,r[e+28>>2]=l,r[e+32>>2]=l,r[e+36>>2]=l,r[e+40>>2]=l,r[e+44>>2]=l,r[e+48>>2]=l,r[e+52>>2]=l,r[e+56>>2]=l,r[e+60>>2]=l,e=e+64|0;for(;(0|e)<(0|s);)r[e>>2]=l,e=e+4|0}for(;(0|e)<(0|o);)i[e>>0]=t,e=e+1|0;return o-n|0}function Mt(e){return(e=+e)>=0?+a(e+.5):+y(e-.5)}function It(e){e|=0;var t,n,i;return i=0|T(),(0|e)>0&(0|(t=(n=0|r[s>>2])+e|0))<(0|n)|(0|t)<0?(P(0|t),S(12),-1):(0|t)>(0|i)&&!(0|C(0|t))?(S(12),-1):(r[s>>2]=t,0|n)}return{___uremdi3:wt,_bitshift64Lshr:Et,_bitshift64Shl:St,_calloc:_t,_cellAreaKm2:function(e,t){var n,i,o,s=0;if(o=M,M=M+192|0,i=o,We(e|=0,t|=0,n=o+168|0),$e(e,t,i),(0|(t=0|r[i>>2]))>0){if(s=+Pe(i+8|0,i+8+((1!=(0|t)&1)<<4)|0,n)+0,1!=(0|t)){e=1;do{s+=+Pe(i+8+(e<<4)|0,i+8+(((0|(e=e+1|0))%(0|t)|0)<<4)|0,n)}while((0|e)<(0|t))}}else s=0;return M=o,6371.007180918475*s*6371.007180918475},_cellAreaM2:function(e,t){var n,i,o,s=0;if(o=M,M=M+192|0,i=o,We(e|=0,t|=0,n=o+168|0),$e(e,t,i),(0|(t=0|r[i>>2]))>0){if(s=+Pe(i+8|0,i+8+((1!=(0|t)&1)<<4)|0,n)+0,1!=(0|t)){e=1;do{s+=+Pe(i+8+(e<<4)|0,i+8+(((0|(e=e+1|0))%(0|t)|0)<<4)|0,n)}while((0|e)<(0|t))}}else s=0;return M=o,6371.007180918475*s*6371.007180918475*1e3*1e3},_cellAreaRads2:function(e,t){var n,i,o,s=0;if(o=M,M=M+192|0,i=o,We(e|=0,t|=0,n=o+168|0),$e(e,t,i),(0|(t=0|r[i>>2]))<=0)return M=o,+(s=0);if(s=+Pe(i+8|0,i+8+((1!=(0|t)&1)<<4)|0,n)+0,1==(0|t))return M=o,+s;e=1;do{s+=+Pe(i+8+(e<<4)|0,i+8+(((0|(e=e+1|0))%(0|t)|0)<<4)|0,n)}while((0|e)<(0|t));return M=o,+s},_compact:function(e,t,n){t|=0;var i,o=0,s=0,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0,x=0,E=0,S=0,T=0;if(!(n|=0))return 0|(S=0);if(o=0|r[(s=e|=0)>>2],!0&0==(15728640&(s=0|r[s+4>>2])|0)){if((0|n)<=0)return 0|(S=0);if(r[(S=t)>>2]=o,r[S+4>>2]=s,1==(0|n))return 0|(S=0);o=1;do{E=0|r[(x=e+(o<<3)|0)+4>>2],r[(S=t+(o<<3)|0)>>2]=r[x>>2],r[S+4>>2]=E,o=o+1|0}while((0|o)!=(0|n));return 0|(o=0)}if(!(E=0|gt(x=n<<3)))return 0|(S=-3);if(Ct(0|E,0|e,0|x),!(i=0|_t(n,8)))return yt(E),0|(S=-3);o=n;e:for(;;){v=0|Et(0|(d=0|r[(l=E)>>2]),0|(l=0|r[l+4>>2]),52),w(),b=(v&=15)+-1|0,_=(0|o)>0;t:do{if(_){if(y=((0|o)<0)<<31>>31,m=0|St(0|b,0,52),g=0|w(),b>>>0>15)for(s=0,e=d,n=l;;){if(!(0==(0|e)&0==(0|n))){if(a=0|Et(0|e,0|n,52),w(),c=(0|(a&=15))<(0|b),a=(0|a)==(0|b),n=0|wt(0|(h=c?0:a?e:0),0|(e=c?0:a?n:0),0|o,0|y),w(),0==(0|(u=0|r[(c=a=i+(n<<3)|0)>>2]))&0==(0|(c=0|r[c+4>>2])))n=h;else for(m=0,A=n,p=c,n=h;;){if((0|m)>(0|o)){S=41;break e}if((0|u)==(0|n)&(-117440513&p|0)==(0|e)){h=0|Et(0|u,0|p,56),w(),f=(h&=7)+1|0,g=0|Et(0|u,0|p,45),w();n:do{if(0|O(127&g)){if(u=0|Et(0|u,0|p,52),w(),!(u&=15)){c=6;break}for(c=1;;){if(!(0==((g=0|St(7,0,3*(15-c|0)|0))&n|0)&0==((0|w())&e|0))){c=7;break n}if(!(c>>>0<u>>>0)){c=6;break}c=c+1|0}}else c=7}while(0);if((h+2|0)>>>0>c>>>0){S=51;break e}g=0|St(0|f,0,56),e=0|w()|-117440513&e,r[(c=a)>>2]=0,r[c+4>>2]=0,c=A,n|=g}else c=(A+1|0)%(0|o)|0;if(0==(0|(u=0|r[(p=a=i+(c<<3)|0)>>2]))&0==(0|(p=0|r[p+4>>2])))break;m=m+1|0,A=c}r[(g=a)>>2]=n,r[g+4>>2]=e}if((0|(s=s+1|0))>=(0|o))break t;e=0|r[(n=E+(s<<3)|0)>>2],n=0|r[n+4>>2]}for(s=0,e=d,n=l;;){if(!(0==(0|e)&0==(0|n))){if(c=0|Et(0|e,0|n,52),w(),(0|(c&=15))>=(0|b)){if((0|c)!=(0|b)&&(e|=m,n=-15728641&n|g,c>>>0>=v>>>0)){a=b;do{A=0|St(7,0,3*(14-a|0)|0),a=a+1|0,e|=A,n=0|w()|n}while(a>>>0<c>>>0)}}else e=0,n=0;if(c=0|wt(0|e,0|n,0|o,0|y),w(),!(0==(0|(h=0|r[(u=a=i+(c<<3)|0)>>2]))&0==(0|(u=0|r[u+4>>2]))))for(A=0;;){if((0|A)>(0|o)){S=41;break e}if((0|h)==(0|e)&(-117440513&u|0)==(0|n)){f=0|Et(0|h,0|u,56),w(),p=(f&=7)+1|0,T=0|Et(0|h,0|u,45),w();n:do{if(0|O(127&T)){if(h=0|Et(0|h,0|u,52),w(),!(h&=15)){u=6;break}for(u=1;;){if(!(0==((T=0|St(7,0,3*(15-u|0)|0))&e|0)&0==((0|w())&n|0))){u=7;break n}if(!(u>>>0<h>>>0)){u=6;break}u=u+1|0}}else u=7}while(0);if((f+2|0)>>>0>u>>>0){S=51;break e}T=0|St(0|p,0,56),n=0|w()|-117440513&n,r[(p=a)>>2]=0,r[p+4>>2]=0,e|=T}else c=(c+1|0)%(0|o)|0;if(0==(0|(h=0|r[(u=a=i+(c<<3)|0)>>2]))&0==(0|(u=0|r[u+4>>2])))break;A=A+1|0}r[(T=a)>>2]=e,r[T+4>>2]=n}if((0|(s=s+1|0))>=(0|o))break t;e=0|r[(n=E+(s<<3)|0)>>2],n=0|r[n+4>>2]}}}while(0);if((o+5|0)>>>0<11){S=99;break}if(!(g=0|_t((0|o)/6|0,8))){S=58;break}t:do{if(_){A=0,p=0;do{if(!(0==(0|(s=0|r[(e=c=i+(A<<3)|0)>>2]))&0==(0|(e=0|r[e+4>>2])))){u=0|Et(0|s,0|e,56),w(),n=(u&=7)+1|0,h=-117440513&e,T=0|Et(0|s,0|e,45),w();n:do{if(0|O(127&T)){if(f=0|Et(0|s,0|e,52),w(),0|(f&=15))for(a=1;;){if(!(0==(s&(T=0|St(7,0,3*(15-a|0)|0))|0)&0==(h&(0|w())|0)))break n;if(!(a>>>0<f>>>0))break;a=a+1|0}s|=e=0|St(0|n,0,56),e=0|w()|h,r[(n=c)>>2]=s,r[n+4>>2]=e,n=u+2|0}}while(0);7==(0|n)&&(r[(T=g+(p<<3)|0)>>2]=s,r[T+4>>2]=-117440513&e,p=p+1|0)}A=A+1|0}while((0|A)!=(0|o));if(_){if(m=((0|o)<0)<<31>>31,f=0|St(0|b,0,52),A=0|w(),b>>>0>15)for(e=0,s=0;;){do{if(!(0==(0|d)&0==(0|l))){for(u=0|Et(0|d,0|l,52),w(),a=(0|(u&=15))<(0|b),u=(0|u)==(0|b),a=0|wt(0|(c=a?0:u?d:0),0|(u=a?0:u?l:0),0|o,0|m),w(),n=0;;){if((0|n)>(0|o)){S=98;break e}if((-117440513&(h=0|r[(T=i+(a<<3)|0)+4>>2])|0)==(0|u)&&(0|r[T>>2])==(0|c)){S=70;break}if((0|r[(T=i+((a=(a+1|0)%(0|o)|0)<<3)|0)>>2])==(0|c)&&(0|r[T+4>>2])==(0|u))break;n=n+1|0}if(70==(0|S)&&(S=0,!0&100663296==(117440512&h|0)))break;r[(T=t+(s<<3)|0)>>2]=d,r[T+4>>2]=l,s=s+1|0}}while(0);if((0|(e=e+1|0))>=(0|o)){o=p;break t}d=0|r[(l=E+(e<<3)|0)>>2],l=0|r[l+4>>2]}for(e=0,s=0;;){do{if(!(0==(0|d)&0==(0|l))){if(u=0|Et(0|d,0|l,52),w(),(0|(u&=15))>=(0|b))if((0|u)!=(0|b))if(n=d|f,a=-15728641&l|A,u>>>0<v>>>0)u=a;else{c=b;do{T=0|St(7,0,3*(14-c|0)|0),c=c+1|0,n|=T,a=0|w()|a}while(c>>>0<u>>>0);u=a}else n=d,u=l;else n=0,u=0;for(c=0|wt(0|n,0|u,0|o,0|m),w(),a=0;;){if((0|a)>(0|o)){S=98;break e}if((-117440513&(h=0|r[(T=i+(c<<3)|0)+4>>2])|0)==(0|u)&&(0|r[T>>2])==(0|n)){S=93;break}if((0|r[(T=i+((c=(c+1|0)%(0|o)|0)<<3)|0)>>2])==(0|n)&&(0|r[T+4>>2])==(0|u))break;a=a+1|0}if(93==(0|S)&&(S=0,!0&100663296==(117440512&h|0)))break;r[(T=t+(s<<3)|0)>>2]=d,r[T+4>>2]=l,s=s+1|0}}while(0);if((0|(e=e+1|0))>=(0|o)){o=p;break t}d=0|r[(l=E+(e<<3)|0)>>2],l=0|r[l+4>>2]}}else s=0,o=p}else s=0,o=0}while(0);if(Pt(0|i,0,0|x),Ct(0|E,0|g,o<<3|0),yt(g),!o)break;t=t+(s<<3)|0}return 41==(0|S)?(yt(E),yt(i),0|(T=-1)):51==(0|S)?(yt(E),yt(i),0|(T=-2)):58==(0|S)?(yt(E),yt(i),0|(T=-3)):98==(0|S)?(yt(g),yt(E),yt(i),0|(T=-1)):(99==(0|S)&&Ct(0|t,0|E,o<<3|0),yt(E),yt(i),0|(T=0))},_destroyLinkedPolygon:function(e){var t=0,n=0,i=0,o=0;if(e|=0)for(i=1;;){if(0|(t=0|r[e>>2]))do{if(0|(n=0|r[t>>2]))do{o=n,n=0|r[n+16>>2],yt(o)}while(0!=(0|n));o=t,t=0|r[t+8>>2],yt(o)}while(0!=(0|t));if(t=e,e=0|r[e+8>>2],i||yt(t),!e)break;i=0}},_edgeLengthKm:function(e){return+ +o[20752+((e|=0)<<3)>>3]},_edgeLengthM:function(e){return+ +o[20880+((e|=0)<<3)>>3]},_emscripten_replace_memory:function(e){return i=new Int8Array(e),r=new Int32Array(e),o=new Float64Array(e),n=e,!0},_exactEdgeLengthKm:function(e,t){var n,i,s=0,a=0,l=0,u=0,f=0,p=0;if(i=M,M=M+176|0,He(e|=0,t|=0,n=i),(0|(e=0|r[n>>2]))<=1)return M=i,+(l=0);t=e+-1|0,e=0,s=0,a=+o[n+8>>3],l=+o[n+16>>3];do{f=a,a=+o[n+8+((e=e+1|0)<<4)>>3],p=+d(.5*(a-f)),u=l,l=+o[n+8+(e<<4)+8>>3],u=p*p+(u=+d(.5*(l-u)))*(+h(+f)*+h(+a)*u),s+=2*+g(+ +c(+u),+ +c(+(1-u)))}while((0|e)!=(0|t));return M=i,+(p=6371.007180918475*s)},_exactEdgeLengthM:function(e,t){var n,i,s=0,a=0,l=0,u=0,f=0,p=0;if(i=M,M=M+176|0,He(e|=0,t|=0,n=i),(0|(e=0|r[n>>2]))<=1)return M=i,+(l=0);t=e+-1|0,e=0,s=0,a=+o[n+8>>3],l=+o[n+16>>3];do{f=a,a=+o[n+8+((e=e+1|0)<<4)>>3],p=+d(.5*(a-f)),u=l,l=+o[n+8+(e<<4)+8>>3],u=p*p+(u=+d(.5*(l-u)))*(+h(+f)*+h(+a)*u),s+=2*+g(+ +c(+u),+ +c(+(1-u)))}while((0|e)!=(0|t));return M=i,+(p=6371.007180918475*s*1e3)},_exactEdgeLengthRads:function(e,t){var n,i,s=0,a=0,l=0,u=0,f=0,p=0;if(i=M,M=M+176|0,He(e|=0,t|=0,n=i),(0|(e=0|r[n>>2]))<=1)return M=i,+(l=0);t=e+-1|0,e=0,s=0,a=+o[n+8>>3],l=+o[n+16>>3];do{f=a,a=+o[n+8+((e=e+1|0)<<4)>>3],p=+d(.5*(a-f)),u=l,l=+o[n+8+(e<<4)+8>>3],u=p*p+(u=+d(.5*(l-u)))*(+h(+a)*+h(+f)*u),s+=2*+g(+ +c(+u),+ +c(+(1-u)))}while((0|e)<(0|t));return M=i,+s},_experimentalH3ToLocalIj:function(e,t,n,i,r){var o,s;return r|=0,s=M,M=M+16|0,(e=0|Je(e|=0,t|=0,n|=0,i|=0,o=s))||(fe(o,r),e=0),M=s,0|e},_experimentalLocalIjToH3:function(e,t,n,i){var r,o;return e|=0,t|=0,i|=0,r=M,M=M+16|0,pe(n|=0,o=r),i=0|et(e,t,o,i),M=r,0|i},_free:yt,_geoToH3:je,_getDestinationH3IndexFromUnidirectionalEdge:function(e,t){e|=0;var n,i,o=0;return n=M,M=M+16|0,o=n,!0&268435456==(2013265920&(t|=0)|0)?(i=0|Et(0|e,0|t,56),w(),r[o>>2]=0,o=0|z(e,-2130706433&t|134217728,7&i,o),t=0|w(),x(0|t),M=n,0|o):(o=0,x(0|(t=0)),M=n,0|o)},_getH3IndexesFromUnidirectionalEdge:function(e,t,n){e|=0;var i,o,s,a,l=0;s=M,M=M+16|0,i=s,a=!0&268435456==(2013265920&(t|=0)|0),o=-2130706433&t|134217728,r[(l=n|=0)>>2]=a?e:0,r[l+4>>2]=a?o:0,a?(t=0|Et(0|e,0|t,56),w(),r[i>>2]=0,e=0|z(e,o,7&t,i),t=0|w()):(e=0,t=0),r[(l=n+8|0)>>2]=e,r[l+4>>2]=t,M=s},_getH3UnidirectionalEdge:function(e,t,n,i){var o,s,a=0,l=0,c=0,u=0,h=0;if(s=M,M=M+16|0,o=s,!(0|Ze(e|=0,t|=0,n|=0,i|=0)))return u=0,x(0|(c=0)),M=s,0|u;for(c=-2130706433&t,a=(a=0==(0|ze(e,t)))?1:2;r[o>>2]=0,l=a+1|0,!((0|(h=0|z(e,t,a,o)))==(0|n)&(0|w())==(0|i));){if(!(l>>>0<7)){a=0,e=0,u=6;break}a=l}return 6==(0|u)?(x(0|a),M=s,0|e):(h=0|St(0|a,0,56),u=0|c|w()|268435456,h|=e,x(0|u),M=s,0|h)},_getH3UnidirectionalEdgeBoundary:He,_getH3UnidirectionalEdgesFromHexagon:function(e,t,n){n|=0;var i,o=0;i=0==(0|ze(e|=0,t|=0)),t&=-2130706433,r[(o=n)>>2]=i?e:0,r[o+4>>2]=i?285212672|t:0,r[(o=n+8|0)>>2]=e,r[o+4>>2]=301989888|t,r[(o=n+16|0)>>2]=e,r[o+4>>2]=318767104|t,r[(o=n+24|0)>>2]=e,r[o+4>>2]=335544320|t,r[(o=n+32|0)>>2]=e,r[o+4>>2]=352321536|t,r[(n=n+40|0)>>2]=e,r[n+4>>2]=369098752|t},_getOriginH3IndexFromUnidirectionalEdge:function(e,t){var n;return e|=0,x(0|((n=!0&268435456==(2013265920&(t|=0)|0))?-2130706433&t|134217728:0)),0|(n?e:0)},_getPentagonIndexes:qe,_getRes0Indexes:function(e){e|=0;var t=0,n=0,i=0;t=0;do{St(0|t,0,45),i=134225919|w(),r[(n=e+(t<<3)|0)>>2]=-1,r[n+4>>2]=i,t=t+1|0}while(122!=(0|t))},_h3Distance:function(e,t,n,i){var r,o,s;return n|=0,i|=0,s=M,M=M+32|0,o=s,e=0==(0|Je(e|=0,t|=0,e,t,r=s+12|0))&&0==(0|Je(e,t,n,i,o))?0|de(r,o):-1,M=s,0|e},_h3GetBaseCell:Me,_h3GetFaces:function e(t,n,i){i|=0;var o,s=0,a=0,l=0,c=0,u=0,h=0,d=0,f=0;o=M,M=M+128|0,d=o+112|0,l=o+96|0,f=o,a=0|Et(0|(t|=0),0|(n|=0),52),w(),u=15&a,r[d>>2]=u,c=0|Et(0|t,0|n,45),w(),c&=127;e:do{if(0|O(c)){if(0|u)for(s=1;;){if(!(0==((h=0|St(7,0,3*(15-s|0)|0))&t|0)&0==((0|w())&n|0))){a=0;break e}if(!(s>>>0<u>>>0))break;s=s+1|0}if(!(1&a))return h=0|St(u+1|0,0,52),f=0|w()|-15728641&n,e((h|t)&~(d=0|St(7,0,3*(14-u|0)|0)),f&~(0|w()),i),void(M=o);a=1}else a=0}while(0);Ge(t,n,l),a?(be(l,d,f),h=5):(Se(l,d,f),h=6);e:do{if(0|O(c))if(u)for(s=1;;){if(!(0==((c=0|St(7,0,3*(15-s|0)|0))&t|0)&0==((0|w())&n|0))){s=8;break e}if(!(s>>>0<u>>>0)){s=20;break}s=s+1|0}else s=20;else s=8}while(0);if(Pt(0|i,-1,0|s),a){a=0;do{for(we(l=f+(a<<4)|0,0|r[d>>2]),l=0|r[l>>2],s=0;!(-1==(0|(u=0|r[(c=i+(s<<2)|0)>>2]))|(0|u)==(0|l));)s=s+1|0;r[c>>2]=l,a=a+1|0}while((0|a)!=(0|h))}else{a=0;do{for(xe(l=f+(a<<4)|0,0|r[d>>2],0,1),l=0|r[l>>2],s=0;!(-1==(0|(u=0|r[(c=i+(s<<2)|0)>>2]))|(0|u)==(0|l));)s=s+1|0;r[c>>2]=l,a=a+1|0}while((0|a)!=(0|h))}M=o},_h3GetResolution:function(e,t){return t=0|Et(0|(e|=0),0|(t|=0),52),w(),15&t|0},_h3IndexesAreNeighbors:Ze,_h3IsPentagon:ze,_h3IsResClassIII:function(e,t){return t=0|Et(0|(e|=0),0|(t|=0),52),w(),1&t|0},_h3IsValid:Ie,_h3Line:function(e,t,n,i,o){n|=0,i|=0,o|=0;var s,a=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0,x=0,w=0,E=0;if(s=M,M=M+48|0,c=s+12|0,w=s,0==(0|Je(e|=0,t|=0,e,t,a=s+24|0))&&0==(0|Je(e,t,n,i,c))){if((0|(x=0|de(a,c)))<0)return M=s,0|(w=x);for(r[a>>2]=0,r[a+4>>2]=0,r[a+8>>2]=0,r[c>>2]=0,r[c+4>>2]=0,r[c+8>>2]=0,Je(e,t,e,t,a),Je(e,t,n,i,c),Ae(a),Ae(c),x?(m=+(0|x),b=a,n=f=0|r[a>>2],i=p=0|r[(_=a+4|0)>>2],a=A=0|r[(v=a+8|0)>>2],g=+((0|r[c>>2])-f|0)/m,y=+((0|r[c+4>>2])-p|0)/m,m=+((0|r[c+8>>2])-A|0)/m):(_=i=a+4|0,v=A=a+8|0,b=a,n=0|r[a>>2],i=0|r[i>>2],a=0|r[A>>2],g=0,y=0,m=0),r[w>>2]=n,r[(A=w+4|0)>>2]=i,r[(p=w+8|0)>>2]=a,f=0;;){E=g*(h=+(0|f))+ +(0|n),u=y*h+ +(0|r[_>>2]),h=m*h+ +(0|r[v>>2]),i=~~+kt(+E),c=~~+kt(+u),n=~~+kt(+h),E=+l(+(+(0|i)-E)),u=+l(+(+(0|c)-u)),h=+l(+(+(0|n)-h));do{if(!(E>u&E>h)){if(d=0-i|0,u>h){a=d-n|0;break}a=c,n=d-c|0;break}i=0-(c+n)|0,a=c}while(0);if(r[w>>2]=i,r[A>>2]=a,r[p>>2]=n,me(w),et(e,t,w,o+(f<<3)|0),(0|f)==(0|x))break;f=f+1|0,n=0|r[b>>2]}return M=s,0|(w=0)}return M=s,0|(w=-1)},_h3LineSize:function(e,t,n,i){var r,o,s;return n|=0,i|=0,s=M,M=M+32|0,o=s,e=0==(0|Je(e|=0,t|=0,e,t,r=s+12|0))&&0==(0|Je(e,t,n,i,o))?0|de(r,o):-1,M=s,(e>>>31^1)+e|0},_h3SetToLinkedGeo:function(e,t,n){n|=0;var i,o,s,a=0;if(s=M,M=M+32|0,i=s,function(e,t,n){e|=0,n|=0;var i,o,s=0,a=0,l=0,c=0,u=0;if(o=M,M=M+176|0,i=o,(0|(t|=0))<1)return ct(n,0,0),void(M=o);c=0|Et(0|r[(c=e)>>2],0|r[c+4>>2],52),w(),ct(n,(0|t)>6?t:6,15&c),c=0;do{if($e(0|r[(s=e+(c<<3)|0)>>2],0|r[s+4>>2],i),(0|(s=0|r[i>>2]))>0){u=0;do{l=i+8+(u<<4)|0,(a=0|pt(n,s=i+8+(((0|(u=u+1|0))%(0|s)|0)<<4)|0,l))?dt(n,a):ft(n,l,s),s=0|r[i>>2]}while((0|u)<(0|s))}c=c+1|0}while((0|c)!=(0|t));M=o}(e|=0,t|=0,o=s+16|0),r[n>>2]=0,r[n+4>>2]=0,r[n+8>>2]=0,!(e=0|ht(o)))return Ye(n),ut(o),void(M=s);do{t=0|Qe(n);do{Xe(t,e),a=e+16|0,r[i>>2]=r[a>>2],r[i+4>>2]=r[a+4>>2],r[i+8>>2]=r[a+8>>2],r[i+12>>2]=r[a+12>>2],dt(o,e),e=0|At(o,i)}while(0!=(0|e));e=0|ht(o)}while(0!=(0|e));Ye(n),ut(o),M=s},_h3ToCenterChild:function(e,t,n){n|=0;var i=0,r=0;if(i=0|Et(0|(e|=0),0|(t|=0),52),w(),(0|n)<16&(0|(i&=15))<=(0|n)){if((0|i)!=(0|n)&&(e|=r=0|St(0|n,0,52),t=0|w()|-15728641&t,(0|i)<(0|n)))do{r=0|St(7,0,3*(14-i|0)|0),i=i+1|0,e&=~r,t&=~(0|w())}while((0|i)<(0|n))}else t=0,e=0;return x(0|t),0|e},_h3ToChildren:Re,_h3ToGeo:We,_h3ToGeoBoundary:$e,_h3ToParent:Le,_h3UnidirectionalEdgeIsValid:function(e,t){var n=0;if(!(!0&268435456==(2013265920&(t|=0)|0)))return 0|(n=0);switch(n=0|Et(0|(e|=0),0|t,56),w(),7&n){case 0:case 7:return 0|(n=0)}return!0&16777216==(117440512&t|0)&0!=(0|ze(e,n=-2130706433&t|134217728))?0|(n=0):0|(n=0|Ie(e,n))},_hexAreaKm2:function(e){return+ +o[20496+((e|=0)<<3)>>3]},_hexAreaM2:function(e){return+ +o[20624+((e|=0)<<3)>>3]},_hexRing:function(e,t,n,i){e|=0,t|=0,i|=0;var o,s=0,a=0,l=0,c=0,u=0,h=0,d=0;if(o=M,M=M+16|0,d=o,!(n|=0))return r[(d=i)>>2]=e,r[d+4>>2]=t,M=o,0|(d=0);r[d>>2]=0;e:do{if(0|ze(e,t))e=1;else{if(a=(0|n)>0){s=0,h=e;do{if(0==(0|(h=0|z(h,t,4,d)))&0==(0|(t=0|w()))){e=2;break e}if(s=s+1|0,0|ze(h,t)){e=1;break e}}while((0|s)<(0|n));if(r[(u=i)>>2]=h,r[u+4>>2]=t,u=n+-1|0,a){a=0,l=1,s=h,e=t;do{if(0==(0|(s=0|z(s,e,2,d)))&0==(0|(e=0|w()))){e=2;break e}if(r[(c=i+(l<<3)|0)>>2]=s,r[c+4>>2]=e,l=l+1|0,0|ze(s,e)){e=1;break e}a=a+1|0}while((0|a)<(0|n));c=0,a=l;do{if(0==(0|(s=0|z(s,e,3,d)))&0==(0|(e=0|w()))){e=2;break e}if(r[(l=i+(a<<3)|0)>>2]=s,r[l+4>>2]=e,a=a+1|0,0|ze(s,e)){e=1;break e}c=c+1|0}while((0|c)<(0|n));l=0;do{if(0==(0|(s=0|z(s,e,1,d)))&0==(0|(e=0|w()))){e=2;break e}if(r[(c=i+(a<<3)|0)>>2]=s,r[c+4>>2]=e,a=a+1|0,0|ze(s,e)){e=1;break e}l=l+1|0}while((0|l)<(0|n));l=0;do{if(0==(0|(s=0|z(s,e,5,d)))&0==(0|(e=0|w()))){e=2;break e}if(r[(c=i+(a<<3)|0)>>2]=s,r[c+4>>2]=e,a=a+1|0,0|ze(s,e)){e=1;break e}l=l+1|0}while((0|l)<(0|n));l=0;do{if(0==(0|(s=0|z(s,e,4,d)))&0==(0|(e=0|w()))){e=2;break e}if(r[(c=i+(a<<3)|0)>>2]=s,r[c+4>>2]=e,a=a+1|0,0|ze(s,e)){e=1;break e}l=l+1|0}while((0|l)<(0|n));for(l=0;;){if(0==(0|(s=0|z(s,e,6,d)))&0==(0|(e=0|w()))){e=2;break e}if((0|l)!=(0|u)){if(r[(c=i+(a<<3)|0)>>2]=s,r[c+4>>2]=e,0|ze(s,e)){e=1;break e}a=a+1|0}if((0|(l=l+1|0))>=(0|n)){l=h,a=t;break}}}else l=h,s=h,a=t,e=t}else r[(l=i)>>2]=e,r[l+4>>2]=t,l=e,s=e,a=t,e=t;e=1&((0|l)!=(0|s)|(0|a)!=(0|e))}}while(0);return M=o,0|(d=e)},_i64Subtract:vt,_kRing:I,_kRingDistances:function(e,t,n,i,r){var o;if(0|L(e|=0,t|=0,n|=0,i|=0,r|=0)){if(Pt(0|i,0,(o=1+(0|_(3*n|0,n+1|0))|0)<<3|0),0|r)return Pt(0|r,0,o<<2|0),void R(e,t,n,i,r,o,0);(r=0|_t(o,4))&&(R(e,t,n,i,r,o,0),yt(r))}},_llvm_minnum_f64:Tt,_llvm_round_f64:kt,_malloc:gt,_maxFaceCount:function(e,t){var n=0,i=0;if(i=0|Et(0|(e|=0),0|(t|=0),45),w(),!(0|O(127&i)))return 0|(i=2);if(i=0|Et(0|e,0|t,52),w(),!(i&=15))return 0|(i=5);for(n=1;;){if(!(0==((0|St(7,0,3*(15-n|0)|0))&e|0)&0==((0|w())&t|0))){n=2,e=6;break}if(!(n>>>0<i>>>0)){n=5,e=6;break}n=n+1|0}return 6==(0|e)?0|n:0},_maxH3ToChildrenSize:function(e,t,n){return n|=0,e=0|Et(0|(e|=0),0|(t|=0),52),w(),(0|n)<16&(0|(e&=15))<=(0|n)?0|(n=0|tt(7,n-e|0)):0|(n=0)},_maxKringSize:function(e){return 1+(0|_(3*(e|=0)|0,e+1|0))|0},_maxPolyfillSize:function(e,t){t|=0;var n,i=0,o=0,s=0,a=0,l=0;if(n=M,M=M+48|0,s=n+8|0,o=n,a=0|r[(l=e|=0)+4>>2],r[(i=o)>>2]=r[l>>2],r[i+4>>2]=a,it(o,s),s=0|$(s,t),t=0|r[o>>2],(0|(o=0|r[e+8>>2]))<=0)return M=n,0|(l=(l=(a=(0|s)<(0|(l=t)))?l:s)+12|0);i=0|r[e+12>>2],e=0;do{t=(0|r[i+(e<<3)>>2])+t|0,e=e+1|0}while((0|e)<(0|o));return M=n,0|(l=(l=(l=(0|s)<(0|t))?t:s)+12|0)},_maxUncompactSize:function(e,t,n){e|=0,n|=0;var i=0,o=0,s=0,a=0;if((0|(t|=0))<=0)return 0|(n=0);if((0|n)>=16){for(i=0;;){if(!(0==(0|r[(a=e+(i<<3)|0)>>2])&0==(0|r[a+4>>2]))){i=-1,o=13;break}if((0|(i=i+1|0))>=(0|t)){i=0,o=13;break}}if(13==(0|o))return 0|i}i=0,a=0;e:for(;;){s=0|r[(o=e+(a<<3)|0)>>2],o=0|r[o+4>>2];do{if(!(0==(0|s)&0==(0|o))){if(o=0|Et(0|s,0|o,52),w(),(0|(o&=15))>(0|n)){i=-1,o=13;break e}if((0|o)==(0|n)){i=i+1|0;break}i=(0|tt(7,n-o|0))+i|0;break}}while(0);if((0|(a=a+1|0))>=(0|t)){o=13;break}}return 13==(0|o)?0|i:0},_memcpy:Ct,_memset:Pt,_numHexagons:function(e){var t;return e=0|r[(t=21008+((e|=0)<<3)|0)>>2],x(0|r[t+4>>2]),0|e},_pentagonIndexCount:function(){return 12},_pointDistKm:Ce,_pointDistM:function(e,t){e|=0;var n,i,r,s=0;return i=+o[(t|=0)>>3],n=+o[e>>3],s=(r=+d(.5*(i-n)))*r+(s=+d(.5*(+o[t+8>>3]-+o[e+8>>3])))*(+h(+i)*+h(+n)*s),2*+g(+ +c(+s),+ +c(+(1-s)))*6371.007180918475*1e3},_pointDistRads:function(e,t){e|=0;var n,i,r,s=0;return i=+o[(t|=0)>>3],n=+o[e>>3],s=(r=+d(.5*(i-n)))*r+(s=+d(.5*(+o[t+8>>3]-+o[e+8>>3])))*(+h(+i)*+h(+n)*s),2*+g(+ +c(+s),+ +c(+(1-s)))},_polyfill:function(e,t,n){var i,o=0,s=0,a=0,l=0,c=0;if(i=M,M=M+48|0,o=i+8|0,s=i,0|function(e,t,n){t|=0,n|=0;var i=0,o=0,s=0,a=0,l=0,c=0,u=0,h=0,d=0,f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0,x=0,S=0,T=0,k=0,C=0,P=0,I=0,z=0,O=0,B=0,F=0,N=0;N=M,M=M+112|0,z=N+80|0,c=N+72|0,O=N,B=N+56|0,(F=0|gt(32+(r[(u=(e=e|0)+8|0)>>2]<<5)|0))||E(22848,22448,800,22456);if(rt(e,F),i=0|r[(s=e)+4>>2],r[(l=c)>>2]=r[s>>2],r[l+4>>2]=i,it(c,z),l=0|$(z,t),i=0|r[c>>2],(0|(s=0|r[u>>2]))>0){a=0|r[e+12>>2],o=0;do{i=(0|r[a+(o<<3)>>2])+i|0,o=o+1|0}while((0|o)!=(0|s))}if(o=0|_t(I=(l=(0|l)<(0|i)?i:l)+12|0,8),h=0|_t(I,8),r[z>>2]=0,P=0|r[(C=e)+4>>2],r[(i=c)>>2]=r[C>>2],r[i+4>>2]=P,0|(i=0|D(c,I,t,z,o,h)))return yt(o),yt(h),yt(F),M=N,0|(F=i);e:do{if((0|r[u>>2])>0){for(s=e+12|0,i=0;a=0|D((0|r[s>>2])+(i<<3)|0,I,t,z,o,h),i=i+1|0,!(0|a);)if((0|i)>=(0|r[u>>2]))break e;return yt(o),yt(h),yt(F),M=N,0|(F=a)}}while(0);(0|l)>-12&&Pt(0|h,0,((0|I)>1?I:1)<<3|0);e:do{if((0|r[z>>2])>0){P=((0|I)<0)<<31>>31,b=o,x=h,S=o,T=o,k=h,C=o,i=o,g=o,y=h,_=h,v=h,o=h;t:for(;;){for(m=0|r[z>>2],p=0,A=0,s=0;;){l=(a=O)+56|0;do{r[a>>2]=0,a=a+4|0}while((0|a)<(0|l));if(0|L(c=0|r[(t=b+(p<<3)|0)>>2],t=0|r[t+4>>2],1,O,0)){l=(a=O)+56|0;do{r[a>>2]=0,a=a+4|0}while((0|a)<(0|l));0|(a=0|_t(7,4))&&(R(c,t,1,O,a,7,0),yt(a))}f=0;do{h=0|r[(d=O+(f<<3)|0)>>2],d=0|r[d+4>>2];n:do{if(!(0==(0|h)&0==(0|d))){if(c=0|wt(0|h,0|d,0|I,0|P),w(),!(0==(0|(t=0|r[(l=a=n+(c<<3)|0)>>2]))&0==(0|(l=0|r[l+4>>2]))))for(u=0;;){if((0|u)>(0|I))break t;if((0|t)==(0|h)&(0|l)==(0|d))break n;if(0==(0|(t=0|r[(l=a=n+((c=(c+1|0)%(0|I)|0)<<3)|0)>>2]))&0==(0|(l=0|r[l+4>>2])))break;u=u+1|0}0==(0|h)&0==(0|d)||(We(h,d,B),0|ot(e,F,B)&&(r[(u=a)>>2]=h,r[u+4>>2]=d,r[(u=x+(s<<3)|0)>>2]=h,r[u+4>>2]=d,s=s+1|0))}}while(0);f=f+1|0}while(f>>>0<7);if((0|(A=A+1|0))>=(0|m))break;p=p+1|0}if((0|m)>0&&Pt(0|S,0,m<<3|0),r[z>>2]=s,!((0|s)>0))break e;h=o,d=v,f=C,p=_,A=y,m=x,o=g,v=i,_=T,y=S,g=h,i=d,C=k,k=f,T=p,S=A,x=b,b=m}return yt(T),yt(k),yt(F),M=N,0|(F=-1)}i=h}while(0);return yt(F),yt(o),yt(i),M=N,0|(F=0)}(e|=0,t|=0,n|=0)){if(a=0|r[(c=e)+4>>2],r[(l=s)>>2]=r[c>>2],r[l+4>>2]=a,it(s,o),l=0|$(o,t),t=0|r[s>>2],(0|(a=0|r[e+8>>2]))>0){s=0|r[e+12>>2],o=0;do{t=(0|r[s+(o<<3)>>2])+t|0,o=o+1|0}while((0|o)!=(0|a))}(0|(t=(0|l)<(0|t)?t:l))<=-12||Pt(0|n,0,8+(((0|(c=t+11|0))>0?c:0)<<3)|0),M=i}else M=i},_res0IndexCount:function(){return 122},_round:Mt,_sbrk:It,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(e,t,n,i,o){e|=0,n|=0,i|=0,o|=0;var s=0,a=0,l=0,c=0,u=0,h=0;if((0|(t|=0))<=0)return 0|(o=0);if((0|o)>=16){for(s=0;;){if(!(0==(0|r[(h=e+(s<<3)|0)>>2])&0==(0|r[h+4>>2]))){s=14;break}if((0|(s=s+1|0))>=(0|t)){a=0,s=16;break}}if(14==(0|s))return 0|((0|i)>0?-2:-1);if(16==(0|s))return 0|a}s=0,h=0;e:for(;;){a=0|r[(l=u=e+(h<<3)|0)>>2],l=0|r[l+4>>2];do{if(!(0==(0|a)&0==(0|l))){if((0|s)>=(0|i)){a=-1,s=16;break e}if(c=0|Et(0|a,0|l,52),w(),(0|(c&=15))>(0|o)){a=-2,s=16;break e}if((0|c)==(0|o)){r[(u=n+(s<<3)|0)>>2]=a,r[u+4>>2]=l,s=s+1|0;break}if((0|(a=(0|tt(7,o-c|0))+s|0))>(0|i)){a=-1,s=16;break e}Re(0|r[u>>2],0|r[u+4>>2],o,n+(s<<3)|0),s=a}}while(0);if((0|(h=h+1|0))>=(0|t)){a=0,s=16;break}}return 16==(0|s)?0|a:0},establishStackSpace:function(e,t){M=e|=0},stackAlloc:function(e){var t;return t=M,M=(M=M+(e|=0)|0)+15&-16,0|t},stackRestore:function(e){M=e|=0},stackSave:function(){return 0|M}}}({Math:Math,Int8Array:Int8Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Float32Array:Float32Array,Float64Array:Float64Array},{a:se,b:function(e){l=e},c:c,d:function(e,t,n,i){se("Assertion failed: "+b(e)+", at: "+[t?b(t):"unknown filename",n,i?b(i):"unknown function"])},e:function(e){return n.___errno_location&&(g[n.___errno_location()>>2]=e),e},f:W,g:function(e,t,n){A.set(A.subarray(t,t+n),e)},h:function(e){var t=W(),n=16777216,i=2130706432;if(e>i)return!1;for(var r=Math.max(t,16777216);r<e;)r=r<=536870912?x(2*r,n):Math.min(x((3*r+2147483648)/4,n),i);return!!$(r)},i:function(e){se("OOM")},j:j,k:V,l:$,m:G,n:function(){var e=G();return n.extraStackTrace&&(e+="\n"+n.extraStackTrace()),V(e)},o:24032,p:24016},f);n.___uremdi3=H.___uremdi3,n._bitshift64Lshr=H._bitshift64Lshr,n._bitshift64Shl=H._bitshift64Shl,n._calloc=H._calloc,n._cellAreaKm2=H._cellAreaKm2,n._cellAreaM2=H._cellAreaM2,n._cellAreaRads2=H._cellAreaRads2,n._compact=H._compact,n._destroyLinkedPolygon=H._destroyLinkedPolygon,n._edgeLengthKm=H._edgeLengthKm,n._edgeLengthM=H._edgeLengthM;var Q=n._emscripten_replace_memory=H._emscripten_replace_memory;n._exactEdgeLengthKm=H._exactEdgeLengthKm,n._exactEdgeLengthM=H._exactEdgeLengthM,n._exactEdgeLengthRads=H._exactEdgeLengthRads,n._experimentalH3ToLocalIj=H._experimentalH3ToLocalIj,n._experimentalLocalIjToH3=H._experimentalLocalIjToH3,n._free=H._free,n._geoToH3=H._geoToH3,n._getDestinationH3IndexFromUnidirectionalEdge=H._getDestinationH3IndexFromUnidirectionalEdge,n._getH3IndexesFromUnidirectionalEdge=H._getH3IndexesFromUnidirectionalEdge,n._getH3UnidirectionalEdge=H._getH3UnidirectionalEdge,n._getH3UnidirectionalEdgeBoundary=H._getH3UnidirectionalEdgeBoundary,n._getH3UnidirectionalEdgesFromHexagon=H._getH3UnidirectionalEdgesFromHexagon,n._getOriginH3IndexFromUnidirectionalEdge=H._getOriginH3IndexFromUnidirectionalEdge,n._getPentagonIndexes=H._getPentagonIndexes,n._getRes0Indexes=H._getRes0Indexes,n._h3Distance=H._h3Distance,n._h3GetBaseCell=H._h3GetBaseCell,n._h3GetFaces=H._h3GetFaces,n._h3GetResolution=H._h3GetResolution,n._h3IndexesAreNeighbors=H._h3IndexesAreNeighbors,n._h3IsPentagon=H._h3IsPentagon,n._h3IsResClassIII=H._h3IsResClassIII,n._h3IsValid=H._h3IsValid,n._h3Line=H._h3Line,n._h3LineSize=H._h3LineSize,n._h3SetToLinkedGeo=H._h3SetToLinkedGeo,n._h3ToCenterChild=H._h3ToCenterChild,n._h3ToChildren=H._h3ToChildren,n._h3ToGeo=H._h3ToGeo,n._h3ToGeoBoundary=H._h3ToGeoBoundary,n._h3ToParent=H._h3ToParent,n._h3UnidirectionalEdgeIsValid=H._h3UnidirectionalEdgeIsValid,n._hexAreaKm2=H._hexAreaKm2,n._hexAreaM2=H._hexAreaM2,n._hexRing=H._hexRing,n._i64Subtract=H._i64Subtract,n._kRing=H._kRing,n._kRingDistances=H._kRingDistances,n._llvm_minnum_f64=H._llvm_minnum_f64,n._llvm_round_f64=H._llvm_round_f64,n._malloc=H._malloc,n._maxFaceCount=H._maxFaceCount,n._maxH3ToChildrenSize=H._maxH3ToChildrenSize,n._maxKringSize=H._maxKringSize,n._maxPolyfillSize=H._maxPolyfillSize,n._maxUncompactSize=H._maxUncompactSize,n._memcpy=H._memcpy,n._memset=H._memset,n._numHexagons=H._numHexagons,n._pentagonIndexCount=H._pentagonIndexCount,n._pointDistKm=H._pointDistKm,n._pointDistM=H._pointDistM,n._pointDistRads=H._pointDistRads,n._polyfill=H._polyfill,n._res0IndexCount=H._res0IndexCount,n._round=H._round,n._sbrk=H._sbrk,n._sizeOfCoordIJ=H._sizeOfCoordIJ,n._sizeOfGeoBoundary=H._sizeOfGeoBoundary,n._sizeOfGeoCoord=H._sizeOfGeoCoord,n._sizeOfGeoPolygon=H._sizeOfGeoPolygon,n._sizeOfGeofence=H._sizeOfGeofence,n._sizeOfH3Index=H._sizeOfH3Index,n._sizeOfLinkedGeoPolygon=H._sizeOfLinkedGeoPolygon,n._uncompact=H._uncompact,n.establishStackSpace=H.establishStackSpace;var X,Y,K=n.stackAlloc=H.stackAlloc,J=n.stackRestore=H.stackRestore,ee=n.stackSave=H.stackSave;if(n.asm=H,n.cwrap=function(e,t,n,i){var r=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&r&&!i?h(e):function(){return d(e,t,n,arguments)}},n.setValue=function(e,t,n,i){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":p[e>>0]=t;break;case"i16":m[e>>1]=t;break;case"i32":g[e>>2]=t;break;case"i64":B=[t>>>0,(O=t,+M(O)>=1?O>0?(0|R(+L(O/4294967296),4294967295))>>>0:~~+I((O-+(~~O>>>0))/4294967296)>>>0:0)],g[e>>2]=B[0],g[e+4>>2]=B[1];break;case"float":y[e>>2]=t;break;case"double":_[e>>3]=t;break;default:se("invalid type for setValue: "+n)}},n.getValue=function(e,t,n){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return p[e>>0];case"i16":return m[e>>1];case"i32":case"i64":return g[e>>2];case"float":return y[e>>2];case"double":return _[e>>3];default:se("invalid type for getValue: "+t)}return null},n.getTempRet0=c,F){U(F)||(X=F,F=n.locateFile?n.locateFile(X,o):o+X),z++,n.monitorRunDependencies&&n.monitorRunDependencies(z);var te=function(e){e.byteLength&&(e=new Uint8Array(e)),A.set(e,8),n.memoryInitializerRequest&&delete n.memoryInitializerRequest.response,function(e){if(z--,n.monitorRunDependencies&&n.monitorRunDependencies(z),0==z&&D){var t=D;D=null,t()}}()},ne=function(){r(F,te,(function(){throw"could not load memory initializer "+F}))},ie=Z(F);if(ie)te(ie.buffer);else if(n.memoryInitializerRequest){var re=function(){var e=n.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var i=Z(n.memoryInitializerRequestURL);if(!i)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+F),void ne();t=i.buffer}te(t)};n.memoryInitializerRequest.response?setTimeout(re,0):n.memoryInitializerRequest.addEventListener("load",re)}else ne()}function oe(e){function t(){Y||(Y=!0,u||(S(k),S(C),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),P.unshift(e);var e;S(P)}()))}z>0||(!function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),T.unshift(e);var e;S(T)}(),z>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),t()}),1)):t()))}function se(e){throw n.onAbort&&n.onAbort(e),s(e+=""),a(e),u=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(D=function e(){Y||oe(),Y||(D=e)},n.run=oe,n.abort=se,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return oe(),e}("object"==typeof q_?q_:{}),Z_="number",H_={};[["sizeOfH3Index",Z_],["sizeOfGeoCoord",Z_],["sizeOfGeoBoundary",Z_],["sizeOfGeoPolygon",Z_],["sizeOfGeofence",Z_],["sizeOfLinkedGeoPolygon",Z_],["sizeOfCoordIJ",Z_],["h3IsValid",Z_,[Z_,Z_]],["geoToH3",Z_,[Z_,Z_,Z_]],["h3ToGeo",null,[Z_,Z_,Z_]],["h3ToGeoBoundary",null,[Z_,Z_,Z_]],["maxKringSize",Z_,[Z_]],["kRing",null,[Z_,Z_,Z_,Z_]],["kRingDistances",null,[Z_,Z_,Z_,Z_,Z_]],["hexRing",null,[Z_,Z_,Z_,Z_]],["maxPolyfillSize",Z_,[Z_,Z_]],["polyfill",null,[Z_,Z_,Z_]],["h3SetToLinkedGeo",null,[Z_,Z_,Z_]],["destroyLinkedPolygon",null,[Z_]],["compact",Z_,[Z_,Z_,Z_]],["uncompact",Z_,[Z_,Z_,Z_,Z_,Z_]],["maxUncompactSize",Z_,[Z_,Z_,Z_]],["h3IsPentagon",Z_,[Z_,Z_]],["h3IsResClassIII",Z_,[Z_,Z_]],["h3GetBaseCell",Z_,[Z_,Z_]],["h3GetResolution",Z_,[Z_,Z_]],["maxFaceCount",Z_,[Z_,Z_]],["h3GetFaces",null,[Z_,Z_,Z_]],["h3ToParent",Z_,[Z_,Z_,Z_]],["h3ToChildren",null,[Z_,Z_,Z_,Z_]],["h3ToCenterChild",Z_,[Z_,Z_,Z_]],["maxH3ToChildrenSize",Z_,[Z_,Z_,Z_]],["h3IndexesAreNeighbors",Z_,[Z_,Z_,Z_,Z_]],["getH3UnidirectionalEdge",Z_,[Z_,Z_,Z_,Z_]],["getOriginH3IndexFromUnidirectionalEdge",Z_,[Z_,Z_]],["getDestinationH3IndexFromUnidirectionalEdge",Z_,[Z_,Z_]],["h3UnidirectionalEdgeIsValid",Z_,[Z_,Z_]],["getH3IndexesFromUnidirectionalEdge",null,[Z_,Z_,Z_]],["getH3UnidirectionalEdgesFromHexagon",null,[Z_,Z_,Z_]],["getH3UnidirectionalEdgeBoundary",null,[Z_,Z_,Z_]],["h3Distance",Z_,[Z_,Z_,Z_,Z_]],["h3Line",Z_,[Z_,Z_,Z_,Z_,Z_]],["h3LineSize",Z_,[Z_,Z_,Z_,Z_]],["experimentalH3ToLocalIj",Z_,[Z_,Z_,Z_,Z_,Z_]],["experimentalLocalIjToH3",Z_,[Z_,Z_,Z_,Z_]],["hexAreaM2",Z_,[Z_]],["hexAreaKm2",Z_,[Z_]],["edgeLengthM",Z_,[Z_]],["edgeLengthKm",Z_,[Z_]],["pointDistM",Z_,[Z_,Z_]],["pointDistKm",Z_,[Z_,Z_]],["pointDistRads",Z_,[Z_,Z_]],["cellAreaM2",Z_,[Z_,Z_]],["cellAreaKm2",Z_,[Z_,Z_]],["cellAreaRads2",Z_,[Z_,Z_]],["exactEdgeLengthM",Z_,[Z_,Z_]],["exactEdgeLengthKm",Z_,[Z_,Z_]],["exactEdgeLengthRads",Z_,[Z_,Z_]],["numHexagons",Z_,[Z_]],["getRes0Indexes",null,[Z_]],["res0IndexCount",Z_],["getPentagonIndexes",null,[Z_,Z_]],["pentagonIndexCount",Z_]].forEach((function(e){H_[e[0]]=q_.cwrap.apply(q_,e)}));var Q_=16;H_.sizeOfH3Index();var X_=H_.sizeOfGeoCoord(),Y_=H_.sizeOfGeoBoundary();H_.sizeOfGeoPolygon(),H_.sizeOfGeofence(),H_.sizeOfLinkedGeoPolygon(),H_.sizeOfCoordIJ();var K_="m",J_="km";var ev=/[^0-9a-fA-F]/;function tv(e){if(Array.isArray(e)&&2===e.length&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if("string"!=typeof e||ev.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),Q_);return[parseInt(e.substring(e.length-8),Q_),t]}function nv(e){if(e>=0)return e.toString(Q_);var t=iv(8,(e&=2147483647).toString(Q_));return t=(parseInt(t[0],Q_)+8).toString(Q_)+t.substring(1)}function iv(e,t){for(var n=e-t.length,i="",r=0;r<n;r++)i+="0";return i+=t}function rv(e){var t=function(e){return[e,q_.getTempRet0()]}(e),n=t[0],i=t[1];return i?function(e,t){return nv(t)+iv(8,nv(e))}(n,i):null}function ov(e){return 180*q_.getValue(e,"double")/Math.PI}function sv(e){return[ov(e),ov(e+8)]}function av(e){return[ov(e+8),ov(e)]}function lv(e){var t=tv(e),n=t[0],i=t[1];return Boolean(H_.h3IsPentagon(n,i))}function cv(e){var t=q_._malloc(X_),n=tv(e),i=n[0],r=n[1];H_.h3ToGeo(i,r,t);var o=sv(t);return q_._free(t),o}function uv(e,t){var n=q_._malloc(Y_),i=tv(e),r=i[0],o=i[1];H_.h3ToGeoBoundary(r,o,n);var s=function(e,t,n){for(var i=q_.getValue(e,"i32"),r=e+8,o=[],s=t?av:sv,a=0;a<2*i;a+=2)o.push(s(r+8*a));return n&&o.push(o[0]),o}(n,t,t);return q_._free(n),s}function hv(e,t){switch(function(e){if("number"!=typeof e||e<0||e>15||Math.floor(e)!==e)throw new Error("Invalid resolution: "+e)}(e),t){case K_:return H_.edgeLengthM(e);case J_:return H_.edgeLengthKm(e);default:throw new Error("Unknown unit: "+t)}}function dv(e){return e*Math.PI/180}function fv(e,t){t=void 0===t?e[0][0]:t;for(const n of e){const e=n[0]-t;e>180?n[0]-=360:e<-180&&(n[0]+=360)}}function pv(e,t,n){const i=e(t,n),[r,o]=cv(i);return[o,r]}function Av(e,t=1,n){const i=uv(e,!0);if(1!==t?function(e,t,n){const[i,r]=cv(e),o=t.length;fv(t,r);const s=t[0]===t[o-1]?o-1:o;for(let e=0;e<s;e++)t[e][0]=ku(r,t[e][0],n),t[e][1]=ku(i,t[e][1],n)}(e,i,t):fv(i),n){const e=new Float64Array(2*i.length);let t=0;for(const n of i)e[t++]=n[0],e[t++]=n[1];return e}return i}const mv={...Mg.defaultProps,highPrecision:!1,coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0};delete mv.getLineDashArray;class gv extends RA{shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagon){let t=-1,n=!1,s=!1;const{iterable:a,objectInfo:l}=_p(e.data);for(const c of a){l.index++;const a=e.getHexagon(c,l),u=(i=void 0,r=void 0,o=void 0,i=tv(a),r=i[0],o=i[1],H_.h3IsValid(r,o)?H_.h3GetResolution(r,o):-1);if(t<0)t=u;else if(t!==u){s=!0;break}if(lv(a)){n=!0;break}}this.setState({resolution:t,edgeLengthKM:t>=0?hv(t,J_):0,hasMultipleRes:s,hasPentagon:n})}var i,r,o;this._updateVertices(this.context.viewport)}_shouldUseHighPrecision(){const{resolution:e,hasPentagon:t,hasMultipleRes:n}=this.state,{viewport:i}=this.context;return this.props.highPrecision||i.resolution||n||t||e>=0&&e<=5}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:n,centerHex:i}=this.state;if(t<0)return;const r=this.props.centerHexagon||function(e,t,n){var i=q_._malloc(X_);q_.HEAPF64.set([e,t].map(dv),i/8);var r=rv(H_.geoToH3(i,n));return q_._free(i),r}(e.latitude,e.longitude,t);if(i===r)return;if(i){const e=(o=r,s=tv(i),a=s[0],l=s[1],c=tv(o),u=c[0],h=c[1],H_.h3Distance(a,l,u,h));if(e>=0&&e*n<10)return}var o,s,a,l,c,u,h;const{unitsPerMeter:d}=e.distanceScales;let f=Av(r);const[p,A]=cv(r),[m,g]=e.projectFlat([A,p]);f=f.map((t=>{const n=e.projectFlat(t);return[(n[0]-m)/d[0],(n[1]-g)/d[1]]})),this.setState({centerHex:r,vertices:f})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:n,extruded:i,wireframe:r,stroked:o,filled:s,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:u,getFillColor:h,getElevation:d,getLineColor:f,getLineWidth:p,transitions:A,updateTriggers:m}=this.props;return{elevationScale:e,extruded:i,coverage:n,wireframe:r,stroked:o,filled:s,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:u,material:t,getElevation:d,getFillColor:h,getLineColor:f,getLineWidth:p,transitions:A,updateTriggers:{getFillColor:m.getFillColor,getElevation:m.getElevation,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:n,coverage:i}=this.props,r=this.getSubLayerClass("hexagon-cell-hifi",Mg),o=this._getForwardProps();return o.updateTriggers.getPolygon=function(e,t){let n;return n=null==e?t:"object"==typeof e?{...e,coverage:t}:{getHexagon:e,coverage:t},n}(n.getHexagon,i),new r(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(e,n)=>Av(t(e,n),i,!0)})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:n}=this.props,i=this.getSubLayerClass("hexagon-cell",Lm),r=this._getForwardProps();return r.updateTriggers.getPosition=n.getHexagon,new i(r,this.getSubLayerProps({id:"hexagon-cell",updateTriggers:r.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:pv.bind(null,t)})}}function yv(e,t,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function _v(e,t,n){void 0===n&&(n={});for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return yv({type:"Polygon",coordinates:e},t,n)}function vv(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function bv(e,t,n){if(null!==e)for(var i,r,o,s,a,l,c,u,h=0,d=0,f=e.type,p="FeatureCollection"===f,A="Feature"===f,m=p?e.features.length:1,g=0;g<m;g++){a=(u=!!(c=p?e.features[g].geometry:A?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var y=0;y<a;y++){var _=0,v=0;if(null!==(s=u?c.geometries[y]:c)){l=s.coordinates;var b=s.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===t(l,d,g,_,v))return!1;d++,_++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===t(l[i],d,g,_,v))return!1;d++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(r=0;r<l[i].length-h;r++){if(!1===t(l[i][r],d,g,_,v))return!1;d++}"MultiLineString"===b&&_++,"Polygon"===b&&v++}"Polygon"===b&&_++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(v=0,r=0;r<l[i].length;r++){for(o=0;o<l[i][r].length-h;o++){if(!1===t(l[i][r][o],d,g,_,v))return!1;d++}v++}_++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===bv(s.geometries[i],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function xv(e){var t=[1/0,1/0,-1/0,-1/0];return bv(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}function wv(e){return"Feature"===e.type?e.geometry:e}function Ev(e,t){void 0===t&&(t={});var n=0,i=0,r=0;return bv(e,(function(e){n+=e[0],i+=e[1],r++}),!0),function(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vv(e[0])||!vv(e[1]))throw new Error("coordinates must contain numbers");return yv({type:"Point",coordinates:e},t,n)}([n/r,i/r],t.properties)}gv.defaultProps=mv,gv.layerName="H3HexagonLayer",xv.default=xv;var Sv={exports:{}};!function(e,t){e.exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}
/**
	   * splaytree v3.1.0
	   * Fast Splay tree for Node and browser
	   *
	   * @author Alexander Milevski <info@w8r.name>
	   * @license MIT
	   * @preserve
	   */var i=function(){function e(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return e}();function r(e,t){return e>t?1:e<t?-1:0}function o(e,t,n){for(var r=new i(null,null),o=r,s=r;;){var a=n(e,t.key);if(a<0){if(null===t.left)break;if(n(e,t.left.key)<0){var l=t.left;if(t.left=l.right,l.right=t,null===(t=l).left)break}s.left=t,s=t,t=t.left}else{if(!(a>0))break;if(null===t.right)break;if(n(e,t.right.key)>0&&(l=t.right,t.right=l.left,l.left=t,null===(t=l).right))break;o.right=t,o=t,t=t.right}}return o.right=t.left,s.left=t.right,t.left=r.right,t.right=r.left,t}function s(e,t,n,r){var s=new i(e,t);if(null===n)return s.left=s.right=null,s;var a=r(e,(n=o(e,n,r)).key);return a<0?(s.left=n.left,s.right=n,n.left=null):a>=0&&(s.right=n.right,s.left=n,n.right=null),s}function a(e,t,n){var i=null,r=null;if(t){var s=n((t=o(e,t,n)).key,e);0===s?(i=t.left,r=t.right):s<0?(r=t.right,t.right=null,i=t):(i=t.left,t.left=null,r=t)}return{left:i,right:r}}function l(e,t,n){return null===t?e:(null===e||((t=o(e.key,t,n)).left=e),t)}function c(e,t,n,i,r){if(e){i(t+(n?"└── ":"├── ")+r(e)+"\n");var o=t+(n?"    ":"│   ");e.left&&c(e.left,o,!1,i,r),e.right&&c(e.right,o,!0,i,r)}}var u=function(){function e(e){void 0===e&&(e=r),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=s(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var n=new i(e,t);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,s=o(e,this._root,r),a=r(e,s.key);return 0===a?this._root=s:(a<0?(n.left=s.left,n.right=s,s.left=null):a>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,n){var i;return null===t?null:0===n(e,(t=o(e,t,n)).key)?(null===t.left?i=t.right:(i=o(e,t.left,n)).right=t.right,this._size--,i):t},e.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=o(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(0===i)return t;t=i<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=o(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(0===i)return!0;t=i<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){for(var n=this._root,i=[],r=!1;!r;)null!==n?(i.push(n),n=n.left):0!==i.length?(n=i.pop(),e.call(t,n),n=n.right):r=!0;return this},e.prototype.range=function(e,t,n,i){for(var r=[],o=this._comparator,s=this._root;0!==r.length||s;)if(s)r.push(s),s=s.left;else{if(o((s=r.pop()).key,t)>0)break;if(o(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},e.prototype.at=function(e){for(var t=this._root,n=!1,i=0,r=[];!n;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},e.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var r=i(e.key,t.key);if(0===r)break;r<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var r=i(e.key,t.key);if(0===r)break;r<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return f(this._root)},e.prototype.load=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=!1);var i=e.length,r=this._comparator;if(n&&m(e,t,0,i-1,r),null===this._root)this._root=h(e,t,0,i),this._size=i;else{var o=A(this.toList(),d(e,t),r);i=this._size+i,this._root=p({head:o},0,i)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return c(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,n){var i=this._comparator,r=a(e,this._root,i),o=r.left,c=r.right;i(e,t)<0?c=s(t,n,c,i):o=s(t,n,o,i),this._root=l(o,c,i)},e.prototype.split=function(e){return a(e,this._root,this._comparator)},e}();function h(e,t,n,r){var o=r-n;if(o>0){var s=n+Math.floor(o/2),a=e[s],l=t[s],c=new i(a,l);return c.left=h(e,t,n,s),c.right=h(e,t,s+1,r),c}return null}function d(e,t){for(var n=new i(null,null),r=n,o=0;o<e.length;o++)r=r.next=new i(e[o],t[o]);return r.next=null,n.next}function f(e){for(var t=e,n=[],r=!1,o=new i(null,null),s=o;!r;)t?(n.push(t),t=t.left):n.length>0?t=(t=s=s.next=n.pop()).right:r=!0;return s.next=null,o.next}function p(e,t,n){var i=n-t;if(i>0){var r=t+Math.floor(i/2),o=p(e,t,r),s=e.head;return s.left=o,e.head=e.head.next,s.right=p(e,r+1,n),s}return null}function A(e,t,n){for(var r=new i(null,null),o=r,s=e,a=t;null!==s&&null!==a;)n(s.key,a.key)<0?(o.next=s,s=s.next):(o.next=a,a=a.next),o=o.next;return null!==s?o.next=s:null!==a&&(o.next=a),r.next}function m(e,t,n,i,r){if(!(n>=i)){for(var o=e[n+i>>1],s=n-1,a=i+1;;){do{s++}while(r(e[s],o)<0);do{a--}while(r(e[a],o)>0);if(s>=a)break;var l=e[s];e[s]=e[a],e[a]=l,l=t[s],t[s]=t[a],t[a]=l}m(e,t,n,a,r),m(e,t,a+1,i,r)}}var g=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},y=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:i,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},_=Number.EPSILON;void 0===_&&(_=Math.pow(2,-52));var v=_*_,b=function(e,t){if(-_<e&&e<_&&-_<t&&t<_)return 0;var n=e-t;return n*n<v*e*t?0:e<t?-1:1},x=function(){function t(){e(this,t),this.reset()}return n(t,[{key:"reset",value:function(){this.xRounder=new w,this.yRounder=new w}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),t}(),w=function(){function t(){e(this,t),this.tree=new u,this.round(0)}return n(t,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===b(t.key,n.key))return this.tree.remove(e),n.key;var i=this.tree.next(t);return null!==i&&0===b(t.key,i.key)?(this.tree.remove(e),i.key):e}}]),t}(),E=new x,S=function(e,t){return e.x*t.y-e.y*t.x},T=function(e,t){return e.x*t.x+e.y*t.y},k=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y},o=S(i,r);return b(o,0)},C=function(e){return Math.sqrt(T(e,e))},P=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return S(r,i)/C(r)/C(i)},M=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return T(r,i)/C(r)/C(i)},I=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},L=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},R=function(e,t,n,i){if(0===t.x)return L(n,i,e.x);if(0===i.x)return L(e,t,n.x);if(0===t.y)return I(n,i,e.y);if(0===i.y)return I(e,t,n.y);var r=S(t,i);if(0==r)return null;var o={x:n.x-e.x,y:n.y-e.y},s=S(o,t)/r,a=S(o,i)/r;return{x:(e.x+a*t.x+(n.x+s*i.x))/2,y:(e.y+a*t.y+(n.y+s*i.y))/2}},z=function(){function t(n,i){e(this,t),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=i}return n(t,null,[{key:"compare",value:function(e,n){var i=t.comparePoints(e.point,n.point);return 0!==i?i:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:O.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),n(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,i=t.length;n<i;n++){var r=t[n];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var i=t+1;i<e;i++){var r=this.point.events[i];void 0===r.consumedBy&&n.otherSE.point.events===r.otherSE.point.events&&n.segment.consume(r.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,i=function(i){var r=i.otherSE;n.set(i,{sine:P(t.point,e.point,r.point),cosine:M(t.point,e.point,r.point)})};return function(e,t){n.has(e)||i(e),n.has(t)||i(t);var r=n.get(e),o=r.sine,s=r.cosine,a=n.get(t),l=a.sine,c=a.cosine;return o>=0&&l>=0?s<c?1:s>c?-1:0:o<0&&l<0?s<c?-1:s>c?1:0:l<o?-1:l>o?1:0}}}]),t}(),D=0,O=function(){function t(n,i,r,o){e(this,t),this.id=++D,this.leftSE=n,n.segment=this,n.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=n,this.rings=r,this.windings=o}return n(t,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,i=t.leftSE.point.x,r=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(r<i)return-1;var s=e.leftSE.point.y,a=t.leftSE.point.y,l=e.rightSE.point.y,c=t.rightSE.point.y;if(n<i){if(a<s&&a<l)return 1;if(a>s&&a>l)return-1;var u=e.comparePoint(t.leftSE.point);if(u<0)return 1;if(u>0)return-1;var h=t.comparePoint(e.rightSE.point);return 0!==h?h:-1}if(n>i){if(s<a&&s<c)return-1;if(s>a&&s>c)return 1;var d=t.comparePoint(e.leftSE.point);if(0!==d)return d;var f=e.comparePoint(t.rightSE.point);return f<0?1:f>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(r<o){var p=t.comparePoint(e.rightSE.point);if(0!==p)return p}if(r>o){var A=e.comparePoint(t.rightSE.point);if(A<0)return 1;if(A>0)return-1}if(r!==o){var m=l-s,g=r-n,y=c-a,_=o-i;if(m>g&&y<_)return 1;if(m<g&&y>_)return-1}return r>o?1:r<o||l<c?-1:l>c?1:e.id<t.id?-1:e.id>t.id?1:0}}]),n(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var r=(e.y-t.y)/i.y,o=t.x+r*i.x;if(e.x===o)return 0;var s=(e.x-t.x)/i.x,a=t.y+s*i.y;return e.y===a?0:e.y<a?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),i=y(t,n);if(null===i)return null;var r=this.leftSE.point,o=this.rightSE.point,s=e.leftSE.point,a=e.rightSE.point,l=g(t,s)&&0===this.comparePoint(s),c=g(n,r)&&0===e.comparePoint(r),u=g(t,a)&&0===this.comparePoint(a),h=g(n,o)&&0===e.comparePoint(o);if(c&&l)return h&&!u?o:!h&&u?a:null;if(c)return u&&r.x===a.x&&r.y===a.y?null:r;if(l)return h&&o.x===s.x&&o.y===s.y?null:s;if(h&&u)return null;if(h)return o;if(u)return a;var d=R(r,this.vector(),s,e.vector());return null===d?null:g(i,d)?E.round(d.x,d.y):null}},{key:"split",value:function(e){var n=[],i=void 0!==e.events,r=new z(e,!0),o=new z(e,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(r);var a=new t(r,s,this.rings.slice(),this.windings.slice());return z.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),z.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(e){for(var n=this,i=e;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var r=t.compare(n,i);if(0!==r){if(r>0){var o=n;n=i,i=o}if(n.prev===i){var s=n;n=i,i=s}for(var a=0,l=i.rings.length;a<l;a++){var c=i.rings[a],u=i.windings[a],h=n.rings.indexOf(c);-1===h?(n.rings.push(c),n.windings.push(u)):n.windings[h]+=u}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys,r=0,o=this.rings.length;r<o;r++){var s=this.rings[r],a=this.windings[r],l=t.indexOf(s);-1===l?(t.push(s),n.push(a)):n[l]+=a}for(var c=[],u=[],h=0,d=t.length;h<d;h++)if(0!==n[h]){var f=t[h],p=f.poly;if(-1===u.indexOf(p))if(f.isExterior)c.push(p);else{-1===u.indexOf(p)&&u.push(p);var A=c.indexOf(f.poly);-1!==A&&c.splice(A,1)}}for(var m=0,g=c.length;m<g;m++){var y=c[m].multiPoly;-1===i.indexOf(y)&&i.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(q.type){case"union":var n=0===e.length,i=0===t.length;this._isInResult=n!==i;break;case"intersection":var r,o;e.length<t.length?(r=e.length,o=t.length):(r=t.length,o=e.length),this._isInResult=o===q.numMultiPolys&&r<o;break;case"xor":var s=Math.abs(e.length-t.length);this._isInResult=s%2==1;break;case"difference":var a=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=a(e)!==a(t);break;default:throw new Error("Unrecognized operation type found ".concat(q.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,i){var r,o,s,a=z.comparePoints(e,n);if(a<0)r=e,o=n,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));r=n,o=e,s=-1}return new t(new z(r,!0),new z(o,!1),[i],[s])}}]),t}(),B=function(){function t(n,i,r){if(e(this,t),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=r,this.segments=[],"number"!=typeof n[0][0]||"number"!=typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=E.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var s=o,a=1,l=n.length;a<l;a++){if("number"!=typeof n[a][0]||"number"!=typeof n[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var c=E.round(n[a][0],n[a][1]);c.x===s.x&&c.y===s.y||(this.segments.push(O.fromRing(s,c,this)),c.x<this.bbox.ll.x&&(this.bbox.ll.x=c.x),c.y<this.bbox.ll.y&&(this.bbox.ll.y=c.y),c.x>this.bbox.ur.x&&(this.bbox.ur.x=c.x),c.y>this.bbox.ur.y&&(this.bbox.ur.y=c.y),s=c)}o.x===s.x&&o.y===s.y||this.segments.push(O.fromRing(s,o,this))}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}]),t}(),F=function(){function t(n,i){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new B(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,o=n.length;r<o;r++){var s=new B(n[r],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=i}return n(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var i=this.interiorRings[t].getSweepEvents(),r=0,o=i.length;r<o;r++)e.push(i[r]);return e}}]),t}(),N=function(){function t(n,i){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof n[0][0][0]&&(n=[n])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,o=n.length;r<o;r++){var s=new F(n[r],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=i}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var i=this.polys[t].getSweepEvents(),r=0,o=i.length;r<o;r++)e.push(i[r]);return e}}]),t}(),U=function(){function t(n){e(this,t),this.events=n;for(var i=0,r=n.length;i<r;i++)n[i].segment.ringOut=this;this.poly=null}return n(t,null,[{key:"factory",value:function(e){for(var n=[],i=0,r=e.length;i<r;i++){var o=e[i];if(o.isInResult()&&!o.ringOut){for(var s=null,a=o.leftSE,l=o.rightSE,c=[a],u=a.point,h=[];s=a,a=l,c.push(a),a.point!==u;)for(;;){var d=a.getAvailableLinkedEvents();if(0===d.length){var f=c[0].point,p=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(p.x,", ").concat(p.y,"]."))}if(1===d.length){l=d[0].otherSE;break}for(var A=null,m=0,g=h.length;m<g;m++)if(h[m].point===a.point){A=m;break}if(null===A){h.push({index:c.length,point:a.point});var y=a.getLeftmostComparator(s);l=d.sort(y)[0].otherSE;break}var _=h.splice(A)[0],v=c.splice(_.index);v.unshift(v[0].otherSE),n.push(new t(v.reverse()))}n.push(new t(c))}}return n}}]),n(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,i=this.events.length-1;n<i;n++){var r=this.events[n].point,o=this.events[n+1].point;0!==k(r,e,o)&&(t.push(r),e=r)}if(1===t.length)return null;var s=t[0],a=t[1];0===k(s,e,a)&&t.shift(),t.push(t[0]);for(var l=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,u=this.isExteriorRing()?t.length:-1,h=[],d=c;d!=u;d+=l)h.push([t[d].x,t[d].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var i=this.events[t];z.compare(e,i)>0&&(e=i)}for(var r=e.segment.prevInResult(),o=r?r.prevInResult():null;;){if(!r)return null;if(!o)return r.ringOut;if(o.ringOut!==r.ringOut)return o.ringOut.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut.enclosingRing();r=o.prevInResult(),o=r?r.prevInResult():null}}}]),t}(),j=function(){function t(n){e(this,t),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var i=this.interiorRings[t].getGeom();null!==i&&e.push(i)}return e}}]),t}(),V=function(){function t(n){e(this,t),this.rings=n,this.polys=this._composePolys(n)}return n(t,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var i=this.polys[t].getGeom();null!==i&&e.push(i)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];if(!r.poly)if(r.isExteriorRing())t.push(new j(r));else{var o=r.enclosingRing();o.poly||t.push(new j(o)),o.poly.addInterior(r)}}return t}}]),t}(),G=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O.compare;e(this,t),this.queue=n,this.tree=new u(i),this.segments=[]}return n(t,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var i=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!i)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var r=i,o=i,s=void 0,a=void 0;void 0===s;)null===(r=this.tree.prev(r))?s=null:void 0===r.key.consumedBy&&(s=r.key);for(;void 0===a;)null===(o=this.tree.next(o))?a=null:void 0===o.key.consumedBy&&(a=o.key);if(e.isLeft){var l=null;if(s){var c=s.getIntersection(t);if(null!==c&&(t.isAnEndpoint(c)||(l=c),!s.isAnEndpoint(c)))for(var u=this._splitSafely(s,c),h=0,d=u.length;h<d;h++)n.push(u[h])}var f=null;if(a){var p=a.getIntersection(t);if(null!==p&&(t.isAnEndpoint(p)||(f=p),!a.isAnEndpoint(p)))for(var A=this._splitSafely(a,p),m=0,g=A.length;m<g;m++)n.push(A[m])}if(null!==l||null!==f){var y=null;y=null===l?f:null===f||z.comparePoints(l,f)<=0?l:f,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(y),v=0,b=_.length;v<b;v++)n.push(_[v])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&a){var x=s.getIntersection(a);if(null!==x){if(!s.isAnEndpoint(x))for(var w=this._splitSafely(s,x),E=0,S=w.length;E<S;E++)n.push(w[E]);if(!a.isAnEndpoint(x))for(var T=this._splitSafely(a,x),k=0,C=T.length;k<C;k++)n.push(T[k])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var i=e.split(t);return i.push(n),void 0===e.consumedBy&&this.tree.insert(e),i}}]),t}(),W="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,$="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,q=new(function(){function t(){e(this,t)}return n(t,[{key:"run",value:function(e,t,n){q.type=e,E.reset();for(var i=[new N(t,!0)],r=0,o=n.length;r<o;r++)i.push(new N(n[r],!1));if(q.numMultiPolys=i.length,"difference"===q.type)for(var s=i[0],a=1;a<i.length;)null!==y(i[a].bbox,s.bbox)?a++:i.splice(a,1);if("intersection"===q.type)for(var l=0,c=i.length;l<c;l++)for(var h=i[l],d=l+1,f=i.length;d<f;d++)if(null===y(h.bbox,i[d].bbox))return[];for(var p=new u(z.compare),A=0,m=i.length;A<m;A++)for(var g=i[A].getSweepEvents(),_=0,v=g.length;_<v;_++)if(p.insert(g[_]),p.size>W)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new G(p),x=p.size,w=p.pop();w;){var S=w.key;if(p.size===x){var T=S.segment;throw new Error("Unable to pop() ".concat(S.isLeft?"left":"right"," SweepEvent ")+"[".concat(S.point.x,", ").concat(S.point.y,"] from segment #").concat(T.id," ")+"[".concat(T.leftSE.point.x,", ").concat(T.leftSE.point.y,"] -> ")+"[".concat(T.rightSE.point.x,", ").concat(T.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(p.size>W)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>$)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var k=b.process(S),C=0,P=k.length;C<P;C++){var M=k[C];void 0===M.consumedBy&&p.insert(M)}x=p.size,w=p.pop()}E.reset();var I=U.factory(b.segments);return new V(I).getGeom()}}]),t}()),Z=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return q.run("union",e,n)},H=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return q.run("intersection",e,n)},Q=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return q.run("xor",e,n)},X=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return q.run("difference",e,n)};return{union:Z,intersection:H,xor:Q,difference:X}}()}(Sv);var Tv=Sv.exports;function kv(e,t){var n=wv(e),i=wv(t),r=e.properties||{},o=Tv.difference(n.coordinates,i.coordinates);return 0===o.length?null:1===o.length?_v(o[0],r):function(e,t,n){return void 0===n&&(n={}),yv({type:"MultiPolygon",coordinates:e},t,n)}(o,r)}const Cv=new wd({color:[255,255,255],intensity:1}),Pv=new NA({color:[255,255,255],intensity:.8,position:[-.144528,49.739968,8e4]}),Mv=new NA({color:[255,255,255],intensity:.8,position:[-3.807751,54.104682,8e3]});new Od({ambientLight:Cv,pointLight1:Pv,pointLight2:Mv});const Iv={ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},Lv={latitude:52.459028,longitude:13.015833,zoom:7,minZoom:6,maxZoom:14,pitch:0,bearing:0};function Rv({object:e}){return e?`    ${Math.round(e.val).toString()} %`:null}function zv({data:e,maskData:n,childMaskData:i,parent:r,show3D:o,resolution:s,mapStyle:a="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",radius:c=1e3,upperPercentile:u=100,coverage:h=1}){const[d,f]=t.exports.useState(Lv.zoom),[p,A]=t.exports.useState(Lv),m=e=>{const t=function(e,t){void 0===t&&(t={});var n=Number(e[0]),i=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[n,i];return _v([[s,[r,i],[r,o],[n,o],s]],t.properties,{bbox:e,id:t.id})}([-180,-85,180,85]);return kv(t,e)},g=[new $_({data:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],maxRequests:20,pickable:!1,tileSize:256,zoomOffset:1===devicePixelRatio?-1:0,renderSubLayers:e=>{const{bbox:{west:t,south:n,east:i,north:r}}=e.tile;return[new XA(e,{data:null,image:e.data,bounds:[t,n,i,r]})]}}),new _y({id:"mask-layer-0_8",data:m(n),getFillColor:[255,255,255,255],stroked:!1,extruded:!1,wireframe:!0,lineJointRounded:!0})];i&&g.push(new _y({id:"child-mask-layer-0_8",data:m(i),getFillColor:[255,255,255,150],stroked:!1,extruded:!1,wireframe:!0,lineJointRounded:!0})),g.push(new gv({id:"",data:e,pickable:!0,wireframe:!1,filled:!0,extruded:!0,elevationScale:25,coverage:.9,visible:!0,getHexagon:e=>e.hex||e.hex10,getFillColor:e=>[e.val/100*157,255*(1-e.val/100),157,150],getElevation:e=>o?e.val:0,updateTriggers:{getElevation:[o]},material:Iv,transitions:{elevationScale:3e3}}));return t.exports.useEffect((()=>{if(i){var e=Ev(i);A({longitude:e.geometry.coordinates[0],latitude:e.geometry.coordinates[1],zoom:8==s?7:9==s?9:10,pitch:0,bearing:0,transitionDuration:1e3,transitionInterpolator:new VA})}}),[i]),l.createElement(Cy,{layers:g,initialViewState:p,controller:!0,onViewStateChange:e=>{var t=xv(n);return e.viewState.latitude>t[3]?e.viewState.latitude=t[3]:e.viewState.latitude<t[1]&&(e.viewState.latitude=t[1]),e.viewState.longitude>t[2]?e.viewState.longitude=t[2]:e.viewState.longitude<t[0]&&(e.viewState.longitude=t[0]),e.viewState.bearing=0,r(e),e.viewState},onDragEnd:(e,t)=>{e.viewport&&f(e.viewport.zoom)},getTooltip:Rv})}var Dv=[{id:1,name:"Gadow",obf:1},{id:2,name:"Waldsieversdorf",obf:10},{id:3,name:"Rathenow",obf:11},{id:4,name:"Brieselang",obf:12},{id:5,name:"Lehnin",obf:13},{id:6,name:"Potsdam",obf:15},{id:7,name:"Wünsdorf",obf:16},{id:8,name:"Baruth",obf:17},{id:9,name:"Jüterbog",obf:18},{id:10,name:"Königs Wusterhausen",obf:19},{id:11,name:"Bad Wilsnack",obf:2},{id:12,name:"Luckau",obf:20},{id:13,name:"Lieberose",obf:21},{id:14,name:"Erkner",obf:22},{id:15,name:"Briesen",obf:23},{id:16,name:"Siehdichum",obf:24},{id:17,name:"Herzberg",obf:25},{id:18,name:"Hohenleipisch",obf:26},{id:19,name:"Calau",obf:27},{id:20,name:"Senftenberg",obf:28},{id:21,name:"Cottbus",obf:29},{id:22,name:"Neustadt",obf:3},{id:23,name:"Drebkau",obf:30},{id:24,name:"Neuruppin",obf:4},{id:25,name:"Neuendorf",obf:5},{id:26,name:"Boitzenburg",obf:6},{id:27,name:"Milmersdorf",obf:7},{id:28,name:"Eberswalde",obf:8},{id:29,name:"Strausberg",obf:9},{id:30,name:"Dippmannsdorf",obf:14}],Ov=[{id:1,name:"Wittenberge",obf:1},{id:2,name:"Dobberzin",obf:1},{id:3,name:"Birkholz",obf:1},{id:4,name:"Karstädt",obf:1},{id:5,name:"Groß Linde",obf:1},{id:6,name:"Putlitz",obf:1},{id:7,name:"Lenzen",obf:1},{id:8,name:"Falkenhagen",obf:10},{id:9,name:"Rehfelde",obf:10},{id:10,name:"Buckow",obf:10},{id:11,name:"Neuhardenberg",obf:10},{id:12,name:"Diedersdorf",obf:10},{id:13,name:"Hermersdorf",obf:10},{id:14,name:"Rhinow",obf:11},{id:15,name:"Rathenow",obf:11},{id:16,name:"Nennhausen",obf:11},{id:17,name:"Kater",obf:11},{id:18,name:"Premnitz",obf:11},{id:19,name:"Klein Behnitz",obf:12},{id:20,name:"Friesack",obf:12},{id:21,name:"Falkensee",obf:12},{id:22,name:"Haage",obf:12},{id:23,name:"Schönwalde-Glien",obf:12},{id:24,name:"Werbig",obf:13},{id:25,name:"Brandenburg",obf:13},{id:26,name:"Wusterwitz",obf:13},{id:27,name:"Görzke",obf:13},{id:28,name:"Golzow",obf:13},{id:29,name:"Lehnin",obf:13},{id:30,name:"Groß Kreutz",obf:13},{id:31,name:"Päwesin",obf:13},{id:32,name:"Ziesar",obf:13},{id:33,name:"Mahlsdorf",obf:14},{id:34,name:"Grabow",obf:14},{id:35,name:"Marzahna",obf:14},{id:36,name:"Treuenbrietzen",obf:14},{id:37,name:"Niemegk",obf:14},{id:38,name:"Brück",obf:14},{id:39,name:"Wiesenburg",obf:14},{id:40,name:"Hagelberg",obf:14},{id:41,name:"Beelitz",obf:15},{id:42,name:"Potsdam",obf:15},{id:43,name:"Güterfelde",obf:15},{id:44,name:"Michendorf",obf:15},{id:45,name:"Borkwalde",obf:15},{id:46,name:"Ferch",obf:15},{id:47,name:"Großbeeren",obf:16},{id:48,name:"Ludwigsfelde",obf:16},{id:49,name:"Trebbin",obf:16},{id:50,name:"Zossen",obf:16},{id:51,name:"Sperenberg",obf:16},{id:52,name:"Wunder",obf:17},{id:53,name:"Merzdorf",obf:17},{id:54,name:"Stülpe",obf:17},{id:55,name:"Luckenwalde",obf:17},{id:56,name:"Märtensmühle",obf:17},{id:57,name:"Kemnitz",obf:17},{id:58,name:"Glashütte",obf:17},{id:59,name:"Malterhausen",obf:18},{id:60,name:"Jüterbog",obf:18},{id:61,name:"Keilberg",obf:18},{id:62,name:"Welsickendorf",obf:18},{id:63,name:"Riesdorfer Heide",obf:18},{id:64,name:"Hohenseefeld",obf:18},{id:65,name:"Görsdorf",obf:18},{id:66,name:"Dahme",obf:18},{id:67,name:"Mittenwalde",obf:19},{id:68,name:"Königs Wusterhausen",obf:19},{id:69,name:"Halbe",obf:19},{id:70,name:"Teupitz",obf:19},{id:71,name:"Schönefeld",obf:19},{id:72,name:"Heidesee",obf:19},{id:73,name:"Plattenburg",obf:2},{id:74,name:"Meyenburg",obf:2},{id:75,name:"Langnow",obf:2},{id:76,name:"Groß Pankow",obf:2},{id:77,name:"Karthan",obf:2},{id:78,name:"Stepenitz",obf:2},{id:79,name:"Glöwen",obf:2},{id:80,name:"Gumtow",obf:2},{id:81,name:"Lübben",obf:20},{id:82,name:"Luckau",obf:20},{id:83,name:"Walddrehna",obf:20},{id:84,name:"Paserin",obf:20},{id:85,name:"Schönwalde",obf:20},{id:86,name:"Golßen",obf:20},{id:87,name:"Krausnick",obf:20},{id:88,name:"Kasel-Golzig",obf:20},{id:89,name:"Wittmannsdorf",obf:21},{id:90,name:"Mochow",obf:21},{id:91,name:"Lieberose",obf:21},{id:92,name:"Ullersdorf",obf:21},{id:93,name:"Goyatz",obf:21},{id:94,name:"Marienberg",obf:21},{id:95,name:"Straupitz",obf:21},{id:96,name:"Storkow",obf:22},{id:97,name:"Scharmützelsee",obf:22},{id:98,name:"Spreenhagen",obf:22},{id:99,name:"Fürstenwalde",obf:22},{id:100,name:"Grünheide",obf:22},{id:101,name:"Kersdorf",obf:23},{id:102,name:"Steinhöfel",obf:23},{id:103,name:"Neubrück",obf:23},{id:104,name:"Wilmersdorf",obf:23},{id:105,name:"Lindenberg",obf:23},{id:106,name:"Friedland",obf:23},{id:107,name:"Groß Muckrow",obf:23},{id:108,name:"Beeskow",obf:23},{id:109,name:"Eisenhüttenstadt",obf:24},{id:110,name:"Müllrose",obf:24},{id:111,name:"Fünfeichen",obf:24},{id:112,name:"Frankfurt Oder",obf:24},{id:113,name:"Treppeln",obf:24},{id:114,name:"Neuzelle",obf:24},{id:115,name:"Dammendorf",obf:24},{id:116,name:"Schlieben",obf:25},{id:117,name:"Uebigau",obf:25},{id:118,name:"Doberlug",obf:25},{id:119,name:"Buchhain",obf:25},{id:120,name:"Hohenbucko",obf:25},{id:121,name:"Falkenberg",obf:25},{id:122,name:"Schönewalde",obf:25},{id:123,name:"Herzberg",obf:25},{id:124,name:"Sallgast",obf:26},{id:125,name:"Elsterwerda",obf:26},{id:126,name:"Gorden",obf:26},{id:127,name:"Schönborn",obf:26},{id:128,name:"Babben",obf:26},{id:129,name:"Rehain",obf:26},{id:130,name:"Sonnewalde",obf:26},{id:131,name:"Finsterwalde",obf:26},{id:132,name:"Lübbenau",obf:27},{id:133,name:"Zinnitz",obf:27},{id:134,name:"Vetschau",obf:27},{id:135,name:"Gollmitz",obf:27},{id:136,name:"Calau",obf:27},{id:137,name:"Lipten",obf:27},{id:138,name:"Neupetershain",obf:27},{id:139,name:"Guteborn",obf:28},{id:140,name:"Senftenberg",obf:28},{id:141,name:"Schwarzheide",obf:28},{id:142,name:"Lauchhammer",obf:28},{id:143,name:"Großräschen",obf:28},{id:144,name:"Hermsdorf",obf:28},{id:145,name:"Jänschwalde",obf:29},{id:146,name:"Pinnow",obf:29},{id:147,name:"Peitz",obf:29},{id:148,name:"Cottbus",obf:29},{id:149,name:"Burg",obf:29},{id:150,name:"Guben",obf:29},{id:151,name:"Dossow",obf:3},{id:152,name:"Heiligengrabe",obf:3},{id:153,name:"Berlinchen",obf:3},{id:154,name:"Königsberg",obf:3},{id:155,name:"Stolpe",obf:3},{id:156,name:"Lüttgen Dreetz",obf:3},{id:157,name:"Tramnitz",obf:3},{id:158,name:"Forst",obf:30},{id:159,name:"Drebkau",obf:30},{id:160,name:"Neuhausen",obf:30},{id:161,name:"Spremberg",obf:30},{id:162,name:"Felixsee",obf:30},{id:163,name:"Döbern",obf:30},{id:164,name:"Trebendorf",obf:30},{id:165,name:"Fehrbellin",obf:4},{id:166,name:"Lindow",obf:4},{id:167,name:"Neuruppin",obf:4},{id:168,name:"Temnitz",obf:4},{id:169,name:"Rheinsberg",obf:4},{id:170,name:"Zehdenick",obf:5},{id:171,name:"Fürstenberg/Havel",obf:5},{id:172,name:"Stechlin",obf:5},{id:173,name:"Gransee",obf:5},{id:174,name:"Teschendorf",obf:5},{id:175,name:"Oranienburg",obf:5},{id:176,name:"Mühlenbeck",obf:5},{id:177,name:"Löwenberg",obf:5},{id:178,name:"Oberkrämer",obf:5},{id:179,name:"Schönermark",obf:6},{id:180,name:"Bebersee",obf:6},{id:181,name:"Werderhof",obf:6},{id:182,name:"Alt Placht",obf:6},{id:183,name:"Leistenbrück",obf:6},{id:184,name:"Brüsenwalde",obf:6},{id:185,name:"Große Heide",obf:6},{id:186,name:"Gartz",obf:7},{id:187,name:"Randowbruch",obf:7},{id:188,name:"Greiffenberg",obf:7},{id:189,name:"Angermünde",obf:7},{id:190,name:"Berkholz",obf:7},{id:191,name:"Passow",obf:7},{id:192,name:"Eberswalde",obf:8},{id:193,name:"Bernau",obf:8},{id:194,name:"Schorfheide",obf:8},{id:195,name:"Joachimsthal",obf:8},{id:196,name:"Oderberg",obf:8},{id:197,name:"Werneuchen",obf:8},{id:198,name:"Wandlitz",obf:8},{id:199,name:"Tornow",obf:8},{id:200,name:"Biesenthal",obf:8},{id:201,name:"Neuenhagen",obf:9},{id:202,name:"Strausberg",obf:9},{id:203,name:"Prötzel",obf:9},{id:204,name:"Brunow",obf:9},{id:205,name:"Wriezen",obf:9},{id:206,name:"Freienwalde",obf:9},{id:207,name:"Marzehns",obf:14},{id:208,name:"Groß Kölpin",obf:7}];return"serviceWorker"in navigator&&window.addEventListener("load",(function(){})),class{constructor(e={}){this.selectedObf=null,this.selectedRevier=null,this.dataObj=e,this.views={},this.currentView=null,this.dataValid={geoData:!1,data:!0},this.currentLayerKey=null,this.currentViewKey="",this.selectedYear="2021",this.selectedLayer="ivus_verbiss",this.selectedResolution=8,this.areaId=null,this.is3D=!1,this.currentArea={8:"undefined",9:null,10:null}}toOverview(e){this.dataObj=e||this.dataObj,this.dataObj.polygons||console.error("polygons attribute is not defined"),this.dataObj.mask&&this.getMaskLayer(this.dataObj.mask,0,8),this.selectedResolution=8,this.currentArea[this.selectedResolution]="undefined",this.getH3Layer("./interpolation/"+this.selectedYear+"/"+this.selectedLayer+"/"+this.selectedResolution+"/fid_"+this.currentArea[this.selectedResolution]+"_"+this.selectedResolution+".json","global",this.selectedResolution)}changeYear(e){this.selectedYear!=newYear&&(this.selectedYear=e)}changeLayer(e){this.selectedLayer!=e&&(this.selectedLayer=e,this.getH3Layer("./interpolation/"+this.selectedYear+"/"+this.selectedLayer+"/"+this.selectedResolution+"/fid_"+this.currentArea[this.selectedResolution]+"_"+this.selectedResolution+".json","global",this.selectedResolution))}createObfDropdown(e,t){const n=this,i=document.createElement("SELECT");let r=document.createElement("OPTION");r.innerText="wählen ...",r.setAttribute("value",0),i.append(r);for(var o=0;o<Dv.length;o++){let e=document.createElement("OPTION");e.innerText=Dv[o].name,e.setAttribute("value",Dv[o].id),i.append(e)}document.getElementById(e).append(i),i.addEventListener("change",(e=>{const i=e.target.options[e.target.selectedIndex].value;if(0!==i){n.focusLand(i);var r=Dv.filter((e=>e.id===parseInt(i)));0!==r.length&&n.createRevierDropdown(t,parseInt(r[0].obf))}}))}createRevierDropdown(e,t){const n=Ov.filter((e=>e.obf===t)),i=this,r=document.createElement("SELECT");let o=document.createElement("OPTION");o.innerText="wählen ...",o.setAttribute("value",0),r.append(o);for(var s=0;s<n.length;s++){let e=document.createElement("OPTION");e.innerText=n[s].name,e.setAttribute("value",n[s].id),r.append(e)}document.getElementById(e).innerHTML="",document.getElementById(e).append(r),r.addEventListener("change",(e=>{var t=e.target.options[e.target.selectedIndex].value;0!==t&&i.focusObf(t)}))}addJsonLayer(e){this._loadJson(e).then((e=>{}))}getMaskLayer(e,t,n){this._loadJson(e).then((e=>{8==n?this.maskLayer=e.features[0]:(this.focus=this.childMaskLayer!==e.features[0],this.childMaskLayer=e.features[0]),this.refreshReact()}))}getH3Layer(e,t,n){this._loadJson(e).then((e=>{this.h3Layer=e,this.refreshReact()})).catch((e=>{console.log(e)}))}changeView(e){this.is3D!==e.viewState.pitch>0&&(this.is3D=e.viewState.pitch>0,this.refreshReact())}refreshReact(){var e=this;A.render(l.createElement(zv,{data:this.h3Layer,maskData:this.maskLayer,childMaskData:this.childMaskLayer,parent:function(t){e.changeView(t)},show3D:this.is3D,resolution:this.selectedResolution}),document.getElementById("react-gl"))}addView(e,t){this.views[e]=t}focusLand(e,t){0==e?this.selectedResolution=8:(this.selectedResolution=9,this.currentArea[9]=e,this.areaId=e),this.getH3Layer("./interpolation/"+this.selectedYear+"/"+this.selectedLayer+"/"+this.selectedResolution+"/fid_"+this.currentArea[this.selectedResolution]+"_"+this.selectedResolution+".json",this.currentArea[this.selectedResolution],this.selectedResolution),9==this.selectedResolution&&this.getMaskLayer("./geo/obf/"+this.currentArea[this.selectedResolution]+".geojson",this.currentArea[this.selectedResolution],this.selectedResolution)}focusObf(e,t){if(console.log(e),0==e){this.selectedResolution=9;var n="obf"}else{this.selectedResolution=10,this.currentArea[10]=e,this.areaId=e;n="reviere"}this.getH3Layer("./interpolation/"+this.selectedYear+"/"+this.selectedLayer+"/"+this.selectedResolution+"/fid_"+this.currentArea[this.selectedResolution]+"_"+this.selectedResolution+".json",this.currentArea[this.selectedResolution],this.selectedResolution),this.getMaskLayer("./geo/"+n+"/"+this.currentArea[this.selectedResolution]+".geojson",this.currentArea[this.selectedResolution],this.selectedResolution)}addMap(e){this.toOverview()}async _loadJson(e){return(await fetch(e,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}})).json()}}}));
//# sourceMappingURL=bundle.iife.js.map
